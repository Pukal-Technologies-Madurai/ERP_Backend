"use strict";(self.webpackChunkerp=self.webpackChunkerp||[]).push([[6430],{16430:(e,t,l)=>{l.r(t),l.d(t,{default:()=>E});var o=l(89379),a=l(65043),d=l(12110),s=l(11906),n=l(26494),r=l(17392),i=l(91036),c=l(97707),u=l(70141),v=l(44676),m=l(83560),_=l(51387),I=l(65074),p=l(48471),h=l(14844),x=l(73216),b=l(97280),A=l(63406),g=l(20656),y=l(70579);const j=e=>{let{StaffArray:t=[],setStaffArray:l,costCenter:a=[],costCategory:d=[]}=e;return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)("div",{className:"d-flex align-items-center flex-wrap mb-2 border-bottom pb-2",children:[(0,y.jsx)("h6",{className:"flex-grow-1 m-0",children:"Staff Involved"}),(0,y.jsx)(s.A,{variant:"outlined",color:"primary",type:"button",onClick:()=>l(e=>[...e,(0,o.A)({},b.Ud)]),children:"Add"})]}),(0,y.jsxs)("table",{className:"table table-bordered",children:[(0,y.jsx)("thead",{children:(0,y.jsxs)("tr",{children:[(0,y.jsx)("th",{className:"fa-13",children:"Sno"}),(0,y.jsx)("th",{className:"fa-13",children:"Staff Name"}),(0,y.jsx)("th",{className:"fa-13",children:"Category"}),(0,y.jsx)("th",{className:"fa-13",children:"#"})]})}),(0,y.jsx)("tbody",{children:(0,c.$r)(t).map((e,s)=>(0,y.jsxs)("tr",{children:[(0,y.jsx)("td",{className:"fa-13 vctr text-center",children:s+1}),(0,y.jsx)("td",{className:"fa-13 w-100 p-0",children:(0,y.jsx)(g.Ay,{value:{value:null===e||void 0===e?void 0:e.Emp_Id,label:null===e||void 0===e?void 0:e.Emp_Name},onChange:e=>l(t=>t.map((t,l)=>{if((0,c.id)(l,s)){const l=(0,c.$r)(a).find(t=>(0,c.id)(null===t||void 0===t?void 0:t.Cost_Center_Id,e.value));return(0,o.A)((0,o.A)({},t),{},{Emp_Type_Id:(0,c.IQ)(null===t||void 0===t?void 0:t.Emp_Type_Id)?Number(null===t||void 0===t?void 0:t.Emp_Type_Id):(0,c.IQ)(l.User_Type)?Number(l.User_Type):0,Emp_Id:Number(e.value),Emp_Name:e.label})}return t})),options:[...(0,c.$r)(a).filter(e=>!t.some(t=>(0,c.id)(t.Emp_Id,e.Cost_Center_Id)))].map(e=>({value:e.Cost_Center_Id,label:e.Cost_Center_Name})),styles:A.MR,isSearchable:!0,placeholder:"Select Staff",filterOption:c.GI})}),(0,y.jsx)("td",{className:"fa-13 vctr p-0",style:{maxWidth:"130px",minWidth:"100px"},children:(0,y.jsxs)("select",{value:null===e||void 0===e?void 0:e.Emp_Type_Id,onChange:e=>l(t=>t.map((t,l)=>(0,c.id)(l,s)?(0,o.A)((0,o.A)({},t),{},{Emp_Type_Id:e.target.value}):t)),className:"cus-inpt p-2 border-0",children:[(0,y.jsx)("option",{value:"",children:"Select"}),(0,c.$r)(d).map((e,t)=>(0,y.jsx)("option",{value:null===e||void 0===e?void 0:e.Cost_Category_Id,children:null===e||void 0===e?void 0:e.Cost_Category},t))]})}),(0,y.jsx)("td",{className:"fa-13 vctr p-0",children:(0,y.jsx)(r.A,{onClick:()=>{l(e=>e.filter((e,t)=>s!==t))},size:"small",children:(0,y.jsx)(_.A,{color:"error"})})})]},s))})]})]})};var f=l(38641),N=l(24651),S=l(34104),C=l(35786),w=l(83462),G=l(26600),B=l(35316),D=l(29347),Q=l(34496),T=l(14792);const P=(e,t,l)=>{var o;const a=null===(o=(0,c.$r)(l).find(l=>(0,c.id)(null===l||void 0===l?void 0:l.Product_Id,e)&&(0,c.id)(null===l||void 0===l?void 0:l.Godown_Id,t)))||void 0===o?void 0:o.Act_Bal_Qty;return(0,c.Ro)(a)},O=e=>{var t,l;let{children:d,orderProducts:n=[],setOrderProducts:r,open:u=!1,onClose:v,products:m=[],brands:_=[],uom:p=[],godowns:x=[],GST_Inclusive:b,IS_IGST:j,editValues:f=null,initialValue:N={},batchDetails:S=[]}=e;const[C,O]=(0,a.useState)(N),R=(0,c.id)(b,1),E=(0,c.id)(b,2),[k,z]=(0,a.useState)([]);(0,a.useEffect)(()=>{(0,c.aF)(f)&&u&&O(e=>Object.fromEntries(Object.entries(e).map(e=>{let[t,l]=e;return[t,f[t]?f[t]:l]})))},[f]);const L=e=>{var t;return null!==(t=null===m||void 0===m?void 0:m.find(t=>(0,c.id)(null===t||void 0===t?void 0:t.Product_Id,e)))&&void 0!==t?t:{}},U=()=>{O(N),v()};return(0,a.useEffect)(()=>{z([]),(0,c.IQ)(C.Item_Id)&&!(0,c.id)(C.Item_Id,0)&&(0,I.z)({address:"sales/stockInGodown?Item_Id=".concat(C.Item_Id)}).then(e=>{const t=(e.success?e.data:[]).sort((e,t)=>String(null===e||void 0===e?void 0:e.stock_item_name).localeCompare(null===t||void 0===t?void 0:t.stock_item_name));z(t)})},[C.Item_Id]),(0,y.jsxs)(y.Fragment,{children:[d,(0,y.jsxs)(w.A,{open:u,onClose:U,maxWidth:"md",fullWidth:!0,children:[(0,y.jsx)(G.A,{className:"border-bottom",children:(0,y.jsx)("span",{children:"Add Products Details"})}),(0,y.jsxs)("form",{onSubmit:e=>{e.preventDefault(),C.Item_Id?(r(e=>[...e.filter(e=>!(0,c.id)(e.Item_Id,C.Item_Id)),Object.fromEntries(Object.entries(N).map(e=>{let[t,l]=e;const o=L(C.Item_Id),a=j?o.Igst_P:o.Gst_P,d=a>0,{Bill_Qty:s,Item_Rate:n,Amount:r}=C,i=E?"zerotax":R?"remove":"add",c=(0,h.v)(n,a,i),u=(0,h.v)(r,a,i),v=j?0:u.cgst_per,m=j?u.igst_per:0,_=j?0:u.cgst_amount,I=j?u.igst_amount:0;switch(t){case"Item_Name":return[t,o.Product_Name];case"Taxable_Rate":return[t,c.base_amount];case"Total_Qty":return[t,s];case"Taxble":return[t,d?1:0];case"Taxable_Amount":return[t,u.base_amount];case"Tax_Rate":return[t,a];case"Cgst":case"Sgst":return[t,null!==v&&void 0!==v?v:0];case"Cgst_Amo":case"Sgst_Amo":return[t,E?0:_];case"Igst":return[t,null!==m&&void 0!==m?m:0];case"Igst_Amo":return[t,E?0:I];case"Final_Amo":return[t,u.with_tax];default:return[t,C[t]||l]}}))]),U()):i.oR.warn("Select Product")},children:[(0,y.jsx)(B.A,{children:(0,y.jsxs)("div",{className:"row pb-5",children:[(0,y.jsxs)("div",{className:"col-6 p-2",children:[(0,y.jsx)("label",{children:"Brand"}),(0,y.jsx)(g.Ay,{value:{value:C.BrandID,label:C.Brand},onChange:e=>O(t=>(0,o.A)((0,o.A)({},t),{},{BrandID:e.value,Brand:e.label})),options:[{value:"",label:"select",isDisabled:!0},..._.map(e=>({value:null===e||void 0===e?void 0:e.Brand,label:null===e||void 0===e?void 0:e.Brand_Name}))],styles:A.MR,menuPortalTarget:document.body,isSearchable:!0,placeholder:"Select Brand",maxMenuHeight:200,filterOption:c.GI})]}),(0,y.jsxs)("div",{className:"col-6 p-2",children:[(0,y.jsx)("label",{children:"Group"}),(0,y.jsx)(g.Ay,{value:{value:C.GroupID,label:C.Group},onChange:e=>O(t=>(0,o.A)((0,o.A)({},t),{},{GroupID:e.value,Group:e.label})),options:[{value:"",label:"select",isDisabled:!0},...m.filter(e=>!C.BrandID||(0,c.id)(e.Brand,C.BrandID)).reduce((e,t)=>(e.some(e=>e.value===t.Product_Group)||e.push({value:t.Product_Group,label:t.Pro_Group}),e),[])],styles:A.MR,menuPortalTarget:document.body,isSearchable:!0,placeholder:"Select Group",maxMenuHeight:200,filterOption:c.GI})]}),(0,y.jsxs)("div",{className:Object.hasOwn(C,"GoDown_Id")?"col-md-8 p-2":"col-12 p-2",children:[(0,y.jsxs)("label",{children:["Item Name ",(0,y.jsx)(T.A,{})]}),(0,y.jsx)(g.Ay,{value:{value:C.Item_Id,label:null===(t=L(C.Item_Id))||void 0===t?void 0:t.Product_Name},isDisabled:(0,c.IQ)(C.Pre_Id),menuPortalTarget:document.body,onChange:e=>{const t=L(e.value);O(l=>{var a,d,s,n,r,i,c;return(0,o.A)((0,o.A)({},l),{},{Group:null!==(a=t.Pro_Group)&&void 0!==a?a:l.Group,GroupID:null!==(d=t.Product_Group)&&void 0!==d?d:l.GroupID,Brand:null!==(s=t.Brand_Name)&&void 0!==s?s:l.Brand,BrandID:null!==(n=t.Brand)&&void 0!==n?n:l.BrandID,Item_Id:e.value,Item_Rate:null!==(r=t.Item_Rate)&&void 0!==r?r:0,GoDown_Id:"",Bill_Qty:0,Amount:0,Unit_Id:null!==(i=t.UOM_Id)&&void 0!==i?i:l.Unit_Id,Unit_Name:null!==(c=t.Units)&&void 0!==c?c:l.Unit_Name,HSN_Code:null===t||void 0===t?void 0:t.HSN_Code})})},options:[{value:"",label:"select",isDisabled:!0},...[...m.filter(e=>!C.BrandID||(0,c.id)(e.Brand,C.BrandID)).filter(e=>!C.GroupID||(0,c.id)(e.Product_Group,C.GroupID))].map(e=>({value:null===e||void 0===e?void 0:e.Product_Id,label:null===e||void 0===e?void 0:e.Product_Name,isDisabled:-1!==n.findIndex(t=>(0,c.id)(null===t||void 0===t?void 0:t.Item_Id,null===e||void 0===e?void 0:e.Product_Id))}))],styles:A.MR,isSearchable:!0,required:!0,placeholder:"Select Product",maxMenuHeight:200,filterOption:c.GI})]}),Object.hasOwn(C,"GoDown_Id")&&(0,y.jsxs)("div",{className:"col-md-4 p-2",children:[(0,y.jsx)("label",{children:"Godown"}),(0,y.jsx)(g.Ay,{value:{value:null===C||void 0===C?void 0:C.GoDown_Id,label:(null===(l=x.find(e=>(0,c.id)(e.Godown_Id,null===C||void 0===C?void 0:C.GoDown_Id)))||void 0===l?void 0:l.Godown_Name)||""},onChange:e=>O(t=>(0,o.A)((0,o.A)({},t),{},{GoDown_Id:e.value})),options:[{value:"",label:"select",isDisabled:!0},...(0,c.$r)(x).map(e=>({value:null===e||void 0===e?void 0:e.Godown_Id,label:"".concat(null===e||void 0===e?void 0:e.Godown_Name).concat((0,c.IQ)(null===e||void 0===e?void 0:e.Godown_Id)?" (Bal: ".concat(P(C.Item_Id,null===e||void 0===e?void 0:e.Godown_Id,k),")"):"")}))],styles:A.MR,isDisabled:!(0,c.IQ)(null===C||void 0===C?void 0:C.Item_Id),menuPortalTarget:document.body,isSearchable:!0,placeholder:"Select Godown",filterOption:c.GI})]}),(0,y.jsxs)("div",{className:"col-lg-4 col-md-6 p-2",children:[(0,y.jsxs)("label",{children:["Quantity ",(0,y.jsx)(T.A,{})]}),(0,y.jsx)("input",{required:!0,value:C.Bill_Qty?C.Bill_Qty:"",onInput:c.BE,disabled:!(0,c.IQ)(C.Item_Id),onChange:e=>{C.Item_Rate?O(t=>(0,o.A)((0,o.A)({},t),{},{Amount:(0,c.JH)(C.Item_Rate,e.target.value),Bill_Qty:e.target.value})):C.Amount?O(t=>(0,o.A)((0,o.A)({},t),{},{Item_Rate:(0,c.SX)(t.Amount,e.target.value),Bill_Qty:e.target.value})):O(t=>(0,o.A)((0,o.A)({},t),{},{Bill_Qty:e.target.value}))},className:"cus-inpt",min:1})]}),Object.hasOwn(C,"Act_Qty")&&(0,y.jsxs)("div",{className:"col-lg-4 col-md-6 p-2",children:[(0,y.jsx)("label",{children:"Actual Quantity "}),(0,y.jsx)("input",{value:C.Act_Qty?C.Act_Qty:"",onInput:c.BE,disabled:!(0,c.IQ)(C.Item_Id),onChange:e=>O(t=>(0,o.A)((0,o.A)({},t),{},{Act_Qty:e.target.value})),required:!0,className:"cus-inpt"})]}),(0,y.jsxs)("div",{className:"col-lg-4 col-md-6 p-2",children:[(0,y.jsx)("label",{children:"Rate "}),(0,y.jsx)("input",{value:C.Item_Rate?C.Item_Rate:"",onInput:c.BE,disabled:!(0,c.IQ)(C.Item_Id),onChange:e=>O(t=>(0,o.A)((0,o.A)({},t),{},{Item_Rate:e.target.value,Amount:t.Bill_Qty?(0,c.JH)(e.target.value,t.Bill_Qty):t.Amount})),required:!0,className:"cus-inpt"})]}),(0,y.jsxs)("div",{className:"col-lg-4 col-md-6 p-2",children:[(0,y.jsx)("label",{children:"UOM"}),(0,y.jsxs)("select",{value:Object.hasOwn(C,"UOM")?C.UOM:Object.hasOwn(C,"Unit_Id")?C.Unit_Id:"",onChange:e=>{const t=e.target.selectedIndex,l=e.target.options[t].text,a=e.target.value;O(e=>(0,o.A)((0,o.A)({},e),{},{UOM:a,Unit_Id:a,Units:l,Unit_Name:l}))},className:"cus-inpt",disabled:!(0,c.IQ)(C.Item_Id),children:[(0,y.jsx)("option",{value:"",disabled:!0,children:"select"}),p.map((e,t)=>(0,y.jsx)("option",{value:e.Unit_Id,children:e.Units},t))]})]}),(0,y.jsxs)("div",{className:"col-lg-4 col-md-6 p-2",children:[(0,y.jsx)("label",{children:"Amount"}),(0,y.jsx)("input",{required:!0,value:C.Amount?C.Amount:"",onInput:c.BE,disabled:!(0,c.IQ)(C.Item_Id),onChange:e=>O(t=>(0,o.A)((0,o.A)({},t),{},{Amount:e.target.value,Item_Rate:t.Bill_Qty?(0,c.SX)(e.target.value,t.Bill_Qty):t.Item_Rate})),className:"cus-inpt",min:1})]}),(0,y.jsxs)("div",{className:"col-lg-4 col-md-6 p-2",children:[(0,y.jsx)("label",{children:"Batch"}),(0,y.jsx)(g.Ay,{value:{value:(null===C||void 0===C?void 0:C.Batch_Name)||"",label:(null===C||void 0===C?void 0:C.Batch_Name)||""},onChange:e=>O(t=>(0,o.A)((0,o.A)({},t),{},{Batch_Name:e.value})),options:S.filter(e=>(0,c.id)(e.item_id,null===C||void 0===C?void 0:C.Item_Id)&&(0,c.id)(null===e||void 0===e?void 0:e.godown_id,null===C||void 0===C?void 0:C.GoDown_Id)&&(0,c.Ro)(e.pendingQuantity)>=(0,c.Ro)(null===C||void 0===C?void 0:C.Bill_Qty)).map(e=>({value:e.batch,label:e.batch})),styles:A.MR,isSearchable:!0,placeholder:"Select Batch",menuPortalTarget:document.body,isDisabled:!(0,c.IQ)(null===C||void 0===C?void 0:C.Item_Id)||!(0,c.IQ)(null===C||void 0===C?void 0:C.GoDown_Id)||(0,c.id)(null===C||void 0===C?void 0:C.Bill_Qty,0)})]})]})}),(0,y.jsxs)(D.A,{className:"d-flex justify-content-between align-items-center",children:[(0,y.jsx)(s.A,{onClick:()=>O(N),type:"button",startIcon:(0,y.jsx)(Q.A,{}),children:"Clear"}),(0,y.jsxs)("span",{children:[(0,y.jsx)(s.A,{type:"button",onClick:U,children:"cancel"}),(0,y.jsx)(s.A,{type:"submit",variant:"outlined",children:"Add"})]})]})]})]})]})},R=(0,c.aN)().user,E=e=>{let{loadingOn:t,loadingOff:l}=e;const A=(0,x.Zp)(),g=(0,x.zy)().state,[w,G]=(0,a.useState)({products:[],branch:[],retailers:[],voucherType:[],uom:[],staff:[],staffType:[],brand:[],godown:[],expence:[],stockInGodown:[],stockItemLedgerName:[],batchDetails:[]}),[B,D]=(0,a.useState)({addProductDialog:!1,importFromSaleOrder:!1}),[Q,T]=(0,a.useState)(b.Q4),[P,E]=(0,a.useState)(b.zA),[k,z]=(0,a.useState)([]),[L,U]=(0,a.useState)([]),[M,F]=(0,a.useState)([]),[H,V]=(0,a.useState)(null),$=(0,c.id)(Q.GST_Inclusive,1),q=(0,c.id)(Q.GST_Inclusive,2),W=(0,c.id)(Q.IS_IGST,1),J=q?"zerotax":$?"remove":"add",X=3-k.length;(0,a.useEffect)(()=>{(async()=>{try{t&&t();const[e,l,a,d,s,n,r,i,u,v,m]=await Promise.all([(0,I.z)({address:"masters/branch/dropDown"}),(0,I.z)({address:"masters/products"}),(0,I.z)({address:"masters/retailers/dropDown?Company_Id=".concat(null===R||void 0===R?void 0:R.Company_id)}),(0,I.z)({address:"masters/voucher?module=SALES"}),(0,I.z)({address:"masters/uom"}),(0,I.z)({address:"dataEntry/costCenter"}),(0,I.z)({address:"dataEntry/costCenter/category"}),(0,I.z)({address:"dataEntry/godownLocationMaster"}),(0,I.z)({address:"masters/defaultAccountMaster"}),(0,I.z)({address:"purchase/stockItemLedgerName?type=SALES"}),(0,I.z)({address:"inventory/batchMaster/stockBalance"})]),_=(e.success?e.data:[]).sort((e,t)=>String(null===e||void 0===e?void 0:e.BranchName).localeCompare(null===t||void 0===t?void 0:t.BranchName)),p=(l.success?l.data:[]).sort((e,t)=>String(null===e||void 0===e?void 0:e.Product_Name).localeCompare(null===t||void 0===t?void 0:t.Product_Name)),h=(a.success?a.data:[]).sort((e,t)=>String(null===e||void 0===e?void 0:e.Retailer_Name).localeCompare(null===t||void 0===t?void 0:t.Retailer_Name)),x=(d.success?d.data:[]).sort((e,t)=>String(null===e||void 0===e?void 0:e.Voucher_Type).localeCompare(null===t||void 0===t?void 0:t.Voucher_Type)),b=(s.success?s.data:[]).sort((e,t)=>String(e.Units).localeCompare(t.Units)),A=(n.success?n.data:[]).sort((e,t)=>String(null===e||void 0===e?void 0:e.Cost_Center_Name).localeCompare(null===t||void 0===t?void 0:t.Cost_Center_Name)),g=(r.success?r.data:[]).sort((e,t)=>String(null===e||void 0===e?void 0:e.Cost_Category).localeCompare(null===t||void 0===t?void 0:t.Cost_Category)),y=(i.success?i.data:[]).sort((e,t)=>String(null===e||void 0===e?void 0:e.Godown_Name).localeCompare(null===t||void 0===t?void 0:t.Godown_Name)),j=(u.success?(0,c.$r)(u.data):[]).sort((e,t)=>String(null===e||void 0===e?void 0:e.Account_Name).localeCompare(null===t||void 0===t?void 0:t.Account_Name)),f=(v.success?v.data:[]).sort((e,t)=>String(null===e||void 0===e?void 0:e.Stock_Item_Ledger_Name).localeCompare(null===t||void 0===t?void 0:t.Stock_Item_Ledger_Name));G(e=>(0,o.A)((0,o.A)({},e),{},{products:p,branch:_,retailers:h,voucherType:x,uom:b,staff:A,staffType:g,godown:y,brand:(0,c.Mn)(p,"Brand",["Brand_Name"]),expence:j.filter(e=>!(0,c.xL)(e.Type,"DEFAULT")).map(e=>({Id:e.Acc_Id,Expence_Name:e.Account_Name})),stockItemLedgerName:f,batchDetails:(0,c.$r)(m.data)}))}catch(e){console.error("Error fetching data:",e)}finally{l&&l()}})()},[null===R||void 0===R?void 0:R.Company_id]);(0,a.useEffect)(()=>{z(e=>[...e].map(e=>Object.fromEntries(Object.entries(e).map(t=>{let[l,o]=t;const a=function(){var e;let t=arguments.length>1?arguments[1]:void 0;return null!==(e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).find(e=>(0,c.id)(e.Product_Id,t)))&&void 0!==e?e:{}}(w.products,null===e||void 0===e?void 0:e.Item_Id),d=W?a.Igst_P:a.Gst_P,s=d>0,{Bill_Qty:n,Item_Rate:r,Amount:i}=e,u=(0,h.v)(r,d,J),v=(0,h.v)(i,d,J),m=W?0:v.cgst_per,_=W?v.igst_per:0,I=W?0:v.cgst_amount,p=W?v.igst_amount:0;switch(l){case"Taxable_Rate":return[l,u.base_amount];case"Total_Qty":return[l,n];case"Taxble":return[l,s?1:0];case"Taxable_Amount":return[l,v.base_amount];case"Tax_Rate":return[l,d];case"Cgst":case"Sgst":return[l,null!==m&&void 0!==m?m:0];case"Cgst_Amo":case"Sgst_Amo":return[l,q?0:I];case"Igst":return[l,null!==_&&void 0!==_?_:0];case"Igst_Amo":return[l,q?0:p];case"Final_Amo":return[l,v.with_tax];default:return[l,e[l]||o]}}))))},[w.products,W,J]),(0,a.useEffect)(()=>{U(e=>[...e].map(e=>{const t=W?(0,c.Ro)(null===e||void 0===e?void 0:e.Igst):0,l=W?0:(0,c.Ro)(null===e||void 0===e?void 0:e.Cgst),a=W?0:(0,c.Ro)(null===e||void 0===e?void 0:e.Sgst),d=(0,c.Ro)(null===e||void 0===e?void 0:e.Expence_Value),s=W?t:(0,c.Lr)(l,a),n=(0,h.v)(d,s,J);return(0,o.A)((0,o.A)({},e),{},{Cgst:l,Sgst:a,Igst:t,Expence_Value:d,Cgst_Amo:l>0?n.cgst_amount:0,Sgst_Amo:a>0?n.sgst_amount:0,Igst_Amo:t>0?n.igst_amount:0})}))},[w.expence,W,J]),(0,a.useEffect)(()=>{if((0,c.aF)(g)&&Array.isArray(null===g||void 0===g?void 0:g.Products_List)){const{Products_List:e,Expence_Array:t,Staffs_Array:l}=g;T(Object.fromEntries(Object.entries(b.Q4).map(e=>{var t;let[l,o]=e;return"Do_Date"===l?[l,g[l]?(0,c.ny)(g[l]):o]:[l,null!==(t=g[l])&&void 0!==t?t:o]}))),z(e.map(e=>Object.fromEntries(Object.entries(b.a4).map(t=>{var l;let[o,a]=t;return[o,null!==(l=e[o])&&void 0!==l?l:a]})))),U((0,c.$r)(t).map(e=>Object.fromEntries(Object.entries(b.ju).map(t=>{var l;let[o,a]=t;return[o,null!==(l=e[o])&&void 0!==l?l:a]})))),F((0,c.$r)(l).map(e=>Object.fromEntries(Object.entries(b.Ud).map(t=>{var l;let[o,a]=t;return[o,null!==(l=e[o])&&void 0!==l?l:a]}))))}},[g]),(0,a.useEffect)(()=>{if((0,c.IQ)(null===g||void 0===g?void 0:g.Retailer_Id)&&!(0,c.id)(null===g||void 0===g?void 0:g.Retailer_Id,0)){var e;const t=w.retailers.find(e=>(0,c.id)(e.Retailer_Id,null===g||void 0===g?void 0:g.Retailer_Id))||{},l=null!==(e=(0,c.$r)(null===t||void 0===t?void 0:t.deliveryAddresses).find(e=>(0,c.id)(null===e||void 0===e?void 0:e.id,null===g||void 0===g?void 0:g.deliveryAddressId)))&&void 0!==e?e:null;l&&E({deliveryName:null===l||void 0===l?void 0:l.deliveryName,phoneNumber:null===l||void 0===l?void 0:l.phoneNumber,cityName:null===l||void 0===l?void 0:l.cityName,deliveryAddress:null===l||void 0===l?void 0:l.deliveryAddress,id:l.id})}},[g,w.retailers]);const Z=()=>{t&&t(),(0,I.z)({address:"sales/salesInvoice",method:(0,c.IQ)(null===Q||void 0===Q?void 0:Q.Do_Id)?"PUT":"POST",bodyData:(0,o.A)((0,o.A)({},Q),{},{delivery_id:null===P||void 0===P?void 0:P.id,deliveryName:null===P||void 0===P?void 0:P.deliveryName,phoneNumber:null===P||void 0===P?void 0:P.phoneNumber,cityName:null===P||void 0===P?void 0:P.cityName,deliveryAddress:null===P||void 0===P?void 0:P.deliveryAddress,Product_Array:k,Staffs_Array:M,Expence_Array:L})}).then(e=>{e.success?(T(b.Q4),z([]),U([]),F([]),i.oR.success(e.message),A("/erp/sales/invoice")):i.oR.warn(e.message)}).catch(e=>console.error(e)).finally(()=>{l&&l()})};return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(O,{orderProducts:k,setOrderProducts:z,open:B.addProductDialog,onClose:()=>{D(e=>(0,o.A)((0,o.A)({},e),{},{addProductDialog:!1})),V(null)},products:w.products,brands:w.brand,uom:w.uom,godowns:w.godown,GST_Inclusive:Q.GST_Inclusive,IS_IGST:W,editValues:H,initialValue:(0,o.A)((0,o.A)({},b.a4),{},{Pre_Id:Q.So_No}),batchDetails:w.batchDetails}),(0,y.jsxs)(d.A,{children:[(0,y.jsxs)("div",{className:"d-flex flex-wrap align-items-center border-bottom py-2 px-3",children:[(0,y.jsx)("span",{className:"flex-grow-1 fa-16 fw-bold",children:"Sales Invoice"}),(0,y.jsxs)("span",{children:[(0,y.jsx)(s.A,{type:"button",onClick:()=>{window.history.length>1?A(-1):A("/erp/sales/invoice")},children:"Cancel"}),(0,y.jsx)(s.A,{onClick:()=>Z(),variant:"contained",children:"submit"})]})]}),(0,y.jsxs)(n.A,{children:[(0,y.jsxs)("div",{className:"row p-0",children:[(0,y.jsx)("div",{className:"col-xxl-3 col-lg-4 col-md-5 p-2",children:(0,y.jsx)("div",{className:"border p-2",style:{minHeight:"30vh",height:"100%"},children:(0,y.jsx)(j,{StaffArray:M,setStaffArray:F,costCenter:w.staff,costCategory:w.staffType})})}),(0,y.jsx)("div",{className:"col-xxl-9 col-lg-8 col-md-7 py-2 px-0",children:(0,y.jsx)("div",{className:"border px-3 py-1",style:{minHeight:"30vh",height:"100%"},children:(0,y.jsx)(f.A,{invoiceInfo:Q,setInvoiceInfo:T,retailers:w.retailers,branches:w.branch,voucherType:w.voucherType,stockItemLedgerName:w.stockItemLedgerName,onChangeRetailer:()=>{z([]),U([])},retailerDeliveryAddress:P,setRetailerDeliveryAddress:E})})})]}),(0,y.jsx)(p.Ay,{title:"Items",headerFontSizePx:13,bodyFontSizePx:13,EnableSerialNumber:!0,disablePagination:!0,ButtonArea:(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(s.A,{onClick:()=>{V(null),D(e=>(0,o.A)((0,o.A)({},e),{},{addProductDialog:!0}))},sx:{ml:1},variant:"outlined",type:"button",startIcon:(0,y.jsx)(u.A,{}),disabled:!(0,c.IQ)(Q.Retailer_Id)||k.length>0&&(0,c.IQ)(Q.So_No),children:"Add Product"}),(0,y.jsx)(S.A,{loadingOn:t,loadingOff:l,open:B.importFromSaleOrder,onClose:()=>D(e=>(0,o.A)((0,o.A)({},e),{},{importFromSaleOrder:!1})),retailer:null===Q||void 0===Q?void 0:Q.Retailer_Id,selectedItems:k,setSelectedItems:z,staffArray:M,setStaffArray:F,products:w.products,GST_Inclusive:Q.GST_Inclusive,IS_IGST:W,invoiceInfo:Q,setInvoiceInfo:T,godowns:w.godown,stockInGodown:w.stockInGodown,children:(0,y.jsx)(s.A,{onClick:()=>D(e=>(0,o.A)((0,o.A)({},e),{},{importFromSaleOrder:!0})),disabled:!(0,c.IQ)(Q.Retailer_Id)||k.length>0&&!(0,c.IQ)(Q.So_No),sx:{ml:1},type:"button",variant:"outlined",startIcon:(0,y.jsx)(v.A,{}),children:"Choose Sale Order"})})]}),dataArray:[...k,...Array.from({length:X>0?X:0}).map(e=>b.a4)],columns:[(0,p.Lj)("Item_Name","string"),(0,p.Lj)("Batch_Name","string"),(0,p.Lj)("Bill_Qty","number"),(0,p.Lj)("Act_Qty","number"),(0,p.Lj)("Item_Rate","number"),{isVisible:1,ColumnHeader:"Tax",isCustomCell:!0,Cell:e=>{let{row:t}=e;const{Cgst:l=0,Sgst:o=0,Igst:a=0,Cgst_Amo:d=0,Sgst_Amo:s=0,Igst_Amo:n=0}=t,r=W?a:(0,c.Lr)(l,o),i=W?n:(0,c.Lr)(d,s);return(0,c.IQ)(null===t||void 0===t?void 0:t.Item_Id)?"".concat(i," - (").concat(r," %)"):""}},{isVisible:1,ColumnHeader:"Godown",isCustomCell:!0,Cell:e=>{var t,l;let{row:o}=e;return null!==(t=null===(l=w.godown.find(e=>(0,c.id)(e.Godown_Id,null===o||void 0===o?void 0:o.GoDown_Id)))||void 0===l?void 0:l.Godown_Name)&&void 0!==t?t:""}},(0,p.Lj)("Amount","number"),{isCustomCell:!0,Cell:e=>{let{row:t}=e;return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(r.A,{onClick:()=>{V(t),D(e=>(0,o.A)((0,o.A)({},e),{},{addProductDialog:!0}))},size:"small",type:"button",disabled:!(0,c.IQ)(null===t||void 0===t?void 0:t.Item_Id),children:(0,y.jsx)(m.A,{})}),(0,y.jsx)(r.A,{size:"small",type:"button",onClick:()=>z(e=>e.filter(e=>!(0,c.id)(e.Item_Id,t.Item_Id))),color:"error",disabled:!(0,c.IQ)(null===t||void 0===t?void 0:t.Item_Id),children:(0,y.jsx)(_.A,{})})]})},ColumnHeader:"Action",isVisible:1}]}),(0,y.jsx)("br",{}),(0,y.jsx)(C.A,{invoiceExpences:L,setInvoiceExpences:U,expenceMaster:w.expence,IS_IGST:W,taxType:J}),(0,y.jsx)("br",{}),(0,y.jsx)(N.A,{invoiceProducts:k,invoiceExpences:L,isNotTaxableBill:q,isInclusive:$,IS_IGST:W,products:w.products,invoiceInfo:Q,setInvoiceInfo:T})]})]})]})}},44676:(e,t,l)=>{l.d(t,{A:()=>d});var o=l(59662),a=l(70579);const d=(0,o.A)([(0,a.jsx)("path",{d:"M19.5 3.5 18 2l-1.5 1.5L15 2l-1.5 1.5L12 2l-1.5 1.5L9 2 7.5 3.5 6 2v14H3v3c0 1.66 1.34 3 3 3h12c1.66 0 3-1.34 3-3V2zM19 19c0 .55-.45 1-1 1s-1-.45-1-1v-3H8V5h11z"},"0"),(0,a.jsx)("path",{d:"M9 7h6v2H9zm7 0h2v2h-2zm-7 3h6v2H9zm7 0h2v2h-2z"},"1")],"ReceiptLong")}}]);
//# sourceMappingURL=6430.a36dffea.chunk.js.map