"use strict";(self.webpackChunkerp=self.webpackChunkerp||[]).push([[6430],{16430:(e,l,t)=>{t.r(l),t.d(l,{default:()=>z});var o=t(89379),d=t(65043),a=t(12110),s=t(11906),i=t(26494),n=t(17392),r=t(83462),c=t(26600),u=t(35316),v=t(29347),m=t(91036),_=t(97707),p=t(33438),I=t(70141),h=t(44676),A=t(83560),g=t(51387),b=t(65074),x=t(48471),y=t(14844),j=t(73216),N=t(97280),f=t(63406),S=t(20656),C=t(70579);const w=e=>{let{StaffArray:l=[],setStaffArray:t,costCenter:d=[],costCategory:a=[]}=e;return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsxs)("div",{className:"d-flex align-items-center flex-wrap mb-2 border-bottom pb-2",children:[(0,C.jsx)("h6",{className:"flex-grow-1 m-0",children:"Staff Involved"}),(0,C.jsx)(s.A,{variant:"outlined",color:"primary",type:"button",onClick:()=>t(e=>[...e,(0,o.A)({},N.Ud)]),children:"Add"})]}),(0,C.jsxs)("table",{className:"table table-bordered",children:[(0,C.jsx)("thead",{children:(0,C.jsxs)("tr",{children:[(0,C.jsx)("th",{className:"fa-13",children:"Sno"}),(0,C.jsx)("th",{className:"fa-13",children:"Staff Name"}),(0,C.jsx)("th",{className:"fa-13",children:"Category"}),(0,C.jsx)("th",{className:"fa-13",children:"#"})]})}),(0,C.jsx)("tbody",{children:(0,_.$r)(l).map((e,s)=>(0,C.jsxs)("tr",{children:[(0,C.jsx)("td",{className:"fa-13 vctr text-center",children:s+1}),(0,C.jsx)("td",{className:"fa-13 w-100 p-0",children:(0,C.jsx)(S.Ay,{value:{value:null===e||void 0===e?void 0:e.Emp_Id,label:null===e||void 0===e?void 0:e.Emp_Name},onChange:e=>t(l=>l.map((l,t)=>{if((0,_.id)(t,s)){const t=(0,_.$r)(d).find(l=>(0,_.id)(null===l||void 0===l?void 0:l.Cost_Center_Id,e.value));return(0,o.A)((0,o.A)({},l),{},{Emp_Type_Id:(0,_.IQ)(null===l||void 0===l?void 0:l.Emp_Type_Id)?Number(null===l||void 0===l?void 0:l.Emp_Type_Id):(0,_.IQ)(t.User_Type)?Number(t.User_Type):0,Emp_Id:Number(e.value),Emp_Name:e.label})}return l})),options:[...(0,_.$r)(d).filter(e=>!l.some(l=>(0,_.id)(l.Emp_Id,e.Cost_Center_Id)))].map(e=>({value:e.Cost_Center_Id,label:e.Cost_Center_Name})),styles:f.MR,isSearchable:!0,placeholder:"Select Staff",filterOption:_.GI})}),(0,C.jsx)("td",{className:"fa-13 vctr p-0",style:{maxWidth:"130px",minWidth:"100px"},children:(0,C.jsxs)("select",{value:null===e||void 0===e?void 0:e.Emp_Type_Id,onChange:e=>t(l=>l.map((l,t)=>(0,_.id)(t,s)?(0,o.A)((0,o.A)({},l),{},{Emp_Type_Id:e.target.value}):l)),className:"cus-inpt p-2 border-0",children:[(0,C.jsx)("option",{value:"",children:"Select"}),(0,_.$r)(a).map((e,l)=>(0,C.jsx)("option",{value:null===e||void 0===e?void 0:e.Cost_Category_Id,children:null===e||void 0===e?void 0:e.Cost_Category},l))]})}),(0,C.jsx)("td",{className:"fa-13 vctr p-0",children:(0,C.jsx)(n.A,{onClick:()=>{t(e=>e.filter((e,l)=>s!==l))},size:"small",children:(0,C.jsx)(g.A,{color:"error"})})})]},s))})]})]})};var G=t(94232),D=t(24651),B=t(34104),P=t(35786),T=t(34496),O=t(14792);const Q=(e,l,t)=>{var o;const d=null===(o=(0,_.$r)(t).find(t=>(0,_.id)(null===t||void 0===t?void 0:t.Product_Id,e)&&(0,_.id)(null===t||void 0===t?void 0:t.Godown_Id,l)))||void 0===o?void 0:o.Act_Bal_Qty;return(0,_.Ro)(d)},R=e=>{var l,t;let{children:a,orderProducts:i=[],setOrderProducts:n,open:p=!1,onClose:I,products:h=[],brands:A=[],uom:g=[],godowns:x=[],GST_Inclusive:j,IS_IGST:N,editValues:w=null,initialValue:G={},batchDetails:D=[]}=e;const[B,P]=(0,d.useState)(G),R=(0,_.id)(j,1),E=(0,_.id)(j,2),[k,z]=(0,d.useState)([]);(0,d.useEffect)(()=>{(0,_.aF)(w)&&p&&P(e=>Object.fromEntries(Object.entries(e).map(e=>{let[l,t]=e;return[l,w[l]?w[l]:t]})))},[w]);const L=e=>{var l;return null!==(l=null===h||void 0===h?void 0:h.find(l=>(0,_.id)(null===l||void 0===l?void 0:l.Product_Id,e)))&&void 0!==l?l:{}},U=()=>{P(G),I()};return(0,d.useEffect)(()=>{z([]),(0,_.IQ)(B.Item_Id)&&!(0,_.id)(B.Item_Id,0)&&(0,b.z)({address:"sales/stockInGodown?Item_Id=".concat(B.Item_Id)}).then(e=>{const l=(e.success?e.data:[]).sort((e,l)=>String(null===e||void 0===e?void 0:e.stock_item_name).localeCompare(null===l||void 0===l?void 0:l.stock_item_name));z(l)})},[B.Item_Id]),(0,C.jsxs)(C.Fragment,{children:[a,(0,C.jsxs)(r.A,{open:p,onClose:U,maxWidth:"md",fullWidth:!0,children:[(0,C.jsx)(c.A,{className:"border-bottom",children:(0,C.jsx)("span",{children:"Add Products Details"})}),(0,C.jsxs)("form",{onSubmit:e=>{e.preventDefault(),B.Item_Id?(n(e=>[...e.filter(e=>!(0,_.id)(e.Item_Id,B.Item_Id)),Object.fromEntries(Object.entries(G).map(e=>{let[l,t]=e;const o=L(B.Item_Id),d=N?o.Igst_P:o.Gst_P,a=d>0,{Bill_Qty:s,Item_Rate:i,Amount:n}=B,r=E?"zerotax":R?"remove":"add",c=(0,y.v)(i,d,r),u=(0,y.v)(n,d,r),v=N?0:u.cgst_per,m=N?u.igst_per:0,_=N?0:u.cgst_amount,p=N?u.igst_amount:0;switch(l){case"Item_Name":return[l,o.Product_Name];case"Taxable_Rate":return[l,c.base_amount];case"Total_Qty":return[l,s];case"Taxble":return[l,a?1:0];case"Taxable_Amount":return[l,u.base_amount];case"Tax_Rate":return[l,d];case"Cgst":case"Sgst":return[l,null!==v&&void 0!==v?v:0];case"Cgst_Amo":case"Sgst_Amo":return[l,E?0:_];case"Igst":return[l,null!==m&&void 0!==m?m:0];case"Igst_Amo":return[l,E?0:p];case"Final_Amo":return[l,u.with_tax];default:return[l,B[l]||t]}}))]),U()):m.oR.warn("Select Product")},children:[(0,C.jsx)(u.A,{children:(0,C.jsxs)("div",{className:"row pb-5",children:[(0,C.jsxs)("div",{className:"col-6 p-2",children:[(0,C.jsx)("label",{children:"Brand"}),(0,C.jsx)(S.Ay,{value:{value:B.BrandID,label:B.Brand},onChange:e=>P(l=>(0,o.A)((0,o.A)({},l),{},{BrandID:e.value,Brand:e.label})),options:[{value:"",label:"select",isDisabled:!0},...A.map(e=>({value:null===e||void 0===e?void 0:e.Brand,label:null===e||void 0===e?void 0:e.Brand_Name}))],styles:f.MR,menuPortalTarget:document.body,isSearchable:!0,placeholder:"Select Brand",maxMenuHeight:200,filterOption:_.GI})]}),(0,C.jsxs)("div",{className:"col-6 p-2",children:[(0,C.jsx)("label",{children:"Group"}),(0,C.jsx)(S.Ay,{value:{value:B.GroupID,label:B.Group},onChange:e=>P(l=>(0,o.A)((0,o.A)({},l),{},{GroupID:e.value,Group:e.label})),options:[{value:"",label:"select",isDisabled:!0},...h.filter(e=>!B.BrandID||(0,_.id)(e.Brand,B.BrandID)).reduce((e,l)=>(e.some(e=>e.value===l.Product_Group)||e.push({value:l.Product_Group,label:l.Pro_Group}),e),[])],styles:f.MR,menuPortalTarget:document.body,isSearchable:!0,placeholder:"Select Group",maxMenuHeight:200,filterOption:_.GI})]}),(0,C.jsxs)("div",{className:Object.hasOwn(B,"GoDown_Id")?"col-md-8 p-2":"col-12 p-2",children:[(0,C.jsxs)("label",{children:["Item Name ",(0,C.jsx)(O.A,{})]}),(0,C.jsx)(S.Ay,{value:{value:B.Item_Id,label:null===(l=L(B.Item_Id))||void 0===l?void 0:l.Product_Name},isDisabled:(0,_.IQ)(B.Pre_Id),menuPortalTarget:document.body,onChange:e=>{const l=L(e.value);P(t=>{var d,a,s,i,n,r,c;return(0,o.A)((0,o.A)({},t),{},{Group:null!==(d=l.Pro_Group)&&void 0!==d?d:t.Group,GroupID:null!==(a=l.Product_Group)&&void 0!==a?a:t.GroupID,Brand:null!==(s=l.Brand_Name)&&void 0!==s?s:t.Brand,BrandID:null!==(i=l.Brand)&&void 0!==i?i:t.BrandID,Item_Id:e.value,Item_Rate:null!==(n=l.Item_Rate)&&void 0!==n?n:0,GoDown_Id:"",Bill_Qty:0,Amount:0,Unit_Id:null!==(r=l.UOM_Id)&&void 0!==r?r:t.Unit_Id,Unit_Name:null!==(c=l.Units)&&void 0!==c?c:t.Unit_Name,HSN_Code:null===l||void 0===l?void 0:l.HSN_Code})})},options:[{value:"",label:"select",isDisabled:!0},...[...h.filter(e=>!B.BrandID||(0,_.id)(e.Brand,B.BrandID)).filter(e=>!B.GroupID||(0,_.id)(e.Product_Group,B.GroupID))].map(e=>({value:null===e||void 0===e?void 0:e.Product_Id,label:null===e||void 0===e?void 0:e.Product_Name,isDisabled:-1!==i.findIndex(l=>(0,_.id)(null===l||void 0===l?void 0:l.Item_Id,null===e||void 0===e?void 0:e.Product_Id))}))],styles:f.MR,isSearchable:!0,required:!0,placeholder:"Select Product",maxMenuHeight:200,filterOption:_.GI})]}),Object.hasOwn(B,"GoDown_Id")&&(0,C.jsxs)("div",{className:"col-md-4 p-2",children:[(0,C.jsx)("label",{children:"Godown"}),(0,C.jsx)(S.Ay,{value:{value:null===B||void 0===B?void 0:B.GoDown_Id,label:(null===(t=x.find(e=>(0,_.id)(e.Godown_Id,null===B||void 0===B?void 0:B.GoDown_Id)))||void 0===t?void 0:t.Godown_Name)||""},onChange:e=>P(l=>(0,o.A)((0,o.A)({},l),{},{GoDown_Id:e.value})),options:[{value:"",label:"select",isDisabled:!0},...(0,_.$r)(x).map(e=>({value:null===e||void 0===e?void 0:e.Godown_Id,label:"".concat(null===e||void 0===e?void 0:e.Godown_Name).concat((0,_.IQ)(null===e||void 0===e?void 0:e.Godown_Id)?" (Bal: ".concat(Q(B.Item_Id,null===e||void 0===e?void 0:e.Godown_Id,k),")"):"")}))],styles:f.MR,isDisabled:!(0,_.IQ)(null===B||void 0===B?void 0:B.Item_Id),menuPortalTarget:document.body,isSearchable:!0,placeholder:"Select Godown",filterOption:_.GI})]}),(0,C.jsxs)("div",{className:"col-lg-4 col-md-6 p-2",children:[(0,C.jsxs)("label",{children:["Quantity ",(0,C.jsx)(O.A,{})]}),(0,C.jsx)("input",{required:!0,value:B.Bill_Qty?B.Bill_Qty:"",onInput:_.BE,disabled:!(0,_.IQ)(B.Item_Id),onChange:e=>{B.Item_Rate?P(l=>(0,o.A)((0,o.A)({},l),{},{Amount:(0,_.JH)(B.Item_Rate,e.target.value),Bill_Qty:e.target.value})):B.Amount?P(l=>(0,o.A)((0,o.A)({},l),{},{Item_Rate:(0,_.SX)(l.Amount,e.target.value),Bill_Qty:e.target.value})):P(l=>(0,o.A)((0,o.A)({},l),{},{Bill_Qty:e.target.value}))},className:"cus-inpt",min:1})]}),Object.hasOwn(B,"Act_Qty")&&(0,C.jsxs)("div",{className:"col-lg-4 col-md-6 p-2",children:[(0,C.jsx)("label",{children:"Actual Quantity "}),(0,C.jsx)("input",{value:B.Act_Qty?B.Act_Qty:"",onInput:_.BE,disabled:!(0,_.IQ)(B.Item_Id),onChange:e=>P(l=>(0,o.A)((0,o.A)({},l),{},{Act_Qty:e.target.value})),required:!0,className:"cus-inpt"})]}),(0,C.jsxs)("div",{className:"col-lg-4 col-md-6 p-2",children:[(0,C.jsx)("label",{children:"Rate "}),(0,C.jsx)("input",{value:B.Item_Rate?B.Item_Rate:"",onInput:_.BE,disabled:!(0,_.IQ)(B.Item_Id),onChange:e=>P(l=>(0,o.A)((0,o.A)({},l),{},{Item_Rate:e.target.value,Amount:l.Bill_Qty?(0,_.JH)(e.target.value,l.Bill_Qty):l.Amount})),required:!0,className:"cus-inpt"})]}),(0,C.jsxs)("div",{className:"col-lg-4 col-md-6 p-2",children:[(0,C.jsx)("label",{children:"UOM"}),(0,C.jsxs)("select",{value:Object.hasOwn(B,"UOM")?B.UOM:Object.hasOwn(B,"Unit_Id")?B.Unit_Id:"",onChange:e=>{const l=e.target.selectedIndex,t=e.target.options[l].text,d=e.target.value;P(e=>(0,o.A)((0,o.A)({},e),{},{UOM:d,Unit_Id:d,Units:t,Unit_Name:t}))},className:"cus-inpt",disabled:!(0,_.IQ)(B.Item_Id),children:[(0,C.jsx)("option",{value:"",disabled:!0,children:"select"}),g.map((e,l)=>(0,C.jsx)("option",{value:e.Unit_Id,children:e.Units},l))]})]}),(0,C.jsxs)("div",{className:"col-lg-4 col-md-6 p-2",children:[(0,C.jsx)("label",{children:"Amount"}),(0,C.jsx)("input",{required:!0,value:B.Amount?B.Amount:"",onInput:_.BE,disabled:!(0,_.IQ)(B.Item_Id),onChange:e=>P(l=>(0,o.A)((0,o.A)({},l),{},{Amount:e.target.value,Item_Rate:l.Bill_Qty?(0,_.SX)(e.target.value,l.Bill_Qty):l.Item_Rate})),className:"cus-inpt",min:1})]}),(0,C.jsxs)("div",{className:"col-lg-4 col-md-6 p-2",children:[(0,C.jsx)("label",{children:"Batch"}),(0,C.jsx)(S.Ay,{value:{value:(null===B||void 0===B?void 0:B.Batch_Name)||"",label:(null===B||void 0===B?void 0:B.Batch_Name)||""},onChange:e=>P(l=>(0,o.A)((0,o.A)({},l),{},{Batch_Name:e.value})),options:D.filter(e=>(0,_.id)(e.item_id,null===B||void 0===B?void 0:B.Item_Id)&&(0,_.id)(null===e||void 0===e?void 0:e.godown_id,null===B||void 0===B?void 0:B.GoDown_Id)&&(0,_.Ro)(e.pendingQuantity)>=(0,_.Ro)(null===B||void 0===B?void 0:B.Bill_Qty)).map(e=>({value:e.batch,label:e.batch})),styles:f.MR,isSearchable:!0,placeholder:"Select Batch",menuPortalTarget:document.body,isDisabled:!0})]})]})}),(0,C.jsxs)(v.A,{className:"d-flex justify-content-between align-items-center",children:[(0,C.jsx)(s.A,{onClick:()=>P(G),type:"button",startIcon:(0,C.jsx)(T.A,{}),children:"Clear"}),(0,C.jsxs)("span",{children:[(0,C.jsx)(s.A,{type:"button",onClick:U,children:"cancel"}),(0,C.jsx)(s.A,{type:"submit",variant:"outlined",children:"Add"})]})]})]})]})]})};var E=t(90001);const k=(0,_.aN)().user,z=e=>{let{loadingOn:l,loadingOff:t}=e;const f=(0,j.Zp)(),S=(0,j.zy)().state,[T,O]=(0,d.useState)({products:[],branch:[],retailers:[],voucherType:[],uom:[],staff:[],staffType:[],brand:[],godown:[],expence:[],stockInGodown:[],stockItemLedgerName:[],batchDetails:[]}),[Q,z]=(0,d.useState)({addProductDialog:!1,importFromSaleOrder:!1}),[L,U]=(0,d.useState)(N.Q4),[M,F]=(0,d.useState)(N.zA),[H,V]=(0,d.useState)(N.zA),[$,W]=(0,d.useState)([]),[q,J]=(0,d.useState)([]),[X,Z]=(0,d.useState)([]),[K,Y]=(0,d.useState)(null),ee=(0,_.id)(L.GST_Inclusive,1),le=(0,_.id)(L.GST_Inclusive,2),te=(0,_.id)(L.IS_IGST,1),oe=le?"zerotax":ee?"remove":"add",de=3-$.length,[ae,se]=(0,d.useState)({open:!1,Do_Id:null});(0,d.useEffect)(()=>{(async()=>{try{l&&l();const[e,t,d,a,s,i,n,r,c,u,v]=await Promise.all([(0,b.z)({address:"masters/branch/dropDown"}),(0,b.z)({address:"masters/products"}),(0,b.z)({address:"masters/retailers/dropDown?Company_Id=".concat(null===k||void 0===k?void 0:k.Company_id)}),(0,b.z)({address:"masters/voucher?module=SALES"}),(0,b.z)({address:"masters/uom"}),(0,b.z)({address:"dataEntry/costCenter"}),(0,b.z)({address:"dataEntry/costCenter/category"}),(0,b.z)({address:"dataEntry/godownLocationMaster"}),(0,b.z)({address:"masters/defaultAccountMaster"}),(0,b.z)({address:"purchase/stockItemLedgerName?type=SALES"}),(0,b.z)({address:"inventory/batchMaster/stockBalance"})]),m=(e.success?e.data:[]).sort((e,l)=>String(null===e||void 0===e?void 0:e.BranchName).localeCompare(null===l||void 0===l?void 0:l.BranchName)),p=(t.success?t.data:[]).sort((e,l)=>String(null===e||void 0===e?void 0:e.Product_Name).localeCompare(null===l||void 0===l?void 0:l.Product_Name)),I=(d.success?d.data:[]).sort((e,l)=>String(null===e||void 0===e?void 0:e.Retailer_Name).localeCompare(null===l||void 0===l?void 0:l.Retailer_Name)),h=(a.success?a.data:[]).sort((e,l)=>String(null===e||void 0===e?void 0:e.Voucher_Type).localeCompare(null===l||void 0===l?void 0:l.Voucher_Type)),A=(s.success?s.data:[]).sort((e,l)=>String(e.Units).localeCompare(l.Units)),g=(i.success?i.data:[]).sort((e,l)=>String(null===e||void 0===e?void 0:e.Cost_Center_Name).localeCompare(null===l||void 0===l?void 0:l.Cost_Center_Name)),x=(n.success?n.data:[]).sort((e,l)=>String(null===e||void 0===e?void 0:e.Cost_Category).localeCompare(null===l||void 0===l?void 0:l.Cost_Category)),y=(r.success?r.data:[]).sort((e,l)=>String(null===e||void 0===e?void 0:e.Godown_Name).localeCompare(null===l||void 0===l?void 0:l.Godown_Name)),j=(c.success?(0,_.$r)(c.data):[]).sort((e,l)=>String(null===e||void 0===e?void 0:e.Account_Name).localeCompare(null===l||void 0===l?void 0:l.Account_Name)),N=(u.success?u.data:[]).sort((e,l)=>String(null===e||void 0===e?void 0:e.Stock_Item_Ledger_Name).localeCompare(null===l||void 0===l?void 0:l.Stock_Item_Ledger_Name));O(e=>(0,o.A)((0,o.A)({},e),{},{products:p,branch:m,retailers:I,voucherType:h,uom:A,staff:g,staffType:x,godown:y,brand:(0,_.Mn)(p,"Brand",["Brand_Name"]),expence:j.filter(e=>!(0,_.xL)(e.Type,"DEFAULT")).map(e=>({Id:e.Acc_Id,Expence_Name:e.Account_Name})),stockItemLedgerName:N,batchDetails:(0,_.$r)(v.data)}))}catch(e){console.error("Error fetching data:",e)}finally{t&&t()}})()},[null===k||void 0===k?void 0:k.Company_id]);const ie=()=>{U(N.Q4),W([]),J([]),Z([])};(0,d.useEffect)(()=>{W(e=>[...e].map(e=>Object.fromEntries(Object.entries(e).map(l=>{let[t,o]=l;const d=function(){var e;let l=arguments.length>1?arguments[1]:void 0;return null!==(e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).find(e=>(0,_.id)(e.Product_Id,l)))&&void 0!==e?e:{}}(T.products,null===e||void 0===e?void 0:e.Item_Id),a=te?d.Igst_P:d.Gst_P,s=a>0,{Bill_Qty:i,Item_Rate:n,Amount:r}=e,c=(0,y.v)(n,a,oe),u=(0,y.v)(r,a,oe),v=te?0:u.cgst_per,m=te?u.igst_per:0,p=te?0:u.cgst_amount,I=te?u.igst_amount:0;switch(t){case"Taxable_Rate":return[t,c.base_amount];case"Total_Qty":return[t,i];case"Taxble":return[t,s?1:0];case"Taxable_Amount":return[t,u.base_amount];case"Tax_Rate":return[t,a];case"Cgst":case"Sgst":return[t,null!==v&&void 0!==v?v:0];case"Cgst_Amo":case"Sgst_Amo":return[t,le?0:p];case"Igst":return[t,null!==m&&void 0!==m?m:0];case"Igst_Amo":return[t,le?0:I];case"Final_Amo":return[t,u.with_tax];default:return[t,e[t]||o]}}))))},[T.products,te,oe]),(0,d.useEffect)(()=>{J(e=>[...e].map(e=>{const l=te?(0,_.Ro)(null===e||void 0===e?void 0:e.Igst):0,t=te?0:(0,_.Ro)(null===e||void 0===e?void 0:e.Cgst),d=te?0:(0,_.Ro)(null===e||void 0===e?void 0:e.Sgst),a=(0,_.Ro)(null===e||void 0===e?void 0:e.Expence_Value),s=te?l:(0,_.Lr)(t,d),i=(0,y.v)(a,s,oe);return(0,o.A)((0,o.A)({},e),{},{Cgst:t,Sgst:d,Igst:l,Expence_Value:a,Cgst_Amo:t>0?i.cgst_amount:0,Sgst_Amo:d>0?i.sgst_amount:0,Igst_Amo:l>0?i.igst_amount:0})}))},[T.expence,te,oe]),(0,d.useEffect)(()=>{if((0,_.aF)(S)&&Array.isArray(null===S||void 0===S?void 0:S.Products_List)){const{Products_List:e,Expence_Array:l,Staffs_Array:t}=S;U(Object.fromEntries(Object.entries(N.Q4).map(e=>{var l;let[t,o]=e;return"Do_Date"===t?[t,S[t]?(0,_.ny)(S[t]):o]:[t,null!==(l=S[t])&&void 0!==l?l:o]}))),W(e.map(e=>Object.fromEntries(Object.entries(N.a4).map(l=>{var t;let[o,d]=l;return[o,null!==(t=e[o])&&void 0!==t?t:d]})))),J((0,_.$r)(l).map(e=>Object.fromEntries(Object.entries(N.ju).map(l=>{var t;let[o,d]=l;return[o,null!==(t=e[o])&&void 0!==t?t:d]})))),Z((0,_.$r)(t).map(e=>Object.fromEntries(Object.entries(N.Ud).map(l=>{var t;let[o,d]=l;return[o,null!==(t=e[o])&&void 0!==t?t:d]}))))}},[S]),(0,d.useEffect)(()=>{if((0,_.IQ)(null===S||void 0===S?void 0:S.Retailer_Id)&&!(0,_.id)(null===S||void 0===S?void 0:S.Retailer_Id,0)){var e,l;const t=T.retailers.find(e=>(0,_.id)(e.Retailer_Id,null===S||void 0===S?void 0:S.Retailer_Id))||{},o=null!==(e=(0,_.$r)(null===t||void 0===t?void 0:t.deliveryAddresses).find(e=>(0,_.id)(null===e||void 0===e?void 0:e.id,null===S||void 0===S?void 0:S.deliveryAddressId)))&&void 0!==e?e:null;o&&F({deliveryName:null===o||void 0===o?void 0:o.deliveryName,phoneNumber:null===o||void 0===o?void 0:o.phoneNumber,cityName:null===o||void 0===o?void 0:o.cityName,deliveryAddress:null===o||void 0===o?void 0:o.deliveryAddress,gstNumber:null===o||void 0===o?void 0:o.gstNumber,stateName:null===o||void 0===o?void 0:o.stateName,id:o.id});const d=null!==(l=(0,_.$r)(null===t||void 0===t?void 0:t.deliveryAddresses).find(e=>(0,_.id)(null===e||void 0===e?void 0:e.id,null===S||void 0===S?void 0:S.shipingAddressId)))&&void 0!==l?l:null;d&&F({deliveryName:null===d||void 0===d?void 0:d.deliveryName,phoneNumber:null===d||void 0===d?void 0:d.phoneNumber,cityName:null===d||void 0===d?void 0:d.cityName,deliveryAddress:null===d||void 0===d?void 0:d.deliveryAddress,gstNumber:null===d||void 0===d?void 0:d.gstNumber,stateName:null===d||void 0===d?void 0:d.stateName,id:d.id})}},[S,T.retailers]);return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(R,{orderProducts:$,setOrderProducts:W,open:Q.addProductDialog,onClose:()=>{z(e=>(0,o.A)((0,o.A)({},e),{},{addProductDialog:!1})),Y(null)},products:T.products,brands:T.brand,uom:T.uom,godowns:T.godown,GST_Inclusive:L.GST_Inclusive,IS_IGST:te,editValues:K,initialValue:(0,o.A)((0,o.A)({},N.a4),{},{Pre_Id:L.So_No}),batchDetails:T.batchDetails}),(0,C.jsxs)(a.A,{children:[(0,C.jsxs)("div",{className:"d-flex flex-wrap align-items-center border-bottom py-2 px-3",children:[(0,C.jsx)("span",{className:"flex-grow-1 fa-16 fw-bold",children:"Sales Invoice"}),(0,C.jsxs)("span",{children:[(0,C.jsx)(s.A,{type:"button",onClick:()=>{window.history.length>1?f(-1):f("/erp/sales/invoice")},children:"Cancel"}),(0,C.jsx)(s.A,{onClick:()=>(l&&l(),void(0,b.z)({address:"sales/salesInvoice",method:(0,_.IQ)(null===L||void 0===L?void 0:L.Do_Id)?"PUT":"POST",bodyData:(0,o.A)((0,o.A)({},L),{},{deliveryAddressDetails:{delivery_id:null===M||void 0===M?void 0:M.id,deliveryName:null===M||void 0===M?void 0:M.deliveryName,phoneNumber:null===M||void 0===M?void 0:M.phoneNumber,cityName:null===M||void 0===M?void 0:M.cityName,deliveryAddress:null===M||void 0===M?void 0:M.deliveryAddress,gstNumber:null===M||void 0===M?void 0:M.gstNumber,stateName:null===M||void 0===M?void 0:M.stateName},shipingAddressDetails:{delivery_id:null===H||void 0===H?void 0:H.id,deliveryName:null===H||void 0===H?void 0:H.deliveryName,phoneNumber:null===H||void 0===H?void 0:H.phoneNumber,cityName:null===H||void 0===H?void 0:H.cityName,deliveryAddress:null===H||void 0===H?void 0:H.deliveryAddress,gstNumber:null===H||void 0===H?void 0:H.gstNumber,stateName:null===H||void 0===H?void 0:H.stateName},Product_Array:$,Staffs_Array:X,Expence_Array:q})}).then(e=>{if(e.success){var l;const t=null===(l=e.others)||void 0===l?void 0:l.Do_Id;m.oR.success(e.message),se({open:!0,Do_Id:t})}else m.oR.warn(e.message)}).catch(e=>{console.error(e),m.oR.error("Failed to save invoice")}).finally(()=>{t&&t()})),variant:"contained",children:"submit"})]})]}),(0,C.jsxs)(i.A,{children:[(0,C.jsxs)("div",{className:"row p-0",children:[(0,C.jsx)("div",{className:"col-xxl-3 col-lg-4 col-md-5 p-2",children:(0,C.jsx)("div",{className:"border p-2",style:{minHeight:"30vh",height:"100%"},children:(0,C.jsx)(w,{StaffArray:X,setStaffArray:Z,costCenter:T.staff,costCategory:T.staffType})})}),(0,C.jsx)("div",{className:"col-xxl-9 col-lg-8 col-md-7 py-2 px-0",children:(0,C.jsx)("div",{className:"border px-3 py-1",style:{minHeight:"30vh",height:"100%"},children:(0,C.jsx)(G.A,{invoiceInfo:L,setInvoiceInfo:U,retailers:T.retailers,branches:T.branch,voucherType:T.voucherType,stockItemLedgerName:T.stockItemLedgerName,onChangeRetailer:()=>{W([]),J([])},retailerDeliveryAddress:M,setRetailerDeliveryAddress:F,shippingAddress:H,setShippingAddress:V})})})]}),(0,C.jsx)(x.Ay,{title:"Items",headerFontSizePx:13,bodyFontSizePx:13,EnableSerialNumber:!0,disablePagination:!0,ButtonArea:(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(s.A,{onClick:()=>{Y(null),z(e=>(0,o.A)((0,o.A)({},e),{},{addProductDialog:!0}))},sx:{ml:1},variant:"outlined",type:"button",startIcon:(0,C.jsx)(I.A,{}),disabled:!(0,_.IQ)(L.Retailer_Id)||$.length>0&&(0,_.IQ)(L.So_No),children:"Add Product"}),(0,C.jsx)(B.A,{loadingOn:l,loadingOff:t,open:Q.importFromSaleOrder,onClose:()=>z(e=>(0,o.A)((0,o.A)({},e),{},{importFromSaleOrder:!1})),retailer:null===L||void 0===L?void 0:L.Retailer_Id,selectedItems:$,setSelectedItems:W,staffArray:X,setStaffArray:Z,products:T.products,GST_Inclusive:L.GST_Inclusive,IS_IGST:te,invoiceInfo:L,setInvoiceInfo:U,godowns:T.godown,stockInGodown:T.stockInGodown,children:(0,C.jsx)(s.A,{onClick:()=>z(e=>(0,o.A)((0,o.A)({},e),{},{importFromSaleOrder:!0})),disabled:!(0,_.IQ)(L.Retailer_Id)||$.length>0&&!(0,_.IQ)(L.So_No),sx:{ml:1},type:"button",variant:"outlined",startIcon:(0,C.jsx)(h.A,{}),children:"Choose Sale Order"})})]}),dataArray:[...$,...Array.from({length:de>0?de:0}).map(e=>N.a4)],columns:[(0,x.Lj)("Item_Name","string"),(0,x.Lj)("Batch_Name","string"),(0,x.Lj)("Bill_Qty","number"),(0,x.Lj)("Act_Qty","number"),(0,x.Lj)("Item_Rate","number"),{isVisible:1,ColumnHeader:"Tax",isCustomCell:!0,Cell:e=>{let{row:l}=e;const{Cgst:t=0,Sgst:o=0,Igst:d=0,Cgst_Amo:a=0,Sgst_Amo:s=0,Igst_Amo:i=0}=l,n=te?d:(0,_.Lr)(t,o),r=te?i:(0,_.Lr)(a,s);return(0,_.IQ)(null===l||void 0===l?void 0:l.Item_Id)?"".concat(r," - (").concat(n," %)"):""}},{isVisible:1,ColumnHeader:"Godown",isCustomCell:!0,Cell:e=>{var l,t;let{row:o}=e;return null!==(l=null===(t=T.godown.find(e=>(0,_.id)(e.Godown_Id,null===o||void 0===o?void 0:o.GoDown_Id)))||void 0===t?void 0:t.Godown_Name)&&void 0!==l?l:""}},(0,x.Lj)("Amount","number"),{isCustomCell:!0,Cell:e=>{let{row:l}=e;return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(n.A,{onClick:()=>{Y(l),z(e=>(0,o.A)((0,o.A)({},e),{},{addProductDialog:!0}))},size:"small",type:"button",disabled:!(0,_.IQ)(null===l||void 0===l?void 0:l.Item_Id),children:(0,C.jsx)(A.A,{})}),(0,C.jsx)(n.A,{size:"small",type:"button",onClick:()=>W(e=>e.filter(e=>!(0,_.id)(e.Item_Id,l.Item_Id))),color:"error",disabled:!(0,_.IQ)(null===l||void 0===l?void 0:l.Item_Id),children:(0,C.jsx)(g.A,{})})]})},ColumnHeader:"Action",isVisible:1}]}),(0,C.jsxs)(r.A,{open:ae.open,maxWidth:"lg",fullWidth:!0,scroll:"paper",children:[(0,C.jsxs)(c.A,{children:["Print Invoice #",ae.Do_Id,(0,C.jsx)(n.A,{onClick:()=>{se({open:!1,Do_Id:null}),ie(),f("/erp/sales/invoice")},style:{position:"absolute",right:8,top:8},children:(0,C.jsx)(p.A,{})})]}),(0,C.jsx)(u.A,{children:ae.Do_Id&&(0,C.jsx)(E.A,{Do_Id:ae.Do_Id,loadingOn:l,loadingOff:t})}),(0,C.jsx)(v.A,{children:(0,C.jsx)(s.A,{onClick:()=>{se({open:!1,Do_Id:null}),ie(),f("/erp/sales/invoice")},children:"Close and Go to Listing"})})]}),(0,C.jsx)("br",{}),(0,C.jsx)(P.A,{invoiceExpences:q,setInvoiceExpences:J,expenceMaster:T.expence,IS_IGST:te,taxType:oe}),(0,C.jsx)("br",{}),(0,C.jsx)(D.A,{invoiceProducts:$,invoiceExpences:q,isNotTaxableBill:le,isInclusive:ee,IS_IGST:te,products:T.products,invoiceInfo:L,setInvoiceInfo:U})]})]})]})}},44676:(e,l,t)=>{t.d(l,{A:()=>a});var o=t(59662),d=t(70579);const a=(0,o.A)([(0,d.jsx)("path",{d:"M19.5 3.5 18 2l-1.5 1.5L15 2l-1.5 1.5L12 2l-1.5 1.5L9 2 7.5 3.5 6 2v14H3v3c0 1.66 1.34 3 3 3h12c1.66 0 3-1.34 3-3V2zM19 19c0 .55-.45 1-1 1s-1-.45-1-1v-3H8V5h11z"},"0"),(0,d.jsx)("path",{d:"M9 7h6v2H9zm7 0h2v2h-2zm-7 3h6v2H9zm7 0h2v2h-2z"},"1")],"ReceiptLong")}}]);
//# sourceMappingURL=6430.57301220.chunk.js.map