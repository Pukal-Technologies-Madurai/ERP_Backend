"use strict";(self.webpackChunkerp=self.webpackChunkerp||[]).push([[7806],{10489:(e,t,o)=>{o.d(t,{A:()=>r});o(65043);var l=o(83462),d=o(26600),a=o(35316),i=o(29347),n=o(11906),s=o(70579);const r=e=>{let{open:t=!1,onClose:o,children:r,title:c,onSubmit:u,submitText:v="Submit",closeText:m="Close",maxWidth:p="sm",fullWidth:_=!0,isSubmit:I=!1}=e;return(0,s.jsxs)(l.A,{open:t,onClose:o,fullWidth:_,maxWidth:p,children:[c&&(0,s.jsx)(d.A,{children:c}),(0,s.jsx)(a.A,{children:r}),(0,s.jsxs)(i.A,{children:[(0,s.jsx)(n.A,{onClick:o,children:m}),u&&(0,s.jsx)(n.A,{variant:"contained",onClick:u,type:I?"submit":"button",children:v})]})]})}},44676:(e,t,o)=>{o.d(t,{A:()=>a});var l=o(59662),d=o(70579);const a=(0,l.A)([(0,d.jsx)("path",{d:"M19.5 3.5 18 2l-1.5 1.5L15 2l-1.5 1.5L12 2l-1.5 1.5L9 2 7.5 3.5 6 2v14H3v3c0 1.66 1.34 3 3 3h12c1.66 0 3-1.34 3-3V2zM19 19c0 .55-.45 1-1 1s-1-.45-1-1v-3H8V5h11z"},"0"),(0,d.jsx)("path",{d:"M9 7h6v2H9zm7 0h2v2h-2zm-7 3h6v2H9zm7 0h2v2h-2z"},"1")],"ReceiptLong")},77806:(e,t,o)=>{o.r(t),o.d(t,{default:()=>K});var l=o(89379),d=o(65043),a=o(12110),i=o(11906),n=o(26494),s=o(17392),r=o(83462),c=o(26600),u=o(35316),v=o(29347),m=o(98587),p=o(58168),_=o(58387),I=o(68606),h=o(34535),A=o(6431),g=o(57056),b=o(32400);function x(e){return(0,b.Ay)("MuiCardActions",e)}(0,g.A)("MuiCardActions",["root","spacing"]);var y=o(70579);const f=["disableSpacing","className"],N=(0,h.Ay)("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,!o.disableSpacing&&t.spacing]}})(e=>{let{ownerState:t}=e;return(0,p.A)({display:"flex",alignItems:"center",padding:8},!t.disableSpacing&&{"& > :not(style) ~ :not(style)":{marginLeft:8}})}),j=d.forwardRef(function(e,t){const o=(0,A.b)({props:e,name:"MuiCardActions"}),{disableSpacing:l=!1,className:d}=o,a=(0,m.A)(o,f),i=(0,p.A)({},o,{disableSpacing:l}),n=(e=>{const{classes:t,disableSpacing:o}=e,l={root:["root",!o&&"spacing"]};return(0,I.A)(l,x,t)})(i);return(0,y.jsx)(N,(0,p.A)({className:(0,_.A)(n.root,d),ownerState:i,ref:t},a))});var S=o(91036),C=o(97707),w=o(33438),T=o(70141),E=o(44676),D=o(83560),G=o(51387),R=o(65074),O=o(48471),P=o(14844),B=o(73216),Q=o(97280),L=o(63406),k=o(20656);const M=e=>{let{StaffArray:t=[],setStaffArray:o,costCenter:d=[],costCategory:a=[]}=e;const n=(e,o)=>{return(0,C.IQ)(null===e||void 0===e?void 0:e.Emp_Type_Id)?(l=e.Emp_Type_Id,a=o,(0,C.IQ)(l)?(0,C.$r)(d).filter(e=>(0,C.id)(e.User_Type,l)&&!t.some((t,o)=>o!==a&&(0,C.id)(t.Emp_Id,e.Cost_Center_Id))).map(e=>({value:e.Cost_Center_Id,label:e.Cost_Center_Name,userType:e.User_Type})):[]):(e=>(0,C.$r)(d).filter(o=>!t.some((t,l)=>l!==e&&(0,C.id)(t.Emp_Id,o.Cost_Center_Id))).map(e=>({value:e.Cost_Center_Id,label:e.Cost_Center_Name,userType:e.User_Type})))(o);var l,a};return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)("div",{className:"d-flex align-items-center flex-wrap mb-2 border-bottom pb-2",children:[(0,y.jsx)("h6",{className:"flex-grow-1 m-0",children:"Staff Involved"}),(0,y.jsx)(i.A,{variant:"outlined",color:"primary",type:"button",onClick:()=>o(e=>[...e,(0,l.A)({},Q.Ud)]),children:"Add"})]}),(0,y.jsxs)("table",{className:"table table-bordered",children:[(0,y.jsx)("thead",{children:(0,y.jsxs)("tr",{children:[(0,y.jsx)("th",{className:"fa-13",children:"Sno"}),(0,y.jsx)("th",{className:"fa-13",children:"Category"}),(0,y.jsx)("th",{className:"fa-13",children:"Staff Name"}),(0,y.jsx)("th",{className:"fa-13",children:"#"})]})}),(0,y.jsx)("tbody",{children:(0,C.$r)(t).map((e,t)=>(0,y.jsxs)("tr",{children:[(0,y.jsx)("td",{className:"fa-13 vctr text-center",children:t+1}),(0,y.jsx)("td",{className:"fa-13 w-100 p-0",children:(0,y.jsx)(k.Ay,{value:(0,C.IQ)(null===e||void 0===e?void 0:e.Emp_Id)?{value:null===e||void 0===e?void 0:e.Emp_Id,label:null===e||void 0===e?void 0:e.Emp_Name}:null,onChange:e=>((e,t)=>{o(o=>o.map((o,a)=>{if(a===t){const t=(0,C.$r)(d).find(t=>(0,C.id)(t.Cost_Center_Id,e.value));return(0,l.A)((0,l.A)({},o),{},{Emp_Id:Number(e.value),Emp_Name:e.label,Emp_Type_Id:(null===t||void 0===t?void 0:t.User_Type)||""})}return o}))})(e,t),options:n(e,t),styles:L.MR,isSearchable:!0,placeholder:"Select Staff",filterOption:C.GI,noOptionsMessage:()=>(0,C.IQ)(null===e||void 0===e?void 0:e.Emp_Type_Id)?"No staff available for this category":"No staff available"})}),(0,y.jsx)("td",{className:"fa-13 vctr p-0",style:{maxWidth:"130px",minWidth:"100px"},children:(0,y.jsxs)("select",{value:(null===e||void 0===e?void 0:e.Emp_Type_Id)||"",onChange:e=>((e,t)=>{const a=e.target.value;o(e=>e.map((e,o)=>{if(o===t){const t=(0,C.$r)(d).find(t=>(0,C.id)(t.Cost_Center_Id,e.Emp_Id)),o=t&&!(0,C.id)(t.User_Type,a);return(0,l.A)((0,l.A)({},e),{},{Emp_Type_Id:a},o?{Emp_Id:"",Emp_Name:""}:{})}return e}))})(e,t),className:"cus-inpt p-2 border-0 w-100",children:[(0,y.jsx)("option",{value:"",children:"Select Category"}),(0,C.$r)(a).map((e,t)=>(0,y.jsx)("option",{value:null===e||void 0===e?void 0:e.Cost_Category_Id,children:null===e||void 0===e?void 0:e.Cost_Category},t))]})}),(0,y.jsx)("td",{className:"fa-13 vctr p-0",children:(0,y.jsx)(s.A,{onClick:()=>{o(e=>e.filter((e,o)=>t!==o))},size:"small",children:(0,y.jsx)(G.A,{color:"error"})})})]},t))})]})]})};var z=o(94232),U=o(24651),F=o(34104),H=o(35786),V=o(34496),$=o(14792);const W=(e,t,o)=>{var l;const d=null===(l=(0,C.$r)(o).find(o=>(0,C.id)(null===o||void 0===o?void 0:o.Product_Id,e)&&(0,C.id)(null===o||void 0===o?void 0:o.Godown_Id,t)))||void 0===l?void 0:l.Act_Bal_Qty;return(0,C.Ro)(d)},q=e=>{var t,o;let{children:a,orderProducts:n=[],setOrderProducts:s,open:m=!1,onClose:p,products:_=[],brands:I=[],uom:h=[],godowns:A=[],GST_Inclusive:g,IS_IGST:b,editValues:x=null,initialValue:f={},batchDetails:N=[]}=e;const[j,w]=(0,d.useState)(f),T=(0,C.id)(g,1),E=(0,C.id)(g,2),[D,G]=(0,d.useState)([]);(0,d.useEffect)(()=>{(0,C.aF)(x)&&m&&w(e=>Object.fromEntries(Object.entries(e).map(e=>{let[t,o]=e;return[t,x[t]?x[t]:o]})))},[x]);const O=e=>{var t;return null!==(t=null===_||void 0===_?void 0:_.find(t=>(0,C.id)(null===t||void 0===t?void 0:t.Product_Id,e)))&&void 0!==t?t:{}},B=()=>{w(f),p()};return(0,d.useEffect)(()=>{G([]),(0,C.IQ)(j.Item_Id)&&!(0,C.id)(j.Item_Id,0)&&(0,R.z)({address:"sales/stockInGodown?Item_Id=".concat(j.Item_Id)}).then(e=>{const t=(e.success?e.data:[]).sort((e,t)=>String(null===e||void 0===e?void 0:e.stock_item_name).localeCompare(null===t||void 0===t?void 0:t.stock_item_name));G(t)})},[j.Item_Id]),(0,y.jsxs)(y.Fragment,{children:[a,(0,y.jsxs)(r.A,{open:m,onClose:B,maxWidth:"md",fullWidth:!0,children:[(0,y.jsx)(c.A,{className:"border-bottom",children:(0,y.jsx)("span",{children:"Add Products Details"})}),(0,y.jsxs)("form",{onSubmit:e=>{e.preventDefault(),j.Item_Id?(s(e=>[...e.filter(e=>!(0,C.id)(e.Item_Id,j.Item_Id)),Object.fromEntries(Object.entries(f).map(e=>{let[t,o]=e;const l=O(j.Item_Id),d=b?l.Igst_P:l.Gst_P,a=d>0,{Bill_Qty:i,Item_Rate:n,Amount:s}=j,r=E?"zerotax":T?"remove":"add",c=(0,P.v)(n,d,r),u=(0,P.v)(s,d,r),v=b?0:u.cgst_per,m=b?u.igst_per:0,p=b?0:u.cgst_amount,_=b?u.igst_amount:0;switch(t){case"Item_Name":return[t,l.Product_Name];case"Taxable_Rate":return[t,c.base_amount];case"Total_Qty":return[t,i];case"Taxble":return[t,a?1:0];case"Taxable_Amount":return[t,u.base_amount];case"Tax_Rate":return[t,d];case"Cgst":case"Sgst":return[t,null!==v&&void 0!==v?v:0];case"Cgst_Amo":case"Sgst_Amo":return[t,E?0:p];case"Igst":return[t,null!==m&&void 0!==m?m:0];case"Igst_Amo":return[t,E?0:_];case"Final_Amo":return[t,u.with_tax];default:return[t,j[t]||o]}}))]),B()):S.oR.warn("Select Product")},children:[(0,y.jsx)(u.A,{children:(0,y.jsxs)("div",{className:"row pb-5",children:[(0,y.jsxs)("div",{className:"col-6 p-2",children:[(0,y.jsx)("label",{children:"Brand"}),(0,y.jsx)(k.Ay,{value:{value:j.BrandID,label:j.Brand},onChange:e=>w(t=>(0,l.A)((0,l.A)({},t),{},{BrandID:e.value,Brand:e.label})),options:[{value:"",label:"select",isDisabled:!0},...I.map(e=>({value:null===e||void 0===e?void 0:e.Brand,label:null===e||void 0===e?void 0:e.Brand_Name}))],styles:L.MR,menuPortalTarget:document.body,isSearchable:!0,placeholder:"Select Brand",maxMenuHeight:200,filterOption:C.GI})]}),(0,y.jsxs)("div",{className:"col-6 p-2",children:[(0,y.jsx)("label",{children:"Group"}),(0,y.jsx)(k.Ay,{value:{value:j.GroupID,label:j.Group},onChange:e=>w(t=>(0,l.A)((0,l.A)({},t),{},{GroupID:e.value,Group:e.label})),options:[{value:"",label:"select",isDisabled:!0},..._.filter(e=>!j.BrandID||(0,C.id)(e.Brand,j.BrandID)).reduce((e,t)=>(e.some(e=>e.value===t.Product_Group)||e.push({value:t.Product_Group,label:t.Pro_Group}),e),[])],styles:L.MR,menuPortalTarget:document.body,isSearchable:!0,placeholder:"Select Group",maxMenuHeight:200,filterOption:C.GI})]}),(0,y.jsxs)("div",{className:Object.hasOwn(j,"GoDown_Id")?"col-md-8 p-2":"col-12 p-2",children:[(0,y.jsxs)("label",{children:["Item Name ",(0,y.jsx)($.A,{})]}),(0,y.jsx)(k.Ay,{value:{value:j.Item_Id,label:null===(t=O(j.Item_Id))||void 0===t?void 0:t.Product_Name},isDisabled:(0,C.IQ)(j.Pre_Id),menuPortalTarget:document.body,onChange:e=>{const t=O(e.value);w(o=>{var d,a,i,n,s,r,c;return(0,l.A)((0,l.A)({},o),{},{Group:null!==(d=t.Pro_Group)&&void 0!==d?d:o.Group,GroupID:null!==(a=t.Product_Group)&&void 0!==a?a:o.GroupID,Brand:null!==(i=t.Brand_Name)&&void 0!==i?i:o.Brand,BrandID:null!==(n=t.Brand)&&void 0!==n?n:o.BrandID,Item_Id:e.value,Item_Rate:null!==(s=t.Item_Rate)&&void 0!==s?s:0,GoDown_Id:"",Bill_Qty:0,Amount:0,Unit_Id:null!==(r=t.UOM_Id)&&void 0!==r?r:o.Unit_Id,Unit_Name:null!==(c=t.Units)&&void 0!==c?c:o.Unit_Name,HSN_Code:null===t||void 0===t?void 0:t.HSN_Code})})},options:[{value:"",label:"select",isDisabled:!0},...[..._.filter(e=>!j.BrandID||(0,C.id)(e.Brand,j.BrandID)).filter(e=>!j.GroupID||(0,C.id)(e.Product_Group,j.GroupID))].map(e=>({value:null===e||void 0===e?void 0:e.Product_Id,label:null===e||void 0===e?void 0:e.Product_Name,isDisabled:-1!==n.findIndex(t=>(0,C.id)(null===t||void 0===t?void 0:t.Item_Id,null===e||void 0===e?void 0:e.Product_Id))}))],styles:L.MR,isSearchable:!0,required:!0,placeholder:"Select Product",maxMenuHeight:200,filterOption:C.GI})]}),Object.hasOwn(j,"GoDown_Id")&&(0,y.jsxs)("div",{className:"col-md-4 p-2",children:[(0,y.jsx)("label",{children:"Godown"}),(0,y.jsx)(k.Ay,{value:{value:null===j||void 0===j?void 0:j.GoDown_Id,label:(null===(o=A.find(e=>(0,C.id)(e.Godown_Id,null===j||void 0===j?void 0:j.GoDown_Id)))||void 0===o?void 0:o.Godown_Name)||""},onChange:e=>w(t=>(0,l.A)((0,l.A)({},t),{},{GoDown_Id:e.value})),options:[{value:"",label:"select",isDisabled:!0},...(0,C.$r)(A).map(e=>({value:null===e||void 0===e?void 0:e.Godown_Id,label:"".concat(null===e||void 0===e?void 0:e.Godown_Name).concat((0,C.IQ)(null===e||void 0===e?void 0:e.Godown_Id)?" (Bal: ".concat(W(j.Item_Id,null===e||void 0===e?void 0:e.Godown_Id,D),")"):"")}))],styles:L.MR,isDisabled:!(0,C.IQ)(null===j||void 0===j?void 0:j.Item_Id),menuPortalTarget:document.body,isSearchable:!0,placeholder:"Select Godown",filterOption:C.GI})]}),(0,y.jsxs)("div",{className:"col-lg-4 col-md-6 p-2",children:[(0,y.jsxs)("label",{children:["Quantity ",(0,y.jsx)($.A,{})]}),(0,y.jsx)("input",{required:!0,value:j.Bill_Qty?j.Bill_Qty:"",onInput:C.BE,disabled:!(0,C.IQ)(j.Item_Id),onChange:e=>{j.Item_Rate?w(t=>(0,l.A)((0,l.A)({},t),{},{Amount:(0,C.JH)(j.Item_Rate,e.target.value),Bill_Qty:e.target.value})):j.Amount?w(t=>(0,l.A)((0,l.A)({},t),{},{Item_Rate:(0,C.SX)(t.Amount,e.target.value),Bill_Qty:e.target.value})):w(t=>(0,l.A)((0,l.A)({},t),{},{Bill_Qty:e.target.value}))},className:"cus-inpt",min:1})]}),Object.hasOwn(j,"Act_Qty")&&(0,y.jsxs)("div",{className:"col-lg-4 col-md-6 p-2",children:[(0,y.jsx)("label",{children:"Actual Quantity "}),(0,y.jsx)("input",{value:j.Act_Qty?j.Act_Qty:"",onInput:C.BE,disabled:!(0,C.IQ)(j.Item_Id),onChange:e=>w(t=>(0,l.A)((0,l.A)({},t),{},{Act_Qty:e.target.value})),required:!0,className:"cus-inpt"})]}),(0,y.jsxs)("div",{className:"col-lg-4 col-md-6 p-2",children:[(0,y.jsx)("label",{children:"Rate "}),(0,y.jsx)("input",{value:j.Item_Rate?j.Item_Rate:"",onInput:C.BE,disabled:!(0,C.IQ)(j.Item_Id),onChange:e=>w(t=>(0,l.A)((0,l.A)({},t),{},{Item_Rate:e.target.value,Amount:t.Bill_Qty?(0,C.JH)(e.target.value,t.Bill_Qty):t.Amount})),required:!0,className:"cus-inpt"})]}),(0,y.jsxs)("div",{className:"col-lg-4 col-md-6 p-2",children:[(0,y.jsx)("label",{children:"UOM"}),(0,y.jsxs)("select",{value:Object.hasOwn(j,"UOM")?j.UOM:Object.hasOwn(j,"Unit_Id")?j.Unit_Id:"",onChange:e=>{const t=e.target.selectedIndex,o=e.target.options[t].text,d=e.target.value;w(e=>(0,l.A)((0,l.A)({},e),{},{UOM:d,Unit_Id:d,Units:o,Unit_Name:o}))},className:"cus-inpt",disabled:!(0,C.IQ)(j.Item_Id),children:[(0,y.jsx)("option",{value:"",disabled:!0,children:"select"}),h.map((e,t)=>(0,y.jsx)("option",{value:e.Unit_Id,children:e.Units},t))]})]}),(0,y.jsxs)("div",{className:"col-lg-4 col-md-6 p-2",children:[(0,y.jsx)("label",{children:"Amount"}),(0,y.jsx)("input",{required:!0,value:j.Amount?j.Amount:"",onInput:C.BE,disabled:!(0,C.IQ)(j.Item_Id),onChange:e=>w(t=>(0,l.A)((0,l.A)({},t),{},{Amount:e.target.value,Item_Rate:t.Bill_Qty?(0,C.SX)(e.target.value,t.Bill_Qty):t.Item_Rate})),className:"cus-inpt",min:1})]}),(0,y.jsxs)("div",{className:"col-lg-4 col-md-6 p-2",children:[(0,y.jsx)("label",{children:"Batch"}),(0,y.jsx)(k.Ay,{value:{value:(null===j||void 0===j?void 0:j.Batch_Name)||"",label:(null===j||void 0===j?void 0:j.Batch_Name)||""},onChange:e=>w(t=>(0,l.A)((0,l.A)({},t),{},{Batch_Name:e.value})),options:N.filter(e=>(0,C.id)(e.item_id,null===j||void 0===j?void 0:j.Item_Id)&&(0,C.id)(null===e||void 0===e?void 0:e.godown_id,null===j||void 0===j?void 0:j.GoDown_Id)&&(0,C.Ro)(e.pendingQuantity)>=(0,C.Ro)(null===j||void 0===j?void 0:j.Bill_Qty)).map(e=>({value:e.batch,label:e.batch})),styles:L.MR,isSearchable:!0,placeholder:"Select Batch",menuPortalTarget:document.body,isDisabled:!0})]})]})}),(0,y.jsxs)(v.A,{className:"d-flex justify-content-between align-items-center",children:[(0,y.jsx)(i.A,{onClick:()=>w(f),type:"button",startIcon:(0,y.jsx)(V.A,{}),children:"Clear"}),(0,y.jsxs)("span",{children:[(0,y.jsx)(i.A,{type:"button",onClick:B,children:"cancel"}),(0,y.jsx)(i.A,{type:"submit",variant:"outlined",children:"Add"})]})]})]})]})]})};var J=o(90001),X=o(10489);const Y=(0,C.aN)().user,Z=function(){var e;let t=arguments.length>1?arguments[1]:void 0;return null!==(e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).find(e=>(0,C.id)(e.Product_Id,t)))&&void 0!==e?e:{}},K=e=>{let{loadingOn:t,loadingOff:o}=e;const m=(0,B.Zp)(),p=(0,B.zy)().state,[_,I]=(0,d.useState)({products:[],branch:[],retailers:[],voucherType:[],uom:[],staff:[],staffType:[],brand:[],godown:[],expence:[],stockInGodown:[],stockItemLedgerName:[],batchDetails:[]}),[h,A]=(0,d.useState)({addProductDialog:!1,importFromSaleOrder:!1}),[g,b]=(0,d.useState)(Q.Q4),[x,f]=(0,d.useState)(Q.zA),[N,L]=(0,d.useState)(Q.zA),[k,V]=(0,d.useState)([]),[$,W]=(0,d.useState)([]),[K,ee]=(0,d.useState)([]),[te,oe]=(0,d.useState)(Q.NP),[le,de]=(0,d.useState)(null),ae=(0,C.id)(g.GST_Inclusive,1),ie=(0,C.id)(g.GST_Inclusive,2),ne=(0,C.id)(g.IS_IGST,1),se=ie?"zerotax":ae?"remove":"add",re=3-k.length,[ce,ue]=(0,d.useState)({open:!1,Do_Id:null});(0,d.useEffect)(()=>{(async()=>{try{t&&t();const[e,o,d,a,i,n,s,r,c,u,v]=await Promise.all([(0,R.z)({address:"masters/branch/dropDown"}),(0,R.z)({address:"masters/products"}),(0,R.z)({address:"masters/retailers/dropDown?Company_Id=".concat(null===Y||void 0===Y?void 0:Y.Company_id)}),(0,R.z)({address:"masters/voucher?module=SALES"}),(0,R.z)({address:"masters/uom"}),(0,R.z)({address:"dataEntry/costCenter"}),(0,R.z)({address:"dataEntry/costCenter/category"}),(0,R.z)({address:"dataEntry/godownLocationMaster"}),(0,R.z)({address:"masters/defaultAccountMaster"}),(0,R.z)({address:"purchase/stockItemLedgerName?type=SALES"}),(0,R.z)({address:"inventory/batchMaster/stockBalance"})]),m=(e.success?e.data:[]).sort((e,t)=>String(null===e||void 0===e?void 0:e.BranchName).localeCompare(null===t||void 0===t?void 0:t.BranchName)),p=(o.success?o.data:[]).sort((e,t)=>String(null===e||void 0===e?void 0:e.Product_Name).localeCompare(null===t||void 0===t?void 0:t.Product_Name)),_=(d.success?d.data:[]).sort((e,t)=>String(null===e||void 0===e?void 0:e.Retailer_Name).localeCompare(null===t||void 0===t?void 0:t.Retailer_Name)),h=(a.success?a.data:[]).sort((e,t)=>String(null===e||void 0===e?void 0:e.Voucher_Type).localeCompare(null===t||void 0===t?void 0:t.Voucher_Type)),A=(i.success?i.data:[]).sort((e,t)=>String(e.Units).localeCompare(t.Units)),g=(n.success?n.data:[]).sort((e,t)=>String(null===e||void 0===e?void 0:e.Cost_Center_Name).localeCompare(null===t||void 0===t?void 0:t.Cost_Center_Name)),b=(s.success?s.data:[]).sort((e,t)=>String(null===e||void 0===e?void 0:e.Cost_Category).localeCompare(null===t||void 0===t?void 0:t.Cost_Category)),x=(r.success?r.data:[]).sort((e,t)=>String(null===e||void 0===e?void 0:e.Godown_Name).localeCompare(null===t||void 0===t?void 0:t.Godown_Name)),y=(c.success?(0,C.$r)(c.data):[]).sort((e,t)=>String(null===e||void 0===e?void 0:e.Account_Name).localeCompare(null===t||void 0===t?void 0:t.Account_Name)),f=(u.success?u.data:[]).sort((e,t)=>String(null===e||void 0===e?void 0:e.Stock_Item_Ledger_Name).localeCompare(null===t||void 0===t?void 0:t.Stock_Item_Ledger_Name));I(e=>(0,l.A)((0,l.A)({},e),{},{products:p,branch:m,retailers:_,voucherType:h,uom:A,staff:g,staffType:b,godown:x,brand:(0,C.Mn)(p,"Brand",["Brand_Name"]),expence:y.filter(e=>!(0,C.xL)(e.Type,"DEFAULT")).map(e=>({Id:e.Acc_Id,Expence_Name:e.Account_Name,percentageValue:e.percentageValue})),stockItemLedgerName:f,batchDetails:(0,C.$r)(v.data)}))}catch(e){console.error("Error fetching data:",e)}finally{o&&o()}})()},[null===Y||void 0===Y?void 0:Y.Company_id]),(0,d.useEffect)(()=>{(0,C.gf)(g.Retailer_Id)?(0,R.z)({address:"receipt/receiptMaster/pendingSalesInvoiceReceipt/amount?Retailer_Id=".concat(g.Retailer_Id),loadingOff:o,loadingOn:t}).then(e=>{if(e.success){const t=(0,Q.WS)(null===e||void 0===e?void 0:e.others);oe(o=>{var d,a,i,n,s;return(0,l.A)((0,l.A)({},o),{},{outstanding:(0,C.Ro)(null===e||void 0===e||null===(d=e.others)||void 0===d?void 0:d.outstanding),creditLimit:(0,C.Ro)(null===e||void 0===e||null===(a=e.others)||void 0===a?void 0:a.creditLimit),creditDays:(0,C.Ro)(null===e||void 0===e||null===(i=e.others)||void 0===i?void 0:i.creditDays),recentDate:null!==e&&void 0!==e&&null!==(n=e.others)&&void 0!==n&&n.recentDate?new Date(null===e||void 0===e||null===(s=e.others)||void 0===s?void 0:s.recentDate):new Date,invoiceCreationStatus:t})})}}).catch(console.error):oe(Q.NP)},[g.Retailer_Id]),(0,d.useEffect)(()=>{if((0,C.IQ)(g.Retailer_Id)&&_.retailers.length){const e=(0,C.$r)(_.retailers).find(e=>(0,C.id)(null===e||void 0===e?void 0:e.Retailer_Id,g.Retailer_Id));if(!e)return;ee(t=>{const o=[];(0,C.gf)(e.brokerId)&&o.push({Emp_Id:e.brokerId,Emp_Name:e.brokerName,Emp_Type_Id:e.brokerTypeId}),(0,C.gf)(e.transporterId)&&o.push({Emp_Id:e.transporterId,Emp_Name:e.transporterName,Emp_Type_Id:e.transporterTypeId});const l=o.filter(e=>!t.some(t=>t.Emp_Id===e.Emp_Id&&t.Emp_Type_Id===e.Emp_Type_Id)),d=Array.from(new Map(l.map(e=>["".concat(e.Emp_Id,"-").concat(e.Emp_Type_Id),e])).values());return[...t,...d]})}},[g.Retailer_Id,_.retailers.length]);const ve=()=>{b(Q.Q4),V([]),W([]),ee([])};(0,d.useEffect)(()=>{V(e=>[...e].map(e=>Object.fromEntries(Object.entries(e).map(t=>{let[o,l]=t;const d=Z(_.products,null===e||void 0===e?void 0:e.Item_Id),a=ne?d.Igst_P:d.Gst_P,i=a>0,{Bill_Qty:n,Item_Rate:s,Amount:r}=e,c=(0,P.v)(s,a,se),u=(0,P.v)(r,a,se),v=ne?0:u.cgst_per,m=ne?u.igst_per:0,p=ne?0:u.cgst_amount,I=ne?u.igst_amount:0;switch(o){case"Taxable_Rate":return[o,c.base_amount];case"Total_Qty":return[o,n];case"Taxble":return[o,i?1:0];case"Taxable_Amount":return[o,u.base_amount];case"Tax_Rate":return[o,a];case"Cgst":case"Sgst":return[o,null!==v&&void 0!==v?v:0];case"Cgst_Amo":case"Sgst_Amo":return[o,ie?0:p];case"Igst":return[o,null!==m&&void 0!==m?m:0];case"Igst_Amo":return[o,ie?0:I];case"Final_Amo":return[o,u.with_tax];default:return[o,e[o]||l]}}))))},[_.products,ne,se]),(0,d.useEffect)(()=>{W(e=>[...e].map(e=>{const t=ne?(0,C.Ro)(null===e||void 0===e?void 0:e.Igst):0,o=ne?0:(0,C.Ro)(null===e||void 0===e?void 0:e.Cgst),d=ne?0:(0,C.Ro)(null===e||void 0===e?void 0:e.Sgst),a=(0,C.Ro)(null===e||void 0===e?void 0:e.Expence_Value),i=ne?t:(0,C.Lr)(o,d),n=(0,P.v)(a,i,se);return(0,l.A)((0,l.A)({},e),{},{Cgst:o,Sgst:d,Igst:t,Expence_Value:a,Cgst_Amo:o>0?n.cgst_amount:0,Sgst_Amo:d>0?n.sgst_amount:0,Igst_Amo:t>0?n.igst_amount:0})}))},[_.expence,ne,se]),(0,d.useEffect)(()=>{if((0,C.aF)(p)&&Array.isArray(null===p||void 0===p?void 0:p.Products_List)){const{Products_List:e,Expence_Array:t,Staffs_Array:o}=p;b(Object.fromEntries(Object.entries(Q.Q4).map(e=>{var t;let[o,l]=e;return"Do_Date"===o?[o,p[o]?(0,C.ny)(p[o]):l]:[o,null!==(t=p[o])&&void 0!==t?t:l]}))),V(e.map(e=>Object.fromEntries(Object.entries(Q.a4).map(t=>{var o;let[l,d]=t;return[l,null!==(o=e[l])&&void 0!==o?o:d]})))),W((0,C.$r)(t).map(e=>Object.fromEntries(Object.entries(Q.ju).map(t=>{var o;let[l,d]=t;return[l,null!==(o=e[l])&&void 0!==o?o:d]})))),ee(()=>{const e=(0,C.$r)(o).map(e=>Object.fromEntries(Object.entries(Q.Ud).map(t=>{var o;let[l,d]=t;return[l,null!==(o=e[l])&&void 0!==o?o:d]})));return Array.from(new Map(e.map(e=>["".concat(e.Emp_Id,"-").concat(e.Emp_Type_Id),e])).values())})}},[p]),(0,d.useEffect)(()=>{const e=(null===p||void 0===p?void 0:p.Retailer_Id)||g.Retailer_Id;if((0,C.gf)(e)){var t,o;const l=_.retailers.find(t=>(0,C.id)(t.Retailer_Id,e))||{},d=(0,C.$r)(null===l||void 0===l?void 0:l.deliveryAddresses),a=d.length>0?d[0]:null,i=null!==(t=d.find(e=>(0,C.id)(null===e||void 0===e?void 0:e.id,null===p||void 0===p?void 0:p.deliveryAddressId)))&&void 0!==t?t:null;i?f({deliveryName:null===i||void 0===i?void 0:i.deliveryName,phoneNumber:null===i||void 0===i?void 0:i.phoneNumber,cityName:null===i||void 0===i?void 0:i.cityName,deliveryAddress:null===i||void 0===i?void 0:i.deliveryAddress,gstNumber:null===i||void 0===i?void 0:i.gstNumber,stateName:null===i||void 0===i?void 0:i.stateName,id:i.id}):a&&f({deliveryName:null===a||void 0===a?void 0:a.deliveryName,phoneNumber:null===a||void 0===a?void 0:a.phoneNumber,cityName:null===a||void 0===a?void 0:a.cityName,deliveryAddress:null===a||void 0===a?void 0:a.deliveryAddress,gstNumber:null===a||void 0===a?void 0:a.gstNumber,stateName:null===a||void 0===a?void 0:a.stateName,id:a.id});const n=null!==(o=d.find(e=>(0,C.id)(null===e||void 0===e?void 0:e.id,null===p||void 0===p?void 0:p.shipingAddressId)))&&void 0!==o?o:null;n?L({deliveryName:null===n||void 0===n?void 0:n.deliveryName,phoneNumber:null===n||void 0===n?void 0:n.phoneNumber,cityName:null===n||void 0===n?void 0:n.cityName,deliveryAddress:null===n||void 0===n?void 0:n.deliveryAddress,gstNumber:null===n||void 0===n?void 0:n.gstNumber,stateName:null===n||void 0===n?void 0:n.stateName,id:n.id}):a&&L({deliveryName:null===a||void 0===a?void 0:a.deliveryName,phoneNumber:null===a||void 0===a?void 0:a.phoneNumber,cityName:null===a||void 0===a?void 0:a.cityName,deliveryAddress:null===a||void 0===a?void 0:a.deliveryAddress,gstNumber:null===a||void 0===a?void 0:a.gstNumber,stateName:null===a||void 0===a?void 0:a.stateName,id:a.id})}},[p,_.retailers,g.Retailer_Id]);const me=(0,d.useMemo)(()=>(0,C.$r)($).reduce((e,t)=>(0,C.Lr)(e,null===t||void 0===t?void 0:t.Expence_Value),0),[$]),pe=(0,d.useMemo)(()=>{const e=k.reduce((e,t)=>{const o=(0,C.e3)(null===t||void 0===t?void 0:t.Amount);if(ie)return(0,C.Lr)(e,o);const l=Z(_.products,t.Item_Id),d=ne?l.Igst_P:l.Gst_P;return ae?(0,C.Lr)(e,(0,P.v)(o,d,"remove").with_tax):(0,C.Lr)(e,(0,P.v)(o,d,"add").with_tax)},0);return(0,C.Lr)(e,me)},[k,ie,_.products,ne,ae,me]),_e=(0,d.useMemo)(()=>{if(0===(0,C.$r)(k).length)return{};let e=0,t=0;k.forEach(o=>{const l=(0,C.e3)((null===o||void 0===o?void 0:o.Amount)||0);if(ie)return void(e=(0,C.Lr)(e,l));const d=Z(_.products,o.Item_Id),a=(0,C.id)(ne,1)?d.Igst_P:d.Gst_P,i=(0,P.v)(l,a,ae?"remove":"add");e=(0,C.Lr)(e,parseFloat(i.without_tax)),t=(0,C.Lr)(t,parseFloat(i.tax_amount))});const o=(0,C.Lr)(e,t),l=(0,C.Lr)(o,me),d=Math.round(l),a=(0,C.e3)(d-l),i=(0,C.id)(ne,1)?0:(0,C.e3)(t/2),n=(0,C.id)(ne,1)?0:(0,C.e3)(t/2),s=(0,C.id)(ne,1)?(0,C.e3)(t):0;return{totalTaxable:(0,C.e3)(e),totalTax:(0,C.e3)(t),cgst:i,sgst:n,igst:s,roundOff:a,invoiceTotal:d}},[k,_.products,ne,ie,ae,me]);(0,d.useEffect)(()=>{null!==_e&&void 0!==_e&&_e.roundOff&&(null===_e||void 0===_e?void 0:_e.roundOff)!==g.Round_off&&b(e=>(0,l.A)((0,l.A)({},e),{},{Round_off:_e.roundOff}))},[null===_e||void 0===_e?void 0:_e.roundOff]);const Ie=()=>{!1!==te.forceCreateInvoice||!1!==te.invoiceCreationStatus?(0,R.z)({address:"sales/salesInvoice",method:(0,C.IQ)(null===g||void 0===g?void 0:g.Do_Id)?"PUT":"POST",loadingOff:o,loadingOn:t,bodyData:(0,l.A)((0,l.A)({},g),{},{deliveryAddressDetails:{delivery_id:null===x||void 0===x?void 0:x.id,deliveryName:null===x||void 0===x?void 0:x.deliveryName,phoneNumber:null===x||void 0===x?void 0:x.phoneNumber,cityName:null===x||void 0===x?void 0:x.cityName,deliveryAddress:null===x||void 0===x?void 0:x.deliveryAddress,gstNumber:null===x||void 0===x?void 0:x.gstNumber,stateName:null===x||void 0===x?void 0:x.stateName},shipingAddressDetails:{delivery_id:null===N||void 0===N?void 0:N.id,deliveryName:null===N||void 0===N?void 0:N.deliveryName,phoneNumber:null===N||void 0===N?void 0:N.phoneNumber,cityName:null===N||void 0===N?void 0:N.cityName,deliveryAddress:null===N||void 0===N?void 0:N.deliveryAddress,gstNumber:null===N||void 0===N?void 0:N.gstNumber,stateName:null===N||void 0===N?void 0:N.stateName},Product_Array:k,Staffs_Array:Array.from(new Map(K.map(e=>["".concat(e.Emp_Id,"-").concat(e.Emp_Type_Id),e])).values()),Expence_Array:$})}).then(e=>{if(e.success){var t;const o=null===(t=e.others)||void 0===t?void 0:t.Do_Id;S.oR.success(e.message),ue({open:!0,Do_Id:o})}else S.oR.warn(e.message)}).catch(e=>{console.error(e),S.oR.error("Failed to save invoice")}):oe(e=>(0,l.A)((0,l.A)({},e),{},{dialog:!0}))};return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(q,{orderProducts:k,setOrderProducts:V,open:h.addProductDialog,onClose:()=>{A(e=>(0,l.A)((0,l.A)({},e),{},{addProductDialog:!1})),de(null)},products:_.products,brands:_.brand,uom:_.uom,godowns:_.godown,GST_Inclusive:g.GST_Inclusive,IS_IGST:ne,editValues:le,initialValue:(0,l.A)((0,l.A)({},Q.a4),{},{Pre_Id:g.So_No}),batchDetails:_.batchDetails}),(0,y.jsxs)(a.A,{children:[(0,y.jsxs)("div",{className:"d-flex flex-wrap align-items-center border-bottom py-2 px-3",children:[(0,y.jsx)("span",{className:"flex-grow-1 fa-16 fw-bold",children:"Sales Invoice"}),(0,y.jsxs)("span",{children:[(0,y.jsx)(i.A,{type:"button",onClick:()=>{window.history.length>1?m(-1):m("/erp/sales/invoice")},children:"Cancel"}),(0,y.jsx)(i.A,{onClick:()=>Ie(),variant:"contained",children:"submit"})]})]}),(0,y.jsxs)(n.A,{children:[(0,y.jsxs)("div",{className:"row p-0",children:[(0,y.jsx)("div",{className:"col-xxl-3 col-lg-4 col-md-5 p-2",children:(0,y.jsx)("div",{className:"border p-2",style:{minHeight:"30vh",height:"100%"},children:(0,y.jsx)(M,{StaffArray:K,setStaffArray:ee,costCenter:_.staff,costCategory:_.staffType})})}),(0,y.jsx)("div",{className:"col-xxl-9 col-lg-8 col-md-7 py-2 px-0",children:(0,y.jsx)("div",{className:"border px-3 py-1",style:{minHeight:"30vh",height:"100%"},children:(0,y.jsx)(z.A,{invoiceInfo:g,setInvoiceInfo:b,retailers:_.retailers,branches:_.branch,voucherType:_.voucherType,stockItemLedgerName:_.stockItemLedgerName,onChangeRetailer:()=>{W([])},retailerDeliveryAddress:x,setRetailerDeliveryAddress:f,shippingAddress:N,setShippingAddress:L,retailerSalesStatus:te,staffArray:K,setStaffArray:ee})})})]}),(0,y.jsx)(O.Ay,{title:"Items",headerFontSizePx:13,bodyFontSizePx:13,EnableSerialNumber:!0,disablePagination:!0,ButtonArea:(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(i.A,{onClick:()=>{de(null),A(e=>(0,l.A)((0,l.A)({},e),{},{addProductDialog:!0}))},sx:{ml:1},variant:"outlined",type:"button",startIcon:(0,y.jsx)(T.A,{}),disabled:!(0,C.IQ)(g.Retailer_Id)||k.length>0&&(0,C.IQ)(g.So_No),children:"Add Product"}),(0,y.jsx)(F.A,{loadingOn:t,loadingOff:o,open:h.importFromSaleOrder,onClose:()=>A(e=>(0,l.A)((0,l.A)({},e),{},{importFromSaleOrder:!1})),retailer:null===g||void 0===g?void 0:g.Retailer_Id,selectedItems:k,setSelectedItems:V,staffArray:K,setStaffArray:ee,products:_.products,GST_Inclusive:g.GST_Inclusive,IS_IGST:ne,invoiceInfo:g,setInvoiceInfo:b,godowns:_.godown,stockInGodown:_.stockInGodown,children:(0,y.jsx)(i.A,{onClick:()=>A(e=>(0,l.A)((0,l.A)({},e),{},{importFromSaleOrder:!0})),disabled:!(0,C.IQ)(g.Retailer_Id)||k.length>0&&!(0,C.IQ)(g.So_No),sx:{ml:1},type:"button",variant:"outlined",startIcon:(0,y.jsx)(E.A,{}),children:"Choose Sale Order"})})]}),dataArray:[...k,...Array.from({length:re>0?re:0}).map(e=>Q.a4)],columns:[(0,O.Lj)("Item_Name","string"),(0,O.Lj)("Batch_Name","string"),(0,O.Lj)("Bill_Qty","number"),(0,O.Lj)("Act_Qty","number"),(0,O.Lj)("Item_Rate","number"),{isVisible:1,ColumnHeader:"Tax",isCustomCell:!0,Cell:e=>{let{row:t}=e;const{Cgst:o=0,Sgst:l=0,Igst:d=0,Cgst_Amo:a=0,Sgst_Amo:i=0,Igst_Amo:n=0}=t,s=ne?d:(0,C.Lr)(o,l),r=ne?n:(0,C.Lr)(a,i);return(0,C.IQ)(null===t||void 0===t?void 0:t.Item_Id)?"".concat(r," - (").concat(s," %)"):""}},{isVisible:1,ColumnHeader:"Godown",isCustomCell:!0,Cell:e=>{var t,o;let{row:l}=e;return null!==(t=null===(o=_.godown.find(e=>(0,C.id)(e.Godown_Id,null===l||void 0===l?void 0:l.GoDown_Id)))||void 0===o?void 0:o.Godown_Name)&&void 0!==t?t:""}},(0,O.Lj)("Amount","number"),{isCustomCell:!0,Cell:e=>{let{row:t}=e;return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(s.A,{onClick:()=>{de(t),A(e=>(0,l.A)((0,l.A)({},e),{},{addProductDialog:!0}))},size:"small",type:"button",disabled:!(0,C.IQ)(null===t||void 0===t?void 0:t.Item_Id),children:(0,y.jsx)(D.A,{})}),(0,y.jsx)(s.A,{size:"small",type:"button",onClick:()=>V(e=>e.filter(e=>!(0,C.id)(e.Item_Id,t.Item_Id))),color:"error",disabled:!(0,C.IQ)(null===t||void 0===t?void 0:t.Item_Id),children:(0,y.jsx)(G.A,{})})]})},ColumnHeader:"Action",isVisible:1}]}),(0,y.jsxs)(r.A,{open:ce.open,maxWidth:"lg",fullWidth:!0,scroll:"paper",children:[(0,y.jsxs)(c.A,{children:["Print Invoice #",ce.Do_Id,(0,y.jsx)(s.A,{onClick:()=>{ue({open:!1,Do_Id:null}),ve(),m("/erp/sales/invoice")},style:{position:"absolute",right:8,top:8},children:(0,y.jsx)(w.A,{})})]}),(0,y.jsx)(u.A,{children:ce.Do_Id&&(0,y.jsx)(J.A,{Do_Id:ce.Do_Id,loadingOn:t,loadingOff:o})}),(0,y.jsx)(v.A,{children:(0,y.jsx)(i.A,{onClick:()=>{ue({open:!1,Do_Id:null}),ve(),m("/erp/sales/invoice")},children:"Close and Go to Listing"})})]}),(0,y.jsx)("br",{}),(0,y.jsx)(H.A,{invoiceExpences:$,setInvoiceExpences:W,expenceMaster:_.expence,IS_IGST:ne,taxType:se,Total_Invoice_value:pe}),(0,y.jsx)("br",{}),(0,y.jsx)(U.A,{invoiceProducts:k,invoiceExpences:$,isNotTaxableBill:ie,isInclusive:ae,IS_IGST:ne,products:_.products,invoiceInfo:g,setInvoiceInfo:b,invExpencesTotal:me,Total_Invoice_value:pe,taxSplitUp:_e})]}),(0,y.jsxs)(j,{className:"d-flex justify-content-end",children:[(0,y.jsx)(i.A,{type:"button",onClick:()=>{window.history.length>1?m(-1):m("/erp/sales/invoice")},children:"Cancel"}),(0,y.jsx)(i.A,{onClick:Ie,variant:"contained",children:"submit"})]})]}),(0,y.jsxs)(X.A,{open:te.dialog,onClose:()=>oe(e=>(0,l.A)((0,l.A)({},e),{},{dialog:!1})),title:"Retailer Sales Status",onSubmit:()=>{oe(e=>(0,l.A)((0,l.A)({},e),{},{dialog:!1,forceCreateInvoice:!0})),Ie()},submitText:"Yes",closeText:"No",maxWidth:"sm",fullWidth:!0,isSubmit:!0,children:[(0,y.jsx)("h3",{children:"The Retailer Exceeds the credit limit and credit days!"}),(0,y.jsx)("p",{children:"Anyway Do you want to create invoice?"})]})]})}}}]);
//# sourceMappingURL=7806.6a6bf747.chunk.js.map