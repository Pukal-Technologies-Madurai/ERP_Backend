"use strict";(self.webpackChunkerp=self.webpackChunkerp||[]).push([[6430],{16430:(e,l,t)=>{t.r(l),t.d(l,{default:()=>O});var a=t(89379),s=t(65043),o=t(12110),n=t(11906),r=t(26494),d=t(17392),i=t(91036),c=t(97707),u=t(70141),m=t(44676),v=t(83560),p=t(51387),h=t(65074),_=t(48471),x=t(14844),I=t(73216),g=t(97280),j=t(63406),b=t(20656),A=t(70579);const f=e=>{let{StaffArray:l=[],setStaffArray:t,costCenter:s=[],costCategory:o=[]}=e;return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsxs)("div",{className:"d-flex align-items-center flex-wrap mb-2 border-bottom pb-2",children:[(0,A.jsx)("h6",{className:"flex-grow-1 m-0",children:"Staff Involved"}),(0,A.jsx)(n.A,{variant:"outlined",color:"primary",type:"button",onClick:()=>t(e=>[...e,(0,a.A)({},g.Ud)]),children:"Add"})]}),(0,A.jsxs)("table",{className:"table table-bordered",children:[(0,A.jsx)("thead",{children:(0,A.jsxs)("tr",{children:[(0,A.jsx)("th",{className:"fa-13",children:"Sno"}),(0,A.jsx)("th",{className:"fa-13",children:"Staff Name"}),(0,A.jsx)("th",{className:"fa-13",children:"Category"}),(0,A.jsx)("th",{className:"fa-13",children:"#"})]})}),(0,A.jsx)("tbody",{children:(0,c.$r)(l).map((e,n)=>(0,A.jsxs)("tr",{children:[(0,A.jsx)("td",{className:"fa-13 vctr text-center",children:n+1}),(0,A.jsx)("td",{className:"fa-13 w-100 p-0",children:(0,A.jsx)(b.Ay,{value:{value:null===e||void 0===e?void 0:e.Emp_Id,label:null===e||void 0===e?void 0:e.Emp_Name},onChange:e=>t(l=>l.map((l,t)=>{if((0,c.id)(t,n)){const t=(0,c.$r)(s).find(l=>(0,c.id)(null===l||void 0===l?void 0:l.Cost_Center_Id,e.value));return(0,a.A)((0,a.A)({},l),{},{Emp_Type_Id:(0,c.IQ)(null===l||void 0===l?void 0:l.Emp_Type_Id)?Number(null===l||void 0===l?void 0:l.Emp_Type_Id):(0,c.IQ)(t.User_Type)?Number(t.User_Type):0,Emp_Id:Number(e.value),Emp_Name:e.label})}return l})),options:[...(0,c.$r)(s).filter(e=>!l.some(l=>(0,c.id)(l.Emp_Id,e.Cost_Center_Id)))].map(e=>({value:e.Cost_Center_Id,label:e.Cost_Center_Name})),styles:j.MR,isSearchable:!0,placeholder:"Select Staff",filterOption:c.GI})}),(0,A.jsx)("td",{className:"fa-13 vctr p-0",style:{maxWidth:"130px",minWidth:"100px"},children:(0,A.jsxs)("select",{value:null===e||void 0===e?void 0:e.Emp_Type_Id,onChange:e=>t(l=>l.map((l,t)=>(0,c.id)(t,n)?(0,a.A)((0,a.A)({},l),{},{Emp_Type_Id:e.target.value}):l)),className:"cus-inpt p-2 border-0",children:[(0,A.jsx)("option",{value:"",children:"Select"}),(0,c.$r)(o).map((e,l)=>(0,A.jsx)("option",{value:null===e||void 0===e?void 0:e.Cost_Category_Id,children:null===e||void 0===e?void 0:e.Cost_Category},l))]})}),(0,A.jsx)("td",{className:"fa-13 vctr p-0",children:(0,A.jsx)(d.A,{onClick:()=>{t(e=>e.filter((e,l)=>n!==l))},size:"small",children:(0,A.jsx)(p.A,{color:"error"})})})]},n))})]})]})};var N=t(38641),y=t(24651),S=t(34104),C=t(35786),T=t(83462),G=t(26600),w=t(35316),E=t(29347),R=t(34496),P=t(14792);const B=e=>{var l,t;let{children:o,orderProducts:r=[],setOrderProducts:d,open:u=!1,onClose:m,products:v=[],brands:p=[],uom:h=[],godowns:_=[],GST_Inclusive:I,IS_IGST:g,editValues:f=null,initialValue:N={},batchDetails:y=[]}=e;const[S,C]=(0,s.useState)(N),B=(0,c.id)(I,1),D=(0,c.id)(I,2);(0,s.useEffect)(()=>{(0,c.aF)(f)&&u&&C(e=>Object.fromEntries(Object.entries(e).map(e=>{let[l,t]=e;return[l,f[l]?f[l]:t]})))},[f]);const O=e=>{var l;return null!==(l=null===v||void 0===v?void 0:v.find(l=>(0,c.id)(null===l||void 0===l?void 0:l.Product_Id,e)))&&void 0!==l?l:{}},Q=()=>{C(N),m()};return(0,A.jsxs)(A.Fragment,{children:[o,(0,A.jsxs)(T.A,{open:u,onClose:Q,maxWidth:"md",fullWidth:!0,children:[(0,A.jsx)(G.A,{className:"border-bottom",children:(0,A.jsx)("span",{children:"Add Products Details"})}),(0,A.jsxs)("form",{onSubmit:e=>{e.preventDefault(),S.Item_Id?(d(e=>[...e.filter(e=>!(0,c.id)(e.Item_Id,S.Item_Id)),Object.fromEntries(Object.entries(N).map(e=>{let[l,t]=e;const a=O(S.Item_Id),s=g?a.Igst_P:a.Gst_P,o=s>0,{Bill_Qty:n,Item_Rate:r,Amount:d}=S,i=D?"zerotax":B?"remove":"add",c=(0,x.v)(r,s,i),u=(0,x.v)(d,s,i),m=g?0:u.cgst_per,v=g?u.igst_per:0,p=g?0:u.cgst_amount,h=g?u.igst_amount:0;switch(l){case"Item_Name":return[l,a.Product_Name];case"Taxable_Rate":return[l,c.base_amount];case"Total_Qty":return[l,n];case"Taxble":return[l,o?1:0];case"Taxable_Amount":return[l,u.base_amount];case"Tax_Rate":return[l,s];case"Cgst":case"Sgst":return[l,null!==m&&void 0!==m?m:0];case"Cgst_Amo":case"Sgst_Amo":return[l,D?0:p];case"Igst":return[l,null!==v&&void 0!==v?v:0];case"Igst_Amo":return[l,D?0:h];case"Final_Amo":return[l,u.with_tax];default:return[l,S[l]||t]}}))]),Q()):i.oR.warn("Select Product")},children:[(0,A.jsx)(w.A,{children:(0,A.jsxs)("div",{className:"row pb-5",children:[(0,A.jsxs)("div",{className:"col-6 p-2",children:[(0,A.jsx)("label",{children:"Brand"}),(0,A.jsx)(b.Ay,{value:{value:S.BrandID,label:S.Brand},onChange:e=>C(l=>(0,a.A)((0,a.A)({},l),{},{BrandID:e.value,Brand:e.label})),options:[{value:"",label:"select",isDisabled:!0},...p.map(e=>({value:null===e||void 0===e?void 0:e.Brand,label:null===e||void 0===e?void 0:e.Brand_Name}))],styles:j.MR,menuPortalTarget:document.body,isSearchable:!0,placeholder:"Select Brand",maxMenuHeight:200,filterOption:c.GI})]}),(0,A.jsxs)("div",{className:"col-6 p-2",children:[(0,A.jsx)("label",{children:"Group"}),(0,A.jsx)(b.Ay,{value:{value:S.GroupID,label:S.Group},onChange:e=>C(l=>(0,a.A)((0,a.A)({},l),{},{GroupID:e.value,Group:e.label})),options:[{value:"",label:"select",isDisabled:!0},...v.filter(e=>!S.BrandID||(0,c.id)(e.Brand,S.BrandID)).reduce((e,l)=>(e.some(e=>e.value===l.Product_Group)||e.push({value:l.Product_Group,label:l.Pro_Group}),e),[])],styles:j.MR,menuPortalTarget:document.body,isSearchable:!0,placeholder:"Select Group",maxMenuHeight:200,filterOption:c.GI})]}),(0,A.jsxs)("div",{className:Object.hasOwn(S,"GoDown_Id")?"col-md-8 p-2":"col-12 p-2",children:[(0,A.jsxs)("label",{children:["Item Name ",(0,A.jsx)(P.A,{})]}),(0,A.jsx)(b.Ay,{value:{value:S.Item_Id,label:null===(l=O(S.Item_Id))||void 0===l?void 0:l.Product_Name},isDisabled:(0,c.IQ)(S.Pre_Id),menuPortalTarget:document.body,onChange:e=>{const l=O(e.value);C(t=>{var s,o,n,r,d,i,c;return(0,a.A)((0,a.A)({},t),{},{Group:null!==(s=l.Pro_Group)&&void 0!==s?s:t.Group,GroupID:null!==(o=l.Product_Group)&&void 0!==o?o:t.GroupID,Brand:null!==(n=l.Brand_Name)&&void 0!==n?n:t.Brand,BrandID:null!==(r=l.Brand)&&void 0!==r?r:t.BrandID,Item_Id:e.value,Item_Rate:null!==(d=l.Item_Rate)&&void 0!==d?d:0,Bill_Qty:0,Amount:0,Unit_Id:null!==(i=l.UOM_Id)&&void 0!==i?i:t.Unit_Id,Unit_Name:null!==(c=l.Units)&&void 0!==c?c:t.Unit_Name,HSN_Code:null===l||void 0===l?void 0:l.HSN_Code})})},options:[{value:"",label:"select",isDisabled:!0},...[...v.filter(e=>!S.BrandID||(0,c.id)(e.Brand,S.BrandID)).filter(e=>!S.GroupID||(0,c.id)(e.Product_Group,S.GroupID))].map(e=>({value:null===e||void 0===e?void 0:e.Product_Id,label:null===e||void 0===e?void 0:e.Product_Name,isDisabled:-1!==r.findIndex(l=>(0,c.id)(null===l||void 0===l?void 0:l.Item_Id,null===e||void 0===e?void 0:e.Product_Id))}))],styles:j.MR,isSearchable:!0,required:!0,placeholder:"Select Product",maxMenuHeight:200,filterOption:c.GI})]}),Object.hasOwn(S,"GoDown_Id")&&(0,A.jsxs)("div",{className:"col-md-4 p-2",children:[(0,A.jsx)("label",{children:"Godown"}),(0,A.jsx)(b.Ay,{value:{value:null===S||void 0===S?void 0:S.GoDown_Id,label:(null===(t=_.find(e=>(0,c.id)(e.Godown_Id,null===S||void 0===S?void 0:S.GoDown_Id)))||void 0===t?void 0:t.Godown_Name)||""},onChange:e=>C(l=>(0,a.A)((0,a.A)({},l),{},{GoDown_Id:e.value})),options:[{value:"",label:"select",isDisabled:!0},...(0,c.$r)(_).map(e=>({value:null===e||void 0===e?void 0:e.Godown_Id,label:null===e||void 0===e?void 0:e.Godown_Name}))],styles:j.MR,isDisabled:!(0,c.IQ)(null===S||void 0===S?void 0:S.Item_Id),menuPortalTarget:document.body,isSearchable:!0,placeholder:"Select Godown",filterOption:c.GI})]}),(0,A.jsxs)("div",{className:"col-lg-4 col-md-6 p-2",children:[(0,A.jsxs)("label",{children:["Quantity ",(0,A.jsx)(P.A,{})]}),(0,A.jsx)("input",{required:!0,value:S.Bill_Qty?S.Bill_Qty:"",onInput:c.BE,disabled:!(0,c.IQ)(S.Item_Id),onChange:e=>{S.Item_Rate?C(l=>(0,a.A)((0,a.A)({},l),{},{Amount:(0,c.JH)(S.Item_Rate,e.target.value),Bill_Qty:e.target.value})):S.Amount?C(l=>(0,a.A)((0,a.A)({},l),{},{Item_Rate:(0,c.SX)(l.Amount,e.target.value),Bill_Qty:e.target.value})):C(l=>(0,a.A)((0,a.A)({},l),{},{Bill_Qty:e.target.value}))},className:"cus-inpt",min:1})]}),Object.hasOwn(S,"Act_Qty")&&(0,A.jsxs)("div",{className:"col-lg-4 col-md-6 p-2",children:[(0,A.jsx)("label",{children:"Actual Quantity "}),(0,A.jsx)("input",{value:S.Act_Qty?S.Act_Qty:"",onInput:c.BE,disabled:!(0,c.IQ)(S.Item_Id),onChange:e=>C(l=>(0,a.A)((0,a.A)({},l),{},{Act_Qty:e.target.value})),required:!0,className:"cus-inpt"})]}),(0,A.jsxs)("div",{className:"col-lg-4 col-md-6 p-2",children:[(0,A.jsx)("label",{children:"Rate "}),(0,A.jsx)("input",{value:S.Item_Rate?S.Item_Rate:"",onInput:c.BE,disabled:!(0,c.IQ)(S.Item_Id),onChange:e=>C(l=>(0,a.A)((0,a.A)({},l),{},{Item_Rate:e.target.value,Amount:l.Bill_Qty?(0,c.JH)(e.target.value,l.Bill_Qty):l.Amount})),required:!0,className:"cus-inpt"})]}),(0,A.jsxs)("div",{className:"col-lg-4 col-md-6 p-2",children:[(0,A.jsx)("label",{children:"UOM"}),(0,A.jsxs)("select",{value:Object.hasOwn(S,"UOM")?S.UOM:Object.hasOwn(S,"Unit_Id")?S.Unit_Id:"",onChange:e=>{const l=e.target.selectedIndex,t=e.target.options[l].text,s=e.target.value;C(e=>(0,a.A)((0,a.A)({},e),{},{UOM:s,Unit_Id:s,Units:t,Unit_Name:t}))},className:"cus-inpt",disabled:!(0,c.IQ)(S.Item_Id),children:[(0,A.jsx)("option",{value:"",disabled:!0,children:"select"}),h.map((e,l)=>(0,A.jsx)("option",{value:e.Unit_Id,children:e.Units},l))]})]}),(0,A.jsxs)("div",{className:"col-lg-4 col-md-6 p-2",children:[(0,A.jsx)("label",{children:"Amount"}),(0,A.jsx)("input",{required:!0,value:S.Amount?S.Amount:"",onInput:c.BE,disabled:!(0,c.IQ)(S.Item_Id),onChange:e=>C(l=>(0,a.A)((0,a.A)({},l),{},{Amount:e.target.value,Item_Rate:l.Bill_Qty?(0,c.SX)(e.target.value,l.Bill_Qty):l.Item_Rate})),className:"cus-inpt",min:1})]}),(0,A.jsxs)("div",{className:"col-lg-4 col-md-6 p-2",children:[(0,A.jsx)("label",{children:"Batch"}),(0,A.jsx)(b.Ay,{value:{value:(null===S||void 0===S?void 0:S.Batch_Name)||"",label:(null===S||void 0===S?void 0:S.Batch_Name)||""},onChange:e=>C(l=>(0,a.A)((0,a.A)({},l),{},{Batch_Name:e.value})),options:y.filter(e=>(0,c.id)(e.item_id,null===S||void 0===S?void 0:S.Item_Id)&&(0,c.id)(null===e||void 0===e?void 0:e.godown_id,null===S||void 0===S?void 0:S.GoDown_Id)&&(0,c.Ro)(e.pendingQuantity)>=(0,c.Ro)(null===S||void 0===S?void 0:S.Bill_Qty)).map(e=>({value:e.batch,label:e.batch})),styles:j.MR,isSearchable:!0,placeholder:"Select Batch",menuPortalTarget:document.body,isDisabled:!(0,c.IQ)(null===S||void 0===S?void 0:S.Item_Id)||!(0,c.IQ)(null===S||void 0===S?void 0:S.GoDown_Id)||(0,c.id)(null===S||void 0===S?void 0:S.Bill_Qty,0)})]})]})}),(0,A.jsxs)(E.A,{className:"d-flex justify-content-between align-items-center",children:[(0,A.jsx)(n.A,{onClick:()=>C(N),type:"button",startIcon:(0,A.jsx)(R.A,{}),children:"Clear"}),(0,A.jsxs)("span",{children:[(0,A.jsx)(n.A,{type:"button",onClick:Q,children:"cancel"}),(0,A.jsx)(n.A,{type:"submit",variant:"outlined",children:"Add"})]})]})]})]})]})},D=(0,c.aN)().user,O=e=>{let{loadingOn:l,loadingOff:t}=e;const j=(0,I.Zp)(),b=(0,I.zy)().state,[T,G]=(0,s.useState)({products:[],branch:[],retailers:[],voucherType:[],uom:[],staff:[],staffType:[],brand:[],godown:[],expence:[],stockInGodown:[],stockItemLedgerName:[],batchDetails:[]}),[w,E]=(0,s.useState)({addProductDialog:!1,importFromSaleOrder:!1}),[R,P]=(0,s.useState)(g.Q4),[O,Q]=(0,s.useState)([]),[L,k]=(0,s.useState)([]),[M,V]=(0,s.useState)([]),[z,U]=(0,s.useState)(null),F=(0,c.id)(R.GST_Inclusive,1),H=(0,c.id)(R.GST_Inclusive,2),$=(0,c.id)(R.IS_IGST,1),q=H?"zerotax":F?"remove":"add",W=3-O.length;(0,s.useEffect)(()=>{(async()=>{try{l&&l();const[e,t,s,o,n,r,d,i,u,m,v,p]=await Promise.all([(0,h.z)({address:"masters/branch/dropDown"}),(0,h.z)({address:"masters/products"}),(0,h.z)({address:"masters/retailers/dropDown?Company_Id=".concat(null===D||void 0===D?void 0:D.Company_id)}),(0,h.z)({address:"purchase/voucherType"}),(0,h.z)({address:"masters/uom"}),(0,h.z)({address:"dataEntry/costCenter"}),(0,h.z)({address:"dataEntry/costCenter/category"}),(0,h.z)({address:"dataEntry/godownLocationMaster"}),(0,h.z)({address:"masters/defaultAccountMaster"}),(0,h.z)({address:"sales/stockInGodown"}),(0,h.z)({address:"purchase/stockItemLedgerName?type=SALES"}),(0,h.z)({address:"inventory/batchMaster/stockBalance"})]),_=(e.success?e.data:[]).sort((e,l)=>String(null===e||void 0===e?void 0:e.BranchName).localeCompare(null===l||void 0===l?void 0:l.BranchName)),x=(t.success?t.data:[]).sort((e,l)=>String(null===e||void 0===e?void 0:e.Product_Name).localeCompare(null===l||void 0===l?void 0:l.Product_Name)),I=(s.success?s.data:[]).sort((e,l)=>String(null===e||void 0===e?void 0:e.Retailer_Name).localeCompare(null===l||void 0===l?void 0:l.Retailer_Name)),g=(o.success?o.data:[]).sort((e,l)=>String(null===e||void 0===e?void 0:e.Voucher_Type).localeCompare(null===l||void 0===l?void 0:l.Voucher_Type)),j=(n.success?n.data:[]).sort((e,l)=>String(e.Units).localeCompare(l.Units)),b=(r.success?r.data:[]).sort((e,l)=>String(null===e||void 0===e?void 0:e.Cost_Center_Name).localeCompare(null===l||void 0===l?void 0:l.Cost_Center_Name)),A=(d.success?d.data:[]).sort((e,l)=>String(null===e||void 0===e?void 0:e.Cost_Category).localeCompare(null===l||void 0===l?void 0:l.Cost_Category)),f=(i.success?i.data:[]).sort((e,l)=>String(null===e||void 0===e?void 0:e.Godown_Name).localeCompare(null===l||void 0===l?void 0:l.Godown_Name)),N=(u.success?(0,c.$r)(u.data):[]).sort((e,l)=>String(null===e||void 0===e?void 0:e.Account_Name).localeCompare(null===l||void 0===l?void 0:l.Account_Name)),y=(m.success?m.data:[]).sort((e,l)=>String(null===e||void 0===e?void 0:e.stock_item_name).localeCompare(null===l||void 0===l?void 0:l.stock_item_name)),S=(v.success?v.data:[]).sort((e,l)=>String(null===e||void 0===e?void 0:e.Stock_Item_Ledger_Name).localeCompare(null===l||void 0===l?void 0:l.Stock_Item_Ledger_Name));G(e=>(0,a.A)((0,a.A)({},e),{},{products:x,branch:_,retailers:I,voucherType:g,uom:j,staff:b,staffType:A,godown:f,brand:(0,c.Mn)(x,"Brand",["Brand_Name"]),expence:N.filter(e=>!(0,c.xL)(e.Type,"DEFAULT")).map(e=>({Id:e.Acc_Id,Expence_Name:e.Account_Name})),stockInGodown:y,stockItemLedgerName:S,batchDetails:(0,c.$r)(p.data)}))}catch(e){console.error("Error fetching data:",e)}finally{t&&t()}})()},[null===D||void 0===D?void 0:D.Company_id]);(0,s.useEffect)(()=>{Q(e=>[...e].map(e=>Object.fromEntries(Object.entries(e).map(l=>{let[t,a]=l;const s=function(){var e;let l=arguments.length>1?arguments[1]:void 0;return null!==(e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).find(e=>(0,c.id)(e.Product_Id,l)))&&void 0!==e?e:{}}(T.products,null===e||void 0===e?void 0:e.Item_Id),o=$?s.Igst_P:s.Gst_P,n=o>0,{Bill_Qty:r,Item_Rate:d,Amount:i}=e,u=(0,x.v)(d,o,q),m=(0,x.v)(i,o,q),v=$?0:m.cgst_per,p=$?m.igst_per:0,h=$?0:m.cgst_amount,_=$?m.igst_amount:0;switch(t){case"Taxable_Rate":return[t,u.base_amount];case"Total_Qty":return[t,r];case"Taxble":return[t,n?1:0];case"Taxable_Amount":return[t,m.base_amount];case"Tax_Rate":return[t,o];case"Cgst":case"Sgst":return[t,null!==v&&void 0!==v?v:0];case"Cgst_Amo":case"Sgst_Amo":return[t,H?0:h];case"Igst":return[t,null!==p&&void 0!==p?p:0];case"Igst_Amo":return[t,H?0:_];case"Final_Amo":return[t,m.with_tax];default:return[t,e[t]||a]}}))))},[T.products,$,q]),(0,s.useEffect)(()=>{k(e=>[...e].map(e=>{const l=$?(0,c.Ro)(null===e||void 0===e?void 0:e.Igst):0,t=$?0:(0,c.Ro)(null===e||void 0===e?void 0:e.Cgst),s=$?0:(0,c.Ro)(null===e||void 0===e?void 0:e.Sgst),o=(0,c.Ro)(null===e||void 0===e?void 0:e.Expence_Value),n=$?l:(0,c.Lr)(t,s),r=(0,x.v)(o,n,q);return(0,a.A)((0,a.A)({},e),{},{Cgst:t,Sgst:s,Igst:l,Expence_Value:o,Cgst_Amo:t>0?r.cgst_amount:0,Sgst_Amo:s>0?r.sgst_amount:0,Igst_Amo:l>0?r.igst_amount:0})}))},[T.expence,$,q]),(0,s.useEffect)(()=>{if((0,c.aF)(b)&&Array.isArray(null===b||void 0===b?void 0:b.Products_List)){const{Products_List:e,Expence_Array:l,Staffs_Array:t}=b;P(Object.fromEntries(Object.entries(g.Q4).map(e=>{var l;let[t,a]=e;return"Do_Date"===t?[t,b[t]?(0,c.ny)(b[t]):a]:[t,null!==(l=b[t])&&void 0!==l?l:a]}))),Q(e.map(e=>Object.fromEntries(Object.entries(g.a4).map(l=>{var t;let[a,s]=l;return[a,null!==(t=e[a])&&void 0!==t?t:s]})))),k((0,c.$r)(l).map(e=>Object.fromEntries(Object.entries(g.ju).map(l=>{var t;let[a,s]=l;return[a,null!==(t=e[a])&&void 0!==t?t:s]})))),V((0,c.$r)(t).map(e=>Object.fromEntries(Object.entries(g.Ud).map(l=>{var t;let[a,s]=l;return[a,null!==(t=e[a])&&void 0!==t?t:s]}))))}},[b]);const X=()=>{l&&l(),(0,h.z)({address:"sales/salesInvoice",method:(0,c.IQ)(null===R||void 0===R?void 0:R.Do_Id)?"PUT":"POST",bodyData:(0,a.A)((0,a.A)({},R),{},{Product_Array:O,Staffs_Array:M,Expence_Array:L})}).then(e=>{e.success?(P(g.Q4),Q([]),k([]),V([]),i.oR.success(e.message),j("/erp/sales/invoice")):i.oR.warn(e.message)}).catch(e=>console.error(e)).finally(()=>{t&&t()})};return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(B,{orderProducts:O,setOrderProducts:Q,open:w.addProductDialog,onClose:()=>{E(e=>(0,a.A)((0,a.A)({},e),{},{addProductDialog:!1})),U(null)},products:T.products,brands:T.brand,uom:T.uom,godowns:T.godown,GST_Inclusive:R.GST_Inclusive,IS_IGST:$,editValues:z,initialValue:(0,a.A)((0,a.A)({},g.a4),{},{Pre_Id:R.So_No}),batchDetails:T.batchDetails}),(0,A.jsxs)(o.A,{children:[(0,A.jsxs)("div",{className:"d-flex flex-wrap align-items-center border-bottom py-2 px-3",children:[(0,A.jsx)("span",{className:"flex-grow-1 fa-16 fw-bold",children:"Sales Invoice"}),(0,A.jsxs)("span",{children:[(0,A.jsx)(n.A,{type:"button",onClick:()=>{window.history.length>1?j(-1):j("/erp/sales/invoice")},children:"Cancel"}),(0,A.jsx)(n.A,{onClick:()=>X(),variant:"contained",children:"submit"})]})]}),(0,A.jsxs)(r.A,{children:[(0,A.jsxs)("div",{className:"row p-0",children:[(0,A.jsx)("div",{className:"col-xxl-3 col-lg-4 col-md-5 p-2",children:(0,A.jsx)("div",{className:"border p-2",style:{minHeight:"30vh",height:"100%"},children:(0,A.jsx)(f,{StaffArray:M,setStaffArray:V,costCenter:T.staff,costCategory:T.staffType})})}),(0,A.jsx)("div",{className:"col-xxl-9 col-lg-8 col-md-7 py-2 px-0",children:(0,A.jsx)("div",{className:"border px-3 py-1",style:{minHeight:"30vh",height:"100%"},children:(0,A.jsx)(N.A,{invoiceInfo:R,setInvoiceInfo:P,retailers:T.retailers,branches:T.branch,voucherType:T.voucherType,stockItemLedgerName:T.stockItemLedgerName,onChangeRetailer:()=>{Q([]),k([])}})})})]}),(0,A.jsx)(_.Ay,{title:"Items",headerFontSizePx:13,bodyFontSizePx:13,EnableSerialNumber:!0,disablePagination:!0,ButtonArea:(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(n.A,{onClick:()=>{U(null),E(e=>(0,a.A)((0,a.A)({},e),{},{addProductDialog:!0}))},sx:{ml:1},variant:"outlined",type:"button",startIcon:(0,A.jsx)(u.A,{}),disabled:!(0,c.IQ)(R.Retailer_Id)||O.length>0&&(0,c.IQ)(R.So_No),children:"Add Product"}),(0,A.jsx)(S.A,{loadingOn:l,loadingOff:t,open:w.importFromSaleOrder,onClose:()=>E(e=>(0,a.A)((0,a.A)({},e),{},{importFromSaleOrder:!1})),retailer:null===R||void 0===R?void 0:R.Retailer_Id,selectedItems:O,setSelectedItems:Q,staffArray:M,setStaffArray:V,products:T.products,GST_Inclusive:R.GST_Inclusive,IS_IGST:$,invoiceInfo:R,setInvoiceInfo:P,godowns:T.godown,stockInGodown:T.stockInGodown,children:(0,A.jsx)(n.A,{onClick:()=>E(e=>(0,a.A)((0,a.A)({},e),{},{importFromSaleOrder:!0})),disabled:!(0,c.IQ)(R.Retailer_Id)||O.length>0&&!(0,c.IQ)(R.So_No),sx:{ml:1},type:"button",variant:"outlined",startIcon:(0,A.jsx)(m.A,{}),children:"Choose Sale Order"})})]}),dataArray:[...O,...Array.from({length:W>0?W:0}).map(e=>g.a4)],columns:[(0,_.Lj)("Item_Name","string"),(0,_.Lj)("Batch_Name","string"),(0,_.Lj)("Bill_Qty","number"),(0,_.Lj)("Act_Qty","number"),(0,_.Lj)("Item_Rate","number"),{isVisible:1,ColumnHeader:"Tax",isCustomCell:!0,Cell:e=>{let{row:l}=e;const{Cgst:t=0,Sgst:a=0,Igst:s=0,Cgst_Amo:o=0,Sgst_Amo:n=0,Igst_Amo:r=0}=l,d=$?s:(0,c.Lr)(t,a),i=$?r:(0,c.Lr)(o,n);return(0,c.IQ)(null===l||void 0===l?void 0:l.Item_Id)?"".concat(i," - (").concat(d," %)"):""}},{isVisible:1,ColumnHeader:"Godown",isCustomCell:!0,Cell:e=>{var l,t;let{row:a}=e;return null!==(l=null===(t=T.godown.find(e=>(0,c.id)(e.Godown_Id,null===a||void 0===a?void 0:a.GoDown_Id)))||void 0===t?void 0:t.Godown_Name)&&void 0!==l?l:""}},(0,_.Lj)("Amount","number"),{isCustomCell:!0,Cell:e=>{let{row:l}=e;return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(d.A,{onClick:()=>{U(l),E(e=>(0,a.A)((0,a.A)({},e),{},{addProductDialog:!0}))},size:"small",type:"button",disabled:!(0,c.IQ)(null===l||void 0===l?void 0:l.Item_Id),children:(0,A.jsx)(v.A,{})}),(0,A.jsx)(d.A,{size:"small",type:"button",onClick:()=>Q(e=>e.filter(e=>!(0,c.id)(e.Item_Id,l.Item_Id))),color:"error",disabled:!(0,c.IQ)(null===l||void 0===l?void 0:l.Item_Id),children:(0,A.jsx)(p.A,{})})]})},ColumnHeader:"Action",isVisible:1}]}),(0,A.jsx)("br",{}),(0,A.jsx)(C.A,{invoiceExpences:L,setInvoiceExpences:k,expenceMaster:T.expence,IS_IGST:$,taxType:q}),(0,A.jsx)("br",{}),(0,A.jsx)(y.A,{invoiceProducts:O,invoiceExpences:L,isNotTaxableBill:H,isInclusive:F,IS_IGST:$,products:T.products,invoiceInfo:R,setInvoiceInfo:P})]})]})]})}},24651:(e,l,t)=>{t.d(l,{A:()=>i});var a=t(89379),s=t(65043),o=t(97707),n=t(14844),r=t(70579);const d=function(){var e;let l=arguments.length>1?arguments[1]:void 0;return null!==(e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).find(e=>(0,o.id)(e.Product_Id,l)))&&void 0!==e?e:{}},i=e=>{let{invoiceProducts:l=[],invoiceExpences:t=[],isNotTaxableBill:i,isInclusive:c,IS_IGST:u,products:m=[],invoiceInfo:v={},setInvoiceInfo:p}=e;const h=(0,s.useMemo)(()=>(0,o.$r)(t).reduce((e,l)=>(0,o.Lr)(e,null===l||void 0===l?void 0:l.Expence_Value),0),[t]),_=(0,s.useMemo)(()=>{const e=l.reduce((e,l)=>{const t=(0,o.e3)(null===l||void 0===l?void 0:l.Amount);if(i)return(0,o.Lr)(e,t);const a=d(m,l.Item_Id),s=u?a.Igst_P:a.Gst_P;return c?(0,o.Lr)(e,(0,n.v)(t,s,"remove").with_tax):(0,o.Lr)(e,(0,n.v)(t,s,"add").with_tax)},0);return(0,o.Lr)(e,h)},[l,i,m,u,c,h]),x=(0,s.useMemo)(()=>{if(!l||0===l.length)return{};let e=0,t=0;l.forEach(l=>{const a=(0,o.e3)((null===l||void 0===l?void 0:l.Amount)||0);if(i)return void(e=(0,o.Lr)(e,a));const s=d(m,l.Item_Id),r=(0,o.id)(u,1)?s.Igst_P:s.Gst_P,v=(0,n.v)(a,r,c?"remove":"add");e=(0,o.Lr)(e,parseFloat(v.without_tax)),t=(0,o.Lr)(t,parseFloat(v.tax_amount))});const a=(0,o.Lr)(e,t),s=(0,o.Lr)(a,h),r=Math.round(s),v=(0,o.e3)(r-s),p=(0,o.id)(u,1)?0:(0,o.e3)(t/2),_=(0,o.id)(u,1)?0:(0,o.e3)(t/2),x=(0,o.id)(u,1)?(0,o.e3)(t):0;return{totalTaxable:(0,o.e3)(e),totalTax:(0,o.e3)(t),cgst:p,sgst:_,igst:x,roundOff:v,invoiceTotal:r}},[l,m,u,i,c,h]);return(0,s.useMemo)(()=>{void 0!==x.roundOff&&x.roundOff!==v.Round_off&&p(e=>(0,a.A)((0,a.A)({},e),{},{Round_off:x.roundOff}))},[x.roundOff]),(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("table",{className:"table",children:(0,r.jsxs)("tbody",{children:[(0,r.jsxs)("tr",{children:[(0,r.jsxs)("td",{className:"border p-2",rowSpan:u?5:6,children:["Total in words: ",(0,o.GF)(parseInt(_))]}),(0,r.jsx)("td",{className:"border p-2",children:"Total Taxable Amount"}),(0,r.jsx)("td",{className:"border p-2",children:x.totalTaxable})]}),u?(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"border p-2",children:"IGST"}),(0,r.jsx)("td",{className:"border p-2",children:x.igst})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"border p-2",children:"CGST"}),(0,r.jsx)("td",{className:"border p-2",children:x.cgst})]}),(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"border p-2",children:"SGST"}),(0,r.jsx)("td",{className:"border p-2",children:x.sgst})]})]}),(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"border p-2",children:"Total Expences"}),(0,r.jsx)("td",{className:"border p-2",children:(0,o.e3)(h)})]}),(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"border p-2",children:"Round Off"}),(0,r.jsx)("td",{className:"border p-0",children:(0,r.jsx)("input",{value:v.Round_off||x.roundOff||0,className:"cus-inpt p-2 m-0 border-0",onInput:o.rV,onChange:e=>p(l=>(0,a.A)((0,a.A)({},l),{},{Round_off:parseFloat(e.target.value)||0}))})})]}),(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"border p-2",children:"Total"}),(0,r.jsx)("td",{className:"border p-2",children:(0,o.jG)(Math.round(_))})]})]})})})}},35786:(e,l,t)=>{t.d(l,{A:()=>p});var a=t(89379),s=t(12110),o=t(11906),n=t(17392),r=(t(48471),t(97707)),d=t(97280),i=(t(65043),t(63406)),c=t(51387),u=t(20656),m=t(14844),v=t(70579);const p=e=>{let{invoiceExpences:l=[],setInvoiceExpences:t,expenceMaster:p=[],IS_IGST:h,taxType:_}=e;return(0,v.jsx)(v.Fragment,{children:(0,v.jsxs)(s.A,{children:[(0,v.jsxs)("div",{className:"d-flex align-items-center justify-content-between flex-wrap px-3 py-2",children:[(0,v.jsx)("h5",{className:"m-0",children:"Expenses"}),(0,v.jsx)(o.A,{variant:"outlined",type:"button",onClick:()=>{t(e=>[...e,(0,a.A)((0,a.A)({},d.ju),{},{Sno:e.length})])},children:"Add"})]}),(0,v.jsx)("div",{className:"table-responsive",children:(0,v.jsxs)("table",{className:"table table-bordered m-0",children:[(0,v.jsx)("thead",{className:"table-light",children:(0,v.jsx)("tr",{children:["S.No","Expense","Expense Value","Action"].map((e,l)=>(0,v.jsx)("th",{className:"fa-13 bg-light",children:e},l))})}),(0,v.jsxs)("tbody",{style:{fontSize:"13px"},children:[l.map((e,s)=>{var o;const d=(null===(o=p.find(l=>(0,r.id)(l.Id,null===e||void 0===e?void 0:e.Expense_Id)))||void 0===o?void 0:o.Expence_Name)||"";return(0,v.jsxs)("tr",{children:[(0,v.jsx)("td",{children:s+1}),(0,v.jsx)("td",{className:"p-0 vctr",style:{minWidth:"180px"},children:(0,v.jsx)(u.Ay,{value:{value:null===e||void 0===e?void 0:e.Expense_Id,label:d},onChange:e=>((e,l)=>{const s=p.find(e=>(0,r.id)(e.Id,l.value))||{};t(l=>l.map((l,t)=>t!==e?l:(0,a.A)((0,a.A)({},l),{},{Expense_Id:s.Id,Expence_Value:0})))})(s,e),options:p.filter(t=>!!(0,r.id)(t.Id,null===e||void 0===e?void 0:e.Expense_Id)||!l.some((e,l)=>l!==s&&(0,r.id)(e.Expense_Id,t.Id))).map(e=>({value:e.Id,label:e.Expence_Name})),styles:i.MR,menuPortalTarget:document.body,isSearchable:!0,placeholder:"Select Expense",filterOption:r.GI})}),(0,v.jsx)("td",{className:"p-0 vctr",children:(0,v.jsx)("input",{onInput:r.rV,className:"cus-inpt p-2 border-0",value:e.Expence_Value||"",disabled:!(0,r.IQ)(e.Expense_Id),onChange:e=>{((e,l,s)=>{t(t=>t.map((t,o)=>{if(o!==e)return t;const n=(0,a.A)((0,a.A)({},t),{},{[l]:s});if("Expence_Value"===l){const e=t.Cgst?(0,r.Ro)(t.Cgst):0,l=t.Sgst?(0,r.Ro)(t.Sgst):0,a=t.Igst?(0,r.Ro)(t.Igst):0,o=(0,r.Ro)(s),d=h?a:(0,r.Lr)(e,l),i=(0,m.v)(o,d,_);n.Cgst_Amo=e>0&&!h?i.cgst_amount:0,n.Sgst_Amo=l>0&&!h?i.sgst_amount:0,n.Igst_Amo=a>0&&h?i.igst_amount:0}if("Igst"===l){const e=h?(0,r.Ro)(s):0,l=h?0:(0,r.SX)((0,r.Ro)(s),2),a=h?0:(0,r.SX)((0,r.Ro)(s),2),o=(0,r.Ro)(t.Expence_Value),d=h?e:(0,r.Lr)(l,a),i=(0,m.v)(o,d,_);n.Cgst=l,n.Sgst=a,n.Cgst_Amo=l>0?i.cgst_amount:0,n.Sgst_Amo=a>0?i.sgst_amount:0,n.Igst_Amo=e>0?i.igst_amount:0}return n}))})(s,"Expence_Value",e.target.value)}})}),(0,v.jsx)("td",{className:"p-0 vctr  text-center ",children:(0,v.jsx)(n.A,{onClick:()=>(e=>{t(l=>l.filter((l,t)=>t!==e))})(s),size:"small",children:(0,v.jsx)(c.A,{color:"error",fontSize:"small"})})})]},s)}),0===l.length&&(0,v.jsx)("tr",{children:(0,v.jsx)("td",{className:"text-center",colSpan:6,children:"No rows"})})]})]})})]})})}},38641:(e,l,t)=>{t.d(l,{A:()=>i});var a=t(89379),s=(t(65043),t(20656)),o=t(63406),n=t(97707),r=t(14792),d=t(70579);const i=e=>{var l;let{invoiceInfo:t={},setInvoiceInfo:i,retailers:c=[],voucherType:u=[],branches:m=[],onChangeRetailer:v,stockItemLedgerName:p=[]}=e;const h="cus-inpt p-2";return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{className:"row",children:[(0,d.jsxs)("div",{className:"col-sm-8 p-2",children:[(0,d.jsx)("label",{className:"fa-13",children:"Party Name"}),(0,d.jsx)(s.Ay,{value:{value:null===t||void 0===t?void 0:t.Retailer_Id,label:null===t||void 0===t?void 0:t.Retailer_Name},onChange:e=>{i(l=>(0,a.A)((0,a.A)({},l),{},{Retailer_Id:e.value,Retailer_Name:e.label}))},options:[{value:"",label:"Search",isDisabled:!0},...(0,n.$r)(c).map(e=>({value:null===e||void 0===e?void 0:e.Retailer_Id,label:null===e||void 0===e?void 0:e.Retailer_Name}))],styles:o.MR,isSearchable:!0,placeholder:"Select Vendor",maxMenuHeight:300,filterOption:n.GI})]}),(0,d.jsxs)("div",{className:"col-sm-4 p-2",children:[(0,d.jsx)("label",{className:"fa-13",children:"Voucher Type"}),(0,d.jsx)(s.Ay,{value:{value:t.Voucher_Type,label:null===(l=(0,n.$r)(u).find(e=>(0,n.id)(e.Vocher_Type_Id,t.Voucher_Type)))||void 0===l?void 0:l.Voucher_Type},onChange:e=>i(l=>(0,a.A)((0,a.A)({},l),{},{Voucher_Type:e.value})),options:[{value:"",label:"Search",isDisabled:!0},...(0,n.$r)(u).filter(e=>"SALES"===(null===e||void 0===e?void 0:e.Type)).map(e=>({value:null===e||void 0===e?void 0:e.Vocher_Type_Id,label:null===e||void 0===e?void 0:e.Voucher_Type}))],styles:o.MR,isSearchable:!0,required:!0,placeholder:"Select Voucher Type",maxMenuHeight:300,filterOption:n.GI})]}),(0,d.jsxs)("div",{className:"col-xl-3 col-md-4 col-sm-6 p-2",children:[(0,d.jsxs)("label",{className:"fa-13",children:["Entry Date ",(0,d.jsx)(r.A,{})]}),(0,d.jsx)("input",{value:(null===t||void 0===t?void 0:t.Do_Date)||"",type:"date",required:!0,className:h,onChange:e=>i(l=>(0,a.A)((0,a.A)({},l),{},{Do_Date:e.target.value}))})]}),(0,d.jsxs)("div",{className:"col-xl-3 col-md-4 col-sm-6 p-2",children:[(0,d.jsxs)("label",{className:"fa-13",children:["Branch ",(0,d.jsx)(r.A,{})]}),(0,d.jsxs)("select",{className:h,value:null===t||void 0===t?void 0:t.Branch_Id,required:!0,onChange:e=>i(l=>(0,a.A)((0,a.A)({},l),{},{Branch_Id:e.target.value})),children:[(0,d.jsx)("option",{value:"",children:"select"}),m.map((e,l)=>(0,d.jsx)("option",{value:null===e||void 0===e?void 0:e.BranchId,children:null===e||void 0===e?void 0:e.BranchName},l))]})]}),(0,d.jsxs)("div",{className:"col-xl-3 col-md-4 col-sm-6 p-2",children:[(0,d.jsxs)("label",{className:"fa-13",children:["GST Type ",(0,d.jsx)(r.A,{})]}),(0,d.jsxs)("select",{className:h,onChange:e=>i(l=>(0,a.A)((0,a.A)({},l),{},{GST_Inclusive:Number(e.target.value)})),value:t.GST_Inclusive,required:!0,children:[(0,d.jsx)("option",{value:1,children:"Inclusive Tax"}),(0,d.jsx)("option",{value:0,children:"Exclusive Tax"}),(0,d.jsx)("option",{value:2,children:"Not Taxable"})]})]}),(0,d.jsxs)("div",{className:"col-xl-3 col-md-4 col-sm-6 p-2",children:[(0,d.jsx)("label",{className:"fa-13",children:"Tax Type"}),(0,d.jsxs)("select",{className:h,onChange:e=>i(l=>(0,a.A)((0,a.A)({},l),{},{IS_IGST:Number(e.target.value)})),value:t.IS_IGST,children:[(0,d.jsx)("option",{value:"0",children:"GST"}),(0,d.jsx)("option",{value:"1",children:"IGST"})]})]}),(0,d.jsxs)("div",{className:"col-xl-3 col-md-4 col-sm-6 p-2",children:[(0,d.jsx)("label",{className:"fa-13",children:"Stock Item Ledger Name"}),(0,d.jsx)(s.Ay,{value:{value:t.Stock_Item_Ledger_Name,label:t.Stock_Item_Ledger_Name},onChange:e=>i(l=>(0,a.A)((0,a.A)({},l),{},{Stock_Item_Ledger_Name:e.value})),options:[{value:"",label:"Search",isDisabled:!0},...p.map(e=>({value:null===e||void 0===e?void 0:e.Stock_Item_Ledger_Name,label:null===e||void 0===e?void 0:e.Stock_Item_Ledger_Name}))],styles:o.MR,menuPortalTarget:document.body,required:!0,isSearchable:!0,placeholder:"Select",maxMenuHeight:300,filterOption:n.GI})]}),(0,d.jsxs)("div",{className:"col-xl-3 col-md-4 col-sm-6 p-2",children:[(0,d.jsx)("label",{className:"fa-13",children:"Status"}),(0,d.jsxs)("select",{value:null===t||void 0===t?void 0:t.Cancel_status,className:h,onChange:e=>i(l=>(0,a.A)((0,a.A)({},l),{},{Cancel_status:e.target.value})),children:[(0,d.jsx)("option",{value:"",disabled:!0,children:"Select"}),(0,d.jsx)("option",{value:"1",children:"New"}),(0,d.jsx)("option",{value:"2",children:"Progess"}),(0,d.jsx)("option",{value:"3",children:"Completed"}),(0,d.jsx)("option",{value:"0",children:"Canceled"})]})]})]}),(0,d.jsx)("label",{className:"fa-13",children:"Narration"}),(0,d.jsx)("textarea",{className:"cus-inpt fa-14",rows:2,value:t.Narration,onChange:e=>i(l=>(0,a.A)((0,a.A)({},l),{},{Narration:e.target.value}))})]})}},44676:(e,l,t)=>{t.d(l,{A:()=>o});var a=t(59662),s=t(70579);const o=(0,a.A)([(0,s.jsx)("path",{d:"M19.5 3.5 18 2l-1.5 1.5L15 2l-1.5 1.5L12 2l-1.5 1.5L9 2 7.5 3.5 6 2v14H3v3c0 1.66 1.34 3 3 3h12c1.66 0 3-1.34 3-3V2zM19 19c0 .55-.45 1-1 1s-1-.45-1-1v-3H8V5h11z"},"0"),(0,s.jsx)("path",{d:"M9 7h6v2H9zm7 0h2v2h-2zm-7 3h6v2H9zm7 0h2v2h-2z"},"1")],"ReceiptLong")}}]);
//# sourceMappingURL=6430.1cb738d5.chunk.js.map