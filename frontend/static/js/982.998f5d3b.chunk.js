"use strict";(self.webpackChunkerp=self.webpackChunkerp||[]).push([[982],{29824:(e,t,n)=>{n.r(t),n.d(t,{default:()=>he});var a=n(89379),o=n(65043),l=n(22520),s=n(65074),i=n(48471),r=n(81e3),d=n(85865),c=n(39336),u=n(67254),m=n(11906),p=n(57972),v=n(74605),h=n(14256),g=n(53193),f=n(79190),x=n(72221),A=n(32143),y=n(12412),j=n(51962),_=n(67784),C=n(77739),b=n(17392),D=n(45424),S=n(2050),I=n(48734),N=n(83462),w=n(26600),T=n(35316),F=n(29347),k=n(6520),P=n(20656),R=n(63406),E=n(12249),O=n(5793),z=n(30513),W=n(15626),L=n(8171),M=n(59383),G=n(79484),B=n(47968),Q=n(15954),H=n(31308),V=n(38504),U=n(91036),q=n(93141),$=n(70579);const J=(e,t)=>{if(!Array.isArray(e))return"";const n=e.find(e=>String((null===e||void 0===e?void 0:e.empType)||"").toLowerCase()===String(t).toLowerCase());return(null===n||void 0===n?void 0:n.empName)||""},K=e=>{let{Do_Id:t,Do_Ids:n=[],loadingOn:a,loadingOff:i,isCombinedPrint:r=!1}=e;const[d,c]=(0,o.useState)([]),u=(0,o.useRef)(null),p=Array.isArray(n)&&n.length>0?n:t?[t]:[];(0,o.useEffect)(()=>{if(0===p.length)return;null===a||void 0===a||a();(async()=>{try{const e=p.map(e=>(0,s.z)({address:"sales/salesInvoice/printOuts/katchath?Do_Id=".concat(e),loadingOn:()=>{},loadingOff:()=>{}})),t=(await Promise.all(e)).filter(e=>{var t;return e.success&&(null===(t=e.data)||void 0===t?void 0:t[0])}).map(e=>e.data[0]);c(t)}catch(e){console.error("Error fetching katchath data:",e)}finally{null===i||void 0===i||i()}})()},[JSON.stringify(p)]);const v=(0,q.useReactToPrint)({content:()=>u.current});return r?(0,$.jsx)("div",{ref:u,className:"katchath-combined-print",children:d.map((e,t)=>(0,$.jsxs)("div",{className:"katchath-page",children:[(0,$.jsxs)("div",{style:{width:"calc(13.8cm)",height:"calc(10.5cm)",transform:"scale(1.0)",margin:"0 auto",position:"relative",boxSizing:"border-box",fontWeight:"bold"},className:"border py-1 px-2",children:[(0,$.jsxs)("div",{className:"row",children:[(0,$.jsxs)("div",{className:"col-5 p-2",children:[(0,$.jsx)("h5",{className:"m-0",children:e.voucherTypeGet}),(0,$.jsx)("p",{className:"m-0",children:e.createdByGet}),(0,$.jsx)("p",{className:"m-0",children:(0,l.z5)(e.createdOn)}),(0,$.jsx)("br",{}),(0,$.jsx)("p",{className:"m-0",children:e.mailingName?"".concat(e.mailingName,","):" "}),(0,$.jsx)("p",{className:"m-0",children:e.mailingAddress?"".concat(e.mailingAddress,","):" "}),(0,$.jsx)("p",{className:"m-0",children:e.mailingCity?"".concat(e.mailingCity,","):" "}),(0,$.jsx)("p",{className:"m-0",children:e.mailingNumber?e.mailingNumber:" "})]}),(0,$.jsx)("div",{className:"col-7 p-2",children:(0,$.jsx)("div",{className:"table-responsive",children:(0,$.jsx)("table",{className:"table table-borderless",style:{lineHeight:"0.35cm"},children:(0,$.jsxs)("tbody",{children:[(0,l.$r)(e.productDetails).map((e,t)=>(0,$.jsxs)("tr",{children:[(0,$.jsx)("td",{children:e.itemName}),(0,$.jsx)("td",{children:e.quantity})]},t)),(0,$.jsxs)("tr",{children:[(0,$.jsx)("td",{className:"border text-right pr-4",style:{textAlign:"right",fontSize:"18px",fontWeight:"bold"},children:"Total"}),(0,$.jsx)("td",{className:"border text-right",style:{textAlign:"right",fontSize:"18px",fontWeight:"bold"},children:(0,l.$r)(e.productDetails).reduce((e,t)=>e+t.quantity,0)})]})]})})})})]}),(0,$.jsx)("br",{}),(0,$.jsxs)("div",{children:[(0,$.jsxs)("p",{className:"m-0",children:["Lorry: ",J(e.staffDetails,"Transport")]}),(0,$.jsxs)("p",{className:"m-0",children:["LoadMan: ",J(e.staffDetails,"Load Man")]})]})]}),t<d.length-1&&(0,$.jsx)("div",{className:"page-break",style:{pageBreakAfter:"always",breakAfter:"page"}})]},e.Do_Id||t))}):(0,$.jsxs)("div",{className:"d-flex flex-column align-items-center justify-content-center",children:[(0,$.jsx)("div",{className:"print-button-area",children:(0,$.jsx)(m.A,{onClick:v,startIcon:(0,$.jsx)(z.A,{}),children:"Print"})}),(0,$.jsx)("div",{ref:u,className:"katchath-multiple-print",children:d.map((e,t)=>(0,$.jsxs)("div",{style:{fontWeight:"bold"},className:"mb-4",children:[(0,$.jsxs)("div",{style:{width:"calc(14cm)",height:"calc(10.5cm)",transform:"scale(1.0)",margin:"0 auto",position:"relative",boxSizing:"border-box",fontWeight:"bold"},className:"border py-4 px-4",children:[(0,$.jsxs)("div",{className:"row",children:[(0,$.jsxs)("div",{className:"col-5 p-2",children:[(0,$.jsx)("h5",{className:"m-0",children:e.voucherTypeGet}),(0,$.jsx)("p",{className:"m-0",children:e.createdByGet}),(0,$.jsx)("p",{className:"m-0",children:(0,l.z5)(e.createdOn)}),(0,$.jsx)("br",{}),(0,$.jsx)("p",{className:"m-0",children:e.mailingName?"".concat(e.mailingName,","):" "}),(0,$.jsx)("p",{className:"m-0",children:e.mailingAddress?"".concat(e.mailingAddress,","):" "}),(0,$.jsx)("p",{className:"m-0",children:e.mailingCity?"".concat(e.mailingCity,","):" "}),(0,$.jsx)("p",{className:"m-0",children:e.mailingNumber?e.mailingNumber:" "})]}),(0,$.jsx)("div",{className:"col-7 p-2",children:(0,$.jsx)("div",{className:"table-responsive",children:(0,$.jsx)("table",{className:"table table-borderless",style:{lineHeight:"0.35cm"},children:(0,$.jsxs)("tbody",{children:[(0,l.$r)(e.productDetails).map((e,t)=>(0,$.jsxs)("tr",{children:[(0,$.jsx)("td",{children:e.itemName}),(0,$.jsx)("td",{children:e.quantity})]},t)),(0,$.jsxs)("tr",{children:[(0,$.jsx)("td",{className:"border text-right pr-4",style:{textAlign:"right",fontSize:"18px",fontWeight:"bold"},children:"Total"}),(0,$.jsx)("td",{className:"border text-right",style:{textAlign:"right",fontSize:"18px",fontWeight:"bold"},children:(0,l.$r)(e.productDetails).reduce((e,t)=>e+t.quantity,0)})]})]})})})})]}),(0,$.jsx)("br",{}),(0,$.jsxs)("div",{children:[(0,$.jsxs)("p",{className:"m-0",children:["Lorry: ",J(e.staffDetails,"Transport")]}),(0,$.jsxs)("p",{className:"m-0",children:["LoadMan: ",J(e.staffDetails,"Load Man")]})]})]}),t<d.length-1&&(0,$.jsx)("hr",{className:"my-4"})]},e.Do_Id||t))})]})};var Y=n(90001),Z=n(22240),X=n(36285),ee=n(61430),te=n(79722),ne=n(45036);const ae="https://api.dotpe.in/api/comm/public/enterprise/v1",oe=()=>{let e=ne.fr.replace(/[^\x20-\x7E]/g,"");return e=e.replace(/[\u200B-\u200D\uFEFF\u00A0]/g,""),e=e.trim(),e};class le{static async fetchTemplates(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"APPROVED";try{var t;const n=oe(),a=await te.A.get("".concat(ae,"/templates?status=").concat(e),{headers:{"Dotpe-Api-Key":n,"Content-Type":"application/json"}});return{status:!0,data:(null===(t=a.data)||void 0===t?void 0:t.data)||a.data,message:"Templates fetched successfully"}}catch(s){var n,a,o,l;return console.error("Error fetching templates:",{message:s.message,status:null===(n=s.response)||void 0===n?void 0:n.status,data:null===(a=s.response)||void 0===a?void 0:a.data}),{status:!1,data:null,message:(null===(o=s.response)||void 0===o||null===(l=o.data)||void 0===l?void 0:l.message)||s.message||"Failed to fetch templates"}}}static async sendTemplateMessage(e){try{var t,n,a;const o=oe(),l=await te.A.post("".concat(ae,"/wa/send"),e,{headers:{"Dotpe-Api-Key":o,"Content-Type":"application/json"},timeout:3e4});return{status:!0===(null===(t=l.data)||void 0===t?void 0:t.status)||!0===(null===(n=l.data)||void 0===n?void 0:n.success),data:l.data,message:(null===(a=l.data)||void 0===a?void 0:a.message)||"Message sent successfully"}}catch(h){var o,l,s,i,r,d,c,u,m,p,v;return console.error("Error details:",{message:h.message,status:null===(o=h.response)||void 0===o?void 0:o.status,statusText:null===(l=h.response)||void 0===l?void 0:l.statusText,data:null===(s=h.response)||void 0===s?void 0:s.data,headers:null===(i=h.response)||void 0===i?void 0:i.headers}),422===(null===(r=h.response)||void 0===r?void 0:r.status)&&(console.error("Template validation error. Likely issues:"),console.error("1. Wrong number of parameters"),console.error("2. Parameter names don't match template"),console.error("3. Template not approved"),console.error("4. Missing required parameters")),{status:!1,data:null===(d=h.response)||void 0===d?void 0:d.data,message:(null===(c=h.response)||void 0===c||null===(u=c.data)||void 0===u?void 0:u.message)||(null===(m=h.response)||void 0===m||null===(p=m.data)||void 0===p?void 0:p.error)||h.message||"Failed to send message",statusCode:null===(v=h.response)||void 0===v?void 0:v.status}}}static async sendFreeFormMessage(e){try{var t,n,a;const o=oe();let l="".concat(ae,"/wa/send/free-form"),s=e;e.template&&(l="".concat(ae,"/wa/send"));const i=await te.A.post(l,s,{headers:{"Dotpe-Api-Key":o,"Content-Type":"application/json"},timeout:3e4});return{status:!0===(null===(t=i.data)||void 0===t?void 0:t.status)||!0===(null===(n=i.data)||void 0===n?void 0:n.success),data:i.data,message:(null===(a=i.data)||void 0===a?void 0:a.message)||"Message sent successfully"}}catch(c){var o,l,s,i,r,d;return console.error("Error sending free-form message:",{message:c.message,status:null===(o=c.response)||void 0===o?void 0:o.status,data:null===(l=c.response)||void 0===l?void 0:l.data}),{status:!1,data:null===(s=c.response)||void 0===s?void 0:s.data,message:(null===(i=c.response)||void 0===i||null===(r=i.data)||void 0===r?void 0:r.message)||c.message||"Failed to send message",statusCode:null===(d=c.response)||void 0===d?void 0:d.status}}}static async sendInvoiceWithPDFLink(e,t,n,a,o){try{const t=null!==a&&void 0!==a&&a.Do_Date?a.Do_Date.split("T")[0].split("-").reverse().join("/"):(new Date).toLocaleDateString("en-GB"),n={merchantId:ne._c,template:{name:"template_text",language:"en"},wabaNumber:ne.Or,recipients:["91".concat(e)],source:"crm",type:"document",clientRefId:"invoice_INV001_".concat(Date.now()),params:{body:["".concat(null===a||void 0===a?void 0:a.retailerNameGet),"".concat(null===a||void 0===a?void 0:a.Do_Inv_No),"".concat(t),"".concat(null===a||void 0===a?void 0:a.Total_Invoice_value),"SM TRADERS","".concat(o)]}};return await this.sendFreeFormMessage(n)}catch(l){return console.error("Error sending invoice with PDF:",l),{status:!1,message:l.message||"Failed to send invoice"}}}static async sendPDFAsDocument(e,t,n,a){try{const o={wabaNumber:ne.Or,recipient:e,source:"billing_system",clientRefId:"pdf_".concat(t,"_").concat(Date.now()),type:"document",document:{link:n,caption:a||"\ud83d\udcc4 Invoice #".concat(t,"\nClick to view/download"),filename:"Invoice-".concat(t,".pdf")}};return await this.sendFreeFormMessage(o)}catch(o){return console.error("Error sending PDF as document:",o),{status:!1,message:o.message||"Failed to send PDF"}}}}var se=n(58992),ie=n(37762),re=(n(20557),n(11238));n(72450);const de=(0,$.jsx)(E.A,{fontSize:"small"}),ce=(0,$.jsx)(O.A,{fontSize:"small"}),ue={CostCategory:{label:"",value:""},Do_Id:[],involvedStaffs:[],staffInvolvedStatus:0,deliveryStatus:5},me={CostCategory:{label:"",value:""},Do_Id:[],involvedStaffs:[],staffInvolvedStatus:0,deliveryStatus:5},pe=e=>String(null!==e&&void 0!==e?e:"").toLowerCase().trim(),ve=(e,t)=>(0,l.$r)(null===e||void 0===e?void 0:e.involvedStaffs).filter(e=>(0,l.id)(e.Emp_Type_Id,t)).map(e=>{var t;return String(null!==(t=e.Emp_Name)&&void 0!==t?t:"").trim()}).filter(Boolean),he=e=>{var t,n;let{loadingOn:E,loadingOff:O,AddRights:J,EditRights:te,PrintRights:ae,pageID:oe}=e;const[he,ge]=(0,o.useState)([]),[fe,xe]=(0,o.useState)([]),[Ae,ye]=(0,o.useState)([]),[je,_e]=(0,o.useState)([]),[Ce,be]=(0,o.useState)("normal"),[De,Se]=(0,o.useState)(!0),[Ie,Ne]=(0,o.useState)(!1),[we,Te]=(0,o.useState)(!1),[Fe,ke]=(0,o.useState)(""),[Pe,Re]=(0,o.useState)(!1),[Ee,Oe]=(0,o.useState)(!1),[ze,We]=(0,o.useState)(null),[Le,Me]=((0,o.useRef)(null),JSON.parse(localStorage.getItem("user")),(0,o.useState)({loading:!1,pdfUrl:null,token:null,fileName:null,error:null})),[Ge,Be]=(0,o.useState)(ue),[Qe,He]=(0,o.useState)(me),[Ve,Ue]=(0,o.useState)(!1),[qe,$e]=(0,o.useState)({}),[Je,Ke]=(0,o.useState)([]),[Ye,Ze]=(0,o.useState)({Do_Id:null,Do_Date:null,open:!1}),[Xe,et]=(0,o.useState)({Do_Id:null,open:!1}),[tt,nt]=(0,o.useState)({Do_Id:null,Do_Date:null,open:!1}),[at,ot]=(0,o.useState)({open:!1,order:null,loading:!1,method:"template"}),[lt,st]=(0,o.useState)([]),[it,rt]=(0,o.useState)(""),[dt,ct]=(0,o.useState)({open:!1,message:"",severity:"success"}),[ut,mt]=(0,o.useState)({reqDate:(0,l.ny)(),assignDialog:!1,filterDialog:!1,selectedInvoice:null,multipleStaffUpdateDialog:!1,multipleStaffRemoveDialog:!1,fetchTrigger:0,docType:"",staffStatus:0}),[pt,vt]=(0,o.useState)({open:!1,doIds:[],docType:""}),ht=(0,o.useRef)(null),gt=(0,o.useMemo)(()=>(lt||[]).filter(e=>{const t=e.templateName||e.name||"";return t.toLowerCase().includes("pdf")||t.toLowerCase().includes("invoice")}),[lt]),ft=(0,o.useMemo)(()=>(lt||[]).filter(e=>{const t=e.templateName||e.name||"";return!(t.toLowerCase().includes("pdf")||t.toLowerCase().includes("invoice"))}),[lt]),xt=(0,o.useMemo)(()=>[{Field_Name:"Do_Inv_No",Fied_Data:"string",ColumnHeader:"Invoice"},{Field_Name:"voucherTypeGet",Fied_Data:"string",ColumnHeader:"Voucher"},{Field_Name:"retailerNameGet",Fied_Data:"string",ColumnHeader:"Customer"}],[]),At=e=>{if(void 0!==e.Alt_Act_Qty&&null!==e.Alt_Act_Qty)return Number(e.Alt_Act_Qty)||0;const t=Number(e.Bill_Qty)||0,n=Number(e.PackValue)||1,a=["AltQty","Alt_Act_Qty","Alt_Qty","Alternate_Qty","Actual_Qty"];for(const o of a)if(void 0!==e[o]&&null!==e[o])return Number(e[o])||0;return t*n},yt=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{var t,n;e?Ne(!0):Se(!0),be("normal");const o=await(0,s.z)({address:"sales/salesInvoice/lrReport?reqDate=".concat(ut.reqDate,"&staffStatus=").concat(ut.staffStatus),loadingOn:E,loadingOff:O}),i=(0,l.$r)(o.data).map(e=>{if(e.stockDetails&&Array.isArray(e.stockDetails)){const t=e.stockDetails.map(e=>(0,a.A)((0,a.A)({},e),{},{Alt_Act_Qty:At(e)}));return(0,a.A)((0,a.A)({},e),{},{stockDetails:t})}return e});ge(i),ye((0,l.$r)(null===o||void 0===o||null===(t=o.others)||void 0===t?void 0:t.costTypes)),_e((0,l.$r)(null===o||void 0===o||null===(n=o.others)||void 0===n?void 0:n.uniqeInvolvedStaffs)),we||Te(!0)}catch(o){console.error("Error fetching invoices:",o),U.oR.error("Failed to load invoices")}finally{Se(!1),Ne(!1)}};(0,o.useEffect)(()=>{(async()=>{try{const e=await le.fetchTemplates("APPROVED");if(e.status&&e.data){let t=[];Array.isArray(e.data)?t=e.data:e.data.data&&Array.isArray(e.data.data)?t=e.data.data:e.data.templates&&Array.isArray(e.data.templates)&&(t=e.data.templates),t.length>0?(st(t),t.forEach(e=>{const t=e.templateName||e.name||"";t.includes("template_text")&&rt(t)})):console.warn("No templates found")}else console.warn("Failed to fetch templates:",e.message)}catch(e){console.error("Failed to fetch templates:",e)}})()},[]);const jt=async()=>{try{var e,t;Se(!0),be("pending");const i=await(0,s.z)({address:"sales/salesInvoice/pendingDetails?reqDate=".concat(ut.reqDate),loadingOn:E,loadingOff:O}),r=(0,l.$r)(i.data).map(e=>{if(e.stockDetails&&Array.isArray(e.stockDetails)){const t=e.stockDetails.map(e=>(0,a.A)((0,a.A)({},e),{},{Alt_Act_Qty:At(e)}));return(0,a.A)((0,a.A)({},e),{},{stockDetails:t})}return e});var n,o;if(ge(r),null!==i&&void 0!==i&&null!==(e=i.others)&&void 0!==e&&e.costTypes)ye((0,l.$r)(null===i||void 0===i||null===(n=i.others)||void 0===n?void 0:n.costTypes));if(null!==i&&void 0!==i&&null!==(t=i.others)&&void 0!==t&&t.uniqeInvolvedStaffs)_e((0,l.$r)(null===i||void 0===i||null===(o=i.others)||void 0===o?void 0:o.uniqeInvolvedStaffs))}catch(i){console.error("Error fetching pending invoices:",i),U.oR.error("Failed to load pending invoices")}finally{Se(!1)}},_t=async()=>{try{const e=await(0,s.z)({address:"masters/erpCostCenter/dropDown"});xe((0,l.$r)(e.data))}catch(e){console.error("Error fetching cost center data:",e),U.oR.error("Failed to load cost center data")}};(0,o.useEffect)(()=>{(async()=>{try{Se(!0),await Promise.all([yt(),_t()])}catch(e){console.error("Error fetching initial data:",e),U.oR.error("Failed to load initial data")}finally{Se(!1)}})()},[]),(0,o.useEffect)(()=>{"normal"===Ce&&yt(!0)},[ut.fetchTrigger,ut.staffStatus,Ce]),(0,o.useEffect)(()=>{"normal"===Ce&&we&&yt(!0)},[ut.reqDate,Ce,we]),(0,o.useEffect)(()=>{"pending"===Ce&&we&&jt()},[ut.reqDate,Ce,we]),(0,o.useEffect)(()=>{if(pt.open){const e=setTimeout(()=>{ht.current&&Ue(!0)},300);return()=>clearTimeout(e)}Ue(!1)},[pt.open,pt.doIds,pt.docType]);const Ct=function(e){ct({open:!0,message:e,severity:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success"})},bt=()=>{ot({open:!1,order:null,loading:!1,method:"template"}),rt("")},Dt=async e=>{try{Me({loading:!0,pdfUrl:null,error:null});const t=JSON.parse(localStorage.getItem("user")),n=null===t||void 0===t?void 0:t.Company_id;if(!n)throw new Error("Company ID not found");const a=await(async(e,t)=>{try{const n={invoiceId:e.Do_Inv_No,companyId:t,invoiceData:{Do_Inv_No:e.Do_Inv_No,Total_Invoice_value:e.Total_Invoice_value||0,retailerNameGet:e.retailerNameGet||e.Retailer_Name||"Customer",Do_Date:e.Do_Date||e.So_Date,So_No:e.So_No||e.Do_No||"N/A",Retailer_Name:e.Retailer_Name||e.retailerNameGet,Retailer_Address:e.Retailer_Address||"Address not available",Retailer_GSTIN:e.Retailer_GSTIN||"Not Available",CSGT_Total:e.CSGT_Total||0,SGST_Total:e.SGST_Total||0,IGST_Total:e.IGST_Total||0,Round_off:e.Round_off||0,CSGT_Percentage:e.CSGT_Percentage||0,SGST_Percentage:e.SGST_Percentage||0,IGST_Percentage:e.IGST_Percentage||0,stockDetails:e.stockDetails||e.ProductList||[]}};return await(0,s.z)({address:"sales/generatePdf",method:"POST",bodyData:n,loadingOn:E,loadingOff:O})}catch(n){throw console.error("Error generating PDF:",n),n}})(e,n);if(a.success&&a.data){const e=a.data.pdfUrl;return Me({loading:!1,pdfUrl:e,token:a.data.token,fileName:a.data.fileName,error:null}),{pdfUrl:e,token:a.data.token,fileName:a.data.fileName}}throw new Error(a.message||"Failed to generate PDF")}catch(t){throw console.error("Error generating PDF:",t),Me({loading:!1,pdfUrl:null,error:t.message}),t}},St=async e=>{try{const t=await(0,s.z)({address:"masters/getlolDetails"});if(t&&t.success&&t.data){const n=t.data.find(t=>Number(t.Ret_Id)===Number(null===e||void 0===e?void 0:e.Retailer_Id));return(null===n||void 0===n?void 0:n.Party_Mobile_1)||e.Customer_Phone}return e.Customer_Phone}catch(t){return console.error("Error fetching recipient phone:",t),e.Customer_Phone}},It=(0,o.useMemo)(()=>{const e=Ge.Do_Id;if(!e.length)return{billQty:0,altActQty:0};let t=0,n=0;return he.filter(t=>e.includes((0,l.Ro)(t.Do_Id))).forEach(e=>{Array.isArray(e.stockDetails)&&e.stockDetails.forEach(e=>{t+=Number(e.Bill_Qty)||0,n+=Number(e.Alt_Act_Qty)||0})}),{billQty:t,altActQty:n}},[Ge.Do_Id,he]);(0,o.useEffect)(()=>{(0,s.z)({address:"masters/erpCostCenter/dropDown"}).then(e=>xe((0,l.$r)(e.data))).catch(console.error)},[]);const Nt=(0,o.useMemo)(()=>Ae.filter(e=>je.includes((0,l.Ro)(e.Cost_Category_Id))).map(e=>{const t="costType_".concat((0,l.Ro)(e.Cost_Category_Id));return{costType:e.Cost_Category,field:t,columnConfig:{Field_Name:t,Fied_Data:"string",isVisible:1,ColumnHeader:e.Cost_Category,isCustomCell:!0,getFilterValues:t=>ve(t,e.Cost_Category_Id),Cell:t=>{let{row:n}=t;const a=ve(n,e.Cost_Category_Id).join(", ");return(0,$.jsx)("span",{children:a||"-"})}}}}).sort((e,t)=>{const n=e.costType.toLowerCase(),a=t.costType.toLowerCase();return n.includes("broker")?-1:a.includes("broker")?1:n.includes("transport")?-1:a.includes("transport")?1:e.costType.localeCompare(t.costType)}).map(e=>e.columnConfig),[Ae,je]),wt=(0,o.useMemo)(()=>[...xt,...Nt],[xt,Nt]),Tt=()=>mt(e=>(0,a.A)((0,a.A)({},e),{},{assignDialog:!1,selectedInvoice:null})),Ft=()=>mt(e=>(0,a.A)((0,a.A)({},e),{},{filterDialog:!1})),kt=()=>{Be(ue),mt(e=>(0,a.A)((0,a.A)({},e),{},{multipleStaffUpdateDialog:!1}))},Pt=()=>{He(me),mt(e=>(0,a.A)((0,a.A)({},e),{},{multipleStaffRemoveDialog:!1}))},Rt=()=>Ze(e=>({Do_Id:null,Do_Date:null,open:!1})),Et=()=>et(e=>({Do_Id:null,open:!1})),Ot=()=>nt(e=>({Do_Id:null,Do_Date:null,open:!1})),zt=()=>{"pending"===Ce?jt():mt(e=>(0,a.A)((0,a.A)({},e),{},{fetchTrigger:e.fetchTrigger+1}))},Wt=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{const n=(e=>{const t=se.A,n=e.replace(/\//g,"_"),a="".concat(n);return"".concat(t,"sales/downloadPdf?Do_Inv_No=").concat(a)})(e),a=document.createElement("a");return a.href=n,a.download=t||"".concat(e,".pdf"),document.body.appendChild(a),a.click(),document.body.removeChild(a),!0}catch(n){throw console.error("Error downloading PDF:",n),n}},Lt=e=>{if(!e)return"";try{const t=new Date(e),n=198e5,a=new Date(t.getTime()+n),o=(String(a.getUTCDate()).padStart(2,"0"),String(a.getUTCMonth()+1).padStart(2,"0"),a.getUTCFullYear(),String(a.getUTCHours()).padStart(2,"0")),l=String(a.getUTCMinutes()).padStart(2,"0");return"".concat(o,":").concat(l)}catch(t){return e}},Mt=()=>{We(null)};(0,o.useEffect)(()=>{Bt()},[qe,he,wt]);const Gt=(e,t)=>{$e(n=>(0,a.A)((0,a.A)({},n),{},{[e]:t}))},Bt=()=>{let e=[...he];for(const t of wt){const n=t.Field_Name,a=qe[n];if(a){if("range"===a.type){const{min:t,max:o}=a;e=e.filter(e=>{const a=e[n];return(void 0===t||a>=t)&&(void 0===o||a<=o)});continue}if("date"===a.type){const{start:t,end:o}=a.value||{};e=e.filter(e=>{const a=new Date(e[n]);return(void 0===t||a>=new Date(t))&&(void 0===o||a<=new Date(o))});continue}if(Array.isArray(a)){const o=a.map(pe).filter(Boolean);if(!o.length)continue;e="function"===typeof t.getFilterValues?e.filter(e=>{const n=(t.getFilterValues(e)||[]).map(pe).filter(Boolean);return o.some(e=>n.includes(e))}):e.filter(e=>o.includes(pe(e[n])))}}}Ke(e)},Qt=(0,q.useReactToPrint)({content:()=>ht.current,documentTitle:"Multiple Documents",pageStyle:"delivery_slip"===Fe?"\n        @page {\n            margin: 0.7cm 0 0 0;\n            size: auto;\n        }\n        html, body {\n            margin: 0;\n            padding: 0;\n        }\n        body {\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n        }\n        @media print {\n            body > * {\n                margin-left: 0 !important;\n                margin-right: 0 !important;\n            }\n            .no-print {\n                display: none !important;\n            }\n        }\n    ":"sales_invoice"===Fe?"\n        @page {\n            size: A5 landscape;\n            margin: 0;\n        }\n        html, body {\n            margin: 0;\n            padding: 0;\n            -webkit-print-color-adjust: exact;\n            print-color-adjust: exact;\n        }\n        body {\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n        }\n        @media print {\n            body > * {\n                margin-left: 0 !important;\n                margin-right: 0 !important;\n            }\n            .no-print {\n                display: none !important;\n            }\n        }\n    ":"\n        @page {\n            margin: 0.6cm;\n            size: auto;\n        }\n        html, body {\n            margin: 0;\n            padding: 0;\n        }\n        body {\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n        }\n        @media print {\n            body > * {\n                margin-left: 0 !important;\n                margin-right: 0 !important;\n            }\n            .no-print {\n                display: none !important;\n            }\n        }\n    "}),Ht=e=>{const{Field_Name:t,Fied_Data:n,ColumnHeader:o}=e;var l,s,i,r,d,c,u,m,p,v;if("number"===n)return(0,$.jsxs)("div",{className:"d-flex justify-content-between px-2",children:[(0,$.jsx)("input",{placeholder:"Min",type:"number",className:"bg-light border-0 m-1 p-1 w-50",value:null!==(l=null===(s=qe[t])||void 0===s?void 0:s.min)&&void 0!==l?l:"",onChange:e=>Gt(t,(0,a.A)((0,a.A)({type:"range"},qe[t]),{},{min:e.target.value?parseFloat(e.target.value):void 0}))}),(0,$.jsx)("input",{placeholder:"Max",type:"number",className:"bg-light border-0 m-1 p-1 w-50",value:null!==(i=null===(r=qe[t])||void 0===r?void 0:r.max)&&void 0!==i?i:"",onChange:e=>Gt(t,(0,a.A)((0,a.A)({type:"range"},qe[t]),{},{max:e.target.value?parseFloat(e.target.value):void 0}))})]});if("date"===n)return(0,$.jsxs)("div",{className:"d-flex justify-content-between px-2",children:[(0,$.jsx)("input",{placeholder:"Start Date",type:"date",className:"bg-light border-0 m-1 p-1 w-50",value:null!==(d=null===(c=qe[t])||void 0===c||null===(u=c.value)||void 0===u?void 0:u.start)&&void 0!==d?d:"",onChange:e=>{var n;return Gt(t,{type:"date",value:(0,a.A)((0,a.A)({},null===(n=qe[t])||void 0===n?void 0:n.value),{},{start:e.target.value||void 0})})}}),(0,$.jsx)("input",{placeholder:"End Date",type:"date",className:"bg-light border-0 m-1 p-1 w-50",value:null!==(m=null===(p=qe[t])||void 0===p||null===(v=p.value)||void 0===v?void 0:v.end)&&void 0!==m?m:"",onChange:e=>{var n;return Gt(t,{type:"date",value:(0,a.A)((0,a.A)({},null===(n=qe[t])||void 0===n?void 0:n.value),{},{end:e.target.value||void 0})})}})]});if("string"===n){const n=(e=>{const t=new Map;for(const n of e){const e=String(null!==n&&void 0!==n?n:"").trim();if(!e)continue;const a=e.toLowerCase();t.has(a)||t.set(a,e)}return Array.from(t.values())})("function"===typeof e.getFilterValues?he.flatMap(t=>e.getFilterValues(t)||[]):he.map(e=>e[t]));return(0,$.jsx)(y.A,{multiple:!0,id:"".concat(t,"-filter"),options:n,disableCloseOnSelect:!0,getOptionLabel:e=>e,value:qe[t]||[],onChange:(e,n)=>Gt(t,n),renderOption:(e,t,n)=>{let{selected:o}=n;return(0,$.jsxs)("li",(0,a.A)((0,a.A)({},e),{},{children:[(0,$.jsx)(j.A,{icon:de,checkedIcon:ce,style:{marginRight:8},checked:o}),t]}))},isOptionEqualToValue:(e,t)=>e===t,renderInput:e=>(0,$.jsx)(_.A,(0,a.A)((0,a.A)({},e),{},{label:o||t,placeholder:"Select ".concat((o||t).replace(/_/g," "))}))})}return null};(0,o.useEffect)(()=>{if(Pe){const e=Je.map(e=>(0,l.Ro)(e.Do_Id));Be(t=>(0,a.A)((0,a.A)({},t),{},{Do_Id:e})),He(t=>(0,a.A)((0,a.A)({},t),{},{Do_Id:e}))}else Be(e=>(0,a.A)((0,a.A)({},e),{},{Do_Id:[]})),He(e=>(0,a.A)((0,a.A)({},e),{},{Do_Id:[]}))},[Pe,Je]);const Vt=(0,o.useMemo)(()=>{const e=Ge.Do_Id.length>0,t=Ge.involvedStaffs.length>0,n=(0,l.IQ)(Ge.CostCategory.value)&&!(0,l.id)(Ge.CostCategory.value,0);return!!e&&(!(t&&!n)&&!(!t&&n))},[Ge]),Ut=(0,o.useMemo)(()=>{const e=Qe.Do_Id.length>0,t=(0,l.IQ)(Qe.CostCategory.value)&&!(0,l.id)(Qe.CostCategory.value,0);return e&&t},[Qe]);if(De&&!we)return(0,$.jsx)("div",{className:"d-flex justify-content-center align-items-center",style:{height:"400px"},children:(0,$.jsx)(r.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:2},children:(0,$.jsxs)("div",{className:"text-muted",children:["Loading ","pending"===Ce?"Pending":"Sales"," Invoices..."]})})});return(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)(i.Ay,{title:"pending"===Ce?"Pending Invoices":"Sales Invoice",columns:[{Field_Name:"Select",isVisible:1,isCustomCell:!0,Cell:e=>{let{row:t}=e;const n=Ge.Do_Id.includes((0,l.Ro)(t.Do_Id));return(0,$.jsx)(j.A,{onFocus:e=>{e.target.blur()},checked:n,onChange:()=>{n?(Be(e=>(0,a.A)((0,a.A)({},e),{},{Do_Id:e.Do_Id.filter(e=>!(0,l.id)(e,t.Do_Id))})),He(e=>(0,a.A)((0,a.A)({},e),{},{Do_Id:e.Do_Id.filter(e=>!(0,l.id)(e,t.Do_Id))}))):(Be(e=>(0,a.A)((0,a.A)({},e),{},{Do_Id:[...e.Do_Id,(0,l.Ro)(t.Do_Id)]})),He(e=>(0,a.A)((0,a.A)({},e),{},{Do_Id:[...e.Do_Id,(0,l.Ro)(t.Do_Id)]})))}})}},(0,i.Lj)("Do_Inv_No","string","Invoice"),{Field_Name:"",isVisible:1,isCustomCell:!0,Cell:e=>{let{row:t}=e;return null!==t&&void 0!==t&&t.createdOn?(0,l.z5)(null===t||void 0===t?void 0:t.createdOn):""}},(0,i.Lj)("voucherTypeGet","string","Voucher"),(0,i.Lj)("retailerNameGet","string","Customer"),{Field_Name:"BillQty",isVisible:1,isCustomCell:!0,Cell:e=>{let{row:t}=e;return t.stockDetails&&t.stockDetails.length>0?t.stockDetails.reduce((e,t)=>e+(Number(t.Bill_Qty)||0),0):0}},{Field_Name:"AltActQty",ColumnHeader:"Alt Act Qty",isVisible:1,isCustomCell:!0,Cell:e=>{let{row:t}=e;return(0,l.e3)((0,l.$r)(t.stockDetails).reduce((e,t)=>e+(0,l.Ro)(t.Alt_Act_Qty),0))}},(0,i.Lj)("Narration","string","Narration"),...Nt,(0,i.Lj)("Delivery_Status","string","Delivery_Status"),{Field_Name:"Action",isVisible:1,isCustomCell:!0,Cell:e=>{let{row:t}=e;return(0,$.jsx)(i.wF,{buttonsData:[{name:"Add Employee",onclick:()=>mt(e=>(0,a.A)((0,a.A)({},e),{},{assignDialog:!0,selectedInvoice:t})),icon:(0,$.jsx)(W.A,{fontSize:"small",color:"primary"}),disabled:!J&&!te},{name:"Print Invoice",onclick:()=>{Ze({Do_Id:t.Do_Id,Do_Date:t.Do_Date,open:!0})},icon:(0,$.jsx)(z.A,{fontSize:"small",color:"primary"}),disabled:!ae},{name:"Delivery Slip",onclick:()=>{nt({Do_Id:t.Do_Id,Do_Date:t.Do_Date,open:!0})},icon:(0,$.jsx)(z.A,{fontSize:"small",color:"primary"}),disabled:!ae},{name:"Katchath Copy",onclick:()=>{et({Do_Id:t.Do_Id,open:!0})},icon:(0,$.jsx)(z.A,{fontSize:"small",color:"primary"}),disabled:!ae},{name:"Send WhatsApp",onclick:()=>{(async e=>{try{ot({open:!0,order:e,loading:!0,method:"pdf-link"});const t=await Dt(e),n=await St(e);if(!n)return Ct("Customer phone number not found","error"),void bt();ot({open:!0,order:(0,a.A)((0,a.A)({},e),{},{recipientPhone:n,generatedPdfUrl:t.pdfUrl,pdfToken:t.token,pdfFileName:t.fileName}),loading:!1,method:"pdf-link"})}catch(t){console.error("Error in handleWhatsAppClick:",t),Ct("Failed to prepare PDF: ".concat(t.message),"error"),bt()}})(t)},icon:(0,$.jsx)(ee.A,{fontSize:"small",color:"success"}),disabled:!1}]})}}],dataArray:Je,EnableSerialNumber:!0,ButtonArea:(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)(C.A,{title:"Select All",children:(0,$.jsx)(j.A,{checked:Pe,onChange:e=>Re(e.target.checked)})}),(0,$.jsxs)("button",{type:"button",className:"btn btn-sm ".concat("pending"===Ce?"btn-primary":"btn-outline-secondary"),onClick:async()=>{"normal"===Ce?await jt():await yt(!0)},disabled:Ie,style:{marginRight:"8px",display:"inline-flex",alignItems:"center",justifyContent:"center"},children:[(0,$.jsx)(L.A,{fontSize:"small",style:{marginRight:"4px"}}),"pending"===Ce?"New Invoices":"Pending Invoice"]}),(0,$.jsx)(b.A,{size:"small",onClick:()=>mt(e=>(0,a.A)((0,a.A)({},e),{},{multipleStaffUpdateDialog:!0})),disabled:!Ge.Do_Id.length,children:(0,$.jsx)(W.A,{fontSize:"small"})}),(0,$.jsx)(b.A,{size:"small",onClick:()=>mt(e=>(0,a.A)((0,a.A)({},e),{},{multipleStaffRemoveDialog:!0})),disabled:!Qe.Do_Id.length,children:(0,$.jsx)(X.A,{fontSize:"small"})}),(0,$.jsx)(b.A,{size:"small",onClick:()=>mt(e=>(0,a.A)((0,a.A)({},e),{},{filterDialog:!0})),disabled:Ie,children:(0,$.jsx)(M.A,{})}),(0,$.jsx)(b.A,{size:"small",onClick:()=>{"pending"===Ce?jt():yt(!0)},disabled:Ie,children:(0,$.jsx)(G.A,{})}),"pending"===Ce&&(0,$.jsx)($.Fragment,{children:(0,$.jsxs)("div",{children:[(0,$.jsx)(m.A,{variant:"contained",size:"small",startIcon:(0,$.jsx)(B.A,{}),endIcon:(0,$.jsx)(Q.A,{}),onClick:e=>{We(e.currentTarget)},disabled:!Ge.Do_Id.length||Ee,sx:{ml:1,textTransform:"none"},children:Ee?"Downloading...":"Download"}),(0,$.jsxs)(D.A,{anchorEl:ze,open:Boolean(ze),onClose:Mt,children:[(0,$.jsxs)(A.A,{onClick:()=>{const e=Ge.Do_Id;if(0!==e.length){Oe(!0),Mt();try{const t=he.filter(t=>e.includes((0,l.Ro)(t.Do_Id))),n=[];t.forEach((e,t)=>{const a={"S.No":t+1,"Invoice No":e.Do_Inv_No||"",Created:Lt(e.createdOn),"Voucher Type":e.voucherTypeGet||"",Customer:e.retailerNameGet||"","Bill Qty":e.stockDetails?e.stockDetails.reduce((e,t)=>e+(Number(t.Bill_Qty)||0),0):0,"Alt Act Qty":e.stockDetails?e.stockDetails.reduce((e,t)=>e+(Number(t.Alt_Act_Qty)||0),0):0,Narration:e.Narration||"","Total Amount":e.Total_Invoice_value||0,"Delivery Status":e.Delivery_Status||""};Ae.filter(e=>je.includes((0,l.Ro)(e.Cost_Category_Id))).forEach(t=>{const n=ve(e,t.Cost_Category_Id).join(", ");a[t.Cost_Category]=n||"-"}),n.push(a)});const a=re.Wp.book_new(),o=re.Wp.json_to_sheet(n),s=[],i=re.Wp.decode_range(o["!ref"]||"A1:A1");for(let e=i.s.c;e<=i.e.c;++e){let t=10;for(let n=i.s.r;n<=i.e.r;++n){const a=o[re.Wp.encode_cell({r:n,c:e})];if(a&&a.v){const e=String(a.v).length+2;e>t&&(t=e)}}s[e]={wch:Math.min(t,50)}}o["!cols"]=s,re.Wp.book_append_sheet(a,o,"Invoices");const r="Invoices_".concat(Ce,"_").concat((new Date).toISOString().split("T")[0],".xlsx");re._h(a,r),U.oR.success("Downloaded ".concat(e.length," invoices as Excel"))}catch(t){console.error("Error downloading Excel:",t),U.oR.error("Failed to download Excel: ".concat(t.message))}finally{Oe(!1)}}else U.oR.warning("Please select at least one invoice to download")},disabled:Ee,children:[(0,$.jsx)(S.A,{children:(0,$.jsx)(H.A,{fontSize:"small",color:"success"})}),(0,$.jsx)(I.A,{children:"Download as Excel"})]}),(0,$.jsxs)(A.A,{onClick:()=>{const e=Ge.Do_Id;if(0!==e.length){Oe(!0),Mt();try{const t=he.filter(t=>e.includes((0,l.Ro)(t.Do_Id))),n=new ie.default({orientation:"landscape",unit:"mm",format:"a4"}),a=[];t.forEach((e,t)=>{const n=[t+1,e.Do_Inv_No||"N/A",e.Do_Date?e.Do_Date.split("T")[0]:"",e.createdOn||"",e.voucherTypeGet||"",e.retailerNameGet||"",e.Retailer_GSTIN||"","\u20b9".concat((0,l.jG)(e.Total_Invoice_value||0)),e.stockDetails?e.stockDetails.reduce((e,t)=>e+(Number(t.Bill_Qty)||0),0):0,e.stockDetails?e.stockDetails.reduce((e,t)=>e+(Number(t.Alt_Act_Qty)||0),0):0,e.Narration||"",e.Delivery_Status||""];Ae.filter(e=>je.includes((0,l.Ro)(e.Cost_Category_Id))).forEach(t=>{const a=ve(e,t.Cost_Category_Id).join(", ");n.push(a||"-")}),a.push(n)});const o=["S.No","Invoice No","Invoice Date","Created On","Voucher Type","Customer","Customer GST","Total Amount","Bill Qty","Alt Act Qty","Narration","Delivery Status",...Ae.filter(e=>je.includes((0,l.Ro)(e.Cost_Category_Id))).map(e=>e.Cost_Category)];n.setFontSize(16),n.setTextColor(40,40,40),n.text("Invoices Report - ".concat("pending"===Ce?"Pending":"Sales"),14,15),n.setFontSize(8),n.setTextColor(100,100,100),n.text("Generated on: ".concat((new Date).toLocaleString()),280,10,{align:"right"}),n.text("Total Invoices: ".concat(e.length),14,22),n.text("Date Range: ".concat(ut.reqDate),14,27),n.autoTable({startY:32,head:[o],body:a,theme:"grid",styles:{fontSize:7,cellPadding:2,overflow:"linebreak",cellWidth:"wrap"},headStyles:{fillColor:[66,66,66],textColor:255,fontStyle:"bold",halign:"center"},columnStyles:{0:{cellWidth:10},1:{cellWidth:25},2:{cellWidth:20},3:{cellWidth:20},4:{cellWidth:15},5:{cellWidth:30},6:{cellWidth:25},7:{cellWidth:20,halign:"right"},8:{cellWidth:15,halign:"right"},9:{cellWidth:15,halign:"right"},10:{cellWidth:25},11:{cellWidth:15}},margin:{left:10,right:10},didDrawPage:e=>{n.setFontSize(8),n.setTextColor(150,150,150),n.text("Page ".concat(e.pageNumber," of ").concat(n.internal.getNumberOfPages()),e.settings.margin.left,n.internal.pageSize.height-10)}});const s="Invoices_".concat(Ce,"_").concat((new Date).toISOString().split("T")[0],".pdf");n.save(s),U.oR.success("Downloaded ".concat(e.length," invoices as PDF"))}catch(t){console.error("Error downloading PDF:",t),U.oR.error("Failed to download PDF: ".concat(t.message))}finally{Oe(!1)}}else U.oR.warning("Please select at least one invoice to download")},disabled:Ee,children:[(0,$.jsx)(S.A,{children:(0,$.jsx)(V.A,{fontSize:"small",color:"error"})}),(0,$.jsx)(I.A,{children:"Download as PDF"})]})]})]})}),(0,$.jsx)("input",{type:"date",className:"cus-inpt w-auto",value:ut.reqDate,onChange:e=>mt(t=>(0,a.A)((0,a.A)({},t),{},{reqDate:e.target.value})),disabled:Ie}),(0,$.jsx)(b.A,{size:"small",disabled:!ut.docType||!Ge.Do_Id.length,onClick:()=>{ke(ut.docType),vt({open:!0,doIds:Ge.Do_Id,docType:ut.docType})},children:(0,$.jsx)(z.A,{})}),(0,$.jsxs)("select",{className:"cus-inpt w-auto rounded-5 border-0",disabled:!Ge.Do_Id.length,value:ut.docType,onChange:e=>{const t=e.target.selectedIndex,n=e.target.options[t].text;mt(t=>(0,a.A)((0,a.A)({},t),{},{docType:e.target.value,docTypeLabel:n}))},children:[(0,$.jsx)("option",{value:"",children:"SELECT TYPE"}),(0,$.jsx)("option",{value:"sales_invoice",children:"SALES INVOICE"}),(0,$.jsx)("option",{value:"katchath",children:"KATCHATH"}),(0,$.jsx)("option",{value:"delivery_slip",children:"DELIVERY SLIP"})]}),"normal"===Ce&&(0,$.jsxs)("select",{className:"cus-inpt w-auto rounded-5 border-0",value:ut.staffStatus,onChange:e=>{mt(t=>(0,a.A)((0,a.A)({},t),{},{staffStatus:Number(e.target.value)}))},children:[(0,$.jsx)("option",{value:"1",children:"ALL INVOICES"}),(0,$.jsx)("option",{value:"0",children:"INCOMPLETED INVOICES"})]}),"pending"===Ce&&(0,$.jsxs)("span",{className:"ms-2 fw-bold text-primary",children:["Viewing Pending Invoices (",he.length," found)"]}),Ge.Do_Id.length>0&&(0,$.jsxs)("div",{className:"d-flex gap-4 mb-0 p-0",children:[(0,$.jsxs)("div",{children:[(0,$.jsx)("strong",{children:"Total Bill Qty:"})," ",It.billQty]}),(0,$.jsxs)("div",{children:[(0,$.jsx)("strong",{children:"Total Alt Act Qty:"})," ",It.altActQty]})]})]})}),(0,$.jsxs)(N.A,{open:ut.assignDialog,onClose:Tt,maxWidth:"lg",fullWidth:!0,children:[(0,$.jsxs)(w.A,{children:["Assign Cost Centers: ",(0,$.jsx)("span",{className:"text-primary",children:null===(t=ut.selectedInvoice)||void 0===t?void 0:t.Do_Inv_No})]}),(0,$.jsxs)("form",{onSubmit:async e=>{var t,n,a;e.preventDefault(),(0,s.z)({address:"sales/salesInvoice/lrReport",method:"POST",bodyData:{Do_Id:null===(t=ut.selectedInvoice)||void 0===t?void 0:t.Do_Id,involvedStaffs:null===(n=ut.selectedInvoice)||void 0===n?void 0:n.involvedStaffs,staffInvolvedStatus:(0,l.Ro)(null===(a=ut.selectedInvoice)||void 0===a?void 0:a.staffInvolvedStatus)},loadingOn:E,loadingOff:O}).then(e=>{e.success?(U.oR.success(e.message),Tt(),"pending"===Ce?jt():zt()):U.oR.error(e.message)}).catch(e=>console.log(e))},children:[(0,$.jsx)(T.A,{children:(0,$.jsxs)("div",{className:"row",children:[Ae.filter(e=>!["Broker","Transport"].some(t=>String(null===e||void 0===e?void 0:e.Cost_Category).includes(t))).map((e,t)=>{var n;const o=(0,l.$r)(null===(n=ut.selectedInvoice)||void 0===n?void 0:n.involvedStaffs).filter(t=>(0,l.id)(t.Emp_Type_Id,e.Cost_Category_Id)).map(e=>({value:e.Emp_Id,label:e.Emp_Name}));return(0,$.jsxs)("div",{className:"col-lg-4 col-md-6 p-2",children:[(0,$.jsx)("label",{children:e.Cost_Category}),(0,$.jsx)(P.Ay,{value:o,isMulti:!0,styles:R.MR,options:fe,onChange:t=>{const n=t.map(t=>{var n;return{Do_Id:null===ut||void 0===ut||null===(n=ut.selectedInvoice)||void 0===n?void 0:n.Do_Id,Emp_Id:t.value,Emp_Name:t.label,Emp_Type_Id:e.Cost_Category_Id,Involved_Emp_Type:e.Cost_Category}});((e,t,n)=>{mt(o=>{var s;const i=(0,l.$r)(null===(s=o.selectedInvoice)||void 0===s?void 0:s.involvedStaffs).filter(e=>!(0,l.id)(e.Emp_Type_Id,n.Cost_Category_Id)).concat(t);return(0,a.A)((0,a.A)({},o),{},{selectedInvoice:(0,a.A)((0,a.A)({},e),{},{involvedStaffs:i})})})})(ut.selectedInvoice,n,e)},placeholder:"Select ".concat(e.Cost_Category),filterOption:l.GI,menuPortalTarget:document.body})]},t)}),(0,$.jsxs)("div",{className:"col-lg-4 col-md-6 p-2 d-flex align-items-end",children:[(0,$.jsx)("input",{className:"form-check-input shadow-none pointer mx-2",style:{padding:"0.7em"},type:"checkbox",id:"removeFromList",checked:(0,l.id)(null===(n=ut.selectedInvoice)||void 0===n?void 0:n.staffInvolvedStatus,1),onChange:()=>{mt(e=>{var t;return(0,a.A)((0,a.A)({},e),{},{selectedInvoice:(0,a.A)((0,a.A)({},e.selectedInvoice),{},{staffInvolvedStatus:(0,l.id)(null===(t=e.selectedInvoice)||void 0===t?void 0:t.staffInvolvedStatus,1)?0:1})})})}}),(0,$.jsx)("label",{htmlFor:"removeFromList",className:"fw-bold",children:"Remove invoice from this page"})]})]})}),(0,$.jsxs)(F.A,{children:[(0,$.jsx)(m.A,{onClick:Tt,variant:"outlined",children:"Close"}),(0,$.jsx)(m.A,{variant:"contained",type:"submit",children:"Save"})]})]})]}),(0,$.jsxs)(N.A,{open:ut.filterDialog,onClose:Ft,maxWidth:"sm",fullWidth:!0,children:[(0,$.jsx)(w.A,{children:"Filter Options"}),(0,$.jsx)(T.A,{children:(0,$.jsx)("div",{className:"row",children:wt.map((e,t)=>(0,$.jsx)("div",{className:"col-12 p-2",children:Ht(e)},t))})}),(0,$.jsx)(F.A,{children:(0,$.jsx)(m.A,{onClick:Ft,variant:"outlined",children:"Close"})})]}),(0,$.jsxs)(N.A,{open:ut.multipleStaffUpdateDialog,onClose:kt,maxWidth:"sm",fullWidth:!0,children:[(0,$.jsx)(w.A,{children:"Update Cost Category"}),(0,$.jsxs)(T.A,{children:[(0,$.jsxs)("div",{className:"py-2",children:[(0,$.jsx)("label",{children:"Cost Category"}),(0,$.jsx)(P.Ay,{value:Ge.CostCategory,styles:R.MR,options:Ae.filter(e=>!["Broker","Transport"].some(t=>String(null===e||void 0===e?void 0:e.Cost_Category).includes(t))).map(e=>({value:e.Cost_Category_Id,label:e.Cost_Category})),onChange:e=>Be(t=>(0,a.A)((0,a.A)({},t),{},{CostCategory:e})),placeholder:"Select Cost Category",filterOption:l.GI,menuPortalTarget:document.body})]}),(0,$.jsxs)("div",{className:"py-2",children:[(0,$.jsx)("label",{children:"Staff"}),(0,$.jsx)(P.Ay,{value:Ge.involvedStaffs,isMulti:!0,styles:R.MR,options:fe,onChange:e=>Be(t=>(0,a.A)((0,a.A)({},t),{},{involvedStaffs:e})),placeholder:"Select Staff",filterOption:l.GI,menuPortalTarget:document.body,closeMenuOnSelect:!1})]}),(0,$.jsxs)("div",{className:"py-2",children:[(0,$.jsx)("label",{children:"Delivery Status"}),(0,$.jsxs)("select",{className:"cus-inpt p-1",onChange:e=>Be(t=>(0,a.A)((0,a.A)({},t),{},{deliveryStatus:e.target.value})),value:Ge.deliveryStatus,children:[(0,$.jsx)("option",{value:5,children:"Pending"}),(0,$.jsx)("option",{value:7,children:"Delivered"}),(0,$.jsx)("option",{value:6,children:"Return"}),(0,$.jsx)("option",{value:4,children:"Canceled"})]})]}),(0,$.jsxs)("div",{className:"py-2",children:[(0,$.jsx)("input",{className:"form-check-input shadow-none pointer mx-2",style:{padding:"0.7em"},type:"checkbox",id:"removeFromList",checked:(0,l.id)(Ge.staffInvolvedStatus,1),onChange:()=>{Be(e=>(0,a.A)((0,a.A)({},e),{},{staffInvolvedStatus:(0,l.id)(e.staffInvolvedStatus,1)?0:1}))}}),(0,$.jsx)("label",{htmlFor:"removeFromList",className:"fw-bold",children:"Remove invoice from this page"})]})]}),(0,$.jsxs)(F.A,{children:[(0,$.jsx)(m.A,{onClick:kt,variant:"outlined",children:"Close"}),(0,$.jsx)(m.A,{variant:"contained",onClick:async()=>{(0,s.z)({address:"sales/salesInvoice/lrReport/multiple",method:"POST",bodyData:{CostCategory:(0,l.Ro)(Ge.CostCategory.value),Do_Id:Ge.Do_Id,involvedStaffs:Ge.involvedStaffs.map(e=>(0,l.Ro)(e.value)),staffInvolvedStatus:(0,l.Ro)(Ge.staffInvolvedStatus),deliveryStatus:(0,l.Ro)(Ge.deliveryStatus)},loadingOn:E,loadingOff:O}).then(e=>{e.success?(U.oR.success(e.message),kt(),"pending"===Ce?jt():zt()):U.oR.error(e.message)}).catch(e=>console.log(e))},disabled:!Vt,children:"Save"})]})]}),(0,$.jsxs)(N.A,{open:Ye.open,onClose:Rt,maxWidth:"lg",fullWidth:!0,children:[(0,$.jsx)(w.A,{children:"Bill Print Preview"}),(0,$.jsx)(T.A,{children:(0,$.jsx)(Y.A,{Do_Id:Ye.Do_Id,Do_Date:Ye.Do_Date,loadingOn:E,loadingOff:O})}),(0,$.jsx)(F.A,{children:(0,$.jsx)(m.A,{variant:"outlined",onClick:Rt,children:"Close"})})]}),(0,$.jsxs)(N.A,{open:Xe.open,onClose:Et,maxWidth:"lg",fullWidth:!0,children:[(0,$.jsx)(w.A,{children:"Bill Print Preview"}),(0,$.jsx)(T.A,{children:(0,$.jsx)(K,{Do_Id:Xe.Do_Id,loadingOn:E,loadingOff:O})}),(0,$.jsx)(F.A,{children:(0,$.jsx)(m.A,{variant:"outlined",onClick:Et,children:"Close"})})]}),(0,$.jsxs)(N.A,{open:tt.open,onClose:Ot,maxWidth:"lg",fullWidth:!0,children:[(0,$.jsx)(w.A,{children:"Delivery Slip Preview"}),(0,$.jsx)(T.A,{children:(0,$.jsx)(Z.A,{Do_Id:tt.Do_Id,loadingOn:E,loadingOff:O})}),(0,$.jsx)(F.A,{children:(0,$.jsx)(m.A,{variant:"outlined",onClick:Ot,children:"Close"})})]}),(0,$.jsxs)(N.A,{open:ut.multipleStaffRemoveDialog,onClose:Pt,maxWidth:"sm",fullWidth:!0,children:[(0,$.jsx)(w.A,{children:"Remove Staff from Cost Category"}),(0,$.jsxs)(T.A,{children:[(0,$.jsxs)("div",{className:"py-2",children:[(0,$.jsx)("label",{children:"Cost Category to Remove"}),(0,$.jsx)(P.Ay,{value:Qe.CostCategory,styles:R.MR,options:Ae.filter(e=>!["Broker","Transport"].some(t=>String(null===e||void 0===e?void 0:e.Cost_Category).includes(t))).map(e=>({value:e.Cost_Category_Id,label:e.Cost_Category})),onChange:e=>He(t=>(0,a.A)((0,a.A)({},t),{},{CostCategory:e})),placeholder:"Select Cost Category to Remove",filterOption:l.GI,menuPortalTarget:document.body})]}),(0,$.jsxs)("div",{className:"py-2",children:[(0,$.jsx)("label",{children:"Delivery Status"}),(0,$.jsxs)("select",{className:"cus-inpt p-1",onChange:e=>He(t=>(0,a.A)((0,a.A)({},t),{},{deliveryStatus:e.target.value})),value:Qe.deliveryStatus,children:[(0,$.jsx)("option",{value:5,children:"Pending"}),(0,$.jsx)("option",{value:7,children:"Delivered"}),(0,$.jsx)("option",{value:6,children:"Return"}),(0,$.jsx)("option",{value:4,children:"Canceled"})]})]}),(0,$.jsxs)("div",{className:"py-2",children:[(0,$.jsx)("input",{className:"form-check-input shadow-none pointer mx-2",style:{padding:"0.7em"},type:"checkbox",id:"removeFromListRemove",checked:(0,l.id)(Qe.staffInvolvedStatus,1),onChange:()=>{He(e=>(0,a.A)((0,a.A)({},e),{},{staffInvolvedStatus:(0,l.id)(e.staffInvolvedStatus,1)?0:1}))}}),(0,$.jsx)("label",{htmlFor:"removeFromListRemove",className:"fw-bold",children:"Remove invoice from this page"})]}),(0,$.jsx)("div",{className:"py-2 text-muted",children:(0,$.jsxs)("small",{children:["This will remove all staff members of the selected Cost Category from ",Qe.Do_Id.length," selected invoices."]})})]}),(0,$.jsxs)(F.A,{children:[(0,$.jsx)(m.A,{onClick:Pt,variant:"outlined",children:"Cancel"}),(0,$.jsx)(m.A,{variant:"contained",color:"error",onClick:async()=>{Qe.CostCategory.value&&0!==Qe.Do_Id.length?(0,s.z)({address:"sales/salesInvoice/lrReport/multipleDelete",method:"POST",bodyData:{CostCategory:(0,l.Ro)(Qe.CostCategory.value),Do_Id:Qe.Do_Id,staffInvolvedStatus:(0,l.Ro)(Qe.staffInvolvedStatus),deliveryStatus:(0,l.Ro)(Qe.deliveryStatus)},loadingOn:E,loadingOff:O}).then(e=>{e.success?(U.oR.success(e.message),Pt(),"pending"===Ce?jt():zt()):U.oR.error(e.message)}).catch(e=>console.log(e)):U.oR.error("Please select a Cost Category and at least one invoice")},disabled:!Ut,children:"Remove Staff"})]})]}),(0,$.jsxs)(N.A,{open:pt.open,onClose:()=>vt({open:!1,doIds:[],docType:""}),maxWidth:"lg",fullWidth:!0,children:[(0,$.jsx)(T.A,{dividers:!0,children:(0,$.jsxs)("div",{ref:ht,children:["sales_invoice"===pt.docType&&(0,$.jsx)(Y.A,{Do_Ids:pt.doIds,loadingOn:E,loadingOff:O,isCombinedPrint:!0}),"katchath"===pt.docType&&(0,$.jsx)(K,{Do_Ids:pt.doIds,loadingOn:E,loadingOff:O,isCombinedPrint:!0}),"delivery_slip"===pt.docType&&(0,$.jsx)(Z.A,{Do_Ids:pt.doIds,loadingOn:E,loadingOff:O,isCombinedPrint:!0})]})}),(0,$.jsxs)(F.A,{className:"no-print",children:[(0,$.jsx)(m.A,{variant:"contained",onClick:()=>{Qt()},startIcon:(0,$.jsx)(z.A,{}),children:"Print All"}),(0,$.jsx)(m.A,{variant:"outlined",onClick:()=>vt({open:!1,doIds:[],docType:""}),children:"Close"})]})]}),(0,$.jsxs)(N.A,{open:at.open,onClose:bt,maxWidth:"sm",fullWidth:!0,children:[(0,$.jsx)(w.A,{children:"Send WhatsApp Message"}),(0,$.jsx)(T.A,{children:(()=>{const{order:e,method:t}=at;return(0,$.jsxs)(r.A,{children:[(0,$.jsxs)(r.A,{mb:2,children:[(0,$.jsxs)(d.A,{variant:"subtitle2",color:"textSecondary",children:["Order: ",(0,$.jsx)("strong",{children:null===e||void 0===e?void 0:e.Do_Inv_No})]}),(0,$.jsxs)(d.A,{variant:"subtitle2",color:"textSecondary",children:["Customer: ",(0,$.jsx)("strong",{children:null===e||void 0===e?void 0:e.retailerNameGet})]}),(0,$.jsxs)(d.A,{variant:"subtitle2",color:"textSecondary",children:["Phone: ",(0,$.jsx)("strong",{children:(null===e||void 0===e?void 0:e.Party_Mobile_1)||(null===e||void 0===e?void 0:e.recipientPhone)})]}),(0,$.jsxs)(d.A,{variant:"subtitle2",color:"textSecondary",children:["Amount: ",(0,$.jsxs)("strong",{children:["\u20b9",(0,l.jG)(null===e||void 0===e?void 0:e.Total_Invoice_value)]})]})]}),(0,$.jsx)(c.A,{sx:{my:2}}),Le.loading&&(0,$.jsx)(r.A,{sx:{display:"flex",alignItems:"center",gap:1,my:2,p:2,bgcolor:"info.light",borderRadius:1},children:(0,$.jsx)(d.A,{variant:"body2",children:"Generating PDF document..."})}),Le.error&&(0,$.jsxs)(u.A,{severity:"error",sx:{my:2},children:[(0,$.jsxs)(d.A,{variant:"body2",children:["Failed to generate PDF: ",Le.error]}),(0,$.jsx)(m.A,{size:"small",onClick:()=>Dt(e),sx:{mt:1},children:"Retry PDF Generation"})]}),Le.pdfUrl&&!Le.loading&&(0,$.jsxs)(u.A,{severity:"success",sx:{my:2},children:[(0,$.jsx)(d.A,{variant:"body2",fontWeight:"bold",children:"\u2713 PDF generated successfully!"}),(0,$.jsxs)(r.A,{sx:{mt:1},children:[(0,$.jsxs)(d.A,{variant:"caption",display:"block",children:["File: ",Le.fileName]}),(0,$.jsx)(d.A,{variant:"caption",display:"block",children:"Secure URL generated with token"}),(0,$.jsx)(m.A,{size:"small",variant:"outlined",onClick:()=>Wt(e.Do_Inv_No,Le.fileName),sx:{mt:1},startIcon:(0,$.jsx)(z.A,{fontSize:"small"}),children:"Test Download PDF"})]})]}),(0,$.jsxs)(r.A,{mb:2,children:[(0,$.jsx)(d.A,{variant:"subtitle1",fontWeight:"bold",mb:1,children:"Choose sending method:"}),(0,$.jsxs)(p.A,{value:t,onChange:e=>ot(t=>(0,a.A)((0,a.A)({},t),{},{method:e.target.value})),children:[(0,$.jsx)(v.A,{value:"pdf-link",control:(0,$.jsx)(h.A,{size:"small"}),label:(0,$.jsx)(r.A,{sx:{display:"flex",alignItems:"center",gap:1},children:(0,$.jsx)("span",{children:"Send PDF Download Link"})}),disabled:!Le.pdfUrl&&!Le.loading}),(0,$.jsx)(v.A,{value:"pdf-template",control:(0,$.jsx)(h.A,{size:"small"}),label:"Send with PDF Template"}),(0,$.jsx)(v.A,{value:"other-template",control:(0,$.jsx)(h.A,{size:"small"}),label:"Send with Text Template"})]})]}),"pdf-template"===t&&(0,$.jsx)(r.A,{children:(0,$.jsxs)(g.A,{fullWidth:!0,variant:"outlined",size:"small",children:[(0,$.jsx)(f.A,{children:"Select PDF Template"}),(0,$.jsxs)(x.A,{value:it,onChange:e=>rt(e.target.value),label:"Select PDF Template",children:[(0,$.jsx)(A.A,{value:"",children:(0,$.jsx)("em",{children:"Select a PDF template"})}),gt.length>0?gt.map(e=>{const t=e.templateName||e.name,n=e.eventId||e.id;return(0,$.jsxs)(A.A,{value:t,children:[t," (",e.language||"en",")",e.templateStatus&&" - ".concat(e.templateStatus)]},n)}):(0,$.jsx)(A.A,{disabled:!0,children:"No PDF templates available"})]})]})}),"other-template"===t&&(0,$.jsx)(r.A,{children:(0,$.jsxs)(g.A,{fullWidth:!0,variant:"outlined",size:"small",children:[(0,$.jsx)(f.A,{children:"Select Text Template"}),(0,$.jsxs)(x.A,{value:it,onChange:e=>rt(e.target.value),label:"Select Text Template",children:[(0,$.jsx)(A.A,{value:"",children:(0,$.jsx)("em",{children:"Select a text template"})}),ft.length>0?ft.map(e=>{const t=e.templateName||e.name,n=e.eventId||e.id;return(0,$.jsxs)(A.A,{value:t,children:[t," (",e.language||"en",")"]},n)}):(0,$.jsx)(A.A,{disabled:!0,children:"No text templates available"})]})]})}),it&&t.includes("template")&&(0,$.jsxs)(r.A,{mt:3,p:2,border:1,borderColor:"divider",borderRadius:1,children:[(0,$.jsx)(d.A,{variant:"subtitle2",fontWeight:"bold",mb:1,children:"Preview:"}),(0,$.jsxs)(d.A,{variant:"body2",children:[(0,$.jsx)("strong",{children:"Template:"})," ",it,(0,$.jsx)("br",{}),(0,$.jsx)("strong",{children:"Invoice:"})," ",null===e||void 0===e?void 0:e.Do_Inv_No,(0,$.jsx)("br",{}),(0,$.jsx)("strong",{children:"Customer:"})," ",null===e||void 0===e?void 0:e.retailerNameGet,(0,$.jsx)("br",{}),(0,$.jsx)("strong",{children:"Amount:"})," \u20b9",(0,l.jG)(null===e||void 0===e?void 0:e.Total_Invoice_value),Le.pdfUrl&&(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)("br",{}),(0,$.jsx)("strong",{children:"PDF URL:"})," Will be included in message"]})]})]}),"pdf-link"===t&&Le.pdfUrl&&(0,$.jsxs)(r.A,{mt:3,p:2,border:1,borderColor:"divider",borderRadius:1,children:[(0,$.jsx)(d.A,{variant:"subtitle2",fontWeight:"bold",mb:1,children:"PDF Link Preview:"}),(0,$.jsxs)(d.A,{variant:"body2",children:["The customer will receive a WhatsApp message with a secure link to download the PDF invoice.",(0,$.jsx)("br",{}),(0,$.jsx)("br",{}),(0,$.jsx)("strong",{children:"Invoice PDF Details:"}),(0,$.jsx)("br",{}),"\u2022 File: ",Le.fileName,(0,$.jsx)("br",{}),"\u2022 Secure encrypted link",(0,$.jsx)("br",{}),"\u2022 Valid for 7 days",(0,$.jsx)("br",{}),"\u2022 Professional invoice format"]})]})]})})()}),(0,$.jsxs)(F.A,{children:[(0,$.jsx)(m.A,{onClick:bt,disabled:at.loading,children:"Cancel"}),(0,$.jsx)(m.A,{onClick:async()=>{const{order:e,method:t}=at;ot(e=>(0,a.A)((0,a.A)({},e),{},{loading:!0}));try{var n;const t=(e=>{const t=se.A,n=e.Do_Inv_No.replace(/_/g,"/"),a=btoa(n);return"".concat(t,"sales/downloadPdf?Do_Inv_No=").concat(a)})(e),a=(null===(n=e.ConvertedInvoice)||void 0===n?void 0:n[0])||e,l=e.Do_Inv_No||"N/A",s=e.retailerNameGet||e.Retailer_Name||"Customer",i=new Date(a.Do_Date||e.Do_Date).toLocaleDateString("en-GB"),r=(a.Total_Invoice_value||e.Total_Invoice_value||0).toFixed(2);try{await fetch(t,{method:"HEAD"})}catch(o){console.warn("PDF URL test warning:",o.message)}const d={template:{name:"template_text",language:"en"},source:"crm",wabaNumber:ne.Or,recipients:["91".concat(e.recipientPhone)],clientRefId:"invoice_".concat(l.replace(/\//g,"_"),"_").concat(Date.now()),params:{body:["".concat(s),"".concat(l),"".concat(i),"".concat(r),"SM TRADERS","".concat(t)]}},c=await le.sendTemplateMessage(d);if(null===c||void 0===c||!c.status)throw console.error("WhatsApp API error:",c),new Error((null===c||void 0===c?void 0:c.message)||"Failed to send message");Ct("WhatsApp message sent successfully!","success"),bt()}catch(l){console.error("Error sending WhatsApp:",l),Ct("Failed to send message: ".concat(l.message),"error"),ot(e=>(0,a.A)((0,a.A)({},e),{},{loading:!1}))}},variant:"contained",color:"success",startIcon:(0,$.jsx)(ee.A,{}),disabled:at.loading||"template"===at.method&&!it,children:at.loading?"Sending...":"Send WhatsApp"})]})]}),(0,$.jsx)(k.A,{open:dt.open,autoHideDuration:6e3,onClose:()=>ct(e=>(0,a.A)((0,a.A)({},e),{},{open:!1})),children:(0,$.jsx)(u.A,{severity:dt.severity,onClose:()=>ct(e=>(0,a.A)((0,a.A)({},e),{},{open:!1})),children:dt.message})})]})}},48471:(e,t,n)=>{n.d(t,{Ay:()=>z,JT:()=>E,Lj:()=>P,wF:()=>R});var a=n(89379),o=n(65043),l=n(77739),s=n(17392),i=n(41020),r=n(30922),d=n(32143),c=n(2050),u=n(48734),m=n(28076),p=n(39652),v=n(12110),h=n(63336),g=n(79650),f=n(71806),x=n(84882),A=n(58093),y=n(73460),j=n(31159),_=n(22520),C=n(47968),b=n(692),D=n(8737),S=n(58558),I=n(30599),N=n(433),w=n(37762),T=(n(20557),n(11238)),F=n(70579);const k=(e,t)=>e.map(e=>{const n={};return t.forEach((t,a)=>{if(t.isVisible||t.Defult_Display)if(t.isCustomCell&&t.Cell){const o=t.Cell({row:e}),l=t.ColumnHeader?String(t.ColumnHeader).replace(/\s+/g,"_").toLowerCase():"field_".concat(a+1);"string"!==typeof o&&"number"!==typeof o&&"bigint"!==typeof o||(n[l]=o)}else{let a=t.Field_Name;n[a]=e[a]||""}}),n}),P=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"string",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"left",l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"center",s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;return(0,a.A)({isVisible:s,Field_Name:e,Fied_Data:t,align:o,verticalAlign:l},n&&{ColumnHeader:n})},R=e=>{let{buttonsData:t=[],ToolTipText:n="Options"}=e;const[a,m]=(0,o.useState)(null),p=Boolean(a);return(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(l.A,{title:n,children:(0,F.jsx)(s.A,{"aria-describedby":p,onClick:e=>{m(e.currentTarget)},className:"ms-2",size:"small",children:(0,F.jsx)(S.A,{})})}),(0,F.jsx)(i.Ay,{open:p,anchorEl:a,onClose:()=>{m(null)},anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:(0,F.jsx)(r.A,{children:t.map((e,t)=>(0,F.jsxs)(d.A,{onClick:()=>(null===e||void 0===e?void 0:e.onclick)&&(null===e||void 0===e?void 0:e.onclick()),disabled:null===e||void 0===e?void 0:e.disabled,children:[(0,F.jsx)(c.A,{children:null===e||void 0===e?void 0:e.icon}),(0,F.jsx)(u.A,{children:null===e||void 0===e?void 0:e.name})]},t))})})]})},E=(e,t)=>{switch(t){case"number":return e?(0,_.jG)(e):e;case"date":return e?(0,_.yc)(e):e;case"time":return e?(0,_.JG)(e):e;case"string":return e;default:return""}},O=e=>{let{dataArray:t=[],columns:n=[],onClickFun:l=null,isExpendable:i=!1,expandableComp:r=null,tableMaxHeight:d=550,initialPageCount:c=20,EnableSerialNumber:u=!1,CellSize:S="small",disablePagination:P=!1,title:O="",PDFPrintOption:z=!1,ExcelPrintOption:W=!1,maxHeightOption:L=!1,ButtonArea:M=null,MenuButtons:G=[],bodyFontSizePx:B=13,headerFontSizePx:Q=13}=e;const[H,V]=(0,o.useState)(0),[U,q]=(0,o.useState)(c),[$,J]=(0,o.useState)([]),[K,Y]=(0,o.useState)(!0),Z=K&&L?" max-content ":d,X=[{type:"left",class:"text-start"},{type:"right",class:"text-end"},{type:"center",class:"text-center"}],ee=[{type:"top",class:" vtop "},{type:"bottom",class:" vbottom "},{type:"center",class:" vctr "}],te=(e=>{if(!$.length)return e;return[...e].sort((e,t)=>{for(const n of $){const{columnId:a,direction:o}=n,l=e[a],s=t[a];if(l!==s)return"asc"===o?l>s?1:-1:l<s?1:-1}return 0})})(t),ne=H*U,ae=ne+U,oe=te.slice(ne,ae),le=e=>{let{row:t,index:a}=e;const[d,c]=(0,o.useState)(!1),v="20px";return(0,F.jsxs)(o.Fragment,{children:[(0,F.jsxs)(m.A,{children:[!0===i&&r&&(0,F.jsx)(p.A,{className:"border-end text-center vtop",sx:{fontSize:"".concat(B,"px")},children:(0,F.jsx)(s.A,{size:"small",onClick:()=>c(e=>!e),children:d?(0,F.jsx)(D.A,{sx:{fontSize:v}}):(0,F.jsx)(b.A,{sx:{fontSize:v}})})}),!0===u&&(0,F.jsx)(p.A,{className:"border-end text-center vtop",sx:{fontSize:"".concat(B,"px")},children:U*H+a+1}),null===n||void 0===n?void 0:n.map((e,n)=>{var o,s;const i=(0,_.id)(null===e||void 0===e?void 0:e.Defult_Display,1)||(0,_.id)(null===e||void 0===e?void 0:e.isVisible,1),r=Boolean(null===e||void 0===e?void 0:e.isCustomCell)&&e.Cell,d=!r,c=(t,n,a)=>null!==e&&void 0!==e&&e.tdClass?" ".concat(null===e||void 0===e?void 0:e.tdClass({row:t,Field_Name:n,index:a})," "):"",u=e.align?null===(o=X.find(t=>t.type===String(e.align).toLowerCase()))||void 0===o?void 0:o.class:"",m=e.verticalAlign?null===(s=ee.find(t=>t.type===String(e.verticalAlign).toLowerCase()))||void 0===s?void 0:s.class:" vctr ";if(i&&d){const o=Object.entries(t).find(t=>{let[n]=t;return n===e.Field_Name});return(0,F.jsx)(p.A,{className:"border-end ".concat(u," ").concat(m," ").concat(c(t,e.Field_Name,a)),sx:{fontSize:"".concat(B,"px")},onClick:()=>l?l(t):console.log("Function not supplied"),children:o?E(o[1],null===e||void 0===e?void 0:e.Fied_Data):"-"},n)}return i&&r?(0,F.jsx)(p.A,{className:"border-end ".concat(u," ").concat(m," ").concat(c(t,e.Field_Name,a)),sx:{fontSize:"".concat(B,"px")},children:e.Cell({row:t,Field_Name:e.Field_Name,index:a})},n):(0,F.jsx)(p.A,{sx:{fontSize:"".concat(B,"px")},className:"border-end ".concat(u," ").concat(m),children:"-"},n)})]}),!0===i&&r&&d&&(0,F.jsx)(m.A,{children:(0,F.jsx)(p.A,{colSpan:Number(null===n||void 0===n?void 0:n.length)+(!0===u?2:1),children:r({row:t,index:a})})})]})};return(0,F.jsxs)(v.A,{className:"rounded-3 bg-white overflow-hidden",component:h.A,children:[(0,F.jsxs)("div",{className:"d-flex align-items-center flex-wrap px-3 py-2 flex-row-reverse ",children:[(z||W||G.length>0||L)&&(0,F.jsx)(R,{ToolTipText:"Table Options",buttonsData:[...L?[{name:"Max Height",icon:K?(0,F.jsx)(N.A,{fontSize:"small",color:"primary"}):(0,F.jsx)(I.A,{fontSize:"small"}),onclick:()=>Y(e=>!e),disabled:(0,_.id)(null===t||void 0===t?void 0:t.length,0)}]:[],...z?[{name:"PDF Print",icon:(0,F.jsx)(C.A,{fontSize:"small",color:"primary"}),onclick:()=>((e,t)=>{try{const n=new w.default,o=k(e,t),l=t.filter(e=>e.isVisible||e.Defult_Display).map(e=>e.Field_Name||String(e.ColumnHeader).replace(/\s+/g,"_").toLowerCase()),s=o.map(e=>l.map(t=>e[t])).map((e,t)=>(0,a.A)((0,a.A)({},e),{},{Sno:t+1}));n.autoTable({head:[l],body:s}),n.save("table.pdf")}catch(n){console.error(n)}})(t,n),disabled:(0,_.id)(null===t||void 0===t?void 0:t.length,0)}]:[],...W?[{name:"Excel Print",icon:(0,F.jsx)(C.A,{fontSize:"small",color:"primary"}),onclick:()=>((e,t)=>{try{const n=k(e,t),a=T.Wp.json_to_sheet(n),o=T.Wp.book_new();T.Wp.book_append_sheet(o,a,"Data"),T._h(o,"table.xlsx")}catch(n){console.error(n)}})(t,n),disabled:(0,_.id)(null===t||void 0===t?void 0:t.length,0)}]:[],...G]}),M&&M,O&&(0,F.jsx)("h6",{className:"fw-bold text-muted flex-grow-1 m-0",children:O})]}),(0,F.jsx)(g.A,{sx:{maxHeight:Z},children:(0,F.jsxs)(f.A,{stickyHeader:!0,size:S,children:[(0,F.jsx)(x.A,{children:(0,F.jsxs)(m.A,{children:[i&&r&&(0,F.jsx)(p.A,{className:"fw-bold border-end border-top text-center",sx:{fontSize:"".concat(Q,"px"),backgroundColor:"#EDF0F7"},children:"#"}),u&&(0,F.jsx)(p.A,{className:"fw-bold border-end border-top text-center",sx:{fontSize:"".concat(Q,"px"),backgroundColor:"#EDF0F7"},children:"SNo"}),n.map((e,t)=>{const n=(0,_.id)(null===e||void 0===e?void 0:e.Defult_Display,1)||(0,_.id)(null===e||void 0===e?void 0:e.isVisible,1),o=!1===Boolean(null===e||void 0===e?void 0:e.isCustomCell)||!e.Cell,l=$.find(t=>t.columnId===e.Field_Name),s=l?l.direction:"asc";var i,r,d,c;return n?o?(0,F.jsx)(p.A,{className:"fw-bold border-end border-top "+(e.align?null===(i=X.find(t=>t.type===String(e.align).toLowerCase()))||void 0===i?void 0:i.class:""),sx:{fontSize:"".concat(Q,"px"),backgroundColor:"#EDF0F7"},sortDirection:!!l&&s,children:(0,F.jsx)(A.A,{active:!!l,direction:s,onClick:()=>(e=>{const t=$.find(t=>t.columnId===e);if(t){const n="asc"===t.direction;J($.map(t=>t.columnId===e?(0,a.A)((0,a.A)({},t),{},{direction:n?"desc":"asc"}):t))}else J([...$,{columnId:e,direction:"asc"}])})(e.Field_Name),children:e.ColumnHeader||(null===e||void 0===e||null===(r=e.Field_Name)||void 0===r?void 0:r.replace(/_/g," "))})},t):(0,F.jsx)(p.A,{className:"".concat(e.ColumnHeader||null!==e&&void 0!==e&&e.Field_Name?" fw-bold border-end border-top p-2 appFont ":" p-0 "," ")+(e.align?null===(d=X.find(t=>t.type===String(e.align).toLowerCase()))||void 0===d?void 0:d.class:""),sx:{fontSize:"".concat(Q,"px"),backgroundColor:"#EDF0F7"},children:e.ColumnHeader||(null===e||void 0===e||null===(c=e.Field_Name)||void 0===c?void 0:c.replace(/_/g," "))},t):null})]})}),(0,F.jsxs)(y.A,{children:[(P?te:oe).map((e,t)=>(0,F.jsx)(le,{row:e,index:t},t)),0===t.length&&(0,F.jsx)(m.A,{children:(0,F.jsx)(p.A,{colSpan:n.length+(!0===i&&r?1:0)+(!0===u?1:0),sx:{textAlign:"center"},children:"No Data"})})]})]})}),!P&&0!==oe.length&&(0,F.jsx)("div",{className:"p-2 pb-0",children:(0,F.jsx)(j.A,{component:"div",count:t.length,page:H,onPageChange:(e,t)=>{V(t)},rowsPerPage:U,onRowsPerPageChange:e=>{q(parseInt(e.target.value,10)),V(0)},rowsPerPageOptions:Array.from(new Set([c,5,20,50,100,200,500,1e3,2e3])).sort((e,t)=>e-t),labelRowsPerPage:"Rows per page",showFirstButton:!0,showLastButton:!0})})]})};O.defaultProps={dataArray:[],columns:[],onClickFun:null,isExpendable:!1,expandableComp:null,tableMaxHeight:550,initialPageCount:20,EnableSerialNumber:!1,CellSize:"small",disablePagination:!1,title:void 0,PDFPrintOption:!1,ExcelPrintOption:!1,maxHeightOption:!1,ButtonArea:null,MenuButtons:[],headerFontSizePx:13,bodyFontSizePx:13};const z=O},63406:(e,t,n)=>{n.d(t,{zU:()=>i,ex:()=>r,MR:()=>s,Ap:()=>l,FX:()=>d});var a=n(89379);const o=n.p+"static/media/smt.aa4d4f940bbebff07a57.png",l={table:{style:{width:"auto",backgroundColor:"transparent"}},rows:{style:{backgroundColor:"transparent"}},headCells:{style:{backgroundColor:"#6b9080f8",color:"white",fontSize:"14px"}}},s={menu:(e,t)=>(0,a.A)((0,a.A)({},e),{},{zIndex:9999}),menuPortal:e=>(0,a.A)((0,a.A)({},e),{},{zIndex:9999}),groupHeading:e=>(0,a.A)((0,a.A)({},e),{},{backgroundColor:"#f5f5f5",color:"#333",fontWeight:"bold",fontSize:"14px",padding:"8px 12px",borderBottom:"1px solid #ddd",textTransform:"uppercase"}),option:(e,t)=>(0,a.A)((0,a.A)({},e),{},{backgroundColor:t.isSelected?"#2684FF":t.isFocused?"#E2ECF9":"white",color:t.isSelected?"white":"#333",padding:"10px 12px"})},i=[{id:1,headname:"Menu ID",variant:"head",align:"left",width:100},{id:2,headname:"MenuName"},{id:3,headname:"Read Rights"},{id:4,headname:"Add Rights"},{id:5,headname:"Edit Rights"},{id:6,headname:"Delete Rights"},{id:7,headname:"Print Rights"},{id:8,headname:"Action"}],r=[{dataBase:1,name:"SHANKAR TRADERS",business:"Wholesale Merchant in Dhall",address:"32, Chitrakara Street, Madurai - 01 <br /> Bill of Supply -Disclaimer Affidavlt Field Extemped",logo:o,gstin:"33AADFS6973R1ZD",phone:"984-313-1353, 984-335-5166",fssai:"12418012000818",bankAccount:"0021 5032 0885 122",ifsc:"TMBL0000002"},{dataBase:2,name:"SMT AGRO PRODUCTS",business:"",address:"H.O: 153, Chitrakara Street, 2nd Floor, Madurai -01 <br /> G.O: 746 Puliyur, Sayanapuram, Svga <br /> Bill of Supply -Disclaimer Affidavlt Field Extemped",logo:o,gstin:"33ACMFS3420Q1ZQ",phone:"0452-4371625",fssai:"12418012000818",bankAccount:"0025 3031 0875 947",ifsc:"TMBL0000002"},{dataBase:3,name:"BHAVANI TRADERS",business:"",address:"H.O: 152-A, Chitrakara Street, Madurai -01 <br /> G.O: 30/1-Rajman Nagar, Chintamani Main Road, Mdu-01 <br /> Tax Invoice",logo:o,gstin:"33AAEFB6728J1ZG",phone:"958-559-7641, 958-559-7614",fssai:"12418012000670",bankAccount:"0021 5005 0800 309",ifsc:"TMBL0000002"}],d=[{name:"PURCHASE_ORDER"},{name:"PURCHASE_INVOICE"},{name:"SALE_ORDER"},{name:"SALE_INVOICE"},{name:"JOURNAL"},{name:"STOCK_JOURNAL"},{name:"PAYMENT"},{name:"RECEIPT"},{name:"CONTRA"}]}}]);
//# sourceMappingURL=982.998f5d3b.chunk.js.map