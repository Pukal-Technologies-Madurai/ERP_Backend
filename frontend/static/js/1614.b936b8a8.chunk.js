"use strict";(self.webpackChunkerp=self.webpackChunkerp||[]).push([[1614,2110,9729],{11614:(e,l,t)=>{t.r(l),t.d(l,{default:()=>_});var n=t(89379),a=t(65043),s=t(12110),o=t(11906),r=t(26494),d=t(81e3),i=t(85865),c=t(68903),u=t(77739),m=t(83462),p=t(26600),h=t(35316),b=t(29347),v=t(38463),x=t(65829),A=t(55434),f=t(37141),y=t(97707),g=t(91036),N=t(73216),j=t(45777),I=t(65074),C=t(70579);const _=()=>{const e=JSON.parse(localStorage.getItem("user")),l=(0,N.Zp)(),{contextObj:t}=(0,a.useContext)(j.i),_=(0,N.zy)().state,S={Report_Type_Id:"",reportName:"",tables:[],tableJoins:[],currentTab:"",createdBy:null===e||void 0===e?void 0:e.UserId},[T,R]=(0,a.useState)(S),[k,w]=(0,a.useState)([]),[M,B]=(0,a.useState)([{slot:1,enabled:!1,tableId:null,columnName:null,type:1},{slot:2,enabled:!1,tableId:null,columnName:null,type:2},{slot:3,enabled:!1,tableId:null,columnName:null,type:3}]),[F,E]=(0,a.useState)([]),[D,L]=(0,a.useState)(!1);(0,a.useEffect)(()=>{const l=null===_||void 0===_?void 0:_.ReportState;(0,y.aF)(l)&&R(t=>{var a,s,o;return(0,n.A)((0,n.A)({},t),{},{Report_Type_Id:null!==(a=null===l||void 0===l?void 0:l.Report_Type_Id)&&void 0!==a?a:"",reportName:null!==(s=null===l||void 0===l?void 0:l.reportName)&&void 0!==s?s:"",tables:[...(null===l||void 0===l?void 0:l.tables)||[]],createdBy:null!==(o=null===l||void 0===l?void 0:l.createdBy)&&void 0!==o?o:null===e||void 0===e?void 0:e.UserId})})},[null===_||void 0===_?void 0:_.ReportState,null===e||void 0===e?void 0:e.UserId]),(0,a.useEffect)(()=>{(0,I.z)({address:"reports/tablesAndColumnsMobile"}).then(e=>{null!==e&&void 0!==e&&e.success&&w((null===e||void 0===e?void 0:e.data)||[])}).catch(e=>console.error(e))},[]),(0,a.useEffect)(()=>{if(!T.tables||0===T.tables.length)return;const e=[],l=new Set;T.tables.forEach(t=>{var n;null===(n=t.columns)||void 0===n||n.forEach(n=>{if(n.Type){(Array.isArray(n.Type)?n.Type:[n.Type]).forEach(a=>{if(a&&(e.push({type:Number(a),tableId:t.Table_Id,columnName:n.Column_Name,listType:n.List_Type}),n.List_Type)){String(n.List_Type).split(",").map(e=>Number(e.trim())).filter(e=>!isNaN(e)).forEach(e=>l.add(e))}})}})}),e.length>0&&(B(l=>{const t=l.map(e=>(0,n.A)((0,n.A)({},e),{},{enabled:!1,tableId:null,columnName:null}));return e.forEach(e=>{const l=t.findIndex(l=>l.type===e.type);-1!==l&&(t[l]=(0,n.A)((0,n.A)({},t[l]),{},{enabled:!0,tableId:e.tableId,columnName:e.columnName}))}),t}),l.size>0?E(Array.from(l)):E([1]))},[T.tables]);const z=e=>{if(!e)return[];const l=T.tables.find(l=>String(l.Table_Id)===String(e));if(l&&Array.isArray(l.columns)&&l.columns.length)return l.columns;const t=k.find(l=>String(l.Table_Id)===String(e));return t&&Array.isArray(t.Columns)?t.Columns.map(e=>{var l,t,n,a,s,o;return{Column_Name:e.Column_Name,Column_Data_Type:null!==(l=null!==(t=e.Column_Data_Type)&&void 0!==t?t:null===e||void 0===e?void 0:e.Column_Data_Type)&&void 0!==l?l:"string",IS_Default:null!==(n=null!==(a=e.IS_Default)&&void 0!==a?a:null===e||void 0===e?void 0:e.IS_Default)&&void 0!==n?n:0,IS_Join_Key:null!==(s=null!==(o=e.IS_Join_Key)&&void 0!==o?o:null===e||void 0===e?void 0:e.IS_Join_Key)&&void 0!==s?s:0}}):[]},P=(e,l,t)=>M.some((n,a)=>!!n.enabled&&(a!==t&&(String(n.tableId)===String(e)&&String(n.columnName)===String(l)))),J=M.reduce((e,l)=>e+(l.enabled&&l.tableId?1:0),0),O=M.reduce((e,l)=>e+(l.enabled&&l.columnName?1:0),0),U=async()=>{const t=(()=>{const e=[];return M.forEach(l=>{if(!l.enabled)return;if(!l.tableId||!l.columnName)return;const t=0===F.length?"1":F.join(",");e.push({Type:Number(l.type),Table_Id:Number(l.tableId),Column_Name:l.columnName,List_Type:t})}),e})();if(!t.length)return void g.oR.error("Assign at least one filter slot (table + column) before saving");if(!T.reportName||""===String(T.reportName).trim())return void g.oR.error("Report name is required");const n={Report_Type_Id:(null===T||void 0===T?void 0:T.Report_Type_Id)||null,reportName:T.reportName,createdBy:T.createdBy,updatedBy:null===e||void 0===e?void 0:e.UserId,details:t};try{const e=await(0,I.z)({address:"reports/templateMobile",method:null!==T&&void 0!==T&&T.Report_Type_Id?"PUT":"POST",bodyData:n});null!==e&&void 0!==e&&e.success?(g.oR.success(e.message),R(S),B([{slot:1,enabled:!1,tableId:null,columnName:null,type:1},{slot:2,enabled:!1,tableId:null,columnName:null,type:2},{slot:3,enabled:!1,tableId:null,columnName:null,type:3}]),E([]),l(-1)):g.oR.error((null===e||void 0===e?void 0:e.message)||"Failed to save")}catch(a){console.error(a),g.oR.error("Error saving template")}},W=M.some(e=>e.enabled&&e.tableId&&e.columnName);return(0,y.id)(null===t||void 0===t?void 0:t.Add_Rights,1)?(0,C.jsxs)(C.Fragment,{children:[(0,C.jsxs)(s.A,{children:[(0,C.jsxs)("div",{className:"p-2 border-bottom fa-16 fw-bold d-flex justify-content-between align-items-center",children:[(0,C.jsx)("span",{className:"text-primary text-uppercase ps-3",children:null!==T&&void 0!==T&&T.Report_Type_Id?"Modify Mobile Template":"Mobile Template Creation"}),(0,C.jsx)(o.A,{variant:"outlined",onClick:()=>l(-1),startIcon:(0,C.jsx)(x.A,{}),children:"Back"})]}),(0,C.jsxs)(r.A,{children:[(0,C.jsxs)("div",{children:[(0,C.jsx)("label",{className:"w-100",children:"Report Name"}),(0,C.jsxs)("select",{className:"cus-inpt w-auto",value:T.reportName,onChange:e=>R((0,n.A)((0,n.A)({},T),{},{reportName:e.target.value})),children:[(0,C.jsx)("option",{value:"",disabled:!0,children:"Select"}),(0,C.jsx)("option",{value:"StockInhand",children:"Stock Inhand"}),(0,C.jsx)("option",{value:"Sales Invoice",children:"Sales Invoice"})]})]}),(0,C.jsx)("div",{className:"p-2 mt-3 border rounded-3 d-inline-block",children:(0,C.jsx)("table",{children:(0,C.jsxs)("tbody",{children:[(0,C.jsxs)("tr",{children:[(0,C.jsx)("td",{className:"border-end",children:"Filters Assigned"}),(0,C.jsx)("td",{className:"px-2 blue-text",children:J})]}),(0,C.jsxs)("tr",{children:[(0,C.jsx)("td",{className:"border-end",children:"Columns Assigned"}),(0,C.jsx)("td",{className:"px-2 blue-text",children:O})]})]})})}),(0,C.jsxs)(d.A,{className:"mt-3 p-3 border rounded",sx:{background:"#FBFCFD"},children:[(0,C.jsx)(i.A,{variant:"subtitle1",fontWeight:700,gutterBottom:!0,children:"Filters"}),(0,C.jsx)(c.Ay,{container:!0,spacing:2,children:M.map((e,l)=>{var t,a;const s="Filter ".concat(e.slot);return(0,C.jsx)(c.Ay,{item:!0,xs:12,md:6,children:(0,C.jsxs)(d.A,{sx:{display:"flex",gap:2,alignItems:"center",p:1,borderRadius:1,background:"#fff",boxShadow:"0 0 0 1px rgba(0,0,0,0.03) inset"},children:[(0,C.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,C.jsx)("input",{type:"checkbox",checked:e.enabled,onChange:()=>(e=>{B(l=>{const t=[...l],a=!t[e].enabled;return t[e]=(0,n.A)((0,n.A)({},t[e]),{},{enabled:a,tableId:a&&e>0?t[0].tableId:t[e].tableId,columnName:null}),t})})(l)}),(0,C.jsx)("strong",{children:s})]}),e.enabled&&(0,C.jsxs)(d.A,{sx:{display:"flex",gap:1,alignItems:"center",flex:1},children:[(0,C.jsxs)("select",{className:"cus-inpt",value:null!==(t=e.tableId)&&void 0!==t?t:"",onChange:e=>{const t=e.target.value||null;var a;0===l?(a=t,B(e=>{const l=[...e];l[0]=(0,n.A)((0,n.A)({},l[0]),{},{tableId:a,columnName:null});for(let t=1;t<l.length;t++)l[t].enabled&&(l[t]=(0,n.A)((0,n.A)({},l[t]),{},{tableId:a,columnName:null}));return l})):B(e=>{const a=[...e];return a[l]=(0,n.A)((0,n.A)({},a[l]),{},{tableId:t,columnName:null}),a})},disabled:l>0&&M[0].tableId,children:[(0,C.jsx)("option",{value:"",children:"Select table"}),k.map((e,l)=>(0,C.jsx)("option",{value:e.Table_Id,children:e.AliasName||e.Table_Name},l))]}),(0,C.jsxs)("select",{className:"cus-inpt",value:null!==(a=e.columnName)&&void 0!==a?a:"",disabled:!e.tableId,onChange:t=>{const a=t.target.value||null;a&&P(e.tableId,a,l)?g.oR.error("Column already assigned to another filter slot. Choose a different column."):B(e=>{const t=[...e];return t[l]=(0,n.A)((0,n.A)({},t[l]),{},{columnName:a}),t})},children:[(0,C.jsx)("option",{value:"",children:"Select column"}),e.tableId&&z(e.tableId).map((t,n)=>{const a=P(e.tableId,t.Column_Name,l),s=e.columnName===t.Column_Name,o=s||!a;return(0,C.jsxs)("option",{value:t.Column_Name,disabled:!o,style:{color:o?"inherit":"#999",backgroundColor:o?"inherit":"#f5f5f5",fontStyle:o?"normal":"italic"},children:[t.Column_Name,t.Column_Data_Type?" (".concat(t.Column_Data_Type,")"):"",o||s?"":" - Already used in another filter"]},n)})]})]})]})},e.type)})})]}),(0,C.jsxs)(d.A,{className:"mt-3 d-flex align-items-center",sx:{gap:2},children:[(0,C.jsx)(i.A,{fontWeight:700,children:"List Type:"}),(0,C.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:6},children:[(0,C.jsx)("input",{type:"checkbox",checked:F.includes(1),onChange:e=>{e.target.checked?E(e=>[...e,1]):E(e=>e.filter(e=>1!==e))}}),(0,C.jsx)("span",{children:"Sum"})]}),(0,C.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:6},children:[(0,C.jsx)("input",{type:"checkbox",checked:F.includes(2),onChange:e=>{e.target.checked?E(e=>[...e,2]):E(e=>e.filter(e=>2!==e))}}),(0,C.jsx)("span",{children:"Avg"})]})]}),(0,C.jsxs)(d.A,{className:"mt-4 d-flex justify-content-end",sx:{gap:2},children:[(0,C.jsx)(o.A,{variant:"outlined",onClick:()=>{B([{slot:1,enabled:!1,tableId:null,columnName:null,type:1},{slot:2,enabled:!1,tableId:null,columnName:null,type:2},{slot:3,enabled:!1,tableId:null,columnName:null,type:3}]),E([])},children:"Reset"}),(0,C.jsx)(u.A,{title:W?"":"Assign at least one slot to Preview",children:(0,C.jsx)("span",{children:(0,C.jsx)(o.A,{variant:"outlined",startIcon:(0,C.jsx)(A.A,{}),disabled:!W,onClick:()=>L(!0),children:"Preview"})})}),(0,C.jsx)(o.A,{variant:"contained",startIcon:(0,C.jsx)(f.A,{}),onClick:U,children:"Submit"})]})]})]}),(0,C.jsxs)(m.A,{open:D,onClose:()=>L(!1),fullWidth:!0,maxWidth:"md",children:[(0,C.jsx)(p.A,{children:"Preview - Template Configuration"}),(0,C.jsxs)(h.A,{dividers:!0,children:[(0,C.jsxs)(i.A,{variant:"subtitle1",fontWeight:700,gutterBottom:!0,children:["Report: ",T.reportName||"\u2014"]}),(0,C.jsxs)(d.A,{sx:{mb:2},children:[0===M.filter(e=>e.enabled&&e.tableId&&e.columnName).length&&(0,C.jsx)(i.A,{children:"No filter assigned yet."}),M.filter(e=>e.enabled&&e.tableId&&e.columnName).map((e,l)=>{const t=k.find(l=>String(l.Table_Id)===String(e.tableId)),n=t?t.AliasName||t.Table_Name:"Table ".concat(e.tableId),a=0===F.length?"\u2014":2===F.length?"Sum & Avg":1===F[0]?"Sum":"Avg",s="Filter ".concat(e.slot);return(0,C.jsx)(d.A,{sx:{p:1,borderRadius:1,background:"#F7F9FB",mb:1},children:(0,C.jsxs)(c.Ay,{container:!0,alignItems:"center",children:[(0,C.jsx)(c.Ay,{item:!0,xs:12,md:3,children:(0,C.jsx)("strong",{children:s})}),(0,C.jsx)(c.Ay,{item:!0,xs:12,md:4,children:n}),(0,C.jsx)(c.Ay,{item:!0,xs:12,md:3,children:e.columnName}),(0,C.jsx)(c.Ay,{item:!0,xs:12,md:2,style:{textAlign:"right"},children:a})]})},e.type)})]}),(0,C.jsx)(i.A,{variant:"caption",color:"textSecondary",children:"This preview shows the selected filters and the chosen List Type. It is a configuration review only \u2014 no data is fetched."})]}),(0,C.jsxs)(b.A,{children:[(0,C.jsx)(o.A,{onClick:()=>L(!1),startIcon:(0,C.jsx)(v.A,{}),children:"Back"}),(0,C.jsx)(o.A,{variant:"contained",onClick:()=>{L(!1),U()},children:"Submit"})]})]})]}):null}},12110:(e,l,t)=>{t.d(l,{A:()=>x});var n=t(58168),a=t(98587),s=t(65043),o=t(58387),r=t(68606),d=t(34535),i=t(6431),c=t(63336),u=t(57056),m=t(32400);function p(e){return(0,m.Ay)("MuiCard",e)}(0,u.A)("MuiCard",["root"]);var h=t(70579);const b=["className","raised"],v=(0,d.Ay)(c.A,{name:"MuiCard",slot:"Root",overridesResolver:(e,l)=>l.root})(()=>({overflow:"hidden"})),x=s.forwardRef(function(e,l){const t=(0,i.b)({props:e,name:"MuiCard"}),{className:s,raised:d=!1}=t,c=(0,a.A)(t,b),u=(0,n.A)({},t,{raised:d}),m=(e=>{const{classes:l}=e;return(0,r.A)({root:["root"]},p,l)})(u);return(0,h.jsx)(v,(0,n.A)({className:(0,o.A)(m.root,s),elevation:d?8:void 0,ref:l,ownerState:u},c))})},26494:(e,l,t)=>{t.d(l,{A:()=>v});var n=t(58168),a=t(98587),s=t(65043),o=t(58387),r=t(68606),d=t(34535),i=t(6431),c=t(57056),u=t(32400);function m(e){return(0,u.Ay)("MuiCardContent",e)}(0,c.A)("MuiCardContent",["root"]);var p=t(70579);const h=["className","component"],b=(0,d.Ay)("div",{name:"MuiCardContent",slot:"Root",overridesResolver:(e,l)=>l.root})(()=>({padding:16,"&:last-child":{paddingBottom:24}})),v=s.forwardRef(function(e,l){const t=(0,i.b)({props:e,name:"MuiCardContent"}),{className:s,component:d="div"}=t,c=(0,a.A)(t,h),u=(0,n.A)({},t,{component:d}),v=(e=>{const{classes:l}=e;return(0,r.A)({root:["root"]},m,l)})(u);return(0,p.jsx)(b,(0,n.A)({as:d,className:(0,o.A)(v.root,s),ownerState:u,ref:l},c))})},37141:(e,l,t)=>{t.d(l,{A:()=>s});var n=t(59662),a=t(70579);const s=(0,n.A)((0,a.jsx)("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}),"Save")},38463:(e,l,t)=>{t.d(l,{A:()=>s});var n=t(59662),a=t(70579);const s=(0,n.A)((0,a.jsx)("path",{d:"M17.77 3.77 16 2 6 12l10 10 1.77-1.77L9.54 12z"}),"ArrowBackIosNewOutlined")},55434:(e,l,t)=>{t.d(l,{A:()=>s});var n=t(59662),a=t(70579);const s=(0,n.A)((0,a.jsx)("path",{d:"M12 6.5c3.79 0 7.17 2.13 8.82 5.5-1.65 3.37-5.02 5.5-8.82 5.5S4.83 15.37 3.18 12C4.83 8.63 8.21 6.5 12 6.5m0-2C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5m0 5c1.38 0 2.5 1.12 2.5 2.5s-1.12 2.5-2.5 2.5-2.5-1.12-2.5-2.5 1.12-2.5 2.5-2.5m0-2c-2.48 0-4.5 2.02-4.5 4.5s2.02 4.5 4.5 4.5 4.5-2.02 4.5-4.5-2.02-4.5-4.5-4.5"}),"RemoveRedEyeOutlined")},65829:(e,l,t)=>{t.d(l,{A:()=>s});var n=t(59662),a=t(70579);const s=(0,n.A)((0,a.jsx)("path",{d:"M15.41 16.59 10.83 12l4.58-4.59L14 6l-6 6 6 6z"}),"KeyboardArrowLeft")},81e3:(e,l,t)=>{t.d(l,{A:()=>i});var n=t(84402),a=t(25430),s=t(37344),o=t(13375);const r=(0,t(57056).A)("MuiBox",["root"]),d=(0,s.A)(),i=(0,n.A)({themeId:o.A,defaultTheme:d,defaultClassName:r.root,generateClassName:a.A.generate})},84402:(e,l,t)=>{t.d(l,{A:()=>p});var n=t(58168),a=t(98587),s=t(65043),o=t(58387),r=t(13174),d=t(58812),i=t(18698),c=t(45527),u=t(70579);const m=["className","component"];function p(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{themeId:l,defaultTheme:t,defaultClassName:p="MuiBox-root",generateClassName:h}=e,b=(0,r.default)("div",{shouldForwardProp:e=>"theme"!==e&&"sx"!==e&&"as"!==e})(d.A);return s.forwardRef(function(e,s){const r=(0,c.A)(t),d=(0,i.A)(e),{className:v,component:x="div"}=d,A=(0,a.A)(d,m);return(0,u.jsx)(b,(0,n.A)({as:x,ref:s,className:(0,o.A)(v,h?h(p):p),theme:l&&r[l]||r},A))})}}}]);
//# sourceMappingURL=1614.b936b8a8.chunk.js.map