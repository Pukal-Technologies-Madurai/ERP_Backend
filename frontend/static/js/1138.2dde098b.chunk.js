"use strict";(self.webpackChunkerp=self.webpackChunkerp||[]).push([[1138],{1138:(e,s,t)=>{t.r(s),t.d(s,{default:()=>ae});var a=t(89379),r=t(65043),l=(t(20491),t(43845)),o=t(85865),n=t(81e3),i=t(79650),d=t(63336),c=t(71806),h=t(84882),x=t(28076),p=t(39652),u=t(73460),m=t(10611),_=t(81637),j=t(77739),g=t(17392),S=t(30279),A=t(12110),y=t(26494),v=t(67784),k=t(51787),T=t(83462),f=t(26600),b=t(35316),I=t(29347),E=t(11906),N=t(31159),w=t(20273),D=t(84593),C=t(98606),z=t(56530),P=t(41081),R=t(79484),W=t(47968),L=t(47805),F=t(58293),O=t(75155),M=t(73216),G=t(45777),q=t(65074),H=t(91036),U=t(13448),B=t(28503),V=t(89384),J=t(12412),Z=t(51962),K=t(20656),Q=t(63406),X=t(34109),Y=t(26581),$=t(70579);const ee=(0,$.jsx)(X.A,{fontSize:"small"}),se=(0,$.jsx)(Y.A,{fontSize:"small"}),te=e=>{let{open:s,onClose:t,isEdit:l=!1,initialData:o=null,scheduleId:n,projectId:i,dependencyTasks:d=[],tasks:c=[],taskType:h=[],workStatus:x=[],onSuccess:p}=e;const[u,m]=(0,r.useState)({Sch_Project_Id:i,Sch_Id:n,Task_Levl_Id:"",Task_Id:"",Type_Task_Id:1,Task_Sch_Duaration:"01:00",Task_Start_Time:"10:00",Task_End_Time:"11:00",Task_Est_Start_Date:(new Date).toISOString().split("T")[0],Task_Est_End_Date:(new Date).toISOString().split("T")[0],Task_Sch_Status:1,Levl_Id:2,Task_Depend_Level_Id:"",TasksGet:"- Select Task -"}),[_,j]=(0,r.useState)([]),[g,S]=(0,r.useState)(!1);(0,r.useEffect)(()=>{s&&(l&&o?(m(o),j(o.dependencyTasks||[])):(m(e=>(0,a.A)((0,a.A)({},e),{},{Sch_Project_Id:i,Sch_Id:n,Levl_Id:2})),j([])))},[s,l,o,i,n]),(0,r.useEffect)(()=>{const[e,s]=null===u||void 0===u?void 0:u.Task_Start_Time.split(":").map(Number),[t,r]=null===u||void 0===u?void 0:u.Task_End_Time.split(":").map(Number),l=new Date(0,0,0,e,s),o=new Date(0,0,0,t,r);if(o>l){let e=Math.abs(o-l);const s=Math.floor(e/36e5);e%=36e5;const t=Math.floor(e/6e4),r=String(s).padStart(2,"0"),n=String(t).padStart(2,"0");m(e=>(0,a.A)((0,a.A)({},e),{},{Task_Sch_Duaration:"".concat(r,":").concat(n)}))}},[null===u||void 0===u?void 0:u.Task_Start_Time,null===u||void 0===u?void 0:u.Task_End_Time]),(0,r.useEffect)(()=>{if(_.length>0){const e=_.map(e=>null===e||void 0===e?void 0:e.Task_Levl_Id).join(",");m(s=>(0,a.A)((0,a.A)({},s),{},{Task_Depend_Level_Id:e}))}else m(e=>(0,a.A)((0,a.A)({},e),{},{Task_Depend_Level_Id:""}))},[_]);const A=()=>{m({Sch_Project_Id:i,Sch_Id:n,Task_Levl_Id:"",Task_Id:"",Type_Task_Id:1,Task_Sch_Duaration:"01:00",Task_Start_Time:"10:00",Task_End_Time:"11:00",Task_Est_Start_Date:(new Date).toISOString().split("T")[0],Task_Est_End_Date:(new Date).toISOString().split("T")[0],Task_Sch_Status:1,Levl_Id:2,Task_Depend_Level_Id:"",TasksGet:"- Select Task -"}),j([]),t()};return(0,$.jsxs)(T.A,{open:s,onClose:A,maxWidth:"sm",fullWidth:!0,children:[(0,$.jsx)(f.A,{children:l?"Edit Sub Task":"Assign Sub Task"}),(0,$.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),S(!0),!u.Task_Id)return H.oR.warn("Select Task"),void S(!1);if(""===u.Task_Depend_Level_Id)return H.oR.warn("Select Dependency Tasks"),void S(!1);try{const e=await(0,q.z)({address:"taskManagement/project/schedule/scheduleTask",method:l?"PUT":"POST",headers:{"Content-Type":"application/json"},bodyData:u});e.success?(H.oR.success(e.message),p(),A()):H.oR.error(e.message)}catch(s){console.error(s),H.oR.error("An error occurred while saving the task")}finally{S(!1)}},children:[(0,$.jsxs)(b.A,{children:[(0,$.jsx)("table",{className:"table",children:(0,$.jsxs)("tbody",{children:[(0,$.jsxs)("tr",{children:[(0,$.jsx)("td",{className:"border-bottom-0 fa-15",style:{verticalAlign:"middle"},children:"Task"}),(0,$.jsx)("td",{className:"border-bottom-0 fa-15",children:(0,$.jsx)(K.Ay,{value:{value:null===u||void 0===u?void 0:u.Task_Id,label:null===u||void 0===u?void 0:u.TasksGet},onChange:e=>m((0,a.A)((0,a.A)({},u),{},{Task_Id:e.value,TasksGet:e.label})),options:[...c.map(e=>({value:e.Task_Id,label:e.Task_Name}))],styles:Q.MR,isSearchable:!0,required:!0,placeholder:"Select Task"})})]}),(0,$.jsxs)("tr",{children:[(0,$.jsx)("td",{className:"border-bottom-0 fa-15",style:{verticalAlign:"middle"},children:"Task Type"}),(0,$.jsx)("td",{className:"border-bottom-0 fa-15",children:(0,$.jsx)("select",{className:"cus-inpt",value:null===u||void 0===u?void 0:u.Type_Task_Id,required:!0,onChange:e=>m((0,a.A)((0,a.A)({},u),{},{Type_Task_Id:e.target.value})),children:h.map((e,s)=>(0,$.jsx)("option",{value:null===e||void 0===e?void 0:e.Task_Type_Id,children:null===e||void 0===e?void 0:e.Task_Type},s))})})]}),(0,$.jsxs)("tr",{children:[(0,$.jsx)("td",{className:"border-bottom-0 fa-15",style:{verticalAlign:"middle"},children:"Start Date"}),(0,$.jsx)("td",{className:"border-bottom-0 fa-15",children:(0,$.jsx)("input",{type:"date",className:"cus-inpt",required:!0,value:(null===u||void 0===u?void 0:u.Task_Est_Start_Date)&&new Date(null===u||void 0===u?void 0:u.Task_Est_Start_Date).toISOString().split("T")[0],onChange:e=>m((0,a.A)((0,a.A)({},u),{},{Task_Est_Start_Date:e.target.value}))})})]}),(0,$.jsxs)("tr",{children:[(0,$.jsx)("td",{className:"border-bottom-0 fa-15",style:{verticalAlign:"middle"},children:"End Date"}),(0,$.jsx)("td",{className:"border-bottom-0 fa-15",children:(0,$.jsx)("input",{type:"date",className:"cus-inpt",required:!0,min:null===u||void 0===u?void 0:u.Task_Est_Start_Date,value:(null===u||void 0===u?void 0:u.Task_Est_End_Date)&&new Date(null===u||void 0===u?void 0:u.Task_Est_End_Date).toISOString().split("T")[0],onChange:e=>m((0,a.A)((0,a.A)({},u),{},{Task_Est_End_Date:e.target.value}))})})]}),(0,$.jsxs)("tr",{children:[(0,$.jsx)("td",{className:"border-bottom-0 fa-15",style:{verticalAlign:"middle"},children:"Start Time"}),(0,$.jsx)("td",{className:"border-bottom-0 fa-15",children:(0,$.jsx)("input",{type:"time",className:"cus-inpt",value:null===u||void 0===u?void 0:u.Task_Start_Time,required:!0,onChange:e=>m((0,a.A)((0,a.A)({},u),{},{Task_Start_Time:e.target.value}))})})]}),(0,$.jsxs)("tr",{children:[(0,$.jsx)("td",{className:"border-bottom-0 fa-15",style:{verticalAlign:"middle"},children:"End Time"}),(0,$.jsx)("td",{className:"border-bottom-0 fa-15",children:(0,$.jsx)("input",{type:"time",className:"cus-inpt",required:!0,min:null===u||void 0===u?void 0:u.Task_Start_Time,value:null===u||void 0===u?void 0:u.Task_End_Time,onChange:e=>m((0,a.A)((0,a.A)({},u),{},{Task_End_Time:e.target.value}))})})]}),l&&(0,$.jsxs)("tr",{children:[(0,$.jsx)("td",{className:"border-bottom-0 fa-15",style:{verticalAlign:"middle"},children:"Status"}),(0,$.jsx)("td",{className:"border-bottom-0 fa-15",children:(0,$.jsx)("select",{className:"cus-inpt",value:u.Task_Sch_Status,required:!0,onChange:e=>m((0,a.A)((0,a.A)({},u),{},{Task_Sch_Status:e.target.value})),children:x.map((e,s)=>(0,$.jsx)("option",{value:null===e||void 0===e?void 0:e.Status_Id,children:null===e||void 0===e?void 0:e.Status},s))})})]})]})}),(0,$.jsx)("label",{className:"mb-2",children:"Select Dependency Tasks"}),(0,$.jsx)(J.A,{multiple:!0,id:"level2-dependency-tasks",options:d,disableCloseOnSelect:!0,getOptionLabel:e=>null===e||void 0===e?void 0:e.TaskNameGet,value:_,onChange:(e,s)=>j(s),renderOption:(e,s,t)=>{let{selected:r}=t;return(0,$.jsxs)("li",(0,a.A)((0,a.A)({},e),{},{children:[(0,$.jsx)(Z.A,{icon:ee,checkedIcon:se,style:{marginRight:8},checked:r}),null===s||void 0===s?void 0:s.TaskNameGet]}))},style:{width:"100%"},isOptionEqualToValue:(e,s)=>Number(null===e||void 0===e?void 0:e.Task_Levl_Id)===Number(null===s||void 0===s?void 0:s.Task_Levl_Id),renderInput:e=>(0,$.jsx)(v.A,(0,a.A)((0,a.A)({},e),{},{label:"Dependency Tasks",placeholder:"Select tasks this task depends on",required:!0}))})]}),(0,$.jsxs)(I.A,{children:[(0,$.jsx)(E.A,{type:"button",onClick:A,disabled:g,children:"Cancel"}),(0,$.jsx)(E.A,{type:"submit",disabled:g,children:g?"Saving...":l?"Update Task":"Assign Task"})]})]})]})},ae=e=>{let{onReload:s}=e;const t=localStorage.getItem("user"),J=JSON.parse(t||"{}"),[Z,K]=(0,r.useState)([]),[Q,X]=(0,r.useState)([]),[Y,ee]=(0,r.useState)(""),[se,ae]=(0,r.useState)(new Set),[re,le]=(0,r.useState)({}),[oe,ne]=(0,r.useState)({}),[ie,de]=(0,r.useState)(0),[ce,he]=(0,r.useState)(10),[xe,pe]=(0,r.useState)(!1),{contextObj:ue}=(0,r.useContext)(G.i),[me,_e]=(0,r.useState)([]),[je,ge]=(0,r.useState)([]),[Se,Ae]=(0,r.useState)(!1),[ye,ve]=(0,r.useState)(!1),[ke,Te]=(0,r.useState)([]),fe=JSON.parse(localStorage.getItem("user")||"{}"),[be,Ie]=(0,r.useState)(null),Ee=null===fe||void 0===fe?void 0:fe.UserId,[Ne,we]=((0,M.Zp)(),(0,r.useState)("")),[De,Ce]=(0,r.useState)(!1),[ze,Pe]=(0,r.useState)(!1),[Re,We]=(0,r.useState)(null),Le=null===fe||void 0===fe?void 0:fe.Company_id,[Fe,Oe]=(0,r.useState)(!1),[Me,Ge]=(0,r.useState)(!1),[qe,He]=(0,r.useState)(!1),[Ue,Be]=(0,r.useState)(null),[Ve,Je]=(0,r.useState)(!1),[Ze,Ke]=(0,r.useState)(!1),[Qe,Xe]=(0,r.useState)(null),[Ye,$e]=(0,r.useState)(!1),[es,ss]=(0,r.useState)({Sch_Type_Id:"",Sch_Type:"",Task_Id:"",Task_Est_Start_Date:"",Task_Est_End_Date:""}),[ts,as]=(0,r.useState)(!1),[rs,ls]=(0,r.useState)({open:!1,isEdit:!1,initialData:null,scheduleId:"",dependencyTasks:[]});(0,r.useEffect)(()=>{ns()},[]),(0,r.useEffect)(()=>{ds()},[Z,Y]);const os=()=>{Ce(e=>!e),Pe(e=>!e)},ns=()=>{(0,q.z)({address:"taskManagement/project/AbstractNew?Company_id=".concat(null===J||void 0===J?void 0:J.Company_id)}).then(e=>{if(e.success){const s=e.data.map(e=>(0,a.A)((0,a.A)({},e),{},{progress:is(e)}));K(s)}}).catch(e=>{console.error("Error fetching projects:",e),H.oR.error("Failed to load projects")})},is=e=>{const s=Number(e.TasksScheduled)||0,t=Number(e.CompletedTasks)||0;return 0===s?0:Math.round(t/s*100)},ds=()=>{if(!Y.trim())return void X(Z);const e=Z.filter(e=>{var s,t;return(null===(s=e.Project_Name)||void 0===s?void 0:s.toLowerCase().includes(Y.toLowerCase()))||(null===(t=e.Project_Code)||void 0===t?void 0:t.toLowerCase().includes(Y.toLowerCase()))});X(e)},cs=async e=>{ne(s=>(0,a.A)((0,a.A)({},s),{},{[e]:!0}));try{const s=await(0,q.z)({address:"taskManagement/project/schedule/ListingDetailsAbstract?Project_Id=".concat(e)});s.success&&s.data?le(t=>(0,a.A)((0,a.A)({},t),{},{[e]:s.data})):le(s=>(0,a.A)((0,a.A)({},s),{},{[e]:[]}))}catch(s){console.error("Error fetching schedules:",s),le(s=>(0,a.A)((0,a.A)({},s),{},{[e]:[]})),H.oR.error("Failed to load project schedules")}finally{ne(s=>(0,a.A)((0,a.A)({},s),{},{[e]:!1}))}},hs=e=>{const s=je.find(s=>s.Sch_Type_Id===parseInt(e.target.value));s&&ss((0,a.A)((0,a.A)({},es),{},{Sch_Type_Id:s.Sch_Type_Id,Sch_Type:s.Sch_Type}))},xs=e=>{if(!e)return"N/A";try{return new Date(e).toLocaleDateString("en-IN",{day:"2-digit",month:"2-digit",year:"numeric"})}catch(s){return"Invalid Date"}},ps=e=>{const s={1:{label:"New",color:"primary",icon:(0,$.jsx)(w.A,{})},2:{label:"In Progress",color:"warning",icon:(0,$.jsx)(D.A,{})},3:{label:"Completed",color:"success",icon:(0,$.jsx)(C.A,{})},4:{label:"Canceled",color:"error",icon:(0,$.jsx)(w.A,{})}}[Number(e)]||{label:"Unknown",color:"default",icon:(0,$.jsx)(w.A,{})};return(0,$.jsx)(l.A,{label:s.label,color:s.color,size:"small",icon:s.icon,variant:"outlined"})},us=e=>{let s;if("number"===typeof e)s=e;else if("string"===typeof e){s={completed:3,"in progress":2,new:1,"not started":1,canceled:4,"not assigned":1}[e.toLowerCase()]||1}else s=1;const t={1:{label:"New",color:"primary",icon:(0,$.jsx)(w.A,{})},2:{label:"In Progress",color:"warning",icon:(0,$.jsx)(D.A,{})},3:{label:"Completed",color:"success",icon:(0,$.jsx)(C.A,{})},4:{label:"Canceled",color:"error",icon:(0,$.jsx)(w.A,{})}},a=t[Number(s)]||t[1];return(0,$.jsx)(l.A,{label:a.label,color:a.color,size:"small",icon:a.icon})},ms=e=>e>=80?"success":e>=50?"warning":"primary",_s=(e,s)=>{if(!e||!s)return 0;try{const t=new Date(e),a=new Date(s),r=(a-t)/864e5;return Math.max(1,Math.ceil(r))}catch(t){return 0}},js=(0,r.useCallback)(async()=>{try{const e=await(0,q.z)({address:"taskManagement/project/schedule/newscheduleType"});e.success?ge(e.data):H.oR.error(e.message||"Failed to load schedule types")}catch(e){console.error("Error fetching schedule types:",e),H.oR.error("Error loading schedule types")}},[]),gs=(0,r.useCallback)(async()=>{try{_e([])}catch(e){console.error("Error fetching tasks:",e),H.oR.error("Error loading tasks")}},[Le]),Ss=(0,r.useCallback)(async()=>{if(Ne)try{const e=await(0,q.z)({address:"taskManagement/project/schedule/ListingDetails?Project_Id=".concat(Ne)});e.success?_e(e.data):(console.error("Failed to fetch task details:",e.message),H.oR.error("Failed to load task details"))}catch(e){console.error("Error fetching task details:",e),H.oR.error("Error loading task details")}},[Ne]),As=(0,r.useCallback)(async()=>{try{await Promise.all([js(),gs(),Ss()])}catch(e){console.error("Error fetching all data:",e)}},[js,gs,Ss]);(0,r.useEffect)(()=>{Ne&&As()},[Ne,As]),(0,r.useEffect)(()=>{js(),gs()},[js,gs]);const ys=async e=>{e.Project_Id?we(e.Project_Id):e.Sch_Project_Id&&we(e.Sch_Project_Id),Ie(e),$e(!0)};(0,r.useEffect)(()=>{s&&As()},[s,As]);const vs=e=>{let{schedule:s}=e;if(!s.SchTypes)return(0,$.jsx)(o.A,{variant:"body2",color:"textSecondary",children:"No schedule data available"});try{const e=s.SchTypes;let t=0,r=0;const S=[];e.forEach(e=>{Array.isArray(e.TaskTypeGroups)&&e.TaskTypeGroups.forEach(s=>{Array.isArray(s.Tasks)&&s.Tasks.forEach(l=>{var o;t++;const n=l.AssignedEmployees||[],i=n.length,d=((null===s||void 0===s||null===(o=s.CompletedTaskDetails)||void 0===o?void 0:o.filter(e=>e.Task_Id===l.Task_Id&&e.Task_Levl_Id===l.Task_Levl_Id))||[]).length,c=i>0?Math.round(d/i*100):0;100===c&&r++,S.push((0,a.A)((0,a.A)({},l),{},{Schedule_Type:e.SchType,Task_Group:s.Task_Type,Individual_Progress:c,Actual_Status:100===c?3:c>0?2:1,TaskTypeGroup:s,assignedEmployees:n,completedEmployees:d,totalAssigned:i}))})})});t>0&&Math.round(r/t*100);return(0,$.jsxs)("div",{children:[(0,$.jsxs)(n.A,{sx:{mb:3,p:2,backgroundColor:"#f8f9fa",borderRadius:"8px"},children:[(0,$.jsx)(o.A,{variant:"h6",gutterBottom:!0}),(0,$.jsxs)(n.A,{sx:{display:"flex",justifyContent:"space-between",mt:1},children:[(0,$.jsxs)(o.A,{variant:"body2",color:"textSecondary",children:["Total Tasks: ",t]}),(0,$.jsxs)(o.A,{variant:"body2",color:"textSecondary",children:["Completed: ",r]}),(0,$.jsxs)(o.A,{variant:"body2",color:"textSecondary",children:["Pending: ",t-r]})]})]}),(0,$.jsx)(i.A,{component:d.A,variant:"outlined",children:(0,$.jsxs)(c.A,{size:"small",children:[(0,$.jsx)(h.A,{children:(0,$.jsxs)(x.A,{sx:{backgroundColor:"#2C3E50"},children:[(0,$.jsx)(p.A,{sx:{color:"white",fontWeight:"bold",fontSize:"12px"},children:"Task Group"}),(0,$.jsx)(p.A,{sx:{color:"white",fontWeight:"bold",fontSize:"12px"},children:"Task Type"}),(0,$.jsx)(p.A,{sx:{color:"white",fontWeight:"bold",fontSize:"12px"},children:"Task Name"}),(0,$.jsx)(p.A,{sx:{color:"white",fontWeight:"bold",fontSize:"12px"},children:"Progress"}),(0,$.jsx)(p.A,{sx:{color:"white",fontWeight:"bold",fontSize:"12px"},children:"Status"}),(0,$.jsx)(p.A,{sx:{color:"white",fontWeight:"bold",fontSize:"12px"},children:"Employees"}),(0,$.jsx)(p.A,{sx:{color:"white",fontWeight:"bold",fontSize:"12px"},children:"Start Date"}),(0,$.jsx)(p.A,{sx:{color:"white",fontWeight:"bold",fontSize:"12px"},children:"End Date"}),(0,$.jsx)(p.A,{sx:{color:"white",fontWeight:"bold",fontSize:"12px"},children:"Actions"})]})}),(0,$.jsx)(u.A,{children:S.length>0?S.map((e,s)=>{const t=0===e.totalAssigned?"Not Assigned":0===e.Individual_Progress?"Not Started":100===e.Individual_Progress?"Completed":"In Progress";return(0,$.jsxs)(x.A,{sx:{backgroundColor:s%2===0?"#f8f9fa":"white","&:hover":{backgroundColor:"#e3f2fd"}},children:[(0,$.jsx)(p.A,{sx:{fontSize:"11px"},children:(0,$.jsxs)(n.A,{children:[(0,$.jsx)(o.A,{variant:"body2",style:{fontSize:"0.75rem",fontWeight:"bold"},children:e.Task_Group||"N/A"}),(0,$.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",mt:.5},children:[(0,$.jsx)(m.A,{variant:"determinate",value:e.Individual_Progress,color:ms(e.Individual_Progress),sx:{height:4,width:60,borderRadius:2,mr:1}}),(0,$.jsxs)(o.A,{variant:"caption",style:{fontSize:"0.7rem"},children:[e.completedEmployees,"/",e.totalAssigned," (",e.Individual_Progress,"%)"]})]})]})}),(0,$.jsx)(p.A,{sx:{fontSize:"11px"},children:(0,$.jsx)(o.A,{variant:"body2",style:{fontSize:"0.75rem"},children:e.Schedule_Type||"N/A"})}),(0,$.jsx)(p.A,{sx:{fontSize:"11px"},children:(0,$.jsxs)(n.A,{children:[(0,$.jsx)(o.A,{variant:"body2",style:{fontSize:"0.75rem",fontWeight:"bold"},children:e.Task_Name||"N/A"}),e.Task_Desc&&(0,$.jsx)(o.A,{variant:"caption",color:"textSecondary",style:{fontSize:"0.7rem"},children:e.Task_Desc})]})}),(0,$.jsx)(p.A,{sx:{fontSize:"11px"},children:(0,$.jsxs)(n.A,{sx:{display:"flex",alignItems:"center"},children:[(0,$.jsx)(_.A,{variant:"determinate",value:e.Individual_Progress,size:30,color:ms(e.Individual_Progress)}),(0,$.jsxs)(n.A,{sx:{ml:1},children:[(0,$.jsxs)(o.A,{variant:"caption",display:"block",style:{fontSize:"0.7rem"},children:[e.completedEmployees,"/",e.totalAssigned," (",e.Individual_Progress,"%)"]}),(0,$.jsx)(o.A,{variant:"caption",color:"textSecondary",display:"block",style:{fontSize:"0.6rem"},children:t})]})]})}),(0,$.jsx)(p.A,{sx:{fontSize:"11px"},children:us(t)}),(0,$.jsx)(p.A,{sx:{fontSize:"11px"},children:(0,$.jsx)(n.A,{sx:{display:"flex",alignItems:"flex-start",gap:1},children:(0,$.jsx)(n.A,{sx:{flex:1},children:e.assignedEmployees.length>0?(0,$.jsxs)(n.A,{children:[(0,$.jsx)(n.A,{sx:{mb:1},children:(0,$.jsx)(o.A,{variant:"caption",display:"flex",style:{fontSize:"0.6rem"},children:(0,$.jsx)(j.A,{title:e.assignedEmployees.length>0?"Assign More Employees":"Assign Employees",children:(0,$.jsx)(g.A,{size:"small",onClick:()=>ys(e),sx:{padding:"4px",backgroundColor:e.assignedEmployees.length>0?"#e3f2fd":"#f5f5f5","&:hover":{backgroundColor:e.assignedEmployees.length>0?"#bbdefb":"#e8e8e8"},minWidth:"24px",minHeight:"24px"},children:(0,$.jsx)(z.A,{fontSize:"small"})})})})}),(0,$.jsx)(n.A,{sx:{display:"flex",flexWrap:"wrap",gap:.3,maxWidth:180},children:e.assignedEmployees.map((s,t)=>{var a,r;const o=null===(a=e.TaskTypeGroup)||void 0===a||null===(r=a.CompletedTaskDetails)||void 0===r?void 0:r.some(e=>e.Emp_Id===s.Id);return(0,$.jsx)(l.A,{label:s.Name,variant:o?"filled":"outlined",color:o?"success":"default",size:"small",sx:{fontSize:"0.55rem",height:"18px",mb:.3}},t)})})]}):(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)(j.A,{title:e.assignedEmployees.length>0?"Assign More Employees":"Assign Employees",children:(0,$.jsx)(g.A,{size:"small",onClick:()=>ys(e),sx:{padding:"4px",backgroundColor:e.assignedEmployees.length>0?"#e3f2fd":"#f5f5f5","&:hover":{backgroundColor:e.assignedEmployees.length>0?"#bbdefb":"#e8e8e8"},minWidth:"24px",minHeight:"24px"},children:(0,$.jsx)(z.A,{fontSize:"small"})})}),(0,$.jsx)(o.A,{variant:"caption",color:"textSecondary",style:{fontSize:"0.7rem"},children:"No Employees Assigned"})]})})})}),(0,$.jsx)(p.A,{sx:{fontSize:"11px"},children:(0,$.jsx)(o.A,{variant:"body2",style:{fontSize:"0.75rem"},children:xs(e.Task_Est_Start_Date)})}),(0,$.jsx)(p.A,{sx:{fontSize:"11px"},children:(0,$.jsx)(o.A,{variant:"body2",style:{fontSize:"0.75rem"},children:xs(e.Task_Est_End_Date)})}),(0,$.jsx)(p.A,{sx:{fontSize:"11px"},children:(0,$.jsx)(n.A,{sx:{display:"flex",gap:.5},children:(0,$.jsx)(j.A,{title:"View Details",children:(0,$.jsx)(g.A,{size:"small",onClick:()=>console.log("View task details:",e),sx:{padding:"4px"},children:(0,$.jsx)(P.A,{fontSize:"small"})})})})})]},e.A_Id||s)}):(0,$.jsx)(x.A,{children:(0,$.jsx)(p.A,{colSpan:9,align:"center",sx:{py:3},children:(0,$.jsx)(o.A,{variant:"body2",color:"textSecondary",children:"No tasks found for this schedule"})})})})]})})]})}catch(t){return console.error("Error parsing schedule data:",t),(0,$.jsx)(o.A,{variant:"body2",color:"error",children:"Error loading schedule data"})}},ks=e=>{let{row:s}=e;const t=se.has(s.Project_Id),a=re[s.Project_Id]||[],r=oe[s.Project_Id];return(0,$.jsx)(x.A,{children:(0,$.jsx)(p.A,{colSpan:6,style:{padding:0},children:(0,$.jsx)(S.A,{in:t,timeout:"auto",unmountOnExit:!0,children:(0,$.jsx)("div",{className:"p-3 border-top bg-light",style:{backgroundColor:"#f8f9fa"},children:r?(0,$.jsxs)("div",{className:"text-center py-4",children:[(0,$.jsx)(_.A,{size:24}),(0,$.jsx)(o.A,{variant:"body2",color:"textSecondary",className:"mt-2",children:"Loading tasks..."})]}):a.length>0?(0,$.jsx)("div",{className:"space-y-4",children:a.map((e,s)=>(0,$.jsx)(A.A,{variant:"outlined",children:(0,$.jsx)(y.A,{children:(0,$.jsx)(vs,{schedule:e})})},e.Sch_Id||s))}):(0,$.jsx)("div",{className:"text-center py-4",children:(0,$.jsx)(o.A,{variant:"body2",color:"textSecondary",children:"No schedules found for this project"})})})})})})},Ts=ke.map(e=>({value:e.Task_Id,label:e.Task_Name})),fs=Q.slice(ie*ce,ie*ce+ce);return(0,$.jsx)(A.A,{className:"rounded-3 bg-white overflow-hidden m-3",children:(0,$.jsxs)(y.A,{className:"p-0",children:[(0,$.jsxs)("div",{className:"d-flex justify-content-between align-items-center p-3 border-bottom",children:[(0,$.jsx)(o.A,{variant:"h5",className:"fw-bold text-muted m-0",children:"Active Projects"}),(0,$.jsxs)("div",{className:"d-flex align-items-center gap-2",children:[1===Number(null===ue||void 0===ue?void 0:ue.Add_Rights)&&(0,$.jsx)("button",{onClick:()=>{We(null),Ae(!1),Ge(!0)},className:"btn btn-primary fa-13 shadow",children:"Create Project"}),(0,$.jsx)(v.A,{size:"small",placeholder:"Search projects...",value:Y,onChange:e=>ee(e.target.value),InputProps:{startAdornment:(0,$.jsx)(k.A,{position:"start",children:(0,$.jsx)(R.A,{fontSize:"small"})})},sx:{minWidth:250}}),(0,$.jsx)(j.A,{title:"Export to PDF",children:(0,$.jsx)(g.A,{size:"small",children:(0,$.jsx)(W.A,{})})}),(0,$.jsx)(j.A,{title:"Refresh Projects",children:(0,$.jsx)(g.A,{size:"small",onClick:()=>{ns(),le({}),ae(new Set)},children:(0,$.jsx)(L.A,{})})})]})]}),(0,$.jsx)(i.A,{sx:{maxHeight:600},children:(0,$.jsxs)(c.A,{stickyHeader:!0,size:"small",children:[(0,$.jsx)(h.A,{children:(0,$.jsxs)(x.A,{children:[(0,$.jsx)(p.A,{width:"25%",sx:{fontSize:"13px",backgroundColor:"#EDF0F7",fontWeight:"bold"},className:"border-end border-top",children:"Project Details"}),(0,$.jsx)(p.A,{width:"20%",sx:{fontSize:"13px",backgroundColor:"#EDF0F7",fontWeight:"bold"},className:"border-end border-top",children:"Progress"}),(0,$.jsx)(p.A,{width:"15%",sx:{fontSize:"13px",backgroundColor:"#EDF0F7",fontWeight:"bold"},className:"border-end border-top",children:"Team"}),(0,$.jsx)(p.A,{width:"20%",sx:{fontSize:"13px",backgroundColor:"#EDF0F7",fontWeight:"bold"},className:"border-end border-top",children:"Timeline"}),(0,$.jsx)(p.A,{width:"15%",sx:{fontSize:"13px",backgroundColor:"#EDF0F7",fontWeight:"bold"},className:"border-end border-top",children:"Status"})]})}),(0,$.jsx)(u.A,{children:fs.map((e,s)=>(0,$.jsxs)($.Fragment,{children:[(0,$.jsxs)(x.A,{sx:{"&:last-child td, &:last-child th":{border:0},cursor:"pointer"},children:[(0,$.jsx)(p.A,{sx:{fontSize:"12px"},className:"border-end",children:(0,$.jsxs)("div",{className:"d-flex align-items-center",children:[(0,$.jsx)(g.A,{size:"small",className:"me-2",onClick:()=>(async e=>{const s=new Set(se);s.has(e)?s.delete(e):(s.add(e),re[e]||oe[e]||await cs(e)),ae(s)})(e.Project_Id),sx:{transform:se.has(e.Project_Id)?"rotate(180deg)":"none",transition:"transform 0.2s"},children:(0,$.jsx)(F.A,{fontSize:"small"})}),(0,$.jsxs)("div",{children:[(0,$.jsx)(o.A,{variant:"subtitle1",className:"fw-bold",onClick:()=>{return s=e,void console.log("Project clicked:",s);var s},style:{cursor:"pointer",fontSize:"0.9rem",lineHeight:"1.2"},children:e.Project_Name}),(0,$.jsx)(o.A,{variant:"body2",color:"textSecondary",style:{fontSize:"0.8rem"},children:e.Project_Code||"No Code"}),(0,$.jsx)(n.A,{sx:{display:"flex",alignItems:"center",mt:.5},children:(0,$.jsxs)(o.A,{variant:"caption",color:"textSecondary",children:["Progress: ",e.progress,"%"]})})]})]})}),(0,$.jsx)(p.A,{sx:{fontSize:"12px"},className:"border-end",children:(0,$.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",minWidth:120},children:[(0,$.jsx)(n.A,{sx:{width:"100%",mr:1},children:(0,$.jsx)(m.A,{variant:"determinate",value:e.progress,color:ms(e.progress),sx:{height:8,borderRadius:4}})}),(0,$.jsx)(n.A,{sx:{minWidth:35},children:(0,$.jsxs)(o.A,{variant:"body2",color:"textSecondary",style:{fontSize:"0.8rem"},children:[e.progress,"%"]})})]})}),(0,$.jsxs)(p.A,{sx:{fontSize:"12px"},className:"border-end",children:[1===Number(null===ue||void 0===ue?void 0:ue.Add_Rights)&&(0,$.jsx)(g.A,{onClick:()=>(e=>{we(e),Oe(!0)})(e.Project_Id),children:(0,$.jsx)(O.A,{})}),e.EmployeesInvolved]}),(0,$.jsx)(p.A,{sx:{fontSize:"12px"},className:"border-end",children:(0,$.jsxs)("div",{children:[(0,$.jsxs)(o.A,{variant:"body2",style:{fontSize:"0.8rem",lineHeight:"1.2"},children:["Start: ",xs(null===e||void 0===e?void 0:e.Est_Start_Dt)]}),(0,$.jsxs)(o.A,{variant:"body2",style:{fontSize:"0.8rem",lineHeight:"1.2"},children:["End: ",xs(null===e||void 0===e?void 0:e.Est_End_Dt)]}),(0,$.jsxs)(o.A,{variant:"caption",color:"textSecondary",style:{fontSize:"0.7rem"},children:[_s(null===e||void 0===e?void 0:e.Est_Start_Dt,null===e||void 0===e?void 0:e.Est_End_Dt)," days"]})]})}),(0,$.jsx)(p.A,{sx:{fontSize:"12px"},className:"border-end",children:ps(e.Project_Status)})]},e.Project_Id),(0,$.jsx)(ks,{row:e})]}))})]})}),0===Q.length&&(0,$.jsx)("div",{className:"text-center py-5",children:(0,$.jsx)(o.A,{variant:"h6",color:"textSecondary",children:Y?"No projects match your search":"No projects found"})}),(0,$.jsx)(B.A,{open:Me,onClose:()=>{Ge(!1),He(!1),We(null),Be(null),Je(!1)},inputValue:Re,isEdit:Se,setReload:os,projectData:Ne}),(0,$.jsxs)(T.A,{open:xe,fullWidth:!0,maxWidth:"sm",PaperProps:{style:{borderRadius:"8px"}},onClose:()=>pe(!1),children:[(0,$.jsx)(f.A,{children:"Assign Task"}),(0,$.jsxs)(b.A,{children:[(0,$.jsx)("div",{style:{padding:"1px",display:"flex",marginTop:"16px"},children:(0,$.jsxs)("div",{style:{flex:1,display:"flex",alignItems:"center"},children:[(0,$.jsx)("label",{htmlFor:"task-select",style:{marginRight:"8px",minWidth:"80px"},children:"Select Task"}),(0,$.jsxs)("select",{id:"task-select",value:es.Task_Id||"",className:"cus-inpt",required:!0,onChange:async e=>{const s=e.target.value;ss(e=>(0,a.A)((0,a.A)({},e),{},{Task_Id:s}));try{const e=await(0,q.z)({address:"taskManagement/tasks/tasklistsid?Task_Id=".concat(s)});if(e.success){const s=e.data;ss(e=>(0,a.A)((0,a.A)({},e),{},{Task_Levl_Id:s.Task_Levl_Id,Task_Name:s.Task_Name,Task_Desc:s.Task_Desc,Task_Group_Id:s.Task_Group_Id,Sch_Type_Id:s.Sch_Type_Id,Task_Sch_Duaration:s.Task_Sch_Duaration||"",Task_Start_Time:s.Task_Start_Time||(new Date).toISOString(),Task_End_Time:s.Task_End_Time||(new Date).toISOString(),Task_Est_Start_Date:s.Task_Est_Start_Date||(new Date).toISOString(),Task_Est_End_Date:s.Task_Est_End_Date||(new Date).toISOString()}))}else H.oR.error("Failed to fetch task details")}catch(t){console.error("Error fetching task details:",t),H.oR.error("Error loading task details")}},style:{flex:1,marginRight:"8px",padding:"8px",borderRadius:"4px",border:"1px solid #ccc"},children:[(0,$.jsx)("option",{value:"",disabled:!0,children:"- select -"}),Ts.map((e,s)=>(0,$.jsx)("option",{value:e.value,children:e.label},s))]})]})}),(0,$.jsx)("div",{style:{padding:"1px",display:"flex",marginTop:"16px"},children:(0,$.jsxs)("div",{style:{flex:1,display:"flex",alignItems:"center"},children:[(0,$.jsx)("label",{style:{marginRight:"8px",minWidth:"80px"},children:"Sch_Type"}),(0,$.jsxs)("select",{value:es.Sch_Type_Id||"",onChange:hs,className:"cus-inpt",required:!0,style:{flex:1,padding:"8px",borderRadius:"4px",border:"1px solid #ccc"},children:[(0,$.jsx)("option",{value:"",disabled:!0,children:"- Sch_Type -"}),je.map((e,s)=>(0,$.jsx)("option",{value:e.Sch_Type_Id,children:e.Sch_Type},s))]})]})})]}),(0,$.jsxs)(I.A,{children:[(0,$.jsx)(E.A,{onClick:()=>pe(!1),children:"Cancel"}),(0,$.jsx)(E.A,{variant:"contained",color:"primary",onClick:async()=>{if(!es.Task_Id||!es.Sch_Type_Id)return void H.oR.error("Please select a task and schedule type before saving.");const e={entryBy:Ee,Project_Id:Ne,Sch_Type_Id:es.Sch_Type_Id,Sch_Est_Start_Date:es.Task_Est_Start_Date,Sch_Est_End_Date:es.Task_Est_End_Date,tasks:[es]};try{const t=await(0,q.z)({address:"taskManagement/project/schedule/createNewTaskWithSchedule",method:"POST",bodyData:e});t.success?(H.oR.success(t.message),pe(!1),ss({Sch_Type_Id:"",Sch_Type:"",Task_Id:"",Task_Est_Start_Date:"",Task_Est_End_Date:""}),null===s||void 0===s||s()):"warning"===t.status?H.oR.warn(t.message||"Task already exists for this project."):H.oR.warn(t.message||"Failed to assign task.")}catch(t){console.error("Error assigning task:",t),H.oR.error("Failed to assign task")}},children:"Save"})]})]}),ye&&(0,$.jsxs)(T.A,{open:ye,fullWidth:!0,maxWidth:"sm",PaperProps:{style:{borderRadius:"8px"}},onClose:()=>ve(!1),children:[(0,$.jsx)(f.A,{children:Se?"Edit Task":"Assign Task"}),(0,$.jsx)(b.A,{children:(0,$.jsx)("div",{style:{padding:"1px",display:"flex",marginTop:"16px"},children:(0,$.jsxs)("div",{style:{flex:1,display:"flex",alignItems:"center"},children:[(0,$.jsx)("label",{style:{marginRight:"8px",minWidth:"80px"},children:"Sch_Type"}),(0,$.jsxs)("select",{value:es.Sch_Type_Id||"",onChange:hs,className:"cus-inpt",required:!0,style:{flex:1,padding:"8px",borderRadius:"4px",border:"1px solid #ccc"},children:[(0,$.jsx)("option",{value:"",disabled:!0,children:"- Sch_Type -"}),je.map((e,s)=>(0,$.jsx)("option",{value:e.Sch_Type_Id,children:e.Sch_Type},s))]})]})})}),(0,$.jsxs)(I.A,{children:[(0,$.jsx)(E.A,{onClick:()=>ve(!1),children:"Cancel"}),(0,$.jsx)(E.A,{variant:"contained",color:"primary",onClick:()=>(async e=>{const t={Sch_Project_Id:e.Sch_Project_Id,Sch_Id:e.TaskSchId,schtypeid:es.Sch_Type_Id,Task_Id:e.Task_Id};try{const e=await(0,q.z)({address:"taskManagement/project/schedule/updateScheduleTaskUpdate",method:"PUT",bodyData:t});e.success?(H.oR.success(e.message),ve(!1),Ae(!1),null===s||void 0===s||s()):"warning"===e.status?H.oR.warn(e.message||"Task already exists for this project."):H.oR.warn(e.message||"Failed to update task.")}catch(a){console.error("Error updating task:",a),H.oR.error("Failed to update task")}})(es),children:"Save"})]})]}),Ne&&(0,$.jsx)(U.A,{open:Fe,onClose:()=>Oe(!1),projectId:Ne,onReload:os}),Ne&&(0,$.jsx)(V.A,{open:Ye,onClose:()=>$e(!1),task:be,projectId:Ne,entryBy:Ee,taskId:be,reload:De,onReload:s}),(0,$.jsx)(te,{open:Ze,onClose:()=>{Ke(!1),Xe(null)},parentTask:Qe,projectId:Ne,onSubtaskAdded:()=>{ns(),null!==Qe&&void 0!==Qe&&Qe.Project_Id&&cs(Qe.Project_Id),H.oR.success("Subtask added successfully!")}}),Q.length>0&&(0,$.jsx)("div",{className:"p-2 pb-0",children:(0,$.jsx)(N.A,{component:"div",count:Q.length,page:ie,onPageChange:(e,s)=>{de(s)},rowsPerPage:ce,onRowsPerPageChange:e=>{he(parseInt(e.target.value,10)),de(0)},rowsPerPageOptions:[5,10,20,50],labelRowsPerPage:"Rows per page",showFirstButton:!0,showLastButton:!0})})]})})}}}]);
//# sourceMappingURL=1138.2dde098b.chunk.js.map