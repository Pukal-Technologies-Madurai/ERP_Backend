"use strict";(self.webpackChunkerp=self.webpackChunkerp||[]).push([[1024],{81024(e,l,t){t.r(l),t.d(l,{default:()=>I});var r=t(89379),d=t(65043),i=t(65074),s=t(97707),a=t(48471),o=t(12110),n=t(17392),c=t(11906),u=t(91036),v=t(59662),m=t(70579);const _=(0,v.A)((0,m.jsx)("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-2 10h-4v4h-2v-4H7v-2h4V7h2v4h4z"}),"AddBox");var h=t(83560),p=t(10204),x=t(42841),j=t(43735),y=t(73216);const I=e=>{let{loadingOn:l,loadingOff:t}=e;const[v,I]=(0,d.useState)({FromDate:(new Date).toISOString().split("T")[0],ToDate:(new Date).toISOString().split("T")[0],refresh:!1,search:""}),[g,A]=(0,d.useState)(""),[N,b]=(0,d.useState)([]),[C,T]=(0,d.useState)(!1),[f,P]=(0,d.useState)(!1),[D,S]=(0,d.useState)(!1),[k,L]=(0,d.useState)(null),w=((0,y.Zp)(),e=>{const l=Array.isArray(e.ProductList)?e.ProductList.filter(e=>(0,s.D)(null===e||void 0===e?void 0:e.Bill_Qty,0)).map(l=>{(e=>{const l=null===e||void 0===e?void 0:e.match(/(\d+)\s?kg/i);l&&parseInt(l[1])})(null===l||void 0===l?void 0:l.Product_Name);const t=Number(null===l||void 0===l?void 0:l.Bill_Qty)||0,d=Number(null===l||void 0===l?void 0:l.PackValue)||1;return(0,r.A)((0,r.A)({},l),{},{Pre_Id:null===e||void 0===e?void 0:e.Pos_Id,Act_Qty:t,Bill_Qty:t*d,Total_Qty:t,Amount:t*(Number(null===l||void 0===l?void 0:l.Item_Rate)||0)})}):[];return(0,r.A)((0,r.A)({},e),{},{Product_Array:l,Retailer_Id:null===e||void 0===e?void 0:e.Custome_Id,Staffs_Array:(e=>{const l=[];return e.Broker_Id&&0!==e.Broker_Id&&l.push({Id:"",So_Id:"",Emp_Id:e.Broker_Id,Emp_Type_Id:e.Broker_Type||0}),e.Transporter_Id&&0!==e.Transporter_Id&&l.push({Id:"",Do_Id:"",Emp_Id:e.Transporter_Id,Emp_Type_Id:e.TrasnportType||0}),l.filter(e=>0!==e.Emp_Type_Id)})(e)})}),B=e=>{const l=((null===e||void 0===e?void 0:e.ProductList)||[]).map(e=>{const l=Number(null===e||void 0===e?void 0:e.Bill_Qty)||0,t=Number(null===e||void 0===e?void 0:e.PackValue)||1;return(0,r.A)((0,r.A)({},e),{},{Act_Qty:l,Bill_Qty:l*t,Total_Qty:l,Amount:l*t*(Number(null===e||void 0===e?void 0:e.Item_Rate)||0)})}),t=((null===e||void 0===e?void 0:e.Staff_Involved_List)||[]).map(e=>({Emp_Id:e.Involved_Emp_Id,Emp_Type_Id:e.Cost_Center_Type_Id,Id:"",So_Id:""})),d=(null===e||void 0===e?void 0:e.Custome_Id)||(null===e||void 0===e?void 0:e.Retailer_Id)||0,i=(0,r.A)((0,r.A)({},e),{},{Pre_Date:null!==e&&void 0!==e&&e.Pre_Date?e.Pre_Date:"",Do_Date:null!==e&&void 0!==e&&e.Pre_Date?e.Pre_Date:(null===e||void 0===e?void 0:e.Do_Date)||"",ProductList:l,Staffs_Array:t,Retailer_Id:d}),s=w(i);L({row:i,payload:s}),S(!0)};(0,d.useEffect)(()=>{(async()=>{P(!0),l&&l();try{const e=await(0,i.z)({address:"sales/presaleOrder/getList?FromDate=".concat(v.FromDate,"&ToDate=").concat(v.ToDate)});e.success&&b(e.data)}catch(e){console.error(e)}finally{P(!1),t&&t()}})()},[v.FromDate,v.ToDate,v.refresh]);const F=e=>String(e).toLowerCase().replace(/\s+/g," ").replace(/[^a-z0-9]/gi,"").trim(),E=(0,d.useMemo)(()=>{const e=F(v.search||"");return N.filter(l=>{let t=[];for(let e in l)"ProductList"!==e&&t.push(l[e]);Array.isArray(l.ProductList)&&l.ProductList.forEach(e=>{t.push(...Object.values(e))});return F(t.join(" ")).includes(e)})},[v.search,N]),Q=e=>{var l,t;let{row:r}=e;return(0,m.jsx)(m.Fragment,{children:(null===r||void 0===r||null===(l=r.ProductList)||void 0===l?void 0:l.length)>0&&(0,m.jsxs)("table",{className:"table",children:[(0,m.jsx)("thead",{children:(0,m.jsxs)("tr",{children:[(0,m.jsx)("th",{className:"border p-2 bg-light",children:"S_No"}),(0,m.jsx)("th",{className:"border p-2 bg-light",children:"Item_Id"}),(0,m.jsx)("th",{className:"border p-2 bg-light",children:"Product_Name"}),(0,m.jsx)("th",{className:"border p-2 bg-light",children:"Bill_Qty"}),(0,m.jsx)("th",{className:"border p-2 bg-light",children:"Item_Rate"}),(0,m.jsx)("th",{className:"border p-2 bg-light",children:"Unit_Id"}),(0,m.jsx)("th",{className:"border p-2 bg-light",children:"Unit_Name"}),(0,m.jsx)("th",{className:"border p-2 bg-light",children:"Amount"})]})}),(0,m.jsx)("tbody",{children:null===r||void 0===r||null===(t=r.ProductList)||void 0===t?void 0:t.map((e,l)=>(0,m.jsxs)("tr",{children:[(0,m.jsx)("td",{className:"border p-2",children:null===e||void 0===e?void 0:e.S_No}),(0,m.jsx)("td",{className:"border p-2",children:null===e||void 0===e?void 0:e.Item_Id}),(0,m.jsx)("td",{className:"border p-2",children:null===e||void 0===e?void 0:e.Product_Name}),(0,m.jsx)("td",{className:"border p-2",children:null===e||void 0===e?void 0:e.Bill_Qty}),(0,m.jsx)("td",{className:"border p-2",children:null===e||void 0===e?void 0:e.Item_Rate}),(0,m.jsx)("td",{className:"border p-2",children:null===e||void 0===e?void 0:e.Unit_Id}),(0,m.jsx)("td",{className:"border p-2",children:null===e||void 0===e?void 0:e.Unit_Name}),(0,m.jsx)("td",{className:"border p-2",children:null===e||void 0===e?void 0:e.Amount})]},l))})]})})},R=e=>{l();const d=Array.isArray(e.ProductList)?e.ProductList.filter(e=>(0,s.D)(null===e||void 0===e?void 0:e.Bill_Qty,0)).map(l=>{const t=(e=>{const l=null===e||void 0===e?void 0:e.match(/(\d+)\s?kg/i);return l?parseInt(l[1]):1})(null===l||void 0===l?void 0:l.Product_Name);return(0,r.A)((0,r.A)({},l),{},{Pre_Id:null===e||void 0===e?void 0:e.Pre_Id,Bill_Qty:t*(null===l||void 0===l?void 0:l.Bill_Qty),Total_Qty:null===l||void 0===l?void 0:l.Bill_Qty})}):[],a=(e=>{const l=[];return e.Broker_Id&&0!==e.Broker_Id&&l.push({Id:"",So_Id:"",Emp_Id:e.Broker_Id,Emp_Type_Id:e.Broker_Type||0}),e.Transporter_Id&&0!==e.Transporter_Id&&l.push({Id:"",Do_Id:"",Emp_Id:e.Transporter_Id,Emp_Type_Id:e.TrasnportType||0}),l.filter(e=>0!==e.Emp_Type_Id)})(e),o=(0,r.A)((0,r.A)({},e),{},{Product_Array:d,Retailer_Id:null===e||void 0===e?void 0:e.Custome_Id,Staffs_Array:a});(0,i.z)({address:"sales/presaleOrder/saleOrderCreationWithPso",method:0!==(null===e||void 0===e?void 0:e.isConverted)?"PUT":"POST",bodyData:o}).then(e=>{e.success?(u.oR.success(null===e||void 0===e?void 0:e.message),T(!0)):u.oR.error(null===e||void 0===e?void 0:e.message)}).catch(()=>{u.oR.error("Something went wrong!")}).finally(()=>t())};return(0,d.useEffect)(()=>{C&&(0,i.z)({address:"sales/presaleOrder/getList?FromDate=".concat(v.FromDate,"&ToDate=").concat(v.ToDate)}).then(e=>{e.success&&b(e.data)}).catch(e=>console.error(e)).finally(()=>T(!1))},[C,v.FromDate,v.ToDate]),(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)(o.A,{children:[(0,m.jsx)("div",{className:"px-3 py-2 fa-14",children:(0,m.jsxs)("div",{className:"d-flex flex-wrap align-items-center",children:[(0,m.jsx)("td",{style:{verticalAlign:"middle"},children:"From"}),(0,m.jsx)("td",{children:(0,m.jsx)("input",{type:"date",value:v.FromDate,onChange:e=>I((0,r.A)((0,r.A)({},v),{},{FromDate:e.target.value})),className:"cus-inpt"})}),(0,m.jsx)("td",{style:{verticalAlign:"middle"},children:"To"}),(0,m.jsx)("td",{children:(0,m.jsx)("input",{type:"date",value:v.ToDate,onChange:e=>I((0,r.A)((0,r.A)({},v),{},{ToDate:e.target.value})),className:"cus-inpt"})}),(0,m.jsx)(n.A,{size:"small",onClick:()=>{I(e=>(0,r.A)((0,r.A)({},e),{},{viewNotSynced:!e.viewNotSynced}))}})]})}),v.search?(0,m.jsx)(a.Ay,{title:"Pre-Sale Order List",bodyFontSizePx:11,headerFontSizePx:11,dataArray:E,columns:[(0,a.Lj)("Pre_Id","string","Pre_Id"),{Field_Name:"Pre_Date",ColumnHeader:"Pre_Date",isVisible:1,isCustomCell:!0,Cell:e=>{let{row:l}=e;return(0,m.jsx)("td",{className:"fa-12",style:{minWidth:"80px"},children:null===l||void 0===l?void 0:l.Pre_Date.split("T")[0]})}},(0,a.Lj)("Retailer_Name","string","Retailer_Name"),(0,a.Lj)("Broker_Name","string","Broker_Name"),(0,a.Lj)("Transporter_Name","string","Transporter_Name"),(0,a.Lj)("Total_Invoice_value","string","Total_Invoice_value"),{ColumnHeader:"Status",isVisible:1,align:"center",isCustomCell:!0,Cell:e=>{var l,t;let{row:r}=e;const d=p.T.find(e=>e.id===Number(null===r||void 0===r?void 0:r.isConverted));return(0,m.jsx)("span",{className:null!==(l="py-0 fw-bold px-2 rounded-4 fa-12 "+(null===d||void 0===d?void 0:d.color))&&void 0!==l?l:"bg-secondary text-white",children:null!==(t=null===d||void 0===d?void 0:d.label)&&void 0!==t?t:"Undefined"})}},{Field_Name:"Actions",ColumnHeader:"Actions",isVisible:1,isCustomCell:!0,Cell:e=>{let{row:l}=e;return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("td",{className:"fa-12",style:{minWidth:"80px"},children:(0,m.jsx)(n.A,{size:"small",onClick:()=>R(l),children:0===(null===l||void 0===l?void 0:l.isConverted)?(0,m.jsx)(_,{}):(0,m.jsx)(h.A,{})})}),(0,m.jsx)("td",{className:"fa-12",style:{minWidth:"80px"},children:(0,m.jsx)(n.A,{size:"small",onClick:()=>B(l),children:(0,m.jsx)(x.A,{})})})]})}}],isExpendable:!0,tableMaxHeight:550,expandableComp:Q,ButtonArea:(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(c.A,{sx:{ml:1},variant:"outlined",onClick:()=>I(e=>(0,r.A)((0,r.A)({},e),{},{search:g})),children:"Search"}),(0,m.jsx)("input",{type:"search",className:"cus-inpt p-1 w-auto",value:g,onChange:e=>A(e.target.value),placeholder:"Search.."})]})}):(0,m.jsx)(a.Ay,{title:"Pre-Sale Order List",bodyFontSizePx:11,headerFontSizePx:11,dataArray:N,columns:[(0,a.Lj)("Pre_Id","string","Pre_Id"),{Field_Name:"Pre_Date",ColumnHeader:"Pre_Date",isVisible:1,isCustomCell:!0,Cell:e=>{let{row:l}=e;return(0,m.jsx)("td",{className:"fa-12",style:{minWidth:"80px"},children:null===l||void 0===l?void 0:l.Pre_Date.split("T")[0]})}},(0,a.Lj)("Retailer_Name","string","Retailer_Name"),(0,a.Lj)("Broker_Name","string","Broker_Name"),(0,a.Lj)("Transporter_Name","string","Transporter_Name"),(0,a.Lj)("Total_Invoice_value","string","Total_Invoice_value"),{ColumnHeader:"Status",isVisible:1,align:"center",isCustomCell:!0,Cell:e=>{var l,t;let{row:r}=e;const d=p.T.find(e=>e.id===Number(null===r||void 0===r?void 0:r.isConverted));return(0,m.jsx)("span",{className:null!==(l="py-0 fw-bold px-2 rounded-4 fa-12 "+(null===d||void 0===d?void 0:d.color))&&void 0!==l?l:"bg-secondary text-white",children:null!==(t=null===d||void 0===d?void 0:d.label)&&void 0!==t?t:"Undefined"})}},{Field_Name:"Actions",ColumnHeader:"Actions",isVisible:1,isCustomCell:!0,Cell:e=>{let{row:l}=e;return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("td",{className:"fa-12",style:{minWidth:"50px"},children:(0,m.jsx)(n.A,{size:"small",onClick:()=>R(l),children:0===(null===l||void 0===l?void 0:l.isConverted)?(0,m.jsx)(_,{}):(0,m.jsx)(h.A,{})})}),2!=(null===l||void 0===l?void 0:l.isConverted)&&(0,m.jsx)("td",{className:"fa-12",style:{minWidth:"50px"},children:(0,m.jsx)(n.A,{size:"small",onClick:()=>B(l),children:(0,m.jsx)(x.A,{})})})]})}}],isExpendable:!0,tableMaxHeight:550,expandableComp:Q,ButtonArea:(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(c.A,{sx:{ml:1},variant:"outlined",onClick:()=>I(e=>(0,r.A)((0,r.A)({},e),{},{search:g})),children:"Search"}),(0,m.jsx)("input",{type:"search",className:"cus-inpt p-1 w-auto",value:g,onChange:e=>A(e.target.value),placeholder:"Search.."})]})})]}),(0,m.jsx)(j.A,{open:D,onClose:e=>{S(!1),e&&T(!0)},editValues:null===k||void 0===k?void 0:k.row,defaultValues:null===k||void 0===k?void 0:k.payload,loadingOn:l,loadingOff:t,transactionType:"both"})]})}}}]);
//# sourceMappingURL=1024.82264ef5.chunk.js.map