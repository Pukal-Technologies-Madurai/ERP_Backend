"use strict";(self.webpackChunkerp=self.webpackChunkerp||[]).push([[325],{47968:(e,s,t)=>{t.d(s,{A:()=>d});var a=t(59662),l=t(70579);const d=(0,a.A)((0,l.jsx)("path",{d:"M5 20h14v-2H5zM19 9h-4V3H9v6H5l7 7z"}),"Download")},80325:(e,s,t)=>{t.r(s),t.d(s,{default:()=>C});var a=t(65043),l=t(58992),d=t(73216),i=t(77739),n=t(17392),c=t(83462),o=t(26600),r=t(35316),h=t(29347),u=t(11906),m=t(59662),x=t(70579);const p=(0,m.A)((0,x.jsx)("path",{d:"M11.67 3.87 9.9 2.1 0 12l9.9 9.9 1.77-1.77L3.54 12z"}),"ArrowBackIos"),j=(0,m.A)((0,x.jsx)("path",{d:"M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8"}),"Replay"),v=(0,m.A)([(0,x.jsx)("path",{d:"M19 5v14H5V5zm0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2"},"0"),(0,x.jsx)("path",{d:"M14 17H7v-2h7zm3-4H7v-2h10zm0-4H7V7h10z"},"1")],"ArticleOutlined"),f=(0,m.A)((0,x.jsx)("path",{d:"M2 12.5C2 9.46 4.46 7 7.5 7H18c2.21 0 4 1.79 4 4s-1.79 4-4 4H9.5C8.12 15 7 13.88 7 12.5S8.12 10 9.5 10H17v2H9.41c-.55 0-.55 1 0 1H18c1.1 0 2-.9 2-2s-.9-2-2-2H7.5C5.57 9 4 10.57 4 12.5S5.57 16 7.5 16H17v2H7.5C4.46 18 2 15.54 2 12.5"}),"Attachment"),g=(0,m.A)((0,x.jsx)("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send");var N=t(47968),b=t(91036),A=(t(92342),t(60235)),y=t(79722),I=t(65074);const C=()=>{const e=localStorage.getItem("user"),s=JSON.parse(e),t=(0,d.zy)().state,m=(0,d.Zp)(),[C,S]=(0,a.useState)([]),[w,z]=(0,a.useState)([]),F=(0,a.useRef)(null),[H,k]=(0,a.useState)(""),[T,D]=(0,a.useState)(!1),[M,U]=(0,a.useState)(!1),[_,R]=(0,a.useState)(""),[V,E]=(0,a.useState)(0),[L,O]=(0,a.useState)(!1);(0,a.useEffect)(()=>{if(!t)return m("/taskManagement/discussions");(0,I.z)({address:"discussionForum/messages?Topic_Id=".concat(null===t||void 0===t?void 0:t.Id)}).then(e=>{if(e.success){const s=e.data.reduce((e,s)=>{const t=new Date(s.CreatedAt).toDateString();return e[t]||(e[t]=[]),e[t].push(s),e},{});S(s)}}).catch(e=>console.log(e)),(0,I.z)({address:"discussionForum/files?Topic_Id=".concat(null===t||void 0===t?void 0:t.Id)}).then(e=>{e.success&&z(e.data)}).catch(e=>console.log(e))},[T]),(0,a.useEffect)(()=>{if(F.current){const{scrollHeight:e,clientHeight:s}=F.current;F.current.scrollTop=e-s}},[C]);const P=()=>{U(!1),R("")},W=e=>{e.preventDefault();const a=new FormData;a.append("files",_),a.append("User_Id",null===s||void 0===s?void 0:s.UserId),a.append("Project_Id",null===t||void 0===t?void 0:t.Project_Id),a.append("Topic_Id",null===t||void 0===t?void 0:t.Id);try{y.A.post("".concat(l.A,"discussionForum/files"),a,{headers:{"Content-Type":"multipart/form-data",Authorization:null===s||void 0===s?void 0:s.Autheticate_Id},onUploadProgress:e=>{let s=Math.round(100*e.loaded/e.total);E(s)}}).then(e=>{b.oR.success(e.data.message),D(!T)}).catch(e=>{b.oR.error("Failed to upload"),console.error(e)}).finally(()=>{P(),E(0)})}catch(d){console.error("Error uploading file:",d)}};return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(b.N9,{}),(0,x.jsxs)("div",{className:"chat-header d-flex align-items-center",children:[(0,x.jsx)("p",{className:"mb-0 fa-14 text-white text-uppercase fw-bold flex-grow-1",children:null===t||void 0===t?void 0:t.Topic}),(0,x.jsx)(i.A,{title:"Back",children:(0,x.jsx)(n.A,{size:"small",onClick:()=>m("/taskManagement/discussions"),children:(0,x.jsx)(p,{className:"fa-18"})})}),(0,x.jsx)(i.A,{title:"Refresh Chat",children:(0,x.jsx)(n.A,{size:"small",onClick:()=>D(!T),children:(0,x.jsx)(j,{className:"fa-18"})})}),(0,x.jsx)(i.A,{title:"Documnets Shared",children:(0,x.jsx)(n.A,{size:"small",onClick:()=>O(!0),children:(0,x.jsx)(v,{})})}),(0,x.jsxs)(A.A,{children:[(0,x.jsx)(A.A.Toggle,{variant:"success",id:"actions",className:"rounded-5 bg-transparent text-muted fa-18 border-0 btn"}),(0,x.jsxs)(A.A.Menu,{children:[(0,x.jsx)("h5",{className:"mb-1 text-primary px-3 fa-18 border-bottom",children:" Teams"}),null===t||void 0===t?void 0:t.InvolvedUsers.map((e,s)=>(0,x.jsx)("p",{className:"fw-bold text-muted fa-13 mb-0 px-3 py-1 ",children:e.Name},s))]})]})]}),(0,x.jsx)("div",{className:"chat-body",ref:F,children:Object.entries(C).map(e=>{let[t,l]=e;return(0,x.jsxs)(a.Fragment,{children:[(0,x.jsx)("div",{className:"badge rounded-3 bg-light text-center text-dark mx-auto my-2",children:(new Date).toDateString()===t?"Today":t}),l.map(e=>(0,x.jsxs)("div",{className:"messages ".concat(Number(null===e||void 0===e?void 0:e.User_Id)===Number(null===s||void 0===s?void 0:s.UserId)?"message-right":"message-left"),children:[(0,x.jsx)("p",{className:"fw-bold mb-1 text-primary fa-12",children:Number(null===e||void 0===e?void 0:e.User_Id)===Number(null===s||void 0===s?void 0:s.UserId)?"You":e.Name}),(0,x.jsx)("div",{className:"fa-16 mb-2",children:e.Message}),(0,x.jsx)("p",{className:"fa-11 mb-0 fw-bold ".concat(Number(null===e||void 0===e?void 0:e.User_Id)===Number(null===s||void 0===s?void 0:s.UserId)&&"text-end"," "),children:new Date(e.CreatedAt).toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit"})})]},e.Id))]},t)})}),(0,x.jsx)("form",{onSubmit:async e=>{if(e.preventDefault(),""===H.trim())return b.oR.warn("Enter a message"),void k("");(0,I.z)({address:"discussionForum/messages",method:"POST",bodyData:{Topic_Id:null===t||void 0===t?void 0:t.Id,User_Id:null===s||void 0===s?void 0:s.UserId,Message:H}}).then(e=>{e.success?(D(!T),k("")):b.oR.error(e.message)}).catch(e=>console.log(e))},children:(0,x.jsx)("div",{className:"chat-footer",children:(0,x.jsxs)("div",{className:"input-icon-container",children:[(0,x.jsx)("input",{className:"cus-inpt rounded-5 border-0 outline-none px-3",placeholder:"Type a message",autoFocus:!0,required:!0,value:H,onChange:e=>k(e.target.value),onInvalid:e=>e.target.setCustomValidity("Type a message"),onInput:e=>e.target.setCustomValidity("")}),(0,x.jsx)(i.A,{title:"Upload Files",children:(0,x.jsx)(n.A,{onClick:()=>U(!0),type:"button",children:(0,x.jsx)(f,{})})}),(0,x.jsx)(i.A,{title:"Send Message",children:(0,x.jsx)(n.A,{type:"submit",children:(0,x.jsx)(g,{})})})]})})}),(0,x.jsxs)(c.A,{open:M,onClose:P,fullWidth:!0,maxWidth:"sm",children:[(0,x.jsx)(o.A,{children:"Share Files"}),(0,x.jsxs)("form",{onSubmit:W,children:[(0,x.jsx)(r.A,{children:(0,x.jsx)("input",{type:"file",className:"cus-inpt ",required:!0,onChange:e=>R(e.target.files[0])})}),(0,x.jsxs)(h.A,{children:[(0,x.jsx)(u.A,{onClick:P,type:"button",children:"close"}),(0,x.jsx)(u.A,{onClick:W,disabled:0!==V,type:"submit",children:"Upload"})]})]})]}),(0,x.jsxs)(c.A,{open:L,onClose:()=>O(!1),fullWidth:!0,maxWidth:w.length>0?"lg":"sm",children:[(0,x.jsx)(o.A,{children:"Shared Documents"}),(0,x.jsx)(r.A,{children:w.length>0?(0,x.jsx)("div",{className:"table-responsive",children:(0,x.jsxs)("table",{className:"table",children:[(0,x.jsx)("thead",{children:(0,x.jsxs)("tr",{children:[(0,x.jsx)("th",{className:"fa-14",children:"S.No"}),(0,x.jsx)("th",{className:"fa-14",children:"File Name"}),(0,x.jsx)("th",{className:"fa-14",children:"Size"}),(0,x.jsx)("th",{className:"fa-14",children:"Type"}),(0,x.jsx)("th",{className:"fa-14",children:"Date"}),(0,x.jsx)("th",{className:"fa-14"})]})}),(0,x.jsx)("tbody",{children:w.map((e,t)=>(0,x.jsxs)("tr",{children:[(0,x.jsx)("td",{className:"fa-14",children:t+1}),(0,x.jsx)("td",{className:"fa-14",children:null===e||void 0===e?void 0:e.FileName}),(0,x.jsxs)("td",{className:"fa-14",children:[null!==e&&void 0!==e&&e.FileSize?((null===e||void 0===e?void 0:e.FileSize)/1024/1024).toFixed(2):0," MB"]}),(0,x.jsx)("td",{className:"fa-14",children:null===e||void 0===e?void 0:e.FileType}),(0,x.jsx)("td",{className:"fa-14",children:null===e||void 0===e?void 0:e.SendDate}),(0,x.jsx)("td",{className:"fa-14",children:(0,x.jsx)(n.A,{className:"text-primary",size:"small",onClick:()=>(async e=>{try{const t=await(0,I.z)({address:"discussionForum/files/download?FileId=".concat(e),headers:{"Content-Type":"application/octet-stream",Authorization:s.Autheticate_Id}}),a=await t.blob(),l=window.URL.createObjectURL(a),d=document.createElement("a");d.href=l,d.setAttribute("download","file_".concat(e)),document.body.appendChild(d),d.click(),d.parentNode.removeChild(d)}catch(t){console.error("Download Error",t)}})(e.FileId),children:(0,x.jsx)(N.A,{})})})]},t))})]})}):(0,x.jsx)("h5",{className:"text-center text-muted my-5",children:"No Documents Available"})}),(0,x.jsx)(h.A,{children:(0,x.jsx)(u.A,{onClick:()=>O(!1),children:"Close"})})]})]})}}}]);
//# sourceMappingURL=325.adbaaa42.chunk.js.map