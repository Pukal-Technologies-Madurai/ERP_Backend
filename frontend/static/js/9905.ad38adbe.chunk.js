"use strict";(self.webpackChunkerp=self.webpackChunkerp||[]).push([[9905],{19905:(e,l,i)=>{i.r(l),i.d(l,{default:()=>S});var d=i(89379),o=i(65043),n=i(12110),a=i(11906),s=i(26494),t=i(24056),r=i(4598),v=i(77739),u=i(83462),c=i(26600),m=i(35316),b=i(29347),_=i(38463),x=i(65829),h=i(55434),p=i(37141),j=i(22016),N=i(15710),T=i(86506),f=i(12604),A=i(97707),C=i(91036),I=i(73216),g=i(45777),J=i(65074),y=i(70579);const S=()=>{var e,l,i,S,w,k;const B=JSON.parse(localStorage.getItem("user")),F=(0,I.Zp)(),{contextObj:R}=(0,o.useContext)(g.i),D=(0,I.zy)().state,O={Report_Type_Id:"",reportName:"",tables:[],tableJoins:[],currentTab:"tbl_Q_Pay_Summarry",previewDialog:!1,createdBy:B.UserId},[V,q]=(0,o.useState)(O),[z,E]=(0,o.useState)([]),K=null===V||void 0===V||null===(e=V.tables)||void 0===e?void 0:e.reduce((e,l)=>e+(Boolean(Number(null===l||void 0===l?void 0:l.isChecked))?1:0),0),M=null===V||void 0===V||null===(l=V.tables)||void 0===l?void 0:l.reduce((e,l)=>{var i;return e+(Boolean(Number(null===l||void 0===l?void 0:l.isChecked))?null===l||void 0===l||null===(i=l.columns)||void 0===i?void 0:i.reduce((e,l)=>e+((0,A.id)(null===l||void 0===l?void 0:l.isVisible,1)?1:0),0):0)},0),P=(0,y.jsx)("span",{className:"p-2 mt-3 border rounded-3 d-inline-block w-auto",children:(0,y.jsx)("table",{children:(0,y.jsxs)("tbody",{children:[(0,y.jsxs)("tr",{children:[(0,y.jsx)("td",{className:" border-end",children:"Tables Selected"}),(0,y.jsx)("td",{className:"px-2 blue-text",children:K})]}),(0,y.jsxs)("tr",{children:[(0,y.jsx)("td",{className:" border-end",children:"Columns Selected\u2003\u2003"}),(0,y.jsx)("td",{className:"px-2 blue-text",children:M})]})]})})});(0,o.useEffect)(()=>{const e=null===D||void 0===D?void 0:D.ReportState;(0,A.aF)(e)&&q(l=>{var i,o,n,a;return(0,d.A)((0,d.A)({},l),{},{Report_Type_Id:null!==(i=null===e||void 0===e?void 0:e.Report_Type_Id)&&void 0!==i?i:"",reportName:null!==(o=null===e||void 0===e?void 0:e.reportName)&&void 0!==o?o:"",tables:null!==(n=[...null===e||void 0===e?void 0:e.tables])&&void 0!==n?n:[],createdBy:null!==(a=null===e||void 0===e?void 0:e.createdBy)&&void 0!==a?a:null===B||void 0===B?void 0:B.UserId})})},[]),(0,o.useEffect)(()=>{(0,J.z)({address:"reports/tablesAndColumns"}).then(e=>{null!==e&&void 0!==e&&e.success&&E(null===e||void 0===e?void 0:e.data)}).catch(e=>console.log(e))},[]);const U=(e,l,i)=>{q(o=>{const n=[...o.tableJoins],a=(0,d.A)({},n[l]);return a[i]=e,"Join_First_Table_Id"===i&&(a.Join_First_Table_Column=""),"Join_Second_Table_Id"===i&&(a.Join_Second_Table_Column=""),(null===a||void 0===a?void 0:a.Join_First_Table_Id)===(null===a||void 0===a?void 0:a.Join_Second_Table_Id)&&(a.Join_Second_Table_Id=""),n[l]=a,(0,d.A)((0,d.A)({},o),{},{tableJoins:[...n]})})};return(0,A.id)(null===R||void 0===R?void 0:R.Add_Rights,1)&&(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)(n.A,{children:[(0,y.jsxs)("div",{className:"p-2 border-bottom fa-16 fw-bold d-flex justify-content-between align-items-center",children:[(0,y.jsx)("span",{className:"text-primary text-uppercase ps-3",children:null!==V&&void 0!==V&&V.Report_Type_Id?"Modify Report Template":"Report Templates Creation"}),(0,y.jsx)(a.A,{variant:"outlined",onClick:()=>F(-1),startIcon:(0,y.jsx)(x.A,{}),children:"Back"})]}),(0,y.jsxs)(s.A,{children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"w-100",children:"Report Name"}),(0,y.jsx)("input",{type:"text",className:"cus-inpt w-auto",value:V.reportName,onChange:e=>q((0,d.A)((0,d.A)({},V),{},{reportName:e.target.value}))})]}),P,(0,y.jsx)(f.A,{className:"d-flex flex-wrap mt-3",children:(0,y.jsxs)(j.Ay,{value:V.currentTab,children:[(0,y.jsx)(N.A,{indicatorColor:"transparent",onChange:(e,l)=>q((0,d.A)((0,d.A)({},V),{},{currentTab:l})),variant:"scrollable",scrollButtons:"auto",orientation:"vertical",allowScrollButtonsMobile:!0,sx:{maxHeight:"400px"},children:z.map((e,l)=>{var i;return(0,y.jsx)(t.A,{sx:V.currentTab===(null===e||void 0===e?void 0:e.Table_Name)?{backgroundColor:"#c6d7eb"}:{},className:Boolean(null===(i=V.tables.find(l=>l.Table_Name===(null===e||void 0===e?void 0:e.Table_Name)))||void 0===i?void 0:i.isChecked)?"text-success fw-bold":"text-primary",label:null===e||void 0===e?void 0:e.AliasName,value:null===e||void 0===e?void 0:e.Table_Name},l)})}),z.map((e,l)=>{var i,o;return(0,y.jsxs)(T.A,{value:null===e||void 0===e?void 0:e.Table_Name,className:"flex-grow-1 p-3 border rounded-2",children:[(0,y.jsxs)("div",{className:"d-flex align-items-center mb-4 border-bottom",children:[(0,y.jsx)(r.A,{checked:Boolean(null===(i=V.tables.find(l=>l.Table_Name===(null===e||void 0===e?void 0:e.Table_Name)))||void 0===i?void 0:i.isChecked),onChange:l=>{return i=null===e||void 0===e?void 0:e.Table_Name,o=l.target.checked,n=null===e||void 0===e?void 0:e.AliasName,void q(e=>{var l,a,s;const t=[...e.tables],r=t.findIndex(e=>e.Table_Name===i),v=[],u=null===z||void 0===z?void 0:z.findIndex(e=>e.Table_Name===i),c=null===(l=z[u])||void 0===l||null===(a=l.Columns)||void 0===a?void 0:a.findIndex(e=>(0,A.id)(null===e||void 0===e?void 0:e.IS_Default,1)),m=-1!==c?null===(s=z[u])||void 0===s?void 0:s.Columns[c]:{};var b;return-1!==c&&(m.Order_By="",m.isVisible=!0),v.push(m),-1!==r?(t[r].isChecked=o,t[r].columns=o?v:[]):t.push({Table_Id:(null===z||void 0===z||null===(b=z.find(e=>(null===e||void 0===e?void 0:e.Table_Name)===i))||void 0===b?void 0:b.Table_Id)||"",Table_Name:i,AliasName:n,isChecked:o,columns:v}),(0,d.A)((0,d.A)({},e),{},{tables:t.filter(e=>Boolean(Number(null===e||void 0===e?void 0:e.isChecked)))})});var i,o,n}}),(0,y.jsxs)("h6",{className:"fa-13 mb-0 fw-bold ",children:[null===e||void 0===e?void 0:e.AliasName," TABLE"]})]}),(0,y.jsx)("div",{className:"cus-grid",children:null===e||void 0===e||null===(o=e.Columns)||void 0===o?void 0:o.map((l,i)=>{var o,a,s,t,v,u;return(0,y.jsx)("div",{children:(0,y.jsxs)(n.A,{className:"p-2 d-flex justify-content-between align-items-center flex-wrap ".concat(i%2===0?"bg-light":""),children:[(0,y.jsxs)("div",{className:"d-flex justify-content-between align-items-center flex-wrap",children:[(0,y.jsx)(r.A,{checked:Boolean(null===l||void 0===l?void 0:l.IS_Default)||Boolean(null===(o=V.tables.find(l=>l.Table_Name===(null===e||void 0===e?void 0:e.Table_Name)))||void 0===o||null===(a=o.columns)||void 0===a||null===(s=a.find(e=>e.Column_Name===(null===l||void 0===l?void 0:l.Column_Name)))||void 0===s?void 0:s.isVisible),disabled:Boolean(null===l||void 0===l?void 0:l.IS_Default),onChange:i=>{return o=null===e||void 0===e?void 0:e.Table_Name,n=l,a=i.target.checked,void q(e=>{const l=[...e.tables],i=l.findIndex(e=>e.Table_Name===o);if(-1!==i){const e=l[i].columns||[],o=null===e||void 0===e?void 0:e.findIndex(e=>(null===e||void 0===e?void 0:e.Column_Name)===(null===n||void 0===n?void 0:n.Column_Name));-1!==o?e[o].isVisible=a?1:0:e.push((0,d.A)((0,d.A)({},n),{},{Order_By:"",isVisible:a?1:0})),l[i].columns=null===e||void 0===e?void 0:e.filter(e=>(0,A.id)(null===e||void 0===e?void 0:e.isVisible,1))}return(0,d.A)((0,d.A)({},e),{},{tables:l})});var o,n,a}}),(0,y.jsx)("h6",{className:"fa-12 m-0 fw-bold",children:null===l||void 0===l?void 0:l.Column_Name})]}),(0,y.jsx)("input",{type:"number",className:"p-1 border cus-inpt ".concat(i%2!==0?"bg-light":""),style:{width:"80px"},placeholder:"Order",value:(null===(t=V.tables.find(l=>l.Table_Name===(null===e||void 0===e?void 0:e.Table_Name)))||void 0===t||null===(v=t.columns)||void 0===v||null===(u=v.find(e=>e.Column_Name===(null===l||void 0===l?void 0:l.Column_Name)))||void 0===u?void 0:u.Order_By)||"",onChange:i=>{return o=null===e||void 0===e?void 0:e.Table_Name,n=l,a=i.target.value,void q(e=>{const l=[...e.tables],i=l.findIndex(e=>e.Table_Name===o);if(-1!==i){const e=l[i].columns||[],o=null===e||void 0===e?void 0:e.findIndex(e=>(null===e||void 0===e?void 0:e.Column_Name)===(null===n||void 0===n?void 0:n.Column_Name));-1!==o?e[o].Order_By=a:e.push((0,d.A)((0,d.A)({},n),{},{Order_By:a,isVisible:!0})),l[i].columns=e}return(0,d.A)((0,d.A)({},e),{},{tables:l})});var o,n,a}})]})},i)})})]},l)})]})})]}),(0,y.jsx)("hr",{className:"mt-2 mb-0"}),(0,y.jsx)("div",{className:"p-3 d-flex justify-content-end",children:(0,y.jsx)(v.A,{title:M<=4&&"Select Minimum 5 Columns",children:(0,y.jsx)("span",{children:(0,y.jsx)(a.A,{variant:"outlined",startIcon:(0,y.jsx)(h.A,{}),disabled:!(null!==V&&void 0!==V&&V.reportName)||0===K||M<=4,onClick:M>50?()=>C.oR.warn("Maximum 50 Column limit exceeded"):()=>(()=>{var e;const l=null===(e=V.tables)||void 0===e?void 0:e.reduce((e,l)=>e+(Boolean(null===l||void 0===l?void 0:l.isChecked)?1:0),0);q(e=>(0,d.A)((0,d.A)({},e),{},{previewDialog:!0,tableJoins:l>1?Array.from({length:(0,A.DG)(l,1)}).map((e,l)=>({Join_First_Table_Id:"",Join_First_Table_Column:"",Join_Second_Table_Id:"",Join_Second_Table_Column:""})):[]}))})(),children:"Preview"})})})})]}),(0,y.jsxs)(u.A,{open:null===V||void 0===V?void 0:V.previewDialog,onClose:()=>q(e=>(0,d.A)((0,d.A)({},e),{},{previewDialog:!1})),fullScreen:!0,children:[(0,y.jsx)(c.A,{children:"Define Table Joins"}),(0,y.jsxs)("form",{onSubmit:e=>{e.preventDefault(),(()=>{var e;const l=new Set;if(null===(e=V.tableJoins)||void 0===e||e.forEach(e=>{l.add(e.Join_First_Table_Id),l.add(e.Join_Second_Table_Id)}),l.size!==V.tableJoins.length+1&&V.tables.length>1)return C.oR.error("Invalid table joins");q(e=>(0,d.A)((0,d.A)({},e),{},{previewDialog:!1})),(0,J.z)({address:"reports/template",method:null!==V&&void 0!==V&&V.Report_Type_Id?"PUT":"POST",bodyData:V}).then(e=>{null!==e&&void 0!==e&&e.success?(q(O),F(-1),C.oR.success(e.message)):C.oR.error(e.message)}).catch(e=>console.log(e))})()},children:[(0,y.jsxs)(m.A,{children:[P,(0,y.jsx)("div",{className:"table-responsive",children:(0,y.jsxs)("table",{className:"table",children:[(0,y.jsx)("thead",{children:(0,y.jsx)("tr",{children:null===V||void 0===V||null===(i=V.tables)||void 0===i?void 0:i.map((e,l)=>{var i;return(0,y.jsx)(o.Fragment,{children:(0,y.jsxs)("th",{className:"border fa-14 text-center",children:[null===e||void 0===e?void 0:e.AliasName," ( ",null===e||void 0===e||null===(i=e.columns)||void 0===i?void 0:i.length," )"]})},l)})})}),(0,y.jsx)("tbody",{children:(0,y.jsx)("tr",{children:null===V||void 0===V||null===(S=V.tables)||void 0===S?void 0:S.map((e,l)=>{var i;return(0,y.jsx)(o.Fragment,{children:(0,y.jsx)("td",{className:"border fa-13 text-center",children:null===e||void 0===e||null===(i=e.columns)||void 0===i?void 0:i.map((e,l)=>(0,y.jsx)("p",{children:null===e||void 0===e?void 0:e.Column_Name},l))})},l)})})})]})}),(null===V||void 0===V||null===(w=V.tables)||void 0===w?void 0:w.length)>1&&(0,y.jsx)("div",{className:"p-2 cus-grid",children:null===V||void 0===V||null===(k=V.tableJoins)||void 0===k?void 0:k.map((e,l)=>{var i,d,o,n,a,s,t,r;return(0,y.jsxs)("div",{className:" p-2",children:[(0,y.jsxs)("h5",{className:"border-bottom pb-2 text-center",children:["JOIN - ",l+1]}),(0,y.jsx)("div",{className:"p-2 mt-3 border rounded-3 ",children:(0,y.jsx)("table",{className:"w-100",children:(0,y.jsxs)("tbody",{children:[(0,y.jsxs)("tr",{children:[(0,y.jsx)("td",{className:"fa-13 blue-text",children:"Table - 1"}),(0,y.jsx)("td",{className:"fa-13 ",children:(0,y.jsxs)("select",{value:null===e||void 0===e?void 0:e.Join_First_Table_Id,className:"cus-inpt ",onChange:e=>U(e.target.value,l,"Join_First_Table_Id"),required:!0,children:[(0,y.jsx)("option",{value:"",children:"Select"}),null===V||void 0===V||null===(i=V.tables)||void 0===i?void 0:i.map((e,l)=>{var i;return(0,y.jsx)("option",{value:null===e||void 0===e?void 0:e.Table_Id,disabled:null===V||void 0===V||null===(i=V.tableJoins)||void 0===i?void 0:i.find(l=>(0,A.id)(l.Join_First_Table_Id,null===e||void 0===e?void 0:e.Table_Id)),children:null===e||void 0===e?void 0:e.AliasName},l)})]})})]}),(0,y.jsxs)("tr",{children:[(0,y.jsx)("td",{className:"fa-13 blue-text",children:"Table - 2"}),(0,y.jsx)("td",{className:"fa-13 ",children:(0,y.jsxs)("select",{value:null===e||void 0===e?void 0:e.Join_Second_Table_Id,className:"cus-inpt ",onChange:e=>U(e.target.value,l,"Join_Second_Table_Id"),required:!0,children:[(0,y.jsx)("option",{value:"",children:"Select"}),null===V||void 0===V||null===(d=V.tables)||void 0===d?void 0:d.map((l,i)=>(0,y.jsx)("option",{value:null===l||void 0===l?void 0:l.Table_Id,disabled:(0,A.id)(null===e||void 0===e?void 0:e.Join_First_Table_Id,null===l||void 0===l?void 0:l.Table_Id),children:null===l||void 0===l?void 0:l.AliasName},i))]})})]}),(0,y.jsxs)("tr",{children:[(0,y.jsx)("td",{className:"fa-13 blue-text",children:"Table - 1 Key"}),(0,y.jsx)("td",{className:"fa-13 ",children:(0,y.jsxs)("select",{value:null===e||void 0===e?void 0:e.Join_First_Table_Column,className:"cus-inpt ",onChange:e=>U(e.target.value,l,"Join_First_Table_Column"),required:!0,children:[(0,y.jsx)("option",{value:"",children:"Select"}),(null===e||void 0===e?void 0:e.Join_First_Table_Id)&&(null===(o=[...null===V||void 0===V?void 0:V.tables])||void 0===o||null===(n=o.find(l=>(0,A.id)(null===l||void 0===l?void 0:l.Table_Id,null===e||void 0===e?void 0:e.Join_First_Table_Id)))||void 0===n||null===(a=n.columns)||void 0===a?void 0:a.map((e,l)=>(0,A.id)(null===e||void 0===e?void 0:e.IS_Join_Key,1)&&(0,y.jsx)("option",{value:null===e||void 0===e?void 0:e.Column_Name,children:null===e||void 0===e?void 0:e.Column_Name},l)))]})})]}),(0,y.jsxs)("tr",{children:[(0,y.jsx)("td",{className:"fa-13 blue-text",children:"Table - 2 Key"}),(0,y.jsx)("td",{className:"fa-13 ",children:(0,y.jsxs)("select",{value:null===e||void 0===e?void 0:e.Join_Second_Table_Column,className:"cus-inpt ",onChange:e=>U(e.target.value,l,"Join_Second_Table_Column"),required:!0,children:[(0,y.jsx)("option",{value:"",children:"Select"}),(null===e||void 0===e?void 0:e.Join_Second_Table_Id)&&(null===(s=[...null===V||void 0===V?void 0:V.tables])||void 0===s||null===(t=s.find(l=>(0,A.id)(null===l||void 0===l?void 0:l.Table_Id,null===e||void 0===e?void 0:e.Join_Second_Table_Id)))||void 0===t||null===(r=t.columns)||void 0===r?void 0:r.map((e,l)=>(0,A.id)(null===e||void 0===e?void 0:e.IS_Join_Key,1)&&(0,y.jsx)("option",{value:null===e||void 0===e?void 0:e.Column_Name,children:null===e||void 0===e?void 0:e.Column_Name},l)))]})})]})]})})})]},l)})})]}),(0,y.jsxs)(b.A,{children:[(0,y.jsx)(a.A,{onClick:()=>q(e=>(0,d.A)((0,d.A)({},e),{},{previewDialog:!1})),type:"button",startIcon:(0,y.jsx)(_.A,{}),children:"Back"}),(0,y.jsx)(a.A,{type:"submit",startIcon:(0,y.jsx)(p.A,{}),children:"Submit"})]})]})]})]})}}}]);
//# sourceMappingURL=9905.ad38adbe.chunk.js.map