"use strict";(self.webpackChunkerp=self.webpackChunkerp||[]).push([[1384],{63406:(e,l,a)=>{a.d(l,{zU:()=>s,ex:()=>n,MR:()=>o,Ap:()=>i,FX:()=>d});var t=a(89379);const r=a.p+"static/media/smt.aa4d4f940bbebff07a57.png",i={table:{style:{width:"auto",backgroundColor:"transparent"}},rows:{style:{backgroundColor:"transparent"}},headCells:{style:{backgroundColor:"#6b9080f8",color:"white",fontSize:"14px"}}},o={menu:(e,l)=>(0,t.A)((0,t.A)({},e),{},{zIndex:9999}),menuPortal:e=>(0,t.A)((0,t.A)({},e),{},{zIndex:9999}),groupHeading:e=>(0,t.A)((0,t.A)({},e),{},{backgroundColor:"#f5f5f5",color:"#333",fontWeight:"bold",fontSize:"14px",padding:"8px 12px",borderBottom:"1px solid #ddd",textTransform:"uppercase"}),option:(e,l)=>(0,t.A)((0,t.A)({},e),{},{backgroundColor:l.isSelected?"#2684FF":l.isFocused?"#E2ECF9":"white",color:l.isSelected?"white":"#333",padding:"10px 12px"})},s=[{id:1,headname:"Menu ID",variant:"head",align:"left",width:100},{id:2,headname:"MenuName"},{id:3,headname:"Read Rights"},{id:4,headname:"Add Rights"},{id:5,headname:"Edit Rights"},{id:6,headname:"Delete Rights"},{id:7,headname:"Print Rights"},{id:8,headname:"Action"}],n=[{dataBase:1,name:"SHANKAR TRADERS",business:"Wholesale Merchant in Dhall",address:"32, Chitrakara Street, Madurai - 01 <br /> Bill of Supply -Disclaimer Affidavlt Field Extemped",logo:r,gstin:"33AADFS6973R1ZD",phone:"984-313-1353, 984-335-5166",fssai:"12418012000818",bankAccount:"0021 5032 0885 122",ifsc:"TMBL0000002"},{dataBase:2,name:"SMT AGRO PRODUCTS",business:"",address:"H.O: 153, Chitrakara Street, 2nd Floor, Madurai -01 <br /> G.O: 746 Puliyur, Sayanapuram, Svga <br /> Bill of Supply -Disclaimer Affidavlt Field Extemped",logo:r,gstin:"33ACMFS3420Q1ZQ",phone:"0452-4371625",fssai:"12418012000818",bankAccount:"0025 3031 0875 947",ifsc:"TMBL0000002"},{dataBase:3,name:"BHAVANI TRADERS",business:"",address:"H.O: 152-A, Chitrakara Street, Madurai -01 <br /> G.O: 30/1-Rajman Nagar, Chintamani Main Road, Mdu-01 <br /> Tax Invoice",logo:r,gstin:"33AAEFB6728J1ZG",phone:"958-559-7641, 958-559-7614",fssai:"12418012000670",bankAccount:"0021 5005 0800 309",ifsc:"TMBL0000002"}],d=[{name:"PURCHASE_ORDER"},{name:"PURCHASE_INVOICE"},{name:"SALE_ORDER"},{name:"SALE_INVOICE"},{name:"JOURNAL"},{name:"STOCK_JOURNAL"},{name:"PAYMENT"},{name:"RECEIPT"},{name:"CONTRA"}]},68826:(e,l,a)=>{a.r(l),a.d(l,{default:()=>$});var t=a(89379),r=a(65043),i=a(65074),o=a(97707),s=a(67784),n=a(81e3),d=a(63336),c=a(68903),g=a(85865),h=a(11906),A=a(59395),u=a(24056),x=a(79650),m=a(71806),p=a(84882),y=a(28076),j=a(39652),b=a(73460),k=a(31159),v=a(17392),f=a(77739),_=a(30279),N=a(83462),F=a(35316),C=a(29347),T=a(26600),R=a(98533),B=a(59383),D=a(37141),I=a(8737),S=a(692),P=a(91794),w=a(83560),V=a(8846),E=a(20656),L=a(63406),Q=a(91036),z=a(3044),O=a(78218),G=a(33438),M=a(47968),W=a(93141),Y=a(70579);const K=e=>{var l,a,t;let{open:i,onClose:s,brokerData:n,transactionType:d,fromDate:c,toDate:g}=e;const A=(0,r.useRef)(null),u=(0,W.useReactToPrint)({content:()=>A.current}),x=(null===n||void 0===n?void 0:n.Items)||[];let m=0;m="salesNagal"===d?x.reduce((e,l)=>e+parseFloat(l.Brok_Amt||0),0):x.reduce((e,l)=>e+parseFloat(l.Brokerage||0),0);const p=x.reduce((e,l)=>e+parseFloat(l.Coolie_Amt||0),0),y=parseFloat((null===n||void 0===n?void 0:n.Total_Amount)||0),j=parseFloat((null===n||void 0===n?void 0:n.VilaiVasi)||0),b=y-m+p-j,k=Math.round(b),f=k-b,_=(()=>{const e=x.reduce((e,l)=>{const a=Math.round(parseFloat(l.KGS)/parseFloat(l.QTY));return isNaN(a)||(e[a]=(e[a]||0)+parseFloat(l.QTY)),e},{});return e?Object.entries(e).sort((e,l)=>{let[a]=e,[t]=l;return a-t}).map(e=>{let[l,a]=e;return"".concat(l,"kg - ").concat(a)}).join(" & "):null})();return(0,Y.jsx)(Y.Fragment,{children:(0,Y.jsxs)(N.A,{open:i,onClose:s,fullWidth:!0,maxWidth:"lg",children:[(0,Y.jsxs)(T.A,{children:["salesNagal"===d?"Sales Nakal Report":"Delivery Nakal Report"," : ",null===n||void 0===n?void 0:n.Broker_Name,(0,Y.jsx)(v.A,{"aria-label":"close",onClick:s,sx:{position:"absolute",right:8,top:8,color:e=>e.palette.grey[500]},children:(0,Y.jsx)(G.A,{})})]}),(0,Y.jsxs)(F.A,{ref:A,children:["salesNagal"===d?(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsxs)("div",{className:"text-center mb-3",children:[(0,Y.jsx)("h4",{children:"Broker Report Page"}),(0,Y.jsxs)("p",{className:"mb-0",children:["Date: ",null===n||void 0===n||null===(l=n.Items)||void 0===l||null===(a=l[0])||void 0===a?void 0:a.Date]}),(0,Y.jsxs)("p",{className:"mb-0",children:["Broker: ",null===n||void 0===n?void 0:n.Broker_Name]}),_&&(0,Y.jsxs)("p",{className:"mb-0",children:["Pack Sizes: ",_]})]}),(0,Y.jsxs)("table",{className:"table table-bordered",style:{fontSize:"12px"},children:[(0,Y.jsx)("thead",{children:(0,Y.jsxs)("tr",{children:[(0,Y.jsx)("th",{children:"PARTY NAME"}),(0,Y.jsx)("th",{children:"ALIAS NAME"}),(0,Y.jsx)("th",{className:"text-end",children:"BILL RATE"}),(0,Y.jsx)("th",{className:"text-end",children:"BROKER EXP"}),(0,Y.jsx)("th",{className:"text-end",children:"QTY"}),(0,Y.jsx)("th",{className:"text-end",children:"KGS"}),(0,Y.jsx)("th",{className:"text-end",children:"AMOUNT"}),(0,Y.jsx)("th",{className:"text-end",children:"VILAIVAASI"})]})}),(0,Y.jsxs)("tbody",{children:[x.map((e,l)=>(0,Y.jsxs)("tr",{children:[(0,Y.jsx)("td",{children:e.Retailer_Name||e.Ledger_Name}),(0,Y.jsx)("td",{children:e.Short_Name}),(0,Y.jsx)("td",{className:"text-end",children:e.Item_Rate}),(0,Y.jsx)("td",{className:"text-end",children:(0,o.jG)(e.Brok_Amt||0)}),(0,Y.jsx)("td",{className:"text-end",children:e.QTY}),(0,Y.jsx)("td",{className:"text-end",children:e.KGS}),(0,Y.jsx)("td",{className:"text-end",children:(0,o.jG)(e.Amount)}),(0,Y.jsx)("td",{className:"text-end",children:(0,o.jG)(e.Vilaivasi_Rate)})]},l)),(0,Y.jsxs)("tr",{children:[(0,Y.jsx)("td",{colSpan:"4",className:"text-end fw-bold",children:"TOTAL"}),(0,Y.jsx)("td",{className:"text-end fw-bold",children:(null===n||void 0===n?void 0:n.Total_Qty)||0}),(0,Y.jsx)("td",{className:"text-end fw-bold",children:(null===n||void 0===n?void 0:n.Total_KGS)||0}),(0,Y.jsx)("td",{className:"text-end fw-bold",children:(0,o.jG)((null===n||void 0===n?void 0:n.Total_Amount)||0)}),(0,Y.jsx)("td",{className:"text-end fw-bold",children:(0,o.jG)((null===n||void 0===n?void 0:n.VilaiVasi)||0)})]}),(0,Y.jsx)("tr",{children:(0,Y.jsx)("td",{className:"text-end fw-bold",children:_})})]})]}),(0,Y.jsx)("div",{className:"row mt-3",children:(0,Y.jsx)("div",{className:"col-6 offset-6",children:(0,Y.jsx)("table",{className:"table table-bordered",style:{fontSize:"12px"},children:(0,Y.jsxs)("tbody",{children:[(0,Y.jsxs)("tr",{children:[(0,Y.jsx)("td",{className:"fw-bold",children:"COOLIE"}),(0,Y.jsx)("td",{className:"text-end fw-bold",children:(0,o.jG)(p)})]}),(0,Y.jsxs)("tr",{children:[(0,Y.jsx)("td",{className:"fw-bold",children:"BROKERAGE"}),(0,Y.jsxs)("td",{className:"text-end fw-bold",children:["- ",(0,o.jG)(m)]})]}),(0,Y.jsxs)("tr",{children:[(0,Y.jsx)("td",{className:"fw-bold",children:"VILAIVAASI"}),(0,Y.jsxs)("td",{className:"text-end fw-bold",children:["- ",(0,o.jG)(j)]})]}),(0,Y.jsxs)("tr",{children:[(0,Y.jsx)("td",{className:"fw-bold",children:"ROUNDOFF"}),(0,Y.jsx)("td",{className:"text-end fw-bold",children:function(e){const l=Number(e)||0;return"".concat(l>=0?"+":"").concat((0,o.jG)(l))}(f)})]}),(0,Y.jsxs)("tr",{className:"bg-light",children:[(0,Y.jsx)("td",{className:"fw-bold",children:"NET TOTAL"}),(0,Y.jsx)("td",{className:"text-end fw-bold",children:(0,o.jG)(k)})]})]})})})})]}):(0,Y.jsx)(Y.Fragment,{children:(0,Y.jsxs)("div",{style:{fontFamily:"Arial"},children:[(0,Y.jsxs)("div",{style:{textAlign:"center",marginBottom:"20px"},children:[(0,Y.jsx)("h3",{style:{marginBottom:"5px"},children:null===n||void 0===n?void 0:n.Broker_Name}),(0,Y.jsx)("p",{style:{margin:"5px 0"},children:(null===n||void 0===n||null===(t=n.Items)||void 0===t?void 0:t.length)>0?(0,Y.jsxs)(Y.Fragment,{children:[c," "," TO "," ",g]}):"No date range available"})]}),(0,Y.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"12px"},children:[(0,Y.jsx)("thead",{children:(0,Y.jsxs)("tr",{style:{borderBottom:"1px solid #000"},children:[(0,Y.jsx)("th",{style:{textAlign:"left",padding:"5px",width:"40%"},children:"NAME"}),(0,Y.jsx)("th",{style:{textAlign:"left",padding:"5px",width:"10%"},children:"DATE"}),(0,Y.jsx)("th",{style:{textAlign:"left",padding:"5px",width:"20%"},children:"ALIAS NAME"}),(0,Y.jsx)("th",{style:{textAlign:"right",padding:"5px",width:"10%"},children:"BAGS"}),(0,Y.jsx)("th",{style:{textAlign:"right",padding:"5px",width:"10%"},children:"QTY"}),"sales"===d?(0,Y.jsx)("th",{style:{textAlign:"right",padding:"5px",width:"10%"},children:"AMOUNT"}):"","sales"===d?(0,Y.jsx)("th",{style:{textAlign:"right",padding:"5px",width:"10%"},children:"ITEM.RATE"}):"",(0,Y.jsx)("th",{style:{textAlign:"right",padding:"5px",width:"10%"},children:"BROKERAGE EXP"})]})}),(0,Y.jsxs)("tbody",{children:[x.map((e,l)=>{var a;return(0,Y.jsxs)("tr",{style:{borderBottom:"1px solid #ddd"},children:[(0,Y.jsx)("td",{style:{padding:"5px"},children:e.Retailer_Name||e.Ledger_Name}),(0,Y.jsx)("td",{style:{padding:"5px"},children:(null===(a=e.Date)||void 0===a?void 0:a.split("T")[0])||""}),(0,Y.jsx)("td",{style:{padding:"5px"},children:e.Short_Name}),(0,Y.jsx)("td",{style:{padding:"5px",textAlign:"right"},children:e.QTY}),(0,Y.jsx)("td",{style:{padding:"5px",textAlign:"right"},children:e.KGS}),"sales"===d?(0,Y.jsx)("td",{style:{padding:"5px",textAlign:"right"},children:e.TotaL_Invoice_value}):"","sales"===d?(0,Y.jsx)("td",{style:{padding:"5px",textAlign:"right"},children:e.Item_Rate}):"",(0,Y.jsx)("td",{style:{padding:"5px",textAlign:"right"},children:(0,o.jG)(e.Brokerage||0)})]},l)}),(0,Y.jsxs)("tr",{style:{fontWeight:"bold",borderTop:"2px solid #000"},children:[(0,Y.jsx)("td",{colSpan:"3",style:{padding:"5px",textAlign:"right"},children:"TOTAL"}),(0,Y.jsx)("td",{style:{padding:"5px",textAlign:"right"},children:(null===n||void 0===n?void 0:n.Total_Qty)||0}),(0,Y.jsx)("td",{style:{padding:"5px",textAlign:"right"},children:(null===n||void 0===n?void 0:n.Total_KGS)||0}),(0,Y.jsx)("td",{style:{padding:"5px",textAlign:"right"},children:(0,o.jG)(m)})]})]})]})]})}),(0,Y.jsx)("div",{className:"text-center mt-3 small",children:(0,Y.jsx)("p",{children:"This is a computer generated report"})})]}),(0,Y.jsxs)(C.A,{children:[(0,Y.jsx)(h.A,{startIcon:(0,Y.jsx)(G.A,{}),variant:"outlined",color:"error",onClick:s,children:"Close"}),(0,Y.jsx)(h.A,{startIcon:(0,Y.jsx)(M.A,{}),variant:"contained",color:"primary",onClick:u,children:"Download"})]})]})})};var U=a(69223),Z=a.n(U),H=a(72450);const X=e=>{let{open:l,onClose:a,brokerData:i,transactionType:o,fromDate:s,toDate:n}=e;const d=(null===i||void 0===i?void 0:i.Items)||[];let c;c="salesNagal"===o?d.reduce((e,l)=>e+parseFloat(l.Brok_Amt||0),0):d.reduce((e,l)=>e+parseInt(l.Brokerage||0),0);const g=d.reduce((e,l)=>e+parseFloat(l.Coolie_Amt||0),0),h=parseFloat((null===i||void 0===i?void 0:i.Total_Amount)||0),A=parseFloat((null===i||void 0===i?void 0:i.VilaiVasi)||0),u=h-c+g-A,x=Math.round(u),m=x-u,p=e=>{const l=Number(e)||0;return(l>=0?"+":"")+l.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})},y=()=>{const e=d.reduce((e,l)=>{const a=Math.round(parseFloat(l.KGS)/parseFloat(l.QTY));return isNaN(a)||(e[a]=(e[a]||0)+parseFloat(l.QTY)),e},{});return Object.entries(e).sort((e,l)=>{let[a]=e,[t]=l;return a-t}).map(e=>{let[l,a]=e;return"".concat(l,"kg - ").concat(a)}).join(" & ")},j=async()=>{try{var e;const l=new(Z().Workbook),a=l.addWorksheet("Brokerage Report");l.created=new Date,l.modified=new Date;const t=a.addRow([(null===i||void 0===i?void 0:i.Broker_Name)||""]);t.font={bold:!0,size:14},t.alignment={horizontal:"center"},a.mergeCells("A1:F1");const r=a.addRow([(null===i||void 0===i||null===(e=i.Items)||void 0===e?void 0:e.length)>0?"".concat(s," TO ").concat(n):"No date range available"]);r.font={bold:!0},r.alignment={horizontal:"center"},a.mergeCells("A2:F2"),a.addRow([]);const g=[{header:"NAME",width:50},{header:"DATE",width:10},{header:"ALIAS NAME",width:40},{header:"BAGS",width:10},{header:"QTY",width:10},..."sales"===o?[{header:"Item_Rate",width:10}]:[],{header:"BROKERAGE EXP",width:15}];a.addRow(g.map(e=>e.header)).eachCell(e=>{e.font={bold:!0},e.border={top:{style:"thin",color:{argb:"FF000000"}},left:{style:"thin",color:{argb:"FF000000"}},bottom:{style:"thin",color:{argb:"FF000000"}},right:{style:"thin",color:{argb:"FF000000"}}}}),g.forEach((e,l)=>{a.getColumn(l+1).width=e.width}),d.forEach(e=>{var l;const t=a.addRow([e.Retailer_Name||e.Ledger_Name,(null===(l=e.Date)||void 0===l?void 0:l.split("T")[0])||"",e.Short_Name,e.QTY,e.KGS,..."sales"===o?[e.Item_Rate]:[],Number(e.Brokerage||0)]);t.eachCell(e=>{e.font={bold:!0},e.border={top:{style:"thin",color:{argb:"FF000000"}},left:{style:"thin",color:{argb:"FF000000"}},bottom:{style:"thin",color:{argb:"FF000000"}},right:{style:"thin",color:{argb:"FF000000"}}}}),t.getCell(4).alignment={horizontal:"right"},t.getCell(5).alignment={horizontal:"right"},t.getCell(6).alignment={horizontal:"right"}});const h=a.addRow(["","","TOTAL",Number(null===i||void 0===i?void 0:i.Total_Qty)||0,Number(null===i||void 0===i?void 0:i.Total_KGS)||0,c]);h.eachCell(e=>{e.font={bold:!0},e.border={top:{style:"medium",color:{argb:"FF000000"}},left:{style:"thin",color:{argb:"FF000000"}},bottom:{style:"thin",color:{argb:"FF000000"}},right:{style:"thin",color:{argb:"FF000000"}}}}),h.getCell(4).alignment={horizontal:"right"},h.getCell(5).alignment={horizontal:"right"},h.getCell(6).alignment={horizontal:"right"};const A=await l.xlsx.writeBuffer(),u=new Blob([A],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),x=URL.createObjectURL(u),m=document.createElement("a");m.href=x,m.download="".concat(null===i||void 0===i?void 0:i.Broker_Name,"_").concat(s,"_to_").concat(n,".xlsx"),m.click(),setTimeout(()=>{URL.revokeObjectURL(x)},100)}catch(l){console.error("Error exporting to Excel:",l)}};return(0,r.useEffect)(()=>{l&&("salesNagal"===o?(async()=>{var e,l,a,r;const o=new(Z().Workbook),s=o.addWorksheet("Broker Report"),n={style:"thick",color:{argb:"FF000000"}},h={border:{top:n,bottom:n,left:n,right:n}},u=s.addRow(["Broker Report: ".concat((null===i||void 0===i?void 0:i.Broker_Name)||""," - Date: ").concat(null===i||void 0===i||null===(e=i.Items)||void 0===e||null===(l=e[0])||void 0===l?void 0:l.Date)]);s.mergeCells("A".concat(u.number,":H").concat(u.number)),u.eachCell(e=>{e.style=(0,t.A)((0,t.A)({},h),{},{font:{bold:!0,size:14},alignment:{horizontal:"center"},fill:{type:"pattern",pattern:"solid",fgColor:{argb:"FFD9D9D9"}}})}),s.addRow([]);const j=s.addRow(["PARTY NAME","ALIAS NAME","BILL RATE","BROKER EXP","QTY","KGS","AMOUNT","VILAIVAASI"]);s.columns=[{width:50},{width:30},{width:15},{width:15},{width:10},{width:10},{width:15},{width:15}],j.eachCell(e=>{e.style=(0,t.A)((0,t.A)({},h),{},{font:{bold:!0,color:{argb:"FFFFFFFF"},size:12},fill:{type:"pattern",pattern:"solid",fgColor:{argb:"FF2F5496"}},alignment:{horizontal:"center",vertical:"middle"}})}),d.forEach((e,l)=>{const a=s.addRow([e.Retailer_Name||e.Ledger_Name||"",e.Short_Name||"",e.Item_Rate||"",e.Brok_Amt||"",e.QTY||"",e.KGS||"",Number(e.Amount||0),Number(e.Vilaivasi_Rate||0)]);a.eachCell(e=>{e.style=(0,t.A)((0,t.A)({},h),{},{font:{size:11},alignment:{vertical:"middle"},fill:l%2===1?{type:"pattern",pattern:"solid",fgColor:{argb:"FFF2F2F2"}}:void 0})}),a.getCell(7).numFmt="#,##0.00",a.getCell(8).numFmt="#,##0.00"}),s.addRow(["","","","TOTAL",Number((null===i||void 0===i?void 0:i.Total_Qty)||0),Number((null===i||void 0===i?void 0:i.Total_KGS)||0),Number((null===i||void 0===i?void 0:i.Total_Amount)||0),Number((null===i||void 0===i?void 0:i.VilaiVasi)||0)]).eachCell((e,l)=>{l>=4?(e.style=(0,t.A)((0,t.A)({},h),{},{font:{bold:!0,color:{argb:"FFFFFFFF"}},fill:{type:"pattern",pattern:"solid",fgColor:{argb:"FF70AD47"}}}),l>=5&&(e.numFmt=5===l||6===l?"0.00":"#,##0.00")):e.style=h}),s.addRow([]);const b=s.addRow(["Pack Sizes: ".concat(y())]);s.mergeCells("A".concat(b.number,":H").concat(b.number)),b.eachCell(e=>{e.style=(0,t.A)((0,t.A)({},h),{},{font:{italic:!0},alignment:{horizontal:"left"}})}),s.addRow([]),[{label:"COOLIE",value:Number(g)},{label:"BROKERAGE",value:Number(-c)},{label:"VILAIVAASI",value:Number(-A)},{label:"ROUNDOFF",value:p(m)},{label:"NET TOTAL",value:Number(x)}].forEach(e=>{const l=s.addRow(["","","","","",e.label,e.value,""]);l.getCell(6).style=(0,t.A)((0,t.A)({},h),{},{font:{bold:!0,color:{argb:"FFFFFFFF"}},fill:{type:"pattern",pattern:"solid",fgColor:{argb:"FF4472C4"}},alignment:{horizontal:"right"}}),l.getCell(7).style=(0,t.A)((0,t.A)({},h),{},{font:{bold:!0,color:{argb:"FF000000"}},fill:{type:"pattern",pattern:"solid",fgColor:{argb:"FFFFC000"}},alignment:{horizontal:"right"},numFmt:"#,##0.00"})}),s.addRow([]),s.addRow([]);const k=await o.xlsx.writeBuffer();(0,H.saveAs)(new Blob([k]),"Broker_Report_".concat((null===i||void 0===i?void 0:i.Broker_Name)||"Export","_").concat(null===i||void 0===i||null===(a=i.Items)||void 0===a||null===(r=a[0])||void 0===r?void 0:r.Date,".xlsx"))})().then(()=>{"function"===typeof a&&a()}):("purchase"===o||"sales"===o)&&j().then(()=>{"function"===typeof a&&a()}))},[l,o]),null};var J=a(51387);const $=e=>{let{loadingOn:l,loadingOff:a}=e;const[G,M]=(0,r.useState)("salesNagal"),[W,U]=(0,r.useState)({page:0,rowsPerPage:10}),[Z,H]=(0,r.useState)({page:0,rowsPerPage:10}),[$,q]=(0,r.useState)(0),[ee,le]=(0,r.useState)({broker:[]}),[ae,te]=(0,r.useState)({deliveryReport:[],brokerageValues:{},filters:{FromDate:(new Date).toISOString().split("T")[0],ToDate:(new Date).toISOString().split("T")[0],Broker:{value:"",label:"ALL Brokers"},refresh:!1,filterDialog:!1},headerVilaiVasi:""}),[re,ie]=(0,r.useState)({deliveryReport:[],brokerageValues:{},filters:{FromDate:(new Date).toISOString().split("T")[0],ToDate:(new Date).toISOString().split("T")[0],Broker:{value:"",label:"ALL Brokers"},refresh:!1,filterDialog:!1},headerVilaiVasi:""}),[oe,se]=(0,r.useState)({deliveryReport:[],brokerageValues:{},filters:{FromDate:(new Date).toISOString().split("T")[0],ToDate:(new Date).toISOString().split("T")[0],Broker:{value:"",label:"ALL Brokers"},refresh:!1,filterDialog:!1},headerBrokerage:""}),[ne,de]=(0,r.useState)({FromDate:(new Date).toISOString().split("T")[0],ToDate:(new Date).toISOString().split("T")[0],Broker:{value:"",label:"ALL Brokers"},Ledger:{value:"",label:"All Ledger"},Item:{value:"",label:"All Item"},VilaiVasiZero:{value:"",label:"All"},refresh:!1,filterDialog:!1}),[ce,ge]=(0,r.useState)([]),[he,Ae]=(0,r.useState)({ledgers:[],items:[]}),[ue,xe]=(0,r.useState)({}),[me,pe]=(0,r.useState)(!1),ye=JSON.parse(localStorage.getItem("user")),[je,be]=(0,r.useState)(!1),[ke,ve]=(0,r.useState)(!1),[fe,_e]=(0,r.useState)(null),[Ne,Fe]=(0,r.useState)(null),[Ce,Te]=(0,r.useState)(null),[Re,Be]=(0,r.useState)(!1),[De,Ie]=(0,r.useState)(!1),[Se,Pe]=(0,r.useState)(null),[we,Ve]=(0,r.useState)(null),[Ee,Le]=(0,r.useState)(!1),Qe="salesNagal"===G?ae:"sales"===G?re:oe,ze="salesNagal"===G?te:"sales"===G?ie:se;(0,r.useEffect)(()=>{(0,i.z)({address:"reports/brokerageReport/getInvolvedBroker"}).then(e=>{e.success&&le(l=>(0,t.A)((0,t.A)({},l),{},{broker:(0,o.$r)(e.data)}))}).catch(console.error)},[]),(0,r.useEffect)(()=>{(async()=>{try{l();const e="salesNagal"===G?"brokerageNakalReport/sales":"sales"===G?"brokerageNakalReport/salesEntry":"brokerageNakalReport/purchase",a=await(0,i.z)({address:"reports/".concat(e,"?FromDate=").concat(Qe.filters.FromDate,"&ToDate=").concat(Qe.filters.ToDate,"&broker=").concat(Qe.filters.Broker.value)});if(a.success){const e=(0,o.$r)(a.data),l={};e.forEach(e=>{const a="".concat(e.Do_Id,"-").concat(e.Product_Id);l[a]=e.brokerage||""}),ze(a=>(0,t.A)((0,t.A)({},a),{},{deliveryReport:e,brokerageValues:l}))}else ze(e=>(0,t.A)((0,t.A)({},e),{},{deliveryReport:[],brokerageValues:{}}))}catch(e){console.error(e),ze(e=>(0,t.A)((0,t.A)({},e),{},{deliveryReport:[],brokerageValues:{}}))}finally{a()}})()},[G,Qe.filters.refresh]);const Oe={salesNagal:{dataEntryColumns:[{label:"Date",key:"Date",align:"left",render:e=>{var l;return(null===(l=e.Date)||void 0===l?void 0:l.split("T")[0])||"N/A"}},{label:"Do No",key:"Do_Inv_No"},{label:"Product",key:"Product_Name"},{label:"Ledger_Name",key:"Retailer_Name"},{label:"Broker",key:"CostCenterGet"},{label:"Act_Qty",key:"Act_Qty",align:"right"},{label:"Qty",key:"displayQuantity",align:"right"},{label:"Rate",key:"Rate",align:"right",render:e=>e.Rate||e.Item_Rate},{label:"Pack",key:"Pack",align:"right"},{label:"Amount",key:"Amount",align:"right"},{label:"Brok.Rate",key:"Brokerage",align:"right",render:(e,l,a)=>(0,Y.jsx)(s.A,{size:"small",type:"number",value:e.Brokerage,onChange:e=>a(l,"Brokerage",e.target.value),sx:{width:"80px"},inputProps:{step:"0.01"}})},{label:"Brokerage",key:"BrokerageAmount",align:"right",render:e=>(e.Brokerage*e.displayQuantity).toFixed(2)},{label:"Coolie.Rate",key:"Coolie",align:"right",render:(e,l,a)=>(0,Y.jsx)(s.A,{size:"small",type:"number",value:e.Coolie,onChange:e=>a(l,"Coolie",e.target.value),sx:{width:"80px"},inputProps:{step:"0.01"}})},{label:"Coolie.Amt",key:"CoolieAmount",align:"right",render:e=>(e.Coolie*e.displayQuantity).toFixed(2)},{label:"VilaiVasi",key:"VilaiVasi",align:"right",render:(e,l,a,t,r)=>(0,Y.jsx)(s.A,{size:"small",type:"number",value:t,onChange:r(e.Do_Id,e.Product_Id),sx:{width:"120px"},inputProps:{step:"0.01"}})},{label:"Narration",key:"Narration",align:"right"},{label:"Vilai Amt",key:"VilaiAmt",align:"right",render:(e,l,a,t,r,i)=>(+i(t,e.Act_Qty)).toFixed(2)}],listingColumns:[{label:"Broker",key:"Broker_Name"},{label:"Total KGS",key:"Total_KGS",align:"right"},{label:"Total Bill Qty",key:"Total_Qty",align:"right"},{label:"Total_Amount",key:"Total_Amount",align:"right"},{label:"Total_Broker_Exp",key:"Broker_Exp",align:"right"},{label:"Total_VilaiVasi",key:"VilaiVasi",align:"right"},{label:"Total_Bags",key:"Total_Bags",align:"right"}]},sales:{dataEntryColumns:[{label:"Date",key:"Date",align:"left",render:e=>{var l;return(null===(l=e.Date)||void 0===l?void 0:l.split("T")[0])||"N/A"}},{label:"Do No",key:"Do_Inv_No"},{label:"Product",key:"Product_Name"},{label:"Ledger_Name",key:"Retailer_Name"},{label:"Broker",key:"CostCenterGet"},{label:"Act_Qty",key:"Act_Qty",align:"right"},{label:"Qty",key:"displayQuantity",align:"right"},{label:"Rate",key:"Rate",align:"right",render:e=>e.Rate||e.Item_Rate},{label:"Pack",key:"Pack",align:"right"},{label:"Amount",key:"Amount",align:"right"},{label:"Brokerage",key:"Brokerage",align:"right",render:(e,l,a,t,r)=>(0,Y.jsx)(s.A,{size:"small",type:"number",value:t,onChange:r(e.Do_Id,e.Product_Id),sx:{width:"120px"},inputProps:{step:"0.01"}})},{label:"Brokerage Amt",key:"BrokerageAmount",align:"right",render:(e,l,a,t)=>((parseFloat(t)||0)*(parseFloat(e.Act_Qty)||0)/100).toFixed(2)}],listingColumns:[{label:"Broker",key:"Broker_Name"},{label:"Total KGS",key:"Total_KGS",align:"right"},{label:"Total Bill Qty",key:"Total_Qty",align:"right"},{label:"Total_Amount",key:"Total_Amount",align:"right"},{label:"Total_Broker_Exp",key:"Broker_Exp",align:"right"},{label:"Total_Bags",key:"Total_Bags",align:"right"}]},purchase:{dataEntryColumns:[{label:"Date",key:"Date",align:"left",render:e=>{var l;return(null===(l=e.Po_Entry_Date)||void 0===l?void 0:l.split("T")[0])||"N/A"}},{label:"Invoice No",key:"Po_Inv_No"},{label:"Retailer",key:"Retailer_Name"},{label:"Broker",key:"CostCenterGet",align:"right"},{label:"Product",key:"Product_Name"},{label:"Act_Qty",key:"Act_Qty",align:"right"},{label:"Pack",key:"Pack",align:"right"},{label:"Qty",key:"displayQuantity",align:"right",render:e=>Number(e.displayQuantity).toFixed(2)},{label:"Rate",key:"Item_Rate",align:"right"},{label:"Amount",key:"Total_Invoice_value",align:"right"},{label:"Brokerage",key:"Brokerage",align:"right",render:(e,l,a,t,r)=>(0,Y.jsx)(s.A,{size:"small",type:"number",value:t,onChange:r(e.Do_Id,e.Product_Id,e.PIN_Id),sx:{width:"120px"},inputProps:{step:"0.01"}})},{label:"Brokerage Amt",key:"BrokerageAmount",align:"right",render:(e,l,a,t)=>((parseFloat(t)||0)*(parseFloat(e.Act_Qty)||0)/100).toFixed(2)}],listingColumns:[{label:"Supplier",key:"Supplier_Name"},{label:"Total KGS",key:"Total_KGS",align:"right"},{label:"Total Bill Qty",key:"Total_Qty",align:"right"},{label:"Total_Amount",key:"Total_Amount",align:"right"},{label:"Total_Broker_Exp",key:"Broker_Exp",align:"right"},{label:"Total_Bags",key:"Total_Bags",align:"right"}]}};(0,r.useEffect)(()=>{(async()=>{try{l();let e="";"salesNagal"===G?e="reports/brokerageNagal/list?FromDate=".concat(ne.FromDate,"&ToDate=").concat(ne.ToDate):"purchase"===G?e="reports/brokerageNagalDelivery/list?FromDate=".concat(ne.FromDate,"&ToDate=").concat(ne.ToDate):"sales"===G&&(e="reports//brokerageNagalSales/list?FromDate=".concat(ne.FromDate,"&ToDate=").concat(ne.ToDate)),ne.Broker.value&&(e+="&broker=".concat(ne.Broker.value)),ne.Ledger.value&&(e+="&ledger=".concat(ne.Ledger.value)),ne.Item.value&&(e+="&item=".concat(ne.Item.value)),ne.VilaiVasiZero.value&&(e+="&vilaivasiFilter=".concat(ne.VilaiVasiZero.value));const a=await(0,i.z)({address:e});if(a.success){const e=(0,o.$r)(a.data);ge(e);const l=e.flatMap(e=>e.Items||[]),t=Array.from(new Map(l.map(e=>[e.Ledger_Tally_Id,{value:e.Ledger_Tally_Id,label:e.Ledger_Name}])).values()),r=Array.from(new Map(l.map(e=>[e.Product_Id,{value:e.Product_Id,label:e.Product_Name}])).values());Ae({ledgers:t,items:r})}}catch(e){console.error(e)}finally{a()}})()},[ne.refresh,G]);const Ge=async()=>{try{l();const e=(0,t.A)((0,t.A)({},Ce),{},{TransactionType:G,Updated_By:null===ye||void 0===ye?void 0:ye.UserId});console.log("w",Ce),"salesNagal"===G?(e.Brok_Amt=(parseFloat(Ce.Brok_Rate)||0)*(parseFloat(Ce.QTY)||0),e.Coolie_Amt=(parseFloat(Ce.Coolie_Rate)||0)*(parseFloat(Ce.QTY)||0),e.Vilai_Vasi=parseFloat(Ce.Vilai_Vasi)||0,e.Vilaivasi_Rate=(parseFloat(Ce.Vilai_Vasi)||0)*(parseFloat(Ce.QTY)||0)/100):"sales"!==G&&"purchase"!==G||(e.Brokerage_Amt=(parseFloat(Ce.Brokerage)||0)*(parseFloat(Ce.Act_Qty)||0)/100,e.Brokerage=parseFloat(null===Ce||void 0===Ce?void 0:Ce.Act_Qty)/100*Ce.Brokerage_Amt);const a=await(0,i.z)({address:"reports/brokerageNagalPurchase/list",method:"PUT",bodyData:e,headers:{"Content-Type":"application/json"}});a.success?(Q.oR.success("Item updated successfully!"),de(e=>(0,t.A)((0,t.A)({},e),{},{refresh:!e.refresh})),Te(null)):Q.oR.error(a.message||"Update failed")}catch(e){Q.oR.error("Update failed due to an error")}finally{a()}},Me=(e,l,a)=>r=>{const i=r.target.value,o="salesNagal"===G||"sales"===G?"".concat(e,"-").concat(l):"".concat(a,"-").concat(l);ze(e=>(0,t.A)((0,t.A)({},e),{},{brokerageValues:(0,t.A)((0,t.A)({},e.brokerageValues),{},{[o]:i})}))},We=()=>ze(e=>(0,t.A)((0,t.A)({},e),{},{filters:(0,t.A)((0,t.A)({},e.filters),{},{filterDialog:!1})})),Ye=()=>de(e=>(0,t.A)((0,t.A)({},e),{},{filterDialog:!1})),Ke=(e,l,a)=>{const r=[...Qe.deliveryReport];r[e][l]=parseFloat(a)||0,ze(e=>(0,t.A)((0,t.A)({},e),{},{deliveryReport:r}))},Ue=e=>{M(e),U({page:0,rowsPerPage:10})},Ze=(0,r.useMemo)(()=>Qe.deliveryReport.reduce((e,l)=>(0,o.Lr)(e,l.displayQuantity||l.Qty||0),0),[Qe.deliveryReport]),He=(0,r.useMemo)(()=>ce.reduce((e,l)=>(0,o.Lr)(e,l.Total_Bags||0),0),[ce]),Xe=(e,l)=>(parseFloat(e)||0)/100*(parseFloat(l)||0),Je=(0,r.useMemo)(()=>ce&&0!==ce.length?ce.reduce((e,l)=>{const a=l.Broker_Name||l.Supplier_Name||"Unknown";return e[a]||(e[a]=[]),e[a].push(l),e},{}):{},[ce]),$e=(0,r.useMemo)(()=>Object.keys(Je),[Je]),qe=(e,l)=>!!e&&(e.Product_Id===l.Product_Id&&e.Do_Inv_No===l.Do_Inv_No&&(e.Ledger_Tally_Id?e.Ledger_Tally_Id===l.Ledger_Tally_Id:e.Ledger_Name===l.Ledger_Name));return(0,Y.jsxs)(n.A,{children:[(0,Y.jsxs)(d.A,{sx:{p:3,mb:3},children:[(0,Y.jsxs)(c.Ay,{container:!0,justifyContent:"space-between",alignItems:"center",mb:3,children:[(0,Y.jsx)(g.A,{variant:"h5",component:"h2",children:"Brokerage Nagal Report"}),(0,Y.jsxs)(n.A,{display:"flex",alignItems:"center",gap:2,children:[(0,Y.jsxs)(n.A,{display:"flex",gap:1,children:[(0,Y.jsx)(h.A,{variant:"salesNagal"===G?"contained":"outlined",onClick:()=>Ue("salesNagal"),children:"SalesNagal"}),(0,Y.jsx)(h.A,{variant:"purchase"===G?"contained":"outlined",onClick:()=>Ue("purchase"),children:"Purchase"}),(0,Y.jsx)(h.A,{variant:"sales"===G?"contained":"outlined",onClick:()=>Ue("sales"),children:"Sales"})]}),(0,Y.jsx)(h.A,{variant:"outlined",startIcon:(0,Y.jsx)(B.A,{}),onClick:()=>{0===$?ze(e=>(0,t.A)((0,t.A)({},e),{},{filters:(0,t.A)((0,t.A)({},e.filters),{},{filterDialog:!0})})):de(e=>(0,t.A)((0,t.A)({},e),{},{filterDialog:!0}))},children:"Filters"}),(0,Y.jsxs)(g.A,{component:"span",variant:"body1",children:["Total Bags:"," ",(0,Y.jsx)("strong",{children:0===$?Ze:He})]})]})]}),(0,Y.jsxs)(A.A,{value:$,onChange:(e,l)=>q(l),sx:{mb:3},children:[(0,Y.jsx)(u.A,{label:"Data Entry"}),(0,Y.jsx)(u.A,{label:"Listing"})]}),0===$&&(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsxs)(n.A,{mb:1,sx:{display:"flex",justifyContent:"flex-end",alignItems:"center",gap:2},children:[(0,Y.jsx)(g.A,{sx:{fontWeight:"bold"},children:"salesNagal"===G?"VilaiVasi (All):":"Brokerage (All):"}),(0,Y.jsx)(s.A,{type:"number",size:"small",value:Qe.headerVilaiVasi,inputProps:{step:"1"},onChange:e=>{const l=e.target.value;ze(e=>{const a=(0,t.A)({},e.brokerageValues);return e.deliveryReport.forEach(e=>{const t="salesNagal"===G||"sales"===G?"".concat(e.Do_Id,"-").concat(e.Product_Id):"".concat(e.PIN_Id,"-").concat(e.Product_Id);a[t]=l}),(0,t.A)((0,t.A)({},e),{},{headerVilaiVasi:l,brokerageValues:a})})},placeholder:"Set ".concat("salesNagal"===G?"VilaiVasi":"Brokerage"," for all"),sx:{"& .MuiInputBase-input":{height:40,boxSizing:"border-box"}}}),(0,Y.jsx)(h.A,{variant:"outlined",size:"small",onClick:()=>{ze(e=>{const l=(0,t.A)({},e.brokerageValues);return e.deliveryReport.forEach(e=>{const a="salesNagal"===G||"sales"===G?"".concat(e.Do_Id,"-").concat(e.Product_Id):"".concat(e.PIN_Id,"-").concat(e.Product_Id);l[a]=""}),(0,t.A)((0,t.A)({},e),{},{headerVilaiVasi:"",brokerageValues:l})})},children:"Clear All"})]}),(0,Y.jsxs)(x.A,{component:d.A,children:[(0,Y.jsxs)(m.A,{size:"small",children:[(0,Y.jsx)(p.A,{children:(0,Y.jsx)(y.A,{sx:{backgroundColor:"primary.main"},children:Oe[G].dataEntryColumns.map(e=>(0,Y.jsx)(j.A,{sx:{color:"white",fontWeight:"bold"},align:e.align||"left",children:e.label},e.key))})}),(0,Y.jsx)(b.A,{children:Qe.deliveryReport.length>0?Qe.deliveryReport.slice(W.page*W.rowsPerPage,W.page*W.rowsPerPage+W.rowsPerPage).map((e,l)=>{const a=Qe.brokerageValues["salesNagal"===G||"sales"===G?"".concat(e.Do_Id,"-").concat(e.Product_Id):"".concat(e.PIN_Id,"-").concat(e.Product_Id)]||"";return(0,Y.jsx)(y.A,{hover:!0,children:Oe[G].dataEntryColumns.map(t=>(0,Y.jsx)(j.A,{align:t.align||"left",children:t.render?t.render(e,l,Ke,a,Me,Xe):e[t.key]},t.key))},l)}):(0,Y.jsx)(y.A,{children:(0,Y.jsx)(j.A,{colSpan:Oe[G].dataEntryColumns.length,align:"center",children:"No data found"})})})]}),(0,Y.jsx)(k.A,{rowsPerPageOptions:[10,25,50,100],component:"div",count:Qe.deliveryReport.length,rowsPerPage:W.rowsPerPage,page:W.page,onPageChange:(e,l)=>U((0,t.A)((0,t.A)({},W),{},{page:l})),onRowsPerPageChange:e=>U({page:0,rowsPerPage:parseInt(e.target.value,10)})})]}),(0,Y.jsx)(n.A,{sx:{mt:3,display:"flex",justifyContent:"flex-end"},children:(0,Y.jsx)(h.A,{variant:"contained",color:"primary",startIcon:(0,Y.jsx)(D.A,{}),onClick:async()=>{l();try{pe(!0);const e=Qe.deliveryReport.map(e=>{const l="salesNagal"===G||"sales"===G?"".concat(e.Do_Id,"-").concat(e.Product_Id):"".concat(e.PIN_Id,"-").concat(e.Product_Id),a=Qe.brokerageValues[l]||e.Brokerage||0;return"salesNagal"===G?(0,t.A)((0,t.A)({},e),{},{brokerage:parseFloat(a)||0,Vilai_Vasi:parseFloat(a)||0,Vilaivasi_Rate:(parseFloat(a)||0)/100*(parseFloat(e.Act_Qty)||0),Brok_Rate:(null===e||void 0===e?void 0:e.Brokerage)||0,Brok_Amt:((null===e||void 0===e?void 0:e.Brokerage)||0)*((null===e||void 0===e?void 0:e.displayQuantity)||0),Coolie_Rate:(null===e||void 0===e?void 0:e.Coolie)||0,Coolie_Amt:((null===e||void 0===e?void 0:e.Coolie)||0)*((null===e||void 0===e?void 0:e.displayQuantity)||0),Amount:(null===e||void 0===e?void 0:e.Amount)||0,Created_By:null===ye||void 0===ye?void 0:ye.UserId}):(0,t.A)((0,t.A)({},e),{},{brokerage:(parseFloat(a)||0)*(parseFloat(e.Act_Qty)||0)/100,Created_By:null===ye||void 0===ye?void 0:ye.UserId})});let l;l="salesNagal"===G?"reports/brokerageNagal/create":"sales"===G?"reports/brokerageNagal/createSales":"reports/brokerageNakal/deliveryCreate";const a=await(0,i.z)({address:l,method:"POST",bodyData:e,headers:{"Content-Type":"application/json"}});if(a.success){let e;e="salesNagal"===G?"Sales Nagal created successfully!":"sales"===G?"Sales brokerage created successfully!":"Purchase nakal created successfully!",Q.oR.success(e),ze(e=>(0,t.A)((0,t.A)({},e),{},{filters:(0,t.A)((0,t.A)({},e.filters),{},{refresh:!e.filters.refresh})}))}else Q.oR.error(a.message||"Save operation failed")}catch(e){console.error("Save error:",e),Q.oR.error("Save failed due to an error")}finally{pe(!1),a()}},disabled:me,size:"large",children:me?"Saving...":"Save ".concat("salesNagal"===G?"sales"===G?"Sales":"Purchase":"Sales Nagal"," Brokerage")})})]}),1===$&&(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(n.A,{sx:{mb:2,display:"flex",justifyContent:"flex-end"},children:(0,Y.jsx)(h.A,{variant:"outlined",color:"error",startIcon:(0,Y.jsx)(J.A,{}),onClick:()=>Le(!0),disabled:0===ce.length,children:"Delete All"})}),(0,Y.jsxs)(x.A,{component:d.A,children:[(0,Y.jsxs)(m.A,{size:"small",children:[(0,Y.jsx)(p.A,{children:(0,Y.jsxs)(y.A,{sx:{backgroundColor:"primary.main"},children:[Oe[G].listingColumns.map(e=>(0,Y.jsx)(j.A,{sx:{color:"white",fontWeight:"bold"},align:e.align||"left",children:e.label},e.key)),(0,Y.jsx)(j.A,{sx:{color:"white",fontWeight:"bold"},align:"right",children:"Actions"})]})}),(0,Y.jsx)(b.A,{children:$e.length>0?$e.slice(Z.page*Z.rowsPerPage,Z.page*Z.rowsPerPage+Z.rowsPerPage).map((e,l)=>{const a=Je[e][0];return(0,Y.jsxs)(r.Fragment,{children:[(0,Y.jsxs)(y.A,{hover:!0,children:[(0,Y.jsxs)(j.A,{children:[(0,Y.jsx)(v.A,{size:"small",onClick:()=>(e=>xe(l=>(0,t.A)((0,t.A)({},l),{},{[e]:!l[e]})))(e),children:ue[e]?(0,Y.jsx)(I.A,{}):(0,Y.jsx)(S.A,{})}),e]}),Oe[G].listingColumns.slice(1).map(e=>(0,Y.jsx)(j.A,{align:e.align||"left",children:a[e.key]||"0.00"},e.key)),(0,Y.jsx)(j.A,{align:"right",children:(0,Y.jsxs)(n.A,{display:"flex",gap:1,justifyContent:"flex-end",children:[(0,Y.jsx)(f.A,{title:"Preview PDF",children:(0,Y.jsx)(v.A,{color:"primary",onClick:()=>{_e(a),be(!0)},children:(0,Y.jsx)(z.A,{})})}),(0,Y.jsx)(f.A,{title:"Preview Excel",children:(0,Y.jsx)(v.A,{color:"primary",onClick:()=>{Fe(a),ve(!0)},children:(0,Y.jsx)(O.A,{})})}),(0,Y.jsx)(f.A,{title:"Delete",children:(0,Y.jsx)(v.A,{color:"error",onClick:e=>{e.stopPropagation(),Ve(a),Be(!0)},children:(0,Y.jsx)(J.A,{})})})]})})]}),(0,Y.jsx)(y.A,{children:(0,Y.jsx)(j.A,{style:{padding:0},colSpan:Oe[G].listingColumns.length+1,children:(0,Y.jsx)(_.A,{in:ue[e],timeout:"auto",unmountOnExit:!0,children:(0,Y.jsxs)(n.A,{margin:1,children:[(0,Y.jsxs)(g.A,{variant:"h6",gutterBottom:!0,component:"div",children:["Details for ",e]}),(0,Y.jsxs)(m.A,{size:"small",children:[(0,Y.jsx)(p.A,{children:(0,Y.jsxs)(y.A,{children:[(0,Y.jsx)(j.A,{children:"Date"}),(0,Y.jsx)(j.A,{children:"Do/Inv No"}),(0,Y.jsx)(j.A,{children:"salesNagal"===G||"sales"===G?"Retailer":"Supplier"}),(0,Y.jsx)(j.A,{children:"Product"}),(0,Y.jsx)(j.A,{children:"Short Name"}),(0,Y.jsx)(j.A,{align:"right",children:"QTY"}),(0,Y.jsx)(j.A,{align:"right",children:"KGS"}),(0,Y.jsx)(j.A,{align:"right",children:"Amount"}),(0,Y.jsx)(j.A,{align:"right",children:"Act Qty"}),(0,Y.jsx)(j.A,{align:"right",children:"sales"===G?"Item_Rate":""}),(0,Y.jsx)(j.A,{align:"right",children:"salesNagal"===G?"Broker Amt":"Brok.Amt"}),"salesNagal"===G&&(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(j.A,{align:"right",children:"Brok.Rate"}),(0,Y.jsx)(j.A,{align:"right",children:"Coolie.Amt"}),(0,Y.jsx)(j.A,{align:"right",children:"Coolie.Rate"}),(0,Y.jsx)(j.A,{align:"right",children:"Vilai_Vasi"}),(0,Y.jsx)(j.A,{align:"right",children:"Vilaiva.Rat"})]}),Ce&&("sales"===G||"purchase"===G)&&(0,Y.jsx)(j.A,{align:"right",children:"Brokerage"}),(0,Y.jsx)(j.A,{align:"right",children:"Actions"})]})}),(0,Y.jsx)(b.A,{children:Je[e].flatMap(e=>{var l;return null===(l=e.Items)||void 0===l?void 0:l.map((e,l)=>(0,Y.jsxs)(y.A,{children:[(0,Y.jsx)(j.A,{children:e.Date}),(0,Y.jsx)(j.A,{children:e.Do_Inv_No||e.Po_Inv_No}),(0,Y.jsx)(j.A,{children:e.Retailer_Name||e.Supplier_Name}),(0,Y.jsx)(j.A,{children:e.Product_Name}),(0,Y.jsx)(j.A,{children:e.Short_Name}),(0,Y.jsx)(j.A,{align:"right",children:e.QTY}),(0,Y.jsx)(j.A,{align:"right",children:e.KGS}),(0,Y.jsx)(j.A,{align:"right",children:"salesNagal"===G||"sales"===G?e.Amount:e.Total_Invoice_value}),(0,Y.jsx)(j.A,{align:"right",children:"salesNagal"===G?e.QTY:e.Act_Qty}),(0,Y.jsx)(j.A,{align:"right",children:"sales"===G?e.Item_Rate:""}),qe(Ce,e)?(0,Y.jsxs)(Y.Fragment,{children:["salesNagal"===G?(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(j.A,{align:"right",children:((Ce.Brok_Rate||0)*(Ce.QTY||0)).toFixed(2)}),(0,Y.jsx)(j.A,{align:"right",sx:{minWidth:120},children:(0,Y.jsx)(s.A,{size:"small",type:"number",value:Ce.Brok_Rate||"",onChange:e=>{const l=parseFloat(e.target.value)||0;Te((0,t.A)((0,t.A)({},Ce),{},{Brok_Rate:l,Brok_Amt:(l*(Ce.QTY||0)).toFixed(2)}))},inputProps:{step:"0.01",style:{textAlign:"right"}}})}),(0,Y.jsx)(j.A,{align:"right",children:((Ce.Coolie_Rate||0)*(Ce.QTY||0)).toFixed(2)}),(0,Y.jsx)(j.A,{align:"right",sx:{minWidth:120},children:(0,Y.jsx)(s.A,{size:"small",type:"number",value:Ce.Coolie_Rate||"",onChange:e=>{const l=parseFloat(e.target.value)||0;Te((0,t.A)((0,t.A)({},Ce),{},{Coolie_Rate:l,Coolie_Amt:(l*(Ce.QTY||0)).toFixed(2)}))},inputProps:{step:"0.01",style:{textAlign:"right"}}})}),(0,Y.jsx)(j.A,{align:"right",sx:{minWidth:120},children:(0,Y.jsx)(s.A,{size:"small",type:"number",value:Ce.Vilai_Vasi||"",onChange:e=>{const l=parseFloat(e.target.value)||0;Te((0,t.A)((0,t.A)({},Ce),{},{Vilai_Vasi:l,Vilaivasi_Rate:(l/100*(Ce.QTY||0)).toFixed(2)}))},inputProps:{step:"1",style:{textAlign:"right"}}})}),(0,Y.jsx)(j.A,{align:"right",children:((Ce.Vilai_Vasi||0)*(Ce.QTY||0)/100).toFixed(2)})]}):"sales"===G?(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(j.A,{align:"right",children:Ce.Brokerage_Amt&&Ce.Act_Qty?(Ce.Brokerage_Amt*Ce.Act_Qty/100).toFixed(2):"0.00"}),(0,Y.jsx)(j.A,{align:"right",sx:{minWidth:120},children:(0,Y.jsx)(s.A,{size:"small",type:"number",value:Ce.Brokerage_Amt||"",onChange:e=>{const l=parseFloat(e.target.value)||0,a=Ce.Act_Qty?100*l/Ce.Act_Qty:0;Te((0,t.A)((0,t.A)({},Ce),{},{Brokerage_Amt:l,Brokerage:a.toFixed(2)}))},inputProps:{step:"0.01",style:{textAlign:"right"}}})})]}):(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(j.A,{align:"right",children:Ce.Brokerage_Amt&&Ce.Act_Qty?(Ce.Brokerage_Amt*Ce.Act_Qty/100).toFixed(2):"0.00"}),(0,Y.jsx)(j.A,{align:"right",sx:{minWidth:120},children:(0,Y.jsx)(s.A,{size:"small",type:"number",value:Ce.Brokerage_Amt||"",onChange:e=>{const l=parseFloat(e.target.value)||0,a=Ce.Act_Qty?100*l/Ce.Act_Qty:0;Te((0,t.A)((0,t.A)({},Ce),{},{Brokerage_Amt:l,Brokerage:a.toFixed(2)}))},inputProps:{step:"0.01",style:{textAlign:"right"}}})})]}),(0,Y.jsx)(j.A,{align:"right",children:(0,Y.jsxs)(n.A,{display:"flex",gap:1,justifyContent:"flex-end",children:[(0,Y.jsx)(f.A,{title:"Save changes",children:(0,Y.jsx)(v.A,{color:"primary",size:"small",onClick:Ge,children:(0,Y.jsx)(D.A,{fontSize:"small"})})}),(0,Y.jsx)(f.A,{title:"Cancel editing",children:(0,Y.jsx)(v.A,{color:"secondary",size:"small",onClick:()=>Te(null),children:(0,Y.jsx)(P.A,{fontSize:"small"})})})]})})]}):(0,Y.jsxs)(Y.Fragment,{children:["salesNagal"===G?(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(j.A,{align:"right",children:e.Brok_Amt||"0.00"}),(0,Y.jsx)(j.A,{align:"right",children:e.Brok_Rate||"0.00"}),(0,Y.jsx)(j.A,{align:"right",children:e.Coolie_Amt||"0.00"}),(0,Y.jsx)(j.A,{align:"right",children:e.Coolie_Rate||"0.00"}),(0,Y.jsx)(j.A,{align:"right",children:e.Vilai_Vasi||"0.00"}),(0,Y.jsx)(j.A,{align:"right",children:e.Vilaivasi_Rate||"0.00"})]}):(0,Y.jsx)(Y.Fragment,{children:(0,Y.jsx)(j.A,{align:"right",children:e.Brokerage||"0.00"})}),(0,Y.jsx)(j.A,{align:"right",children:(0,Y.jsxs)(n.A,{display:"flex",gap:1,justifyContent:"flex-end",children:[(0,Y.jsx)(f.A,{title:"Delete this item",children:(0,Y.jsx)(v.A,{color:"error",size:"small",onClick:l=>{l.stopPropagation(),Pe(e),Ie(!0)},children:(0,Y.jsx)(J.A,{fontSize:"small"})})}),(0,Y.jsx)(f.A,{title:"Edit this item",children:(0,Y.jsx)(v.A,{color:"primary",size:"small",onClick:()=>(e=>{var l,a,r,i,o,s,n,d,c,g,h,A,u,x,m;(0,t.A)((0,t.A)({},e),{},{Created_By:null===ye||void 0===ye?void 0:ye.UserId,Updated_By:null===ye||void 0===ye?void 0:ye.UserId}),"salesNagal"===G?Te((0,t.A)((0,t.A)({},e),{},{Brok_Rate:null!==(l=null!==(a=null!==(r=e.Brok_Rate)&&void 0!==r?r:e.Brokerage_Rate)&&void 0!==a?a:e.Brokerage)&&void 0!==l?l:"",Brok_Amt:null!==(i=e.Brok_Amt)&&void 0!==i?i:((null!==(o=e.Brok_Rate)&&void 0!==o?o:0)*(null!==(s=e.QTY)&&void 0!==s?s:0)).toFixed(2),Coolie_Rate:null!==(n=null!==(d=e.Coolie_Rate)&&void 0!==d?d:e.Coolie)&&void 0!==n?n:"",Coolie_Amt:null!==(c=e.Coolie_Amt)&&void 0!==c?c:((null!==(g=e.Coolie_Rate)&&void 0!==g?g:0)*(null!==(h=e.QTY)&&void 0!==h?h:0)).toFixed(2),Vilai_Vasi:null!==(A=e.Vilai_Vasi)&&void 0!==A?A:"",Vilaivasi_Rate:null!==(u=e.Vilaivasi_Rate)&&void 0!==u?u:((null!==(x=e.Vilai_Vasi)&&void 0!==x?x:0)*(null!==(m=e.Act_Qty)&&void 0!==m?m:0)/100).toFixed(2),Id:e.Id})):"sales"!==G&&"purchase"!==G||Te(e)})(e),children:(0,Y.jsx)(w.A,{fontSize:"small"})})})]})})]})]},l))})})]})]})})})})]},l)}):(0,Y.jsx)(y.A,{children:(0,Y.jsx)(j.A,{colSpan:Oe[G].listingColumns.length+1,align:"center",children:"No data found"})})})]}),(0,Y.jsx)(k.A,{rowsPerPageOptions:[10,25,50,100],component:"div",count:$e.length,rowsPerPage:Z.rowsPerPage,page:Z.page,onPageChange:(e,l)=>H((0,t.A)((0,t.A)({},Z),{},{page:l})),onRowsPerPageChange:e=>H({page:0,rowsPerPage:parseInt(e.target.value,10)})})]})]}),(0,Y.jsx)(K,{open:je,onClose:()=>be(!1),brokerData:fe,transactionType:G,fromDate:ne.FromDate,toDate:ne.ToDate}),(0,Y.jsx)(X,{open:ke,onClose:()=>ve(!1),brokerData:Ne,transactionType:G,fromDate:ne.FromDate,toDate:ne.ToDate})]}),(0,Y.jsxs)(N.A,{open:Qe.filters.filterDialog&&0===$,onClose:We,maxWidth:"sm",fullWidth:!0,children:[(0,Y.jsxs)(F.A,{children:[(0,Y.jsxs)(n.A,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[(0,Y.jsxs)(g.A,{variant:"h6",children:["sales"===G?"Sales":"salesNagal"===G?"SalesNagal":"Purchase"," Data Entry Filters"]}),(0,Y.jsx)(v.A,{onClick:We,children:(0,Y.jsx)(V.A,{})})]}),(0,Y.jsxs)(c.Ay,{container:!0,spacing:2,children:[(0,Y.jsx)(c.Ay,{item:!0,xs:12,children:(0,Y.jsx)(s.A,{fullWidth:!0,type:"date",label:"From Date",value:Qe.filters.FromDate,onChange:e=>ze(l=>(0,t.A)((0,t.A)({},l),{},{filters:(0,t.A)((0,t.A)({},l.filters),{},{FromDate:e.target.value})})),InputLabelProps:{shrink:!0}})}),(0,Y.jsx)(c.Ay,{item:!0,xs:12,children:(0,Y.jsx)(s.A,{fullWidth:!0,type:"date",label:"To Date",value:Qe.filters.ToDate,onChange:e=>ze(l=>(0,t.A)((0,t.A)({},l),{},{filters:(0,t.A)((0,t.A)({},l.filters),{},{ToDate:e.target.value})})),InputLabelProps:{shrink:!0}})}),(0,Y.jsx)(c.Ay,{item:!0,xs:12,children:(0,Y.jsx)(E.Ay,{fullWidth:!0,label:"Brokers",value:Qe.filters.Broker,onChange:e=>ze(l=>(0,t.A)((0,t.A)({},l),{},{filters:(0,t.A)((0,t.A)({},l.filters),{},{Broker:e})})),options:[{value:"",label:"ALL Brokers"},...ee.broker],styles:L.MR,menuPortalTarget:document.body,isSearchable:!0,placeholder:"Select Broker"})})]})]}),(0,Y.jsxs)(C.A,{children:[(0,Y.jsx)(h.A,{onClick:We,children:"Cancel"}),(0,Y.jsx)(h.A,{variant:"contained",onClick:()=>{ze(e=>(0,t.A)((0,t.A)({},e),{},{headerVilaiVasi:"",brokerageValues:{},filters:(0,t.A)((0,t.A)({},e.filters),{},{refresh:!e.filters.refresh,filterDialog:!1})}))},children:"Apply Filters"})]})]}),(0,Y.jsxs)(N.A,{open:ne.filterDialog&&1===$,onClose:Ye,maxWidth:"sm",fullWidth:!0,children:[(0,Y.jsxs)(F.A,{children:[(0,Y.jsxs)(n.A,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[(0,Y.jsx)(g.A,{variant:"h6",children:"Listing Filters"}),(0,Y.jsx)(v.A,{onClick:Ye,children:(0,Y.jsx)(V.A,{})})]}),(0,Y.jsxs)(c.Ay,{container:!0,spacing:2,children:[(0,Y.jsx)(c.Ay,{item:!0,xs:5,children:(0,Y.jsx)(s.A,{fullWidth:!0,type:"date",label:"From Date",value:ne.FromDate,onChange:e=>de(l=>(0,t.A)((0,t.A)({},l),{},{FromDate:e.target.value})),InputLabelProps:{shrink:!0}})}),(0,Y.jsx)(c.Ay,{item:!0,xs:5,children:(0,Y.jsx)(s.A,{fullWidth:!0,type:"date",label:"To Date",value:ne.ToDate,onChange:e=>de(l=>(0,t.A)((0,t.A)({},l),{},{ToDate:e.target.value})),InputLabelProps:{shrink:!0}})}),(0,Y.jsx)(c.Ay,{item:!0,xs:2,style:{display:"flex",alignItems:"flex-end"},children:(0,Y.jsx)(h.A,{variant:"contained",color:"primary",onClick:()=>{de(e=>(0,t.A)((0,t.A)({},e),{},{refresh:!e.refresh}))},style:{height:"30px",width:"100%"},children:"Search"})}),"salesNagal"===G?(0,Y.jsx)(Y.Fragment,{children:(0,Y.jsx)(c.Ay,{item:!0,xs:12,children:(0,Y.jsx)(E.Ay,{fullWidth:!0,value:ne.VilaiVasiZero,onChange:e=>de(l=>(0,t.A)((0,t.A)({},l),{},{VilaiVasiZero:e})),options:[{value:"",label:"All"},{value:"zero",label:"VilaiVasi Zero"},{value:"nonzero",label:"VilaiVasi Non-Zero"}],styles:L.MR,menuPortalTarget:document.body,placeholder:"VilaiVasi Zero/Non-Zero"})})}):(0,Y.jsx)(Y.Fragment,{}),(0,Y.jsx)(c.Ay,{item:!0,xs:12,children:(0,Y.jsx)(E.Ay,{fullWidth:!0,label:"Brokers",value:ne.Broker,onChange:e=>de(l=>(0,t.A)((0,t.A)({},l),{},{Broker:e})),options:[{value:"",label:"ALL Brokers"},...ee.broker],styles:L.MR,menuPortalTarget:document.body,isSearchable:!0,placeholder:"Select Broker"})}),(0,Y.jsx)(c.Ay,{item:!0,xs:12,children:(0,Y.jsx)(E.Ay,{fullWidth:!0,label:"Ledger",value:ne.Ledger,onChange:e=>de(l=>(0,t.A)((0,t.A)({},l),{},{Ledger:e})),options:[{value:"",label:"ALL Ledger"},...he.ledgers],styles:L.MR,menuPortalTarget:document.body,isSearchable:!0,placeholder:"Select Ledger"})}),(0,Y.jsx)(c.Ay,{item:!0,xs:12,children:(0,Y.jsx)(E.Ay,{fullWidth:!0,label:"Item",value:ne.Item,onChange:e=>de(l=>(0,t.A)((0,t.A)({},l),{},{Item:e})),options:[{value:"",label:"ALL Item"},...he.items],styles:L.MR,menuPortalTarget:document.body,isSearchable:!0,placeholder:"Select Item"})})]})]}),(0,Y.jsxs)(C.A,{children:[(0,Y.jsx)(h.A,{onClick:Ye,children:"Cancel"}),(0,Y.jsx)(h.A,{variant:"contained",onClick:()=>{de(e=>(0,t.A)((0,t.A)({},e),{},{refresh:!e.refresh,filterDialog:!1}))},children:"Apply Filters"})]})]}),(0,Y.jsxs)(N.A,{open:Re,onClose:()=>Be(!1),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[(0,Y.jsx)(T.A,{id:"alert-dialog-title",children:"Confirm Deletion"}),(0,Y.jsx)(F.A,{children:(0,Y.jsxs)(F.A,{id:"alert-dialog-description",children:["Are you sure you want to delete ",(null===we||void 0===we?void 0:we.Broker_Name)||(null===we||void 0===we?void 0:we.Supplier_Name),"'s records?"]})}),(0,Y.jsxs)(C.A,{children:[(0,Y.jsx)(h.A,{onClick:()=>Be(!1),children:"Cancel"}),(0,Y.jsx)(h.A,{onClick:async()=>{try{l();const e=await(0,i.z)({address:"reports/brokerageNagalPurchase/list",method:"DELETE",bodyData:{TransactionType:G,Broker:we.Broker_Id||we.Supplier_Id,FromDate:ne.FromDate,ToDate:ne.ToDate},headers:{"Content-Type":"application/json"}});e.success&&(Q.oR.success(e.message||"Deleted successfully!"),de(e=>(0,t.A)((0,t.A)({},e),{},{refresh:!e.refresh})))}catch(e){Q.oR.error("Delete failed due to an error")}finally{a(),Be(!1)}},color:"error",autoFocus:!0,children:"Delete"})]})]}),(0,Y.jsxs)(N.A,{open:De,onClose:()=>Ie(!1),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[(0,Y.jsx)(T.A,{id:"alert-dialog-title",children:"Confirm Item Deletion"}),(0,Y.jsx)(F.A,{children:(0,Y.jsxs)(R.A,{id:"alert-dialog-description",children:["Are you sure you want to delete this ",null===Se||void 0===Se?void 0:Se.Product_Name," item?"]})}),(0,Y.jsxs)(C.A,{children:[(0,Y.jsx)(h.A,{onClick:()=>Ie(!1),children:"Cancel"}),(0,Y.jsx)(h.A,{onClick:async()=>{try{l();const e=await(0,i.z)({address:"reports/brokerageNagalPurchase/list",method:"DELETE",bodyData:{Id:Se.Id,Do_Id:Se.Do_Id,Product_Id:Se.Product_Id,PIN_Id:Se.PIN_Id,FromDate:ne.FromDate,ToDate:ne.ToDate,TransactionType:G},headers:{"Content-Type":"application/json"}});e.success&&(Q.oR.success(e.message||"Item deleted successfully!"),de(e=>(0,t.A)((0,t.A)({},e),{},{refresh:!e.refresh})))}catch(e){Q.oR.error("Item delete failed due to an error")}finally{a(),Ie(!1)}},color:"error",autoFocus:!0,children:"Delete"})]})]}),(0,Y.jsxs)(N.A,{open:Ee,onClose:()=>Le(!1),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[(0,Y.jsx)(T.A,{id:"alert-dialog-title",children:"Confirm Bulk Deletion"}),(0,Y.jsx)(F.A,{children:(0,Y.jsx)(R.A,{id:"alert-dialog-description",children:"Are you sure you want to delete ALL filtered records? This action cannot be undone."})}),(0,Y.jsxs)(C.A,{children:[(0,Y.jsx)(h.A,{onClick:()=>Le(!1),children:"Cancel"}),(0,Y.jsx)(h.A,{onClick:async()=>{try{l();const e=await(0,i.z)({address:"reports/brokerageNagalPurchase/list",method:"DELETE",bodyData:{FromDate:ne.FromDate,ToDate:ne.ToDate,Broker:ne.Broker.value,Ledger:ne.Ledger.value,Item:ne.Item.value,TransactionType:G}});e.success&&(Q.oR.success(e.message||"All records deleted successfully!"),de(e=>(0,t.A)((0,t.A)({},e),{},{refresh:!e.refresh})))}catch(e){Q.oR.error("Bulk delete failed due to an error")}finally{a(),Le(!1)}},color:"error",autoFocus:!0,children:"Delete All"})]})]})]})}}}]);
//# sourceMappingURL=1384.0c5e8448.chunk.js.map