"use strict";(self.webpackChunkerp=self.webpackChunkerp||[]).push([[5734],{5734:(e,s,t)=>{t.r(s),t.d(s,{default:()=>I});var a=t(65043),l=t(58992),i=t(73216),d=t(77739),n=t(17392),o=t(83462),r=t(26600),c=t(35316),u=t(29347),h=t(11906),m=t(37131),x=t(68094),p=t(32293),j=t(47968),v=t(8911),f=t(95874),g=t(91036),N=(t(92342),t(60235)),b=t(79722),A=t(65074),y=t(70579);const I=()=>{const e=localStorage.getItem("user"),s=JSON.parse(e),t=(0,i.zy)().state,I=(0,i.Zp)(),[S,C]=(0,a.useState)([]),[w,F]=(0,a.useState)([]),k=(0,a.useRef)(null),[T,U]=(0,a.useState)(""),[D,z]=(0,a.useState)(!1),[_,M]=(0,a.useState)(!1),[R,E]=(0,a.useState)(""),[O,P]=(0,a.useState)(0),[W,L]=(0,a.useState)(!1);(0,a.useEffect)(()=>{if(!t)return I("/taskManagement/discussions");(0,A.z)({address:"discussionForum/messages?Topic_Id=".concat(null===t||void 0===t?void 0:t.Id)}).then(e=>{if(e.success){const s=e.data.reduce((e,s)=>{const t=new Date(s.CreatedAt).toDateString();return e[t]||(e[t]=[]),e[t].push(s),e},{});C(s)}}).catch(e=>console.log(e)),(0,A.z)({address:"discussionForum/files?Topic_Id=".concat(null===t||void 0===t?void 0:t.Id)}).then(e=>{e.success&&F(e.data)}).catch(e=>console.log(e))},[D]),(0,a.useEffect)(()=>{if(k.current){const{scrollHeight:e,clientHeight:s}=k.current;k.current.scrollTop=e-s}},[S]);const q=()=>{M(!1),E("")},B=e=>{e.preventDefault();const a=new FormData;a.append("files",R),a.append("User_Id",null===s||void 0===s?void 0:s.UserId),a.append("Project_Id",null===t||void 0===t?void 0:t.Project_Id),a.append("Topic_Id",null===t||void 0===t?void 0:t.Id);try{b.A.post("".concat(l.A,"discussionForum/files"),a,{headers:{"Content-Type":"multipart/form-data",Authorization:null===s||void 0===s?void 0:s.Autheticate_Id},onUploadProgress:e=>{let s=Math.round(100*e.loaded/e.total);P(s)}}).then(e=>{g.oR.success(e.data.message),z(!D)}).catch(e=>{g.oR.error("Failed to upload"),console.error(e)}).finally(()=>{q(),P(0)})}catch(i){console.error("Error uploading file:",i)}};return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(g.N9,{}),(0,y.jsxs)("div",{className:"chat-header d-flex align-items-center",children:[(0,y.jsx)("p",{className:"mb-0 fa-14 text-white text-uppercase fw-bold flex-grow-1",children:null===t||void 0===t?void 0:t.Topic}),(0,y.jsx)(d.A,{title:"Back",children:(0,y.jsx)(n.A,{size:"small",onClick:()=>I("/taskManagement/discussions"),children:(0,y.jsx)(m.A,{className:"fa-18"})})}),(0,y.jsx)(d.A,{title:"Refresh Chat",children:(0,y.jsx)(n.A,{size:"small",onClick:()=>z(!D),children:(0,y.jsx)(v.A,{className:"fa-18"})})}),(0,y.jsx)(d.A,{title:"Documnets Shared",children:(0,y.jsx)(n.A,{size:"small",onClick:()=>L(!0),children:(0,y.jsx)(x.A,{})})}),(0,y.jsxs)(N.A,{children:[(0,y.jsx)(N.A.Toggle,{variant:"success",id:"actions",className:"rounded-5 bg-transparent text-muted fa-18 border-0 btn"}),(0,y.jsxs)(N.A.Menu,{children:[(0,y.jsx)("h5",{className:"mb-1 text-primary px-3 fa-18 border-bottom",children:" Teams"}),null===t||void 0===t?void 0:t.InvolvedUsers.map((e,s)=>(0,y.jsx)("p",{className:"fw-bold text-muted fa-13 mb-0 px-3 py-1 ",children:e.Name},s))]})]})]}),(0,y.jsx)("div",{className:"chat-body",ref:k,children:Object.entries(S).map(e=>{let[t,l]=e;return(0,y.jsxs)(a.Fragment,{children:[(0,y.jsx)("div",{className:"badge rounded-3 bg-light text-center text-dark mx-auto my-2",children:(new Date).toDateString()===t?"Today":t}),l.map(e=>(0,y.jsxs)("div",{className:"messages ".concat(Number(null===e||void 0===e?void 0:e.User_Id)===Number(null===s||void 0===s?void 0:s.UserId)?"message-right":"message-left"),children:[(0,y.jsx)("p",{className:"fw-bold mb-1 text-primary fa-12",children:Number(null===e||void 0===e?void 0:e.User_Id)===Number(null===s||void 0===s?void 0:s.UserId)?"You":e.Name}),(0,y.jsx)("div",{className:"fa-16 mb-2",children:e.Message}),(0,y.jsx)("p",{className:"fa-11 mb-0 fw-bold ".concat(Number(null===e||void 0===e?void 0:e.User_Id)===Number(null===s||void 0===s?void 0:s.UserId)&&"text-end"," "),children:new Date(e.CreatedAt).toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit"})})]},e.Id))]},t)})}),(0,y.jsx)("form",{onSubmit:async e=>{if(e.preventDefault(),""===T.trim())return g.oR.warn("Enter a message"),void U("");(0,A.z)({address:"discussionForum/messages",method:"POST",bodyData:{Topic_Id:null===t||void 0===t?void 0:t.Id,User_Id:null===s||void 0===s?void 0:s.UserId,Message:T}}).then(e=>{e.success?(z(!D),U("")):g.oR.error(e.message)}).catch(e=>console.log(e))},children:(0,y.jsx)("div",{className:"chat-footer",children:(0,y.jsxs)("div",{className:"input-icon-container",children:[(0,y.jsx)("input",{className:"cus-inpt rounded-5 border-0 outline-none px-3",placeholder:"Type a message",autoFocus:!0,required:!0,value:T,onChange:e=>U(e.target.value),onInvalid:e=>e.target.setCustomValidity("Type a message"),onInput:e=>e.target.setCustomValidity("")}),(0,y.jsx)(d.A,{title:"Upload Files",children:(0,y.jsx)(n.A,{onClick:()=>M(!0),type:"button",children:(0,y.jsx)(p.A,{})})}),(0,y.jsx)(d.A,{title:"Send Message",children:(0,y.jsx)(n.A,{type:"submit",children:(0,y.jsx)(f.A,{})})})]})})}),(0,y.jsxs)(o.A,{open:_,onClose:q,fullWidth:!0,maxWidth:"sm",children:[(0,y.jsx)(r.A,{children:"Share Files"}),(0,y.jsxs)("form",{onSubmit:B,children:[(0,y.jsx)(c.A,{children:(0,y.jsx)("input",{type:"file",className:"cus-inpt ",required:!0,onChange:e=>E(e.target.files[0])})}),(0,y.jsxs)(u.A,{children:[(0,y.jsx)(h.A,{onClick:q,type:"button",children:"close"}),(0,y.jsx)(h.A,{onClick:B,disabled:0!==O,type:"submit",children:"Upload"})]})]})]}),(0,y.jsxs)(o.A,{open:W,onClose:()=>L(!1),fullWidth:!0,maxWidth:w.length>0?"lg":"sm",children:[(0,y.jsx)(r.A,{children:"Shared Documents"}),(0,y.jsx)(c.A,{children:w.length>0?(0,y.jsx)("div",{className:"table-responsive",children:(0,y.jsxs)("table",{className:"table",children:[(0,y.jsx)("thead",{children:(0,y.jsxs)("tr",{children:[(0,y.jsx)("th",{className:"fa-14",children:"S.No"}),(0,y.jsx)("th",{className:"fa-14",children:"File Name"}),(0,y.jsx)("th",{className:"fa-14",children:"Size"}),(0,y.jsx)("th",{className:"fa-14",children:"Type"}),(0,y.jsx)("th",{className:"fa-14",children:"Date"}),(0,y.jsx)("th",{className:"fa-14"})]})}),(0,y.jsx)("tbody",{children:w.map((e,t)=>(0,y.jsxs)("tr",{children:[(0,y.jsx)("td",{className:"fa-14",children:t+1}),(0,y.jsx)("td",{className:"fa-14",children:null===e||void 0===e?void 0:e.FileName}),(0,y.jsxs)("td",{className:"fa-14",children:[null!==e&&void 0!==e&&e.FileSize?((null===e||void 0===e?void 0:e.FileSize)/1024/1024).toFixed(2):0," MB"]}),(0,y.jsx)("td",{className:"fa-14",children:null===e||void 0===e?void 0:e.FileType}),(0,y.jsx)("td",{className:"fa-14",children:null===e||void 0===e?void 0:e.SendDate}),(0,y.jsx)("td",{className:"fa-14",children:(0,y.jsx)(n.A,{className:"text-primary",size:"small",onClick:()=>(async e=>{try{const t=await(0,A.z)({address:"discussionForum/files/download?FileId=".concat(e),headers:{"Content-Type":"application/octet-stream",Authorization:s.Autheticate_Id}}),a=await t.blob(),l=window.URL.createObjectURL(a),i=document.createElement("a");i.href=l,i.setAttribute("download","file_".concat(e)),document.body.appendChild(i),i.click(),i.parentNode.removeChild(i)}catch(t){console.error("Download Error",t)}})(e.FileId),children:(0,y.jsx)(j.A,{})})})]},t))})]})}):(0,y.jsx)("h5",{className:"text-center text-muted my-5",children:"No Documents Available"})}),(0,y.jsx)(u.A,{children:(0,y.jsx)(h.A,{onClick:()=>L(!1),children:"Close"})})]})]})}}}]);
//# sourceMappingURL=5734.f010a005.chunk.js.map