"use strict";(self.webpackChunkerp=self.webpackChunkerp||[]).push([[9920],{89920:(e,s,a)=>{a.r(s),a.d(s,{default:()=>se});var n=a(89379),o=a(65043),t=a(65074),i=a(91036),r=a(39652),l=a(28076),c=a(84882),d=a(81e3),u=a(77739),m=a(17392),h=a(67784),p=a(51787),x=a(85865),A=a(43845),g=a(11906),f=a(32143),j=a(83462),y=a(26600),v=a(35316),C=a(29347),I=a(81637),b=a(12110),w=a(4598),_=a(63336),k=a(79650),S=a(71806),N=a(73460),P=a(31159),E=a(53193),z=a(79190),L=a(72221),R=a(77502),D=a(34535),U=a(88645),T=a(59540),O=a(91794),F=a(30079),W=a(47968),M=a(83560),B=a(34190),H=a(37141),J=a(79484),q=a(32069),G=a(44973),K=a(22520),Q=a(11238),V=a(58992),X=a(70579);const Y=(0,D.Ay)(r.A)(e=>{let{theme:s}=e;return{["&.".concat(R.A.head)]:{backgroundColor:"#EDF0F7",color:"#000000",fontWeight:"bold",borderRight:"1px solid #e0e0e0","&:last-child":{borderRight:"none"}},["&.".concat(R.A.body)]:{fontSize:14,padding:"12px 16px",borderRight:"1px solid #e0e0e0","&:last-child":{borderRight:"none"}}}}),Z=(0,D.Ay)(l.A)(e=>{let{highlight:s}=e;return(0,n.A)((0,n.A)({backgroundColor:s?"#84EAB3":"#fff"},s&&{borderLeft:"4px solid #1976d2"}),{},{"&:hover":{backgroundColor:s?"#84EAB5":"#f5f5f5"}})}),$=(0,D.Ay)("div")({display:"flex",justifyContent:"flex-end",alignItems:"center",gap:"16px",padding:"16px",backgroundColor:"#f5f5f5",borderTop:"1px solid #e0e0e0"}),ee=["Ledger_Name","Ledger_Alias"];const se=function(e){let{loadingOn:s,loadingOff:a}=e;const[r,R]=(0,o.useState)([]),[D,se]=(0,o.useState)([]),[ae,ne]=(0,o.useState)(0),[oe,te]=(0,o.useState)(5),[ie,re]=(0,o.useState)([]),[le,ce]=(0,o.useState)(!1),[de,ue]=(0,o.useState)([]),[me,he]=(0,o.useState)([]),[pe,xe]=(0,o.useState)([]),[Ae,ge]=(0,o.useState)(!1),[fe,je]=(0,o.useState)({}),[ye,ve]=(0,o.useState)({}),[Ce,Ie]=(0,o.useState)(""),[be,we]=(0,o.useState)({key:null,direction:"asc"}),[_e,ke]=(0,o.useState)(!1),[Se,Ne]=(0,o.useState)({}),Pe=(0,K.aN)().user,Ee=JSON.parse(localStorage.getItem("user")),[ze,Le]=(0,o.useState)(!1),[Re,De]=(0,o.useState)(null),[Ue,Te]=(0,o.useState)(!1),[Oe,Fe]=(0,o.useState)(!1),[We,Me]=(0,o.useState)([]);(0,o.useEffect)(()=>{(async()=>{try{const e=await(0,t.z)({address:"masters/columns/dropDown?company_id=".concat(null===Ee||void 0===Ee?void 0:Ee.companyId)});e.success&&he(e.data)}catch(e){console.error("Error fetching columns:",e)}})()},[null===Ee||void 0===Ee?void 0:Ee.companyId]),(0,o.useEffect)(()=>{!async function(){try{Te(!0),s();const e=await(0,t.z)({address:"masters/displayColumn?company_id=".concat(null===Ee||void 0===Ee?void 0:Ee.companyId)});if(!e.success||!Array.isArray(e.data))return void console.error("No display columns found");const a=[...e.data].sort((e,s)=>e.Position-s.Position);re(a),ue([...a]);const n=a.filter(e=>1===e.status&&!["Auto_Id","Ledger_Tally_Id"].includes(e.ColumnName)).sort((e,s)=>e.Position-s.Position).map(e=>({header:e.Alias_Name||e.ColumnName,accessor:e.ColumnName,position:e.Position}));se(n);const o=await(0,t.z)({address:"masters/getlolDetails"});if(o.success&&Array.isArray(o.data)){xe(o.data);const e=n.map(e=>e.accessor),s=o.data.map(s=>{const a={};return e.forEach(e=>{a[e]=s[e]||""}),a});R(s)}}catch(e){console.error("Error loading data:",e)}finally{Te(!1),a()}}()},[Oe,Ae,null===Ee||void 0===Ee?void 0:Ee.companyId]);const Be=e=>{const s=ie.find(s=>s.Id===e);return!!s&&1===s.status},He=()=>{Le(!1),De(null),Te(!1)},Je=(e,s)=>{je(a=>(0,n.A)((0,n.A)({},a),{},{[e]:s}))},qe=(0,o.useMemo)(()=>{let e=[...pe];if(Ce){const s=Ce.split(",").map(e=>e.trim().toLowerCase()).filter(Boolean);e=e.filter(e=>s.some(s=>Object.values(e).some(e=>String(e).toLowerCase().includes(s))))}return e=e.filter(e=>Object.keys(ye).every(s=>!ye[s]||String(e[s]).toLowerCase().includes(String(ye[s]).toLowerCase()))),e.sort((e,s)=>{if(0===e.IsUpdated&&0!==s.IsUpdated)return-1;if(0!==e.IsUpdated&&0===s.IsUpdated)return 1;if(be.key){if(e[be.key]<s[be.key])return"asc"===be.direction?-1:1;if(e[be.key]>s[be.key])return"asc"===be.direction?1:-1}return 0}),e},[pe,Ce,ye,be]);return(0,X.jsxs)(d.A,{sx:{p:3,backgroundColor:"white",borderRadius:"8px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:[(0,X.jsxs)(d.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,X.jsx)(x.A,{variant:"h5",children:"LOL List"}),(0,X.jsxs)(d.A,{sx:{display:"flex",alignItems:"center"},children:[We.length>0&&(0,X.jsx)(A.A,{label:"SELECTED ROWS : ".concat(We.length," "),color:"primary",size:"small",sx:{mr:2}}),(0,X.jsx)(h.A,{variant:"outlined",size:"small",placeholder:"Search...",value:Ce,onChange:e=>Ie(e.target.value),sx:{width:250,mr:2,"& .MuiInputBase-root":{height:32}},InputProps:{startAdornment:(0,X.jsx)(p.A,{position:"start",children:(0,X.jsx)(J.A,{})}),endAdornment:Ce&&(0,X.jsx)(p.A,{position:"end",children:(0,X.jsx)(m.A,{size:"small",onClick:()=>Ie(""),children:(0,X.jsx)(F.A,{fontSize:"small"})})})}}),(0,X.jsx)(u.A,{title:"Column Settings",children:(0,X.jsx)(m.A,{onClick:()=>ce(!0),children:(0,X.jsx)(q.A,{})})}),(0,X.jsx)(g.A,{variant:"contained",startIcon:(0,X.jsx)(J.A,{}),onClick:()=>{ve((0,n.A)({},fe)),ne(0)},disabled:0===Object.keys(fe).length,sx:{ml:2},children:"Apply Filters"}),(0,X.jsx)(g.A,{variant:"outlined",startIcon:(0,X.jsx)(F.A,{}),onClick:()=>{je({}),ve({}),Ie(""),ne(0)},disabled:0===Object.keys(ye).length&&!Ce,sx:{ml:1},children:"Clear All"}),(0,X.jsxs)(f.A,{onClick:()=>((e,s)=>{try{if(!Array.isArray(e)||!Array.isArray(s))throw new Error("Invalid data: columns and selectedRows must be arrays");const a=e.filter(e=>"Auto_Id"!==e.accessor&&"Ledger_Tally_Id"!==e.accessor),n=[a.map(e=>"string"!==typeof e.header?(console.warn("Missing or invalid header for column:",e),"UNNAMED_COLUMN"):e.header),...s.map(e=>a.map(s=>{var a;return null!==(a=e[s.accessor])&&void 0!==a?a:""}))],o=Q.Wp.aoa_to_sheet(n),t=Q.Wp.book_new();Q.Wp.book_append_sheet(t,o,"SelectedData");const i=(new Date).toISOString().slice(0,10);Q._h(t,"selected_data_".concat(i,".xlsx"))}catch(a){console.error("Excel export failed:",a),alert("Export failed: ".concat(a.message))}})(D,We),children:[(0,X.jsx)(W.A,{fontSize:"small",sx:{mr:1}})," Download"," "]}),(0,X.jsxs)(f.A,{onClick:()=>{Le(!0)},children:[(0,X.jsx)(G.A,{fontSize:"small",sx:{mr:1}}),"Upload"]}),(0,X.jsxs)(j.A,{open:ze,fullWidth:!0,children:[(0,X.jsx)(y.A,{children:"Upload Excel File"}),(0,X.jsx)(v.A,{children:(0,X.jsxs)(d.A,{sx:{display:"flex",alignItems:"center",gap:2,mt:2},children:[(0,X.jsxs)(g.A,{variant:"contained",component:"label",children:["Browse",(0,X.jsx)("input",{type:"file",accept:".xls,.xlsx",hidden:!0,onChange:e=>{const s=e.target.files[0];s.size>5242880?alert("File size exceeds 5MB"):De(s)}})]}),(0,X.jsx)(x.A,{children:Re?Re.name:"No file selected"})]})}),(0,X.jsxs)(C.A,{children:[(0,X.jsx)(g.A,{onClick:He,children:"Cancel"}),(0,X.jsx)(g.A,{onClick:async()=>{if(Re)try{Te(!0),await(async e=>{try{const s=new FormData;s.append("file",e),s.append("company_id",null===Ee||void 0===Ee?void 0:Ee.Company_id),s.append("Created_By",null===Ee||void 0===Ee?void 0:Ee.UserId),s.append("isRetailer","1");const a=await fetch("".concat(V.A,"masters/uploadExcel"),{method:"POST",body:s,headers:{Db:null===Pe||void 0===Pe?void 0:Pe.Company_id}});if(!a.ok){const e=await a.json().catch(()=>({}));throw new Error(e.message||"Upload failed")}const n=await a.json();return Te(!1),n}catch(s){throw Te(!1),console.error("Upload Error:",{message:s.message,stack:s.stack,time:(new Date).toISOString()}),new Error("Upload failed: ".concat(s.message))}})(Re),He(),Fe(e=>!e),i.oR.success("File uploaded successfully")}catch(e){i.oR.error("Upload failed: ".concat(e.message))}finally{Te(!1)}},variant:"contained",disabled:!Re||Ue,startIcon:Ue?(0,X.jsx)(I.A,{size:20,color:"inherit"}):null,children:Ue?"Uploading...":"Upload"})]})]})]})]}),(0,X.jsxs)(j.A,{open:le,onClose:()=>ce(!1),maxWidth:"lg",fullWidth:!0,children:[(0,X.jsx)(y.A,{children:"Column Settings"}),(0,X.jsx)(v.A,{children:(0,X.jsx)("div",{className:"row",children:me.sort((e,s)=>e.Position-s.Position).map(e=>{var s,a;return(0,X.jsx)("div",{className:"col-lg-4 col-md-6 p-2",children:(0,X.jsx)(b.A,{className:"p-2",children:(0,X.jsxs)("div",{className:"d-flex justify-content-between align-items-center flex-wrap",children:[(0,X.jsx)(w.A,{checked:Be(e.Id),onChange:s=>((e,s)=>{const a=me.find(s=>s.Id===e);if((null===a||void 0===a?void 0:a.Position)<=5)return void i.oR.error("First 5 columns cannot be disabled");let o;if(ie.some(s=>s.Id===e))o=ie.map(a=>a.Id===e?(0,n.A)((0,n.A)({},a),{},{status:s?1:0}):a);else{const a=me.find(s=>s.Id===e);o=a?[...ie,(0,n.A)((0,n.A)({},a),{},{status:s?1:0})]:[...ie]}o.sort((e,s)=>e.Position-s.Position),re(o)})(e.Id,s.target.checked),disabled:e.Position<=5,color:e.Position<=5?"default":"primary"}),(0,X.jsx)("div",{children:null===e||void 0===e?void 0:e.ColumnName}),(0,X.jsxs)("div",{className:"d-flex align-items-center gap-2",children:[(0,X.jsx)(h.A,{type:"number",size:"small",variant:"outlined",value:null!==(s=e.Position)&&void 0!==s?s:0,onChange:s=>((e,s)=>{const a=parseInt(s);isNaN(a)||he(s=>s.map(s=>s.Id===e?(0,n.A)((0,n.A)({},s),{},{Position:a}):s))})(e.Id,s.target.value),sx:{width:"70px"},inputProps:{min:1,readOnly:ee.includes(e.ColumnName)},disabled:ee.includes(e.ColumnName)}),(0,X.jsx)(h.A,{size:"small",variant:"outlined",value:null!==(a=e.Alias_Name)&&void 0!==a?a:"",onChange:s=>{return!ee.includes(e.ColumnName)&&(a=e.Id,o=s.target.value,void he(e=>e.map(e=>e.Id===a?(0,n.A)((0,n.A)({},e),{},{Alias_Name:o}):e)));var a,o},sx:{"& .MuiInputBase-input":{cursor:ee.includes(e.ColumnName)?"default":"text",backgroundColor:ee.includes(e.ColumnName)?"#f5f5f5":"inherit"}},inputProps:{readOnly:ee.includes(e.ColumnName)},disabled:ee.includes(e.ColumnName)})]})]})})},e.Id)})})}),(0,X.jsxs)(C.A,{children:[(0,X.jsx)(g.A,{onClick:()=>{re([...de]),he([...de])},variant:"outlined",children:"Reset"}),(0,X.jsx)(g.A,{onClick:()=>ce(!1),color:"error",children:"Close"}),(0,X.jsx)(g.A,{onClick:async()=>{ge(!0);try{const e=ie.map(e=>{const s=me.find(s=>s.Id===e.Id);return s?(0,n.A)((0,n.A)({},e),{},{Position:s.Position,Alias_Name:s.Alias_Name}):e}),s={},a=new Set;if(e.forEach(e=>{s[e.Position]&&a.add(e.Position),s[e.Position]=!0}),a.size>0){const e=Array.from(a).join(", ");return void i.oR.error("Duplicate positions found: ".concat(e))}re(e),ue(e);const o=await(0,t.z)({address:"masters/updateColumnChanges",method:"PUT",bodyData:{columns:e.map(e=>({id:e.Id,status:e.status,position:e.Position,alias_name:e.Alias_Name,column_name:e.ColumnName})),company_id:null===Ee||void 0===Ee?void 0:Ee.companyId}});if(!o.success)throw new Error(o.message||"Failed to update column statuses");const r=e.filter(e=>1===e.status).sort((e,s)=>e.Position-s.Position).map(e=>({header:e.Alias_Name||e.ColumnName,accessor:e.ColumnName,position:e.Position}));if(se(r),pe.length>0){const e=r.map(e=>e.accessor),s=pe.map(s=>{const a={};return e.forEach(e=>{a[e]=s[e]||""}),a});R(s)}ce(!1),i.oR.success("Changes Saved")}catch(e){console.error("Error updating column statuses:",e),i.oR.error(e.message||"Failed to update columns. Please try again.")}finally{ge(!1)}},variant:"contained",color:"primary",disabled:Ae,children:Ae?"Applying...":"Apply"})]})]}),(0,X.jsxs)(j.A,{open:_e,onClose:()=>ke(!1),maxWidth:"md",fullWidth:!0,children:[(0,X.jsx)(y.A,{children:"Edit Row"}),(0,X.jsx)("div",{className:"container-fluid",style:{maxHeight:"80vh",overflow:"auto"},children:(0,X.jsx)("div",{className:"row g-3",children:D.map(e=>(0,X.jsx)("div",{className:"col-12 col-sm-6 col-md-4",children:(0,X.jsxs)("div",{className:"form-group",children:[(0,X.jsx)("label",{className:"form-label",children:e.header}),(0,X.jsx)("input",{type:"text",className:"form-control form-control-lg",value:Se[e.accessor]||"",onChange:s=>Ne((0,n.A)((0,n.A)({},Se),{},{[e.accessor]:s.target.value})),disabled:"Auto_Id"===e.accessor||"Ledger_Tally_Id"===e.accessor||"Ledger_Name"===e.accessor,style:{padding:"1rem 1rem",fontSize:"1rem"}})]})},e.accessor))})}),(0,X.jsxs)(C.A,{children:[(0,X.jsx)(g.A,{onClick:()=>ke(!1),variant:"outlined",startIcon:(0,X.jsx)(O.A,{}),children:"Cancel"}),(0,X.jsx)(g.A,{onClick:async()=>{try{const e=await(0,t.z)({address:"masters/updateDetails",method:"PUT",bodyData:Se,headers:{Db:null===Pe||void 0===Pe?void 0:Pe.Company_id}});if(!e.success)throw new Error(e.message||"Failed to update row");xe(e=>e.map(e=>e.Auto_Id===Se.Auto_Id?Se:e)),R(e=>e.map(e=>e.Auto_Id===Se.Auto_Id?Se:e)),ke(!1),i.oR.success("Data updated successfully")}catch(e){console.error("Error updating row:",e),i.oR.error("Failed to update row")}},variant:"contained",color:"primary",startIcon:(0,X.jsx)(H.A,{}),children:"Save Changes"})]})]}),D.length>0&&pe.length>0?(0,X.jsxs)(_.A,{elevation:0,sx:{border:"1px solid #e0e0e0"},children:[(0,X.jsx)(k.A,{children:(0,X.jsxs)(S.A,{stickyHeader:!0,"aria-label":"ledger table",sx:{minWidth:650},children:[(0,X.jsx)(c.A,{children:(0,X.jsxs)(l.A,{children:[(0,X.jsx)(Y,{align:"center",sx:{width:"80px"},children:"S.No"}),(0,X.jsx)(Y,{align:"center",sx:{width:"80px"},children:"CheckBox"}),(0,X.jsx)(Y,{align:"center",sx:{width:"80px"},children:"Actions"}),D.map(e=>(0,X.jsxs)(Y,{align:"center",children:[(0,X.jsxs)(d.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:[e.header,(0,X.jsx)(u.A,{title:"Sort ".concat(be.key===e.accessor&&"asc"===be.direction?"Descending":"Ascending"),children:(0,X.jsx)(m.A,{size:"small",onClick:()=>(e=>{let s="asc";be.key===e&&"asc"===be.direction&&(s="desc"),we({key:e,direction:s})})(e.accessor),color:be.key===e.accessor?"primary":"default",children:be.key===e.accessor?"asc"===be.direction?(0,X.jsx)(T.A,{}):(0,X.jsx)(U.A,{}):(0,X.jsx)(B.A,{})})})]}),(0,X.jsx)(h.A,{size:"small",variant:"outlined",placeholder:"Filter...",value:fe[e.accessor]||"",onChange:s=>Je(e.accessor,s.target.value),sx:{width:"100%",mt:1},InputProps:{endAdornment:fe[e.accessor]&&(0,X.jsx)(p.A,{position:"end",children:(0,X.jsx)(m.A,{size:"small",onClick:()=>Je(e.accessor,""),children:(0,X.jsx)(F.A,{fontSize:"small"})})})}})]},e.accessor))]})}),(0,X.jsx)(N.A,{children:qe.slice(ae*oe,ae*oe+oe).map((e,s)=>(0,X.jsxs)(Z,{highlight:0===e.IsUpdated,children:[(0,X.jsx)(Y,{align:"center",children:ae*oe+s+1}),(0,X.jsx)(Y,{children:(0,X.jsx)(m.A,{children:(0,X.jsx)("input",{type:"checkbox",checked:We.some(s=>s.Ledger_Tally_Id===e.Ledger_Tally_Id),onChange:()=>(e=>{Me(s=>s.some(s=>s.Ledger_Tally_Id===e.Ledger_Tally_Id)?s.filter(s=>s.Ledger_Tally_Id!==e.Ledger_Tally_Id):[...s,e])})(e),onFocus:e=>e.target.blur(),style:{transform:"scale(1.5)",width:"14px",height:"20px"}})})}),(0,X.jsx)(Y,{align:"center",children:(0,X.jsx)(u.A,{title:"Edit",children:(0,X.jsx)(m.A,{onClick:()=>{return s=e,Ne((0,n.A)({},s)),void ke(!0);var s},color:"primary",size:"small",sx:{"&:hover":{backgroundColor:"rgba(25, 118, 210, 0.08)",transform:"scale(1.1)"},transition:"transform 0.2s"},children:(0,X.jsx)(M.A,{fontSize:"small"})})})}),D.map(a=>(0,X.jsx)(Y,{align:"center",children:e[a.accessor]},"".concat(s,"-").concat(a.accessor)))]},s))})]})}),(0,X.jsxs)($,{children:[(0,X.jsx)(P.A,{component:"div",count:qe.length,rowsPerPage:oe,page:ae,onPageChange:(e,s)=>{ne(s)},rowsPerPageOptions:[],sx:{"& .MuiTablePagination-toolbar":{padding:0,minHeight:"auto"},"& .MuiTablePagination-spacer":{display:"none"},"& .MuiTablePagination-actions":{marginLeft:"16px"}}}),(0,X.jsxs)(E.A,{variant:"outlined",size:"small",sx:{minWidth:120},children:[(0,X.jsx)(z.A,{children:"Rows per page"}),(0,X.jsx)(L.A,{value:oe,onChange:e=>{te(parseInt(e.target.value,10)),ne(0)},label:"Rows per page",children:(()=>{const e=[5,10,15,30,60,120,240],s=Math.max(...e);return r.length>s?[...e]:e})().map(e=>(0,X.jsx)(f.A,{value:e,children:e},e))})]})]})]}):(0,X.jsx)(x.A,{children:"Loading..."})]})}}}]);
//# sourceMappingURL=9920.08e96ead.chunk.js.map