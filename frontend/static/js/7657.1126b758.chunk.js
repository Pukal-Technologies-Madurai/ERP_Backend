"use strict";(self.webpackChunkerp=self.webpackChunkerp||[]).push([[7657],{79484:(e,l,o)=>{o.d(l,{A:()=>t});var n=o(59662),i=o(70579);const t=(0,n.A)((0,i.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search")},97657:(e,l,o)=>{o.r(l),o.d(l,{default:()=>B});var n=o(89379),i=o(65043),t=o(17392),d=o(41020),a=o(30922),s=o(32143),r=o(2050),u=o(48734),v=o(12110),c=o(11906),m=o(32357),p=o(26494),_=o(83462),h=o(26600),x=o(35316),C=o(29347),b=o(85865),j=o(33438),N=o(51387),y=o(83560),A=o(59383),T=o(76447),f=o(18124),g=o(79484),S=o(3632),I=o(73216),L=o(91036),R=o(48471),w=o(79773),D=o(65074),E=o(45777),k=o(97707),F=o(70579);const M=e=>{let{row:l,onOpen:o,onFilters:n,onEdit:v,onDelete:c}=e;const[m,p]=(0,i.useState)(null),_=Boolean(m);return(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(t.A,{onClick:e=>p(e.currentTarget),children:(0,F.jsx)(f.A,{})}),(0,F.jsx)(d.Ay,{open:_,anchorEl:m,onClose:()=>p(null),anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:(0,F.jsxs)(a.A,{children:[(0,F.jsxs)(s.A,{onClick:()=>{p(null),o(l)},children:[(0,F.jsx)(r.A,{children:(0,F.jsx)(S.A,{fontSize:"small"})}),(0,F.jsx)(u.A,{children:"Open"})]}),(0,F.jsxs)(s.A,{onClick:()=>{p(null),n(l)},children:[(0,F.jsx)(r.A,{children:(0,F.jsx)(A.A,{fontSize:"small"})}),(0,F.jsx)(u.A,{children:"Filters"})]}),(0,F.jsxs)(s.A,{onClick:()=>{p(null),v(l)},children:[(0,F.jsx)(r.A,{children:(0,F.jsx)(y.A,{fontSize:"small"})}),(0,F.jsx)(u.A,{children:"Edit"})]}),(0,F.jsxs)(s.A,{onClick:()=>{p(null),c(l)},children:[(0,F.jsx)(r.A,{children:(0,F.jsx)(N.A,{fontSize:"small",color:"error"})}),(0,F.jsx)(u.A,{children:"Delete"})]})]})})]})},B=()=>{var e;const l=JSON.parse(localStorage.getItem("user")),{contextObj:o}=(0,i.useContext)(E.i),d=(0,I.Zp)(),[a,s]=(0,i.useState)([]),[r,u]=(0,i.useState)(""),[y,A]=(0,i.useState)(!1),[f,S]=(0,i.useState)({}),[B,O]=(0,i.useState)(!1),[z,J]=(0,i.useState)(!1),[K,H]=(0,i.useState)(!1),[V,W]=(0,i.useState)({});(0,i.useEffect)(()=>{(0,D.z)({address:"reports/templateMobile"}).then(e=>{if(null!==e&&void 0!==e&&e.success){const l=((null===e||void 0===e?void 0:e.data)||[]).map(e=>{var l,o,i,t;const d={};(e.detailsList||[]).forEach(e=>{var l,o,n,i,t,a,s,r,u,v;const c=null!==(l=null===e||void 0===e?void 0:e.Table_Id)&&void 0!==l?l:"unknown_table_"+((null===e||void 0===e?void 0:e.Table_Name)||Math.random());var m,p,_,h;d[c]||(d[c]={Table_Id:c,Table_Name:null!==(m=null!==(p=null===e||void 0===e?void 0:e.Table_Name)&&void 0!==p?p:null===e||void 0===e?void 0:e.Table_Accronym)&&void 0!==m?m:"",AliasName:null!==(_=null!==(h=null===e||void 0===e?void 0:e.Table_Accronym)&&void 0!==h?h:null===e||void 0===e?void 0:e.Table_Name)&&void 0!==_?_:"",columnsList:[]});d[c].columnsList.push({Column_Name:null!==(o=null===e||void 0===e?void 0:e.Column_Name)&&void 0!==o?o:"",Column_Data_Type:null!==(n=null===e||void 0===e?void 0:e.Column_Data_Type)&&void 0!==n?n:"string"===typeof(null===e||void 0===e?void 0:e.Type)?e.Type:(null===e||void 0===e?void 0:e.Column_Data_Type)||"string",IS_Default:null!==(i=null===e||void 0===e?void 0:e.IS_Default)&&void 0!==i?i:0,IS_Join_Key:null!==(t=null===e||void 0===e?void 0:e.IS_Join_Key)&&void 0!==t?t:0,Order_By:null!==(a=null!==(s=null===e||void 0===e?void 0:e.Order_By)&&void 0!==s?s:null===e||void 0===e?void 0:e.OrderBy)&&void 0!==a?a:"",Type:null!==(r=null===e||void 0===e?void 0:e.Type)&&void 0!==r?r:"",List_Type:null!==(u=null===e||void 0===e?void 0:e.List_Type)&&void 0!==u?u:null,List_Type_Display:null!==(v=null===e||void 0===e?void 0:e.List_Type_Display)&&void 0!==v?v:"\u2014"})});const a=Object.values(d);return(0,n.A)((0,n.A)({},e),{},{tablesList:a,CreatedAt:null!==(l=null!==(o=null===e||void 0===e?void 0:e.Created_At)&&void 0!==o?o:null===e||void 0===e?void 0:e.CreatedAt)&&void 0!==l?l:null,CreatedBy:null!==(i=null!==(t=null===e||void 0===e?void 0:e.CreatedByGet)&&void 0!==t?t:null===e||void 0===e?void 0:e.CreatedBy)&&void 0!==i?i:"",TotalTables:a.length,TotalColumns:a.reduce((e,l)=>{var o;return e+((null===(o=l.columnsList)||void 0===o?void 0:o.length)||0)},0)})});s(l)}}).catch(e=>console.error(e))},[y]);const G=e=>{var l,o,n;S({Report_Type_Id:null!==(l=null!==(o=null===e||void 0===e?void 0:e.Report_Type_Id)&&void 0!==o?o:null===e||void 0===e?void 0:e.Mob_Rpt_Id)&&void 0!==l?l:null===e||void 0===e?void 0:e.Mob_Rpt_Id,reportName:null===e||void 0===e?void 0:e.Report_Name,tables:(null===e||void 0===e?void 0:e.tablesList)||(null===e||void 0===e?void 0:e.tablesList)||[],ReportState:null!==(n=null===e||void 0===e?void 0:e.ReportState)&&void 0!==n?n:""}),W({}),O(!0)},U=e=>{var l,o;S({Report_Type_Id:null!==(l=null===e||void 0===e?void 0:e.Report_Type_Id)&&void 0!==l?l:null===e||void 0===e?void 0:e.Mob_Rpt_Id,reportName:null===e||void 0===e?void 0:e.Report_Name,tables:(null===e||void 0===e?void 0:e.tablesList)||[],ReportState:null!==(o=null===e||void 0===e?void 0:e.ReportState)&&void 0!==o?o:""}),W({}),J(!0)},q=async e=>{var l;const o=null!==(l=null===e||void 0===e?void 0:e.Mob_Rpt_Id)&&void 0!==l?l:null===e||void 0===e?void 0:e.Report_Type_Id;try{const l=await(0,D.z)({address:"reports/templateMobile?Mob_Rpt_Id=".concat(o),method:"GET"});if(null!==l&&void 0!==l&&l.success){var n;const{reportName:i,details:t}=l.data,a={};t.forEach(e=>{const l=e.Table_Id;a[l]||(a[l]={Table_Id:l,Table_Name:e.Table_Name,AliasName:e.Table_Accronym||e.Table_Name,columns:[]}),a[l].columns.push({Column_Name:e.Column_Name,Column_Data_Type:e.Column_Data_Type,IS_Default:e.IS_Default,IS_Join_Key:e.IS_Join_Key,Type:e.Type,List_Type:e.List_Type,options:1===e.List_Type||"1"===e.List_Type?[]:void 0})});const s=Object.values(a),r=[];s.forEach(e=>{e.columns.forEach(l=>{if(1===l.List_Type||"1"===l.List_Type){const o=(0,D.z)({address:"reports/mobileReportDropdowns?reportName=".concat(encodeURIComponent(i)),method:"GET"}).then(o=>{if(null!==o&&void 0!==o&&o.success){const n=o.data.find(o=>o.columnName===l.Column_Name&&o.tableName===e.Table_Name);n&&n.options&&(l.options=n.options)}return l}).catch(e=>(console.error("Error fetching dropdown for ".concat(l.Column_Name,":"),e),l));r.push(o)}})}),r.length>0&&await Promise.all(r),d("create",{state:{ReportState:{Report_Type_Id:o,reportName:i,tables:s,createdBy:null!==(n=null===e||void 0===e?void 0:e.CreatedBy)&&void 0!==n?n:null===e||void 0===e?void 0:e.CreatedByGet}}})}else L.oR.error("Failed to load data")}catch(i){L.oR.error("Error fetching template"),console.error(i)}},P=e=>{var l;S({Mob_Rpt_Id:null!==(l=null===e||void 0===e?void 0:e.Mob_Rpt_Id)&&void 0!==l?l:null===e||void 0===e?void 0:e.Report_Type_Id,reportName:null===e||void 0===e?void 0:e.Report_Name}),H(!0)},Y=(e,l)=>{W(o=>(0,n.A)((0,n.A)({},o),{},{[e]:l}))},Z=r?a.filter(e=>{var l;return String(null!==(l=null===e||void 0===e?void 0:e.Report_Name)&&void 0!==l?l:"").toLowerCase().includes(r.toLowerCase())}):a;return(0,F.jsxs)(F.Fragment,{children:[(0,F.jsxs)(v.A,{children:[(0,F.jsxs)("div",{className:"p-2 border-bottom fa-16 fw-bold d-flex justify-content-between align-items-center",children:[(0,F.jsx)("span",{className:"text-primary text-uppercase ps-3",children:"Mobile Report Templates"}),(0,k.id)(null===o||void 0===o?void 0:o.Add_Rights,1)&&(0,F.jsx)(c.A,{variant:"outlined",onClick:()=>d("create"),children:"Add Template"})]}),(0,F.jsx)("div",{className:"d-flex justify-content-end p-3",children:(0,F.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,F.jsx)(g.A,{}),(0,F.jsx)(m.Ay,{placeholder:"Search Report Name",value:r,onChange:e=>u(e.target.value)})]})}),(0,F.jsx)(p.A,{className:"p-0",children:(0,F.jsx)(R.Ay,{dataArray:Z,columns:[{Field_Name:"Report_Name",ColumnHeader:"Report Name",Fied_Data:"string",isVisible:1},{ColumnHeader:"Tables",isVisible:1,isCustomCell:!0,Cell:e=>{var l,o,n;let{row:i}=e;return null!==(l=null===i||void 0===i?void 0:i.TotalTables)&&void 0!==l?l:null!==(o=null===i||void 0===i||null===(n=i.tablesList)||void 0===n?void 0:n.length)&&void 0!==o?o:0}},{ColumnHeader:"Columns",isVisible:1,isCustomCell:!0,Cell:e=>{var l,o;let{row:n}=e;return null!==(l=null===n||void 0===n?void 0:n.TotalColumns)&&void 0!==l?l:null===n||void 0===n||null===(o=n.tablesList)||void 0===o?void 0:o.reduce((e,l)=>{var o;return e+Number((null===l||void 0===l||null===(o=l.columnsList)||void 0===o?void 0:o.length)||0)},0)}},{Field_Name:"CreatedBy",ColumnHeader:"Created By",Fied_Data:"string",isVisible:1},{ColumnHeader:"CreatedAt",isVisible:1,isCustomCell:!0,Cell:e=>{let{row:l}=e;return null!==l&&void 0!==l&&l.CreatedAt?(0,k.K0)(null===l||void 0===l?void 0:l.CreatedAt):" - "}},{ColumnHeader:"Action",isVisible:1,isCustomCell:!0,Cell:e=>{let{row:l}=e;return(0,F.jsx)(M,{row:l,onOpen:G,onFilters:U,onEdit:q,onDelete:P})}}],EnableSerialNumber:!0,isExpendable:!0,expandableComp:e=>{var l;let{row:o}=e;return(0,F.jsx)("div",{className:"table-responsive",children:(0,F.jsxs)("table",{className:"table",children:[(0,F.jsx)("thead",{children:(0,F.jsx)("tr",{children:["SNo","Table","Column","Type","List Type"].map(e=>(0,F.jsx)("th",{className:"border fa-14 text-center",style:{backgroundColor:"#EDF0F7"},children:e},e))})}),(0,F.jsx)("tbody",{children:null===o||void 0===o||null===(l=o.tablesList)||void 0===l?void 0:l.map((e,l)=>{var o;return(0,F.jsx)(i.Fragment,{children:null===e||void 0===e||null===(o=e.columnsList)||void 0===o?void 0:o.map((o,n)=>{var i,t,d;return(0,F.jsxs)("tr",{children:[0===n&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)("td",{className:"border fa-13 text-center vctr",rowSpan:null===e||void 0===e||null===(i=e.columnsList)||void 0===i?void 0:i.length,children:l+1}),(0,F.jsx)("td",{className:"border fa-13 text-center blue-text vctr",rowSpan:null===e||void 0===e||null===(t=e.columnsList)||void 0===t?void 0:t.length,children:(null===e||void 0===e?void 0:e.AliasName)||(null===e||void 0===e?void 0:e.Table_Name)})]}),(0,F.jsx)("td",{className:"border fa-13 vctr ".concat(Boolean(Number(null===o||void 0===o?void 0:o.IS_Default))?" blue-text ":""," ").concat(Boolean(Number(null===o||void 0===o?void 0:o.IS_Join_Key))?" fw-bold ":""),children:null===o||void 0===o?void 0:o.Column_Name}),(0,F.jsx)("td",{className:"border fa-13 vctr",children:null!==(d=null===o||void 0===o?void 0:o.Column_Data_Type)&&void 0!==d?d:"-"}),(0,F.jsx)("td",{className:"border fa-13 vctr",children:(null===o||void 0===o?void 0:o.List_Type_Display)||("1"===(null===o||void 0===o?void 0:o.List_Type)?"Sum":"2"===(null===o||void 0===o?void 0:o.List_Type)?"Avg":"1,2"===(null===o||void 0===o?void 0:o.List_Type)?"Sum, Avg":"2,1"===(null===o||void 0===o?void 0:o.List_Type)?"Avg, Sum":"\u2014")})]},n)})},l)})})]})})},tableMaxHeight:650})})]}),(0,F.jsxs)(_.A,{open:B,onClose:()=>O(!1),fullScreen:!0,children:[(0,F.jsxs)(h.A,{className:"d-flex justify-content-between align-items-center",children:[(0,F.jsxs)("span",{children:["Report - ",(0,F.jsx)("span",{className:"blue-text",children:f.reportName})]}),(0,F.jsx)("span",{children:(0,F.jsx)(t.A,{onClick:()=>O(!1),color:"error",children:(0,F.jsx)(j.A,{})})})]}),(0,F.jsx)(x.A,{children:(null===f||void 0===f?void 0:f.Report_Type_Id)&&(null===l||void 0===l?void 0:l.Company_id)&&(0,F.jsx)(w.A,{reportId:f.Report_Type_Id,company:null===l||void 0===l?void 0:l.Company_id,queryFilters:V})}),(0,F.jsx)(C.A,{children:(0,F.jsx)(c.A,{onClick:()=>O(!1),children:"Back"})})]}),(0,F.jsxs)(_.A,{open:z,onClose:()=>J(!1),fullWidth:!0,maxWidth:"md",children:[(0,F.jsxs)(h.A,{className:"d-flex justify-content-between",children:[(0,F.jsxs)("span",{children:["Filters For ",(0,F.jsx)("span",{className:"blue-text",children:f.reportName})]}),(0,F.jsx)("span",{children:(0,F.jsx)(t.A,{onClick:()=>J(!1),color:"error",children:(0,F.jsx)(j.A,{})})})]}),(0,F.jsx)(x.A,{children:(0,F.jsx)("div",{className:"row",children:null===f||void 0===f||null===(e=f.tables)||void 0===e?void 0:e.map((e,l)=>(0,F.jsxs)("div",{className:"col-12 mb-3",children:[(0,F.jsx)(b.A,{fontWeight:700,children:null===e||void 0===e?void 0:e.AliasName}),(0,F.jsx)("div",{className:"row",children:((null===e||void 0===e?void 0:e.columns)||(null===e||void 0===e?void 0:e.columnsList)||[]).map((e,l)=>{var o,i,t,d,a,s,r,u,v,c;null!==e&&void 0!==e&&e.Column_Name||null!==e&&void 0!==e&&e.Column_Name;const m=((null===e||void 0===e?void 0:e.Column_Data_Type)||(null===e||void 0===e?void 0:e.ColumnType)||"string").toString().toLowerCase(),p=Boolean(Number((null===e||void 0===e?void 0:e.IS_Default)||(null===e||void 0===e?void 0:e.ISDEFAULT)||0)),_=Boolean(Number((null===e||void 0===e?void 0:e.IS_Join_Key)||(null===e||void 0===e?void 0:e.IS_JOIN_KEY)||0));return p||_?null:(0,F.jsxs)("div",{className:"col-md-6 p-2",children:[(0,F.jsx)("label",{className:"mb-2 fw-bold text-muted",children:null===e||void 0===e?void 0:e.Column_Name}),"number"===m&&(0,F.jsxs)("div",{className:"d-flex gap-2",children:[(0,F.jsx)("input",{type:"number",placeholder:"Min",className:"cus-inpt me-1",value:null!==(o=null===(i=V[e.Column_Name])||void 0===i?void 0:i.min)&&void 0!==o?o:"",onChange:l=>Y(e.Column_Name,(0,n.A)((0,n.A)({},V[e.Column_Name]),{},{min:l.target.value?Number(l.target.value):void 0}))}),(0,F.jsx)("input",{type:"number",placeholder:"Max",className:"cus-inpt ms-1",value:null!==(t=null===(d=V[e.Column_Name])||void 0===d?void 0:d.max)&&void 0!==t?t:"",onChange:l=>Y(e.Column_Name,(0,n.A)((0,n.A)({},V[e.Column_Name]),{},{max:l.target.value?Number(l.target.value):void 0}))})]}),"date"===m&&(0,F.jsxs)("div",{className:"d-flex gap-2",children:[(0,F.jsx)("input",{type:"date",className:"cus-inpt me-1",value:null!==(a=null===(s=V[e.Column_Name])||void 0===s?void 0:s.start)&&void 0!==a?a:"",onChange:l=>Y(e.Column_Name,(0,n.A)((0,n.A)({},V[e.Column_Name]),{},{start:l.target.value||void 0}))}),(0,F.jsx)("input",{type:"date",className:"cus-inpt ms-1",value:null!==(r=null===(u=V[e.Column_Name])||void 0===u?void 0:u.end)&&void 0!==r?r:"",onChange:l=>Y(e.Column_Name,(0,n.A)((0,n.A)({},V[e.Column_Name]),{},{end:l.target.value||void 0}))})]}),"date"!==m&&"number"!==m&&(0,F.jsx)("input",{type:"text",placeholder:"Search...",className:"cus-inpt",value:null!==(v=null===(c=V[e.Column_Name])||void 0===c?void 0:c.value)&&void 0!==v?v:"",onChange:l=>Y(e.Column_Name,(0,n.A)((0,n.A)({},V[e.Column_Name]),{},{value:String(l.target.value).toLowerCase()||""}))})]},l)})})]},l))})}),(0,F.jsxs)(C.A,{children:[(0,F.jsx)(c.A,{onClick:()=>{W({}),J(!1)},children:"Cancel"}),(0,F.jsx)(c.A,{variant:"contained",startIcon:(0,F.jsx)(T.A,{}),onClick:()=>{O(!0),J(!1)},children:"Open report"})]})]}),(0,F.jsxs)(_.A,{open:K,onClose:()=>H(!1),fullWidth:!0,maxWidth:"sm",children:[(0,F.jsx)(h.A,{children:"Confirmation"}),(0,F.jsxs)(x.A,{children:["Do you want to delete the Template ",(0,F.jsx)("span",{className:"blue-text",children:f.reportName})," permanently?"]}),(0,F.jsxs)(C.A,{children:[(0,F.jsx)(c.A,{onClick:()=>H(!1),children:"Cancel"}),(0,F.jsx)(c.A,{onClick:()=>{(0,D.z)({address:"reports/templateMobile",method:"DELETE",bodyData:{Mob_Rpt_Id:f.Mob_Rpt_Id}}).then(e=>{null!==e&&void 0!==e&&e.success?(L.oR.success(e.message),A(e=>!e)):L.oR.error((null===e||void 0===e?void 0:e.message)||"Failed to delete")}).catch(e=>console.error(e)).finally(()=>H(!1))},startIcon:(0,F.jsx)(N.A,{}),variant:"outlined",color:"error",children:"Delete"})]})]})]})}}}]);
//# sourceMappingURL=7657.1126b758.chunk.js.map