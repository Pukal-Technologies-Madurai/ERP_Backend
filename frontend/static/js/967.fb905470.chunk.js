"use strict";(self.webpackChunkerp=self.webpackChunkerp||[]).push([[967],{30967:(e,l,a)=>{a.r(l),a.d(l,{default:()=>W,exportTableToXlsx:()=>O,getRows:()=>S,getVisibleColumns:()=>T,rowsToAoA:()=>k});var n=a(89379),t=a(54815),o=a(97707),s=a(65043),r=a(81e3),i=a(77739),d=a(17392),u=a(12412),c=a(51962),m=a(67784),v=a(83462),p=a(26600),g=a(35316),x=a(29347),h=a(11906),C=a(5793),y=a(12249),_=a(56630),A=a(59383),f=a(8846),b=a(79484),N=a(7871),j=(a(68926),a(65074)),w=a(11238),D=a(70579);function T(e){return e.getVisibleLeafColumns()}function S(e,l){var a;const n="currentPage"===l?e.getRowModel():e.getPrePaginationRowModel();return(null!==(a=n.flatRows)&&void 0!==a?a:n.rows).filter(e=>{var l,a,n;return!(null!==(l=e.getIsGrouped)&&void 0!==l&&l.call(e)||null!==(a=e.getIsAggregated)&&void 0!==a&&a.call(e)||null!==(n=e.getIsPlaceholder)&&void 0!==n&&n.call(e))})}function k(e,l){return[l.map(e=>{var l,a,n;const t=null!==(l=null!==(a=null===(n=e.columnDef)||void 0===n?void 0:n.header)&&void 0!==a?a:e.id)&&void 0!==l?l:"";return"string"===typeof t?t:String(t)}),...e.map(e=>l.map(l=>{var a,n,t,o;const s=null===(a=e.getVisibleCells)||void 0===a?void 0:a.call(e).find(e=>e.column.id===l.id);if(s&&"function"===typeof s.getValue)return s.getValue();if("function"===typeof e.getValue)return e.getValue(l.id);const r=null===(n=l.columnDef)||void 0===n?void 0:n.accessorFn;return r?r(e.original):null!==(t=null===(o=e.original)||void 0===o?void 0:o[l.accessorKey])&&void 0!==t?t:""}))]}function O(e){var l,a;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const t=(null!==(l=n.filename)&&void 0!==l?l:"table_export")+".xlsx",o=null!==(a=n.scope)&&void 0!==a?a:"all",s=T(e),r=k(S(e,o),s),i=w.Wp.aoa_to_sheet(r),d=w.Wp.book_new();w.Wp.book_append_sheet(d,i,"Data");const u=r[0].map((e,l)=>Math.max(...r.map(e=>{var a;return String(null!==(a=null===e||void 0===e?void 0:e[l])&&void 0!==a?a:"").length}))+2);i["!cols"]=u.map(e=>({wch:e})),w._h(d,t)}const F=(e,l)=>{switch(l){case"number":return(0,o.Ro)(e)>0?(0,o.jG)(e):0;case"date":return e?(0,o.yc)(e):"";case"string":return e;default:return""}},B=[{Column_Name:"Retailer",accessColumnName:"Retailer_Name",Column_Data_Type:"string",Order_By:1},{Column_Name:"Product",accessColumnName:"Item_Name",Column_Data_Type:"string",Order_By:2},{Column_Name:"Worth",accessColumnName:"StockValueOfItem",Column_Data_Type:"number",Order_By:3},{Column_Name:"Update Date",accessColumnName:"ST_Date",Column_Data_Type:"date",Order_By:4},{Column_Name:"Update Qty",accessColumnName:"ST_Qty",Column_Data_Type:"number",Order_By:6},{Column_Name:"Entry Date",accessColumnName:"Do_Date",Column_Data_Type:"date",Order_By:5},{Column_Name:"Entry Qty",accessColumnName:"Bill_Qty",Column_Data_Type:"number",Order_By:7},{Column_Name:"Stock Days",accessColumnName:"stockDays",Column_Data_Type:"number",Order_By:8},{Column_Name:"Sold Qty",accessColumnName:"soldQuantity",Column_Data_Type:"number",Order_By:9},{Column_Name:"Closing By",accessColumnName:"ClosingStockBy",Column_Data_Type:"string",Order_By:10}],R=(0,D.jsx)(y.A,{fontSize:"small"}),V=(0,D.jsx)(C.A,{fontSize:"small"}),W=e=>{let{loadingOn:l,loadingOff:a}=e;const[C,y]=(0,s.useState)([]),[w,T]=(0,s.useState)(B),[S,k]=(0,s.useState)({}),[W,z]=(0,s.useState)(C),P=Object.keys(S).length>0?W:C,[I,Q]=(0,s.useState)({}),[M,E]=(0,s.useState)({filters:!1,aggregations:!1}),[G,H]=(0,s.useState)({Fromdate:(0,o.ny)(),Todate:(0,o.ny)(),search:!1});(0,s.useEffect)(()=>{y([]),(0,j.z)({address:"\n            reports/customerClosingStock/itemWithRetailer?\n            Fromdate=".concat(G.Fromdate,"&\n            Todate=").concat(G.Todate),loadingOn:l,loadingOff:a}).then(e=>{if(null!==e&&void 0!==e&&e.success){const l=(0,o.$r)(null===e||void 0===e?void 0:e.data).map(e=>{const l=null!==e&&void 0!==e&&e.Do_Date?(0,o.ny)(null===e||void 0===e?void 0:e.Do_Date):"",a=null!==e&&void 0!==e&&e.ST_Date?(0,o.ny)(null===e||void 0===e?void 0:e.ST_Date):"";return(0,n.A)((0,n.A)({},e),{},{Do_Date:l,ST_Date:a,stockDays:l&&a?(0,o.LH)(l,a):"",soldQuantity:(0,o.Ro)((0,o.DG)(null===e||void 0===e?void 0:e.Bill_Qty,null===e||void 0===e?void 0:e.ST_Qty))})});y(l)}else y([])}).catch(e=>console.log(e))},[G.search]);const L=(0,s.useMemo)(()=>[...w].map(e=>{var l;return(0,n.A)({header:null===e||void 0===e||null===(l=e.Column_Name)||void 0===l?void 0:l.replace(/_/g," "),accessorKey:null===e||void 0===e?void 0:e.accessColumnName,sortable:!0,size:(0,o.xL)(null===e||void 0===e?void 0:e.accessColumnName,"Retailer_Name")||(0,o.xL)(null===e||void 0===e?void 0:e.accessColumnName,"Item_Name")?190:110,aggregationFn:I[null===e||void 0===e?void 0:e.Column_Name]?I[null===e||void 0===e?void 0:e.Column_Name]:"",AggregatedCell:e=>{let{cell:l}=e;return(0,D.jsx)("div",{className:"blue-text float-end w-100",children:l.getValue()?(0,o.jG)(l.getValue()):""})},Cell:l=>{let{cell:a}=l;return(0,D.jsx)("p",{className:"m-0 fa-11 w-100",children:F(a.getValue(),null===e||void 0===e?void 0:e.Column_Data_Type)})}},(e=>{switch(e){case"number":return{filterVariant:"range",filterFn:"between"};case"date":case"string":return{filterVariant:"text"};default:return{}}})(null===e||void 0===e?void 0:e.Column_Data_Type))}),[w,I]);(0,s.useEffect)(()=>{X()},[S]);const K=(0,t.Up)({columns:L,data:P||[],enableColumnResizing:!0,enableGrouping:!0,enableStickyHeader:!0,enableStickyFooter:!0,enableColumnOrdering:!0,enableKeyboardShortcuts:!1,enableColumnActions:!1,enableColumnFilters:!1,enableRowNumbers:!1,enableGlobalFilter:!1,initialState:{density:"compact",pagination:{pageIndex:0,pageSize:100}},muiToolbarAlertBannerChipProps:{color:"primary"},muiTableContainerProps:{sx:{maxHeight:"68dvh",minHeight:"46vh"}},muiTableProps:{sx:{caption:{captionSide:"top"}}},muiTableHeadCellProps:{sx:{fontWeight:"normal"},className:" border"},muiTableBodyCellProps:{className:" border-end"},renderTopToolbarCustomActions:e=>{let{table:l}=e;return(0,D.jsxs)(r.A,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"space-between",width:"100%"},children:[(0,D.jsxs)(r.A,{sx:{display:"flex",gap:"8px",padding:"8px",flexWrap:"wrap"},children:[(0,D.jsxs)("div",{className:"d-flex flex-column",children:[(0,D.jsx)("label",{children:"Fromdate"}),(0,D.jsx)("input",{type:"date",value:G.Fromdate,onChange:e=>H(l=>(0,n.A)((0,n.A)({},l),{},{Fromdate:e.target.value})),className:"cus-inpt w-auto p-2"})]}),(0,D.jsxs)("div",{className:"d-flex flex-column",children:[(0,D.jsx)("label",{children:"Todate"}),(0,D.jsx)("input",{type:"date",value:G.Todate,onChange:e=>H(l=>(0,n.A)((0,n.A)({},l),{},{Todate:e.target.value})),className:"cus-inpt w-auto p-2"})]})]}),(0,D.jsxs)(r.A,{sx:{display:"flex",gap:"8px",alignItems:"start",padding:"8px",flexWrap:"wrap"},children:[(0,D.jsx)(i.A,{title:"Search",children:(0,D.jsx)(d.A,{onClick:()=>H(e=>(0,n.A)((0,n.A)({},e),{},{search:!e.search})),size:"small",children:(0,D.jsx)(b.A,{color:"primary"})})}),(0,D.jsx)(i.A,{title:"Excel Download (Current page only)",children:(0,D.jsx)("span",{children:(0,D.jsx)(d.A,{size:"small",disabled:0===l.getRowModel().rows.length,onClick:()=>O(l,{scope:"currentPage",filename:"my_data_page"}),children:(0,D.jsx)(_.A,{color:"primary"})})})}),(0,D.jsx)(i.A,{title:"Aggregation",children:(0,D.jsx)(d.A,{onClick:()=>E(e=>(0,n.A)((0,n.A)({},e),{},{aggregations:!0})),size:"small",children:(0,D.jsx)(N.A,{color:"primary"})})}),(0,D.jsx)(i.A,{title:"Filters",children:(0,D.jsx)(d.A,{onClick:()=>E(e=>(0,n.A)((0,n.A)({},e),{},{filters:!0})),size:"small",children:(0,D.jsx)(A.A,{color:"primary"})})})]})]})}}),U=(0,s.useMemo)(()=>K,[K,I,P]),q=(e,l)=>{k(a=>(0,n.A)((0,n.A)({},a),{},{[e]:l}))},X=()=>{let e=[...C];for(const a of w)if(S[a.accessColumnName])if("range"===S[a.accessColumnName].type){const{min:l,max:n}=S[a.accessColumnName];e=e.filter(e=>{const t=e[a.accessColumnName];return(void 0===l||t>=l)&&(void 0===n||t<=n)})}else if("date"===S[a.accessColumnName].type){const{start:l,end:n}=S[a.accessColumnName].value;e=e.filter(e=>{const t=new Date(e[a.accessColumnName]);return(void 0===l||t>=new Date(l))&&(void 0===n||t<=new Date(n))})}else if(Array.isArray(S[a.accessColumnName])){var l;e=(null===(l=S[a.accessColumnName])||void 0===l?void 0:l.length)>0?e.filter(e=>S[a.accessColumnName].includes((0,o.iw)(e[a.accessColumnName]))):e}z(e)},$=e=>{const{accessColumnName:l,Column_Name:a,Column_Data_Type:t}=e;var o,s,r,i,d,v,p,g,x,h;if("number"===t)return(0,D.jsxs)("div",{className:"d-flex justify-content-between px-2",children:[(0,D.jsx)("input",{placeholder:"Min",type:"number",className:"bg-light border-0 m-1 p-1 w-50",value:null!==(o=null===(s=S[l])||void 0===s?void 0:s.min)&&void 0!==o?o:"",onChange:e=>q(l,(0,n.A)((0,n.A)({type:"range"},S[l]),{},{min:e.target.value?parseFloat(e.target.value):void 0}))}),(0,D.jsx)("input",{placeholder:"Max",type:"number",className:"bg-light border-0 m-1 p-1 w-50",value:null!==(r=null===(i=S[l])||void 0===i?void 0:i.max)&&void 0!==r?r:"",onChange:e=>q(l,(0,n.A)((0,n.A)({type:"range"},S[l]),{},{max:e.target.value?parseFloat(e.target.value):void 0}))})]});if("date"===t)return(0,D.jsxs)("div",{className:"d-flex justify-content-between px-2",children:[(0,D.jsx)("input",{placeholder:"Start Date",type:"date",className:"bg-light border-0 m-1 p-1 w-50",value:null!==(d=null===(v=S[l])||void 0===v||null===(p=v.value)||void 0===p?void 0:p.start)&&void 0!==d?d:"",onChange:e=>{var a;return q(l,{type:"date",value:(0,n.A)((0,n.A)({},null===(a=S[l])||void 0===a?void 0:a.value),{},{start:e.target.value||void 0})})}}),(0,D.jsx)("input",{placeholder:"End Date",type:"date",className:"bg-light border-0 m-1 p-1 w-50",value:null!==(g=null===(x=S[l])||void 0===x||null===(h=x.value)||void 0===h?void 0:h.end)&&void 0!==g?g:"",onChange:e=>{var a;return q(l,{type:"date",value:(0,n.A)((0,n.A)({},null===(a=S[l])||void 0===a?void 0:a.value),{},{end:e.target.value||void 0})})}})]});if("string"===t){const e=[...new Set(C.map(e=>{var a,n;return null===(a=e[l])||void 0===a||null===(n=a.toLowerCase())||void 0===n?void 0:n.trim()}))].sort();return(0,D.jsx)(u.A,{multiple:!0,id:"".concat(l,"-filter"),options:e,disableCloseOnSelect:!0,getOptionLabel:e=>e,value:S[l]||[],onChange:(e,a)=>q(l,a),renderOption:(e,l,a)=>{let{selected:t}=a;return(0,D.jsxs)("li",(0,n.A)((0,n.A)({},e),{},{children:[(0,D.jsx)(c.A,{icon:R,checkedIcon:V,style:{marginRight:8},checked:t}),l]}))},isOptionEqualToValue:(e,l)=>e===l,renderInput:e=>(0,D.jsx)(m.A,(0,n.A)((0,n.A)({},e),{},{label:null===a||void 0===a?void 0:a.replace(/_/g," "),placeholder:"Select ".concat(null===a||void 0===a?void 0:a.replace(/_/g," "))}))})}};return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(t.zp,{table:U}),(0,D.jsxs)(v.A,{open:M.filters,onClose:()=>E(e=>(0,n.A)((0,n.A)({},e),{},{filters:!1})),fullWidth:!0,maxWidth:"sm",children:[(0,D.jsx)(p.A,{children:(0,D.jsxs)("h5",{className:"d-flex justify-content-between px-2",children:["Filters",(0,D.jsx)(i.A,{title:"Clear Filters",children:(0,D.jsx)(d.A,{size:"small",onClick:()=>k({}),children:(0,D.jsx)(f.A,{})})})]})}),(0,D.jsx)(g.A,{children:(0,D.jsxs)("div",{className:"border rounded-3 ",style:{maxHeight:"70vh",overflow:"auto"},children:[w.map((e,l)=>{var a;return(0,D.jsxs)("div",{className:"py-3 px-3 hov-bg border-bottom",children:[(0,D.jsx)("label",{className:"mt-2 mb-1",children:null===e||void 0===e||null===(a=e.Column_Name)||void 0===a?void 0:a.replace(/_/g," ")}),$(e)]},l)}),(0,D.jsx)("br",{})]})}),(0,D.jsx)(x.A,{children:(0,D.jsx)(h.A,{onClick:()=>E(e=>(0,n.A)((0,n.A)({},e),{},{filters:!1})),children:"Close"})})]}),(0,D.jsxs)(v.A,{open:M.aggregations,onClose:()=>E(e=>(0,n.A)((0,n.A)({},e),{},{aggregations:!1})),fullWidth:!0,maxWidth:"sm",children:[(0,D.jsx)(p.A,{children:"Aggregations"}),(0,D.jsx)(g.A,{children:(0,D.jsx)("div",{className:"row",children:[...w].filter(e=>"number"===e.Column_Data_Type).map((e,l)=>{var a,t;return(0,D.jsxs)("div",{className:"col-md-6 p-2",children:[(0,D.jsx)("label",{children:null===e||void 0===e||null===(a=e.Column_Name)||void 0===a?void 0:a.replace(/_/g," ")}),(0,D.jsx)("select",{className:"cus-inpt",value:null!==(t=I[null===e||void 0===e?void 0:e.Column_Name])&&void 0!==t?t:"",onChange:l=>Q(a=>(0,n.A)((0,n.A)({},a),{},{[e.Column_Name]:l.target.value})),children:[{label:"Select Aggregation",value:""},{label:"mean",value:"mean"},{label:"sum",value:"sum"}].map((e,l)=>(0,D.jsx)("option",{value:e.value,children:e.label},l))})]},l)})})}),(0,D.jsx)(x.A,{children:(0,D.jsx)(h.A,{onClick:()=>E(e=>(0,n.A)((0,n.A)({},e),{},{aggregations:!1})),children:"Close"})})]})]})}}}]);
//# sourceMappingURL=967.fb905470.chunk.js.map