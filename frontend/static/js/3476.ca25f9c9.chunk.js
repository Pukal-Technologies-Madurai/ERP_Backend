"use strict";(self.webpackChunkerp=self.webpackChunkerp||[]).push([[3476],{3476:(e,l,a)=>{a.r(l),a.d(l,{default:()=>E});var t=a(89379),s=a(65043),r=a(65074),d=a(12110),o=a(4598),n=a(11906),i=a(26494),c=a(17392),u=a(83462),v=a(26600),m=a(35316),_=a(70141),h=a(51387),p=a(97707),I=a(48471),x=a(91036),j=a(73216),N=a(14844);const A=localStorage.getItem("user"),g=(0,p.zM)(A)?JSON.parse(A):{},b={PIN_Id:"",Po_Inv_No:"",Branch_Id:"",Voucher_Type:0,Ref_Po_Inv_No:"",Po_Inv_Date:(0,p.ny)(),Po_Entry_Date:(0,p.ny)(),Retailer_Id:"",Retailer_Name:"",GST_Inclusive:2,IS_IGST:0,Narration:"",isConverted:"",CSGT_Total:0,SGST_Total:0,IGST_Total:0,Round_off:0,Total_Before_Tax:0,Total_Tax:0,Total_Invoice_value:0,Cancel_status:0,Stock_Item_Ledger_Name:"",Created_by:g.UserId,Altered_by:g.UserId,Created_on:"",Alterd_on:"",Trans_Type:"",Alter_Id:"",Approved_By:"",Approve_Status:""},y={Trip_Id:"",Trip_Item_SNo:"",POI_St_Id:"",DeliveryId:"",OrderId:"",PIN_Id:"",Po_Inv_Date:"",S_No:"",Location_Id:"",Item_Id:"",Item_Name:"",Bill_Qty:0,Act_Qty:0,Item_Rate:0,Bill_Alt_Qty:0,Free_Qty:0,Unit_Id:"",Unit_Name:"",Batch_No:"",Taxable_Rate:0,Amount:0,Total_Qty:0,Taxble:0,HSN_Code:"",Taxable_Amount:0,Tax_Rate:0,Cgst:0,Cgst_Amo:0,Sgst:0,Sgst_Amo:0,Igst:0,Igst_Amo:0,Final_Amo:0,Created_on:""},f={Id:"",PIN_Id:"",Involved_Emp_Id:"",Involved_Emp_Name:"select",Cost_Center_Type_Id:""};var C=a(29347),S=a(34496),T=a(14792),B=a(20656),P=a(63406),R=a(70579);const D=e=>{var l,a;let{children:r,orderProducts:d=[],setOrderProducts:o,open:i=!1,onClose:c,products:_=[],brands:h=[],uom:I=[],godowns:j=[],GST_Inclusive:A,IS_IGST:g,editValues:b=null,initialValue:y={}}=e;const[f,D]=(0,s.useState)(y),G=(0,p.id)(A,1),w=(0,p.id)(A,2);(0,s.useEffect)(()=>{(0,p.aF)(b)&&i&&D(e=>Object.fromEntries(Object.entries(e).map(e=>{let[l,a]=e;return[l,b[l]?b[l]:a]})))},[b]);const O=e=>{var l;return null!==(l=null===_||void 0===_?void 0:_.find(l=>(0,p.id)(null===l||void 0===l?void 0:l.Product_Id,e)))&&void 0!==l?l:{}},Q=()=>{D(y),c()};return(0,R.jsxs)(R.Fragment,{children:[r,(0,R.jsxs)(u.A,{open:i,onClose:Q,maxWidth:"md",fullWidth:!0,children:[(0,R.jsx)(v.A,{className:"border-bottom",children:(0,R.jsx)("span",{children:"Add Products Details"})}),(0,R.jsxs)("form",{onSubmit:e=>{e.preventDefault(),f.Item_Id?(o(e=>[...e.filter(e=>!(0,p.id)(e.Item_Id,f.Item_Id)),Object.fromEntries(Object.entries(y).map(e=>{let[l,a]=e;const t=O(f.Item_Id),s=g?t.Igst_P:t.Gst_P,r=s>0,{Bill_Qty:d,Item_Rate:o,Amount:n}=f,i=w?"zerotax":G?"remove":"add",c=(0,N.v)(o,s,i),u=(0,N.v)(n,s,i),v=g?0:u.cgst_per,m=g?u.igst_per:0,_=g?0:u.cgst_amount,h=g?u.igst_amount:0;switch(l){case"Item_Name":return[l,t.Product_Name];case"Taxable_Rate":return[l,c.base_amount];case"Total_Qty":return[l,d];case"Taxble":return[l,r?1:0];case"Taxable_Amount":return[l,u.base_amount];case"Tax_Rate":return[l,s];case"Cgst":case"Sgst":return[l,null!==v&&void 0!==v?v:0];case"Cgst_Amo":case"Sgst_Amo":return[l,w?0:_];case"Igst":return[l,null!==m&&void 0!==m?m:0];case"Igst_Amo":return[l,w?0:h];case"Final_Amo":return[l,u.with_tax];default:return[l,f[l]||a]}}))]),Q()):x.oR.warn("Select Product")},children:[(0,R.jsx)(m.A,{children:(0,R.jsxs)("div",{className:"row pb-5",children:[(0,R.jsxs)("div",{className:"col-6 p-2",children:[(0,R.jsx)("label",{children:"Brand"}),(0,R.jsx)(B.Ay,{value:{value:f.BrandID,label:f.Brand},onChange:e=>D(l=>(0,t.A)((0,t.A)({},l),{},{BrandID:e.value,Brand:e.label})),options:[{value:"",label:"select",isDisabled:!0},...h.map(e=>({value:null===e||void 0===e?void 0:e.Brand,label:null===e||void 0===e?void 0:e.Brand_Name}))],styles:P.MR,menuPortalTarget:document.body,isSearchable:!0,placeholder:"Select Brand",maxMenuHeight:200,filterOption:p.GI})]}),(0,R.jsxs)("div",{className:"col-6 p-2",children:[(0,R.jsx)("label",{children:"Group"}),(0,R.jsx)(B.Ay,{value:{value:f.GroupID,label:f.Group},onChange:e=>D(l=>(0,t.A)((0,t.A)({},l),{},{GroupID:e.value,Group:e.label})),options:[{value:"",label:"select",isDisabled:!0},..._.filter(e=>!f.BrandID||(0,p.id)(e.Brand,f.BrandID)).reduce((e,l)=>(e.some(e=>e.value===l.Product_Group)||e.push({value:l.Product_Group,label:l.Pro_Group}),e),[])],styles:P.MR,menuPortalTarget:document.body,isSearchable:!0,placeholder:"Select Group",maxMenuHeight:200,filterOption:p.GI})]}),(0,R.jsxs)("div",{className:"col-md-8 p-2",children:[(0,R.jsxs)("label",{children:["Item Name ",(0,R.jsx)(T.A,{})]}),(0,R.jsx)(B.Ay,{value:{value:f.Item_Id,label:null===(l=O(f.Item_Id))||void 0===l?void 0:l.Product_Name},isDisabled:(0,p.IQ)(f.Pre_Id),menuPortalTarget:document.body,onChange:e=>{const l=O(e.value);D(a=>{var s,r,d,o,n,i,c;return(0,t.A)((0,t.A)({},a),{},{Group:null!==(s=l.Pro_Group)&&void 0!==s?s:a.Group,GroupID:null!==(r=l.Product_Group)&&void 0!==r?r:a.GroupID,Brand:null!==(d=l.Brand_Name)&&void 0!==d?d:a.Brand,BrandID:null!==(o=l.Brand)&&void 0!==o?o:a.BrandID,Item_Id:e.value,Item_Rate:null!==(n=l.Item_Rate)&&void 0!==n?n:0,Bill_Qty:0,Amount:0,Unit_Id:null!==(i=l.UOM_Id)&&void 0!==i?i:a.Unit_Id,Unit_Name:null!==(c=l.Units)&&void 0!==c?c:a.Unit_Name,HSN_Code:null===l||void 0===l?void 0:l.HSN_Code})})},options:[{value:"",label:"select",isDisabled:!0},...[..._.filter(e=>!f.BrandID||(0,p.id)(e.Brand,f.BrandID)).filter(e=>!f.GroupID||(0,p.id)(e.Product_Group,f.GroupID))].map(e=>({value:null===e||void 0===e?void 0:e.Product_Id,label:null===e||void 0===e?void 0:e.Product_Name,isDisabled:-1!==d.findIndex(l=>(0,p.id)(null===l||void 0===l?void 0:l.Item_Id,null===e||void 0===e?void 0:e.Product_Id))}))],styles:P.MR,isSearchable:!0,required:!0,placeholder:"Select Product",maxMenuHeight:200,filterOption:p.GI})]}),(0,R.jsxs)("div",{className:"col-md-4 p-2",children:[(0,R.jsx)("label",{children:"Godown"}),(0,R.jsx)(B.Ay,{value:{value:null===f||void 0===f?void 0:f.Location_Id,label:(null===(a=j.find(e=>(0,p.id)(e.Godown_Id,null===f||void 0===f?void 0:f.Location_Id)))||void 0===a?void 0:a.Godown_Name)||""},onChange:e=>D(l=>(0,t.A)((0,t.A)({},l),{},{Location_Id:e.value})),options:[{value:"",label:"select",isDisabled:!0},...(0,p.$r)(j).map(e=>({value:null===e||void 0===e?void 0:e.Godown_Id,label:null===e||void 0===e?void 0:e.Godown_Name}))],styles:P.MR,isDisabled:!(0,p.IQ)(null===f||void 0===f?void 0:f.Item_Id),menuPortalTarget:document.body,isSearchable:!0,placeholder:"Select Godown",filterOption:p.GI})]}),(0,R.jsxs)("div",{className:"col-lg-4 col-md-6 p-2",children:[(0,R.jsxs)("label",{children:["Quantity ",(0,R.jsx)(T.A,{})]}),(0,R.jsx)("input",{required:!0,value:f.Bill_Qty?f.Bill_Qty:"",onInput:p.BE,disabled:!(0,p.IQ)(f.Item_Id),onChange:e=>{f.Item_Rate?D(l=>(0,t.A)((0,t.A)({},l),{},{Amount:(0,p.JH)(f.Item_Rate,e.target.value),Bill_Qty:e.target.value})):f.Amount?D(l=>(0,t.A)((0,t.A)({},l),{},{Item_Rate:(0,p.SX)(l.Amount,e.target.value),Bill_Qty:e.target.value})):D(l=>(0,t.A)((0,t.A)({},l),{},{Bill_Qty:e.target.value}))},className:"cus-inpt",min:1})]}),Object.hasOwn(f,"Act_Qty")&&(0,R.jsxs)("div",{className:"col-lg-4 col-md-6 p-2",children:[(0,R.jsx)("label",{children:"Actual Quantity "}),(0,R.jsx)("input",{value:f.Act_Qty?f.Act_Qty:"",onInput:p.BE,disabled:!(0,p.IQ)(f.Item_Id),onChange:e=>D(l=>(0,t.A)((0,t.A)({},l),{},{Act_Qty:e.target.value})),required:!0,className:"cus-inpt"})]}),(0,R.jsxs)("div",{className:"col-lg-4 col-md-6 p-2",children:[(0,R.jsx)("label",{children:"Rate "}),(0,R.jsx)("input",{value:f.Item_Rate?f.Item_Rate:"",onInput:p.BE,disabled:!(0,p.IQ)(f.Item_Id),onChange:e=>D(l=>(0,t.A)((0,t.A)({},l),{},{Item_Rate:e.target.value,Amount:l.Bill_Qty?(0,p.JH)(e.target.value,l.Bill_Qty):l.Amount})),required:!0,className:"cus-inpt"})]}),(0,R.jsxs)("div",{className:"col-lg-4 col-md-6 p-2",children:[(0,R.jsx)("label",{children:"UOM"}),(0,R.jsxs)("select",{value:Object.hasOwn(f,"UOM")?f.UOM:Object.hasOwn(f,"Unit_Id")?f.Unit_Id:"",onChange:e=>{const l=e.target.selectedIndex,a=e.target.options[l].text,s=e.target.value;D(e=>(0,t.A)((0,t.A)({},e),{},{UOM:s,Unit_Id:s,Units:a,Unit_Name:a}))},className:"cus-inpt",disabled:!(0,p.IQ)(f.Item_Id),children:[(0,R.jsx)("option",{value:"",disabled:!0,children:"select"}),I.map((e,l)=>(0,R.jsx)("option",{value:e.Unit_Id,children:e.Units},l))]})]}),(0,R.jsxs)("div",{className:"col-lg-4 col-md-6 p-2",children:[(0,R.jsx)("label",{children:"Amount"}),(0,R.jsx)("input",{required:!0,value:f.Amount?f.Amount:"",onInput:p.BE,disabled:!(0,p.IQ)(f.Item_Id),onChange:e=>D(l=>(0,t.A)((0,t.A)({},l),{},{Amount:e.target.value,Item_Rate:l.Bill_Qty?(0,p.SX)(e.target.value,l.Bill_Qty):l.Item_Rate})),className:"cus-inpt",min:1})]}),(0,R.jsxs)("div",{className:"col-lg-4 col-md-6 p-2",children:[(0,R.jsx)("label",{children:"Batch"}),(0,R.jsx)("input",{value:f.Batch_No?f.Batch_No:"",disabled:!(0,p.IQ)(f.Item_Id),onChange:e=>D(l=>(0,t.A)((0,t.A)({},l),{},{Batch_No:e.target.value})),className:"cus-inpt"})]})]})}),(0,R.jsxs)(C.A,{className:"d-flex justify-content-between align-items-center",children:[(0,R.jsx)(n.A,{onClick:()=>D(y),type:"button",startIcon:(0,R.jsx)(S.A,{}),children:"Clear"}),(0,R.jsxs)("span",{children:[(0,R.jsx)(n.A,{type:"button",onClick:Q,children:"cancel"}),(0,R.jsx)(n.A,{type:"submit",variant:"outlined",children:"Add"})]})]})]})]})]})},G=e=>{let{baseData:l,StaffArray:a,setStaffArray:s,staffRowDetails:r}=e;return(0,R.jsx)(R.Fragment,{children:(0,R.jsx)("div",{className:"col-xxl-3 col-lg-4 col-md-5 p-2",children:(0,R.jsxs)("div",{className:"border p-2",style:{minHeight:"30vh",height:"100%"},children:[(0,R.jsxs)("div",{className:"d-flex align-items-center flex-wrap mb-2 border-bottom pb-2",children:[(0,R.jsx)("h6",{className:"flex-grow-1 m-0",children:"Staff Involved"}),(0,R.jsx)(n.A,{variant:"outlined",color:"primary",type:"button",onClick:()=>s([...a,(0,t.A)({},r)]),children:"Add"})]}),(0,R.jsxs)("table",{className:"table table-bordered",children:[(0,R.jsx)("thead",{children:(0,R.jsxs)("tr",{children:[(0,R.jsx)("th",{className:"fa-13",children:"Sno"}),(0,R.jsx)("th",{className:"fa-13",children:"Staff Name"}),(0,R.jsx)("th",{className:"fa-13",children:"Category"}),(0,R.jsx)("th",{className:"fa-13",children:"#"})]})}),(0,R.jsx)("tbody",{children:a.map((e,r)=>(0,R.jsxs)("tr",{children:[(0,R.jsx)("td",{className:"fa-13 vctr text-center",children:r+1}),(0,R.jsx)("td",{className:"fa-13 w-100 p-0",children:(0,R.jsx)(B.Ay,{value:{value:null===e||void 0===e?void 0:e.Involved_Emp_Id,label:null===e||void 0===e?void 0:e.Involved_Emp_Name},onChange:e=>s(a=>a.map((a,s)=>{if((0,p.id)(s,r)){const s=l.staff.find(l=>(0,p.id)(l.Cost_Center_Id,e.value));return(0,t.A)((0,t.A)({},a),{},{Cost_Center_Type_Id:(0,p.IQ)(a.Cost_Center_Type_Id)?Number(a.Cost_Center_Type_Id):(0,p.IQ)(s.User_Type)?Number(s.User_Type):0,Involved_Emp_Id:Number(e.value),Involved_Emp_Name:e.label})}return a})),options:[...l.staff.filter(e=>!a.some(l=>(0,p.id)(l.Involved_Emp_Id,e.Cost_Center_Id)))].map(e=>({value:e.Cost_Center_Id,label:e.Cost_Center_Name})),styles:P.MR,isSearchable:!0,placeholder:"Select Staff",filterOption:p.GI})}),(0,R.jsx)("td",{className:"fa-13 vctr p-0",style:{maxWidth:"130px",minWidth:"100px"},children:(0,R.jsxs)("select",{value:null===e||void 0===e?void 0:e.Cost_Center_Type_Id,onChange:e=>s(l=>l.map((l,a)=>(0,p.id)(a,r)?(0,t.A)((0,t.A)({},l),{},{Cost_Center_Type_Id:e.target.value}):l)),className:"cus-inpt p-2 border-0",children:[(0,R.jsx)("option",{value:"",children:"Select"}),l.staffType.map((e,l)=>(0,R.jsx)("option",{value:null===e||void 0===e?void 0:e.Cost_Category_Id,children:null===e||void 0===e?void 0:e.Cost_Category},l))]})}),(0,R.jsx)("td",{className:"fa-13 vctr p-0",children:(0,R.jsx)(c.A,{onClick:()=>{s(e=>e.filter((e,l)=>r!==l))},size:"small",children:(0,R.jsx)(h.A,{color:"error"})})})]},r))})]})]})})})},w=e=>{let{invoiceDetails:l,setInvoiceDetails:a,baseData:s,selectedItems:r,setSelectedItems:d,searchFromArrival:o,inputStyle:n}=e;return(0,R.jsx)(R.Fragment,{children:(0,R.jsx)("div",{className:"col-xxl-9 col-lg-8 col-md-7 py-2 px-0",children:(0,R.jsxs)("div",{className:"border px-3 py-1",style:{minHeight:"30vh",height:"100%"},children:[(0,R.jsxs)("div",{className:"row",children:[(0,R.jsxs)("div",{className:"col-sm-8 p-2",children:[(0,R.jsx)("label",{className:"fa-13",children:"Vendor"}),(0,R.jsx)(B.Ay,{value:{value:null===l||void 0===l?void 0:l.Retailer_Id,label:null===l||void 0===l?void 0:l.Retailer_Name},onChange:e=>{a(l=>(0,t.A)((0,t.A)({},l),{},{Retailer_Id:e.value,Retailer_Name:e.label})),d([]),o(e.value)},options:[{value:"",label:"Search",isDisabled:!0},...s.retailers.map(e=>({value:null===e||void 0===e?void 0:e.Retailer_Id,label:null===e||void 0===e?void 0:e.Retailer_Name}))],styles:P.MR,isSearchable:!0,placeholder:"Select Vendor",maxMenuHeight:300,filterOption:p.GI})]}),(0,R.jsxs)("div",{className:"col-sm-4 p-2",children:[(0,R.jsx)("label",{className:"fa-13",children:"Voucher Type"}),(0,R.jsxs)("select",{value:l.Voucher_Type,onChange:e=>a(l=>(0,t.A)((0,t.A)({},l),{},{Voucher_Type:e.target.value})),className:n,required:!0,children:[(0,R.jsx)("option",{value:"",children:"Select"}),s.voucherType.filter(e=>(0,p.xL)(e.Type,"PURCHASE_INVOICE")).map((e,l)=>(0,R.jsx)("option",{value:e.Vocher_Type_Id,children:e.Voucher_Type},l))]})]}),(0,R.jsxs)("div",{className:"col-xl-3 col-md-4 col-sm-6 p-2",children:[(0,R.jsxs)("label",{className:"fa-13",children:["Branch ",(0,R.jsx)(T.A,{})]}),(0,R.jsxs)("select",{className:n,value:null===l||void 0===l?void 0:l.Branch_Id,required:!0,onChange:e=>a(l=>(0,t.A)((0,t.A)({},l),{},{Branch_Id:e.target.value})),children:[(0,R.jsx)("option",{value:"",children:"select"}),s.branch.map((e,l)=>(0,R.jsx)("option",{value:null===e||void 0===e?void 0:e.BranchId,children:null===e||void 0===e?void 0:e.BranchName},l))]})]}),(0,R.jsxs)("div",{className:"col-xl-3 col-md-4 col-sm-6 p-2",children:[(0,R.jsxs)("label",{className:"fa-13",children:["Entry Date ",(0,R.jsx)(T.A,{})]}),(0,R.jsx)("input",{value:null===l||void 0===l?void 0:l.Po_Entry_Date,type:"date",required:!0,className:n,onChange:e=>a(l=>(0,t.A)((0,t.A)({},l),{},{Po_Entry_Date:e.target.value}))})]}),(0,R.jsxs)("div",{className:"col-xl-3 col-md-4 col-sm-6 p-2",children:[(0,R.jsxs)("label",{className:"fa-13",children:["Bill Date ",(0,R.jsx)(T.A,{})]}),(0,R.jsx)("input",{value:null===l||void 0===l?void 0:l.Po_Inv_Date,type:"date",required:!0,className:n,onChange:e=>a(l=>(0,t.A)((0,t.A)({},l),{},{Po_Inv_Date:e.target.value}))})]}),(0,R.jsxs)("div",{className:"col-xl-3 col-md-4 col-sm-6 p-2",children:[(0,R.jsx)("label",{className:"fa-13",children:"Ref Number"}),(0,R.jsx)("input",{value:null===l||void 0===l?void 0:l.Ref_Po_Inv_No,className:n,onChange:e=>a(l=>(0,t.A)((0,t.A)({},l),{},{Ref_Po_Inv_No:e.target.value}))})]}),(0,R.jsxs)("div",{className:"col-xl-3 col-md-4 col-sm-6 p-2",children:[(0,R.jsxs)("label",{className:"fa-13",children:["GST Type ",(0,R.jsx)(T.A,{})]}),(0,R.jsxs)("select",{className:n,onChange:e=>a(l=>(0,t.A)((0,t.A)({},l),{},{GST_Inclusive:Number(e.target.value)})),value:l.GST_Inclusive,required:!0,children:[(0,R.jsx)("option",{value:1,children:"Inclusive Tax"}),(0,R.jsx)("option",{value:0,children:"Exclusive Tax"}),(0,R.jsx)("option",{value:2,children:"Not Taxable"})]})]}),(0,R.jsxs)("div",{className:"col-xl-3 col-md-4 col-sm-6 p-2",children:[(0,R.jsx)("label",{className:"fa-13",children:"Tax Type"}),(0,R.jsxs)("select",{className:n,onChange:e=>a(l=>(0,t.A)((0,t.A)({},l),{},{IS_IGST:Number(e.target.value)})),value:l.IS_IGST,children:[(0,R.jsx)("option",{value:"0",children:"GST"}),(0,R.jsx)("option",{value:"1",children:"IGST"})]})]}),(0,R.jsxs)("div",{className:"col-sm-6 p-2",children:[(0,R.jsx)("label",{className:"fa-13",children:"Stock Item Ledger Name"}),(0,R.jsx)(B.Ay,{value:{value:l.Stock_Item_Ledger_Name,label:l.Stock_Item_Ledger_Name},onChange:e=>a(l=>(0,t.A)((0,t.A)({},l),{},{Stock_Item_Ledger_Name:e.label})),options:[{value:"",label:"Search",isDisabled:!0},...s.stockItemLedgerName.map(e=>({value:null===e||void 0===e?void 0:e.Stock_Item_Ledger_Name,label:null===e||void 0===e?void 0:e.Stock_Item_Ledger_Name}))],styles:P.MR,required:!0,isSearchable:!0,placeholder:"Select",maxMenuHeight:300,filterOption:p.GI})]})]}),(0,R.jsx)("label",{className:"fa-13",children:"Narration"}),(0,R.jsx)("textarea",{className:"cus-inpt fa-14",rows:2,value:l.Narration,onChange:e=>a(l=>(0,t.A)((0,t.A)({},l),{},{Narration:e.target.value}))})]})})})},O=function(){var e;let l=arguments.length>1?arguments[1]:void 0;return null!==(e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).find(e=>(0,p.id)(e.Product_Id,l)))&&void 0!==e?e:{}},Q={addProductDialog:!1,selectArrivalDialog:!1},E=e=>{var l,a,A;let{loadingOn:g,loadingOff:C}=e;const S=(0,j.zy)(),T=(0,j.Zp)(),B=S.state,[P,E]=(0,s.useState)(b),[L,U]=(0,s.useState)([]),[M,k]=(0,s.useState)([]),[H,F]=(0,s.useState)([]),[V,z]=(0,s.useState)(null),q="border fa-14 vctr",W="cus-inpt p-2",J=(0,p.id)(null===P||void 0===P?void 0:P.GST_Inclusive,1),X=(0,p.id)(null===P||void 0===P?void 0:P.GST_Inclusive,2),Z=(0,p.id)(null===P||void 0===P?void 0:P.IS_IGST,1),[$,K]=(0,s.useState)(Q),[Y,ee]=(0,s.useState)(!1),[le,ae]=(0,s.useState)({retailers:[],branch:[],uom:[],products:[],voucherType:[],stockItemLedgerName:[],godown:[],staff:[],staffType:[],brand:[]}),te=(0,s.useMemo)(()=>L.reduce((e,l)=>{const a=(0,p.e3)(null===l||void 0===l?void 0:l.Amount);if(X)return(0,p.Lr)(e,a);const t=O(le.products,l.Item_Id),s=Z?t.Igst_P:t.Gst_P;return J?(0,p.Lr)(e,(0,N.v)(a,s,"remove").with_tax):(0,p.Lr)(e,(0,N.v)(a,s,"add").with_tax)},0),[L,X,le.products,Z,J]),se=(0,s.useMemo)(()=>{if(!L||0===L.length)return{};let e=0,l=0;L.forEach(a=>{const t=(0,p.e3)((null===a||void 0===a?void 0:a.Amount)||0);if(X)return void(e=(0,p.Lr)(e,t));const s=O(le.products,a.Item_Id),r=(0,p.id)(Z,1)?s.Igst_P:s.Gst_P,d=(0,N.v)(t,r,J?"remove":"add");e=(0,p.Lr)(e,parseFloat(d.without_tax)),l=(0,p.Lr)(l,parseFloat(d.tax_amount))});const a=(0,p.Lr)(e,l),t=Math.round(a),s=(0,p.e3)(t-a),r=(0,p.id)(Z,1)?0:(0,p.e3)(l/2),d=(0,p.id)(Z,1)?0:(0,p.e3)(l/2),o=(0,p.id)(Z,1)?(0,p.e3)(l):0;return{totalTaxable:(0,p.e3)(e),totalTax:(0,p.e3)(l),cgst:r,sgst:d,igst:o,roundOff:s,invoiceTotal:t}},[L,le.products,Z,X,J]);(0,s.useEffect)(()=>{(async()=>{try{g&&g();const[e,l,a,s,d,o,n,i,c]=await Promise.all([(0,r.z)({address:"masters/retailers/dropDown"}),(0,r.z)({address:"masters/branch/dropDown"}),(0,r.z)({address:"masters/uom"}),(0,r.z)({address:"masters/products"}),(0,r.z)({address:"masters/voucher?module=PURCHASE_INVOICE"}),(0,r.z)({address:"purchase/stockItemLedgerName?type=PURCHASE_INVOICE"}),(0,r.z)({address:"dataEntry/godownLocationMaster"}),(0,r.z)({address:"dataEntry/costCenter"}),(0,r.z)({address:"dataEntry/costCenter/category"})]),u=(e.success?e.data:[]).sort((e,l)=>String(null===e||void 0===e?void 0:e.Retailer_Name).localeCompare(null===l||void 0===l?void 0:l.Retailer_Name)),v=(l.success?l.data:[]).sort((e,l)=>String(null===e||void 0===e?void 0:e.BranchName).localeCompare(null===l||void 0===l?void 0:l.BranchName)),m=(a.success?a.data:[]).sort((e,l)=>String(e.Units).localeCompare(l.Units)),_=(s.success?s.data:[]).sort((e,l)=>String(null===e||void 0===e?void 0:e.Product_Name).localeCompare(null===l||void 0===l?void 0:l.Product_Name)),h=(d.success?d.data:[]).sort((e,l)=>String(null===e||void 0===e?void 0:e.Voucher_Type).localeCompare(null===l||void 0===l?void 0:l.Voucher_Type)),I=(o.success?o.data:[]).sort((e,l)=>String(null===e||void 0===e?void 0:e.Stock_Item_Ledger_Name).localeCompare(null===l||void 0===l?void 0:l.Stock_Item_Ledger_Name)),x=(n.success?n.data:[]).sort((e,l)=>String(null===e||void 0===e?void 0:e.Godown_Name).localeCompare(null===l||void 0===l?void 0:l.Godown_Name)),j=(i.success?i.data:[]).sort((e,l)=>String(null===e||void 0===e?void 0:e.Cost_Center_Name).localeCompare(null===l||void 0===l?void 0:l.Cost_Center_Name)),N=(c.success?c.data:[]).sort((e,l)=>String(null===e||void 0===e?void 0:e.Cost_Category).localeCompare(null===l||void 0===l?void 0:l.Cost_Category));ae(e=>(0,t.A)((0,t.A)({},e),{},{retailers:u,branch:v,uom:m,products:_,voucherType:h,stockItemLedgerName:I,godown:x,staff:j,staffType:N,brand:(0,p.Mn)(_,"Brand",["Brand_Name"])}))}catch(e){console.error("Error fetching data:",e)}finally{C&&C()}})()},[]),(0,s.useEffect)(()=>{if((0,p.aF)(B)&&Array.isArray(null===B||void 0===B?void 0:B.orderInfo)&&Array.isArray(null===B||void 0===B?void 0:B.staffInfo)&&(0,p.aF)(null===B||void 0===B?void 0:B.invoiceInfo)){const{invoiceInfo:e,orderInfo:l,staffInfo:a}=B;re(e.Retailer_Id),E(Object.fromEntries(Object.entries(b).map(l=>{var a;let[t,s]=l;return"Po_Inv_Date"===t||"Po_Entry_Date"===t?[t,e[t]?(0,p.ny)(e[t]):s]:[t,null!==(a=e[t])&&void 0!==a?a:s]}))),U(l.map(e=>Object.fromEntries(Object.entries(y).map(l=>{var a;let[t,s]=l;return"Item_Name"===t?[t,e.Product_Name||s]:[t,null!==(a=e[t])&&void 0!==a?a:s]})))),k(a.map(e=>Object.fromEntries(Object.entries(f).map(l=>{var a;let[t,s]=l;return[t,null!==(a=e[t])&&void 0!==a?a:s]})))),ee(e.isFromPurchaseOrder)}},[B]);const re=e=>{(0,p.IQ)(e)&&(g&&g(),F([]),(0,r.z)({address:"dataEntry/purchaseOrderEntry/delivery/partyBased?VendorId=".concat(e)}).then(e=>{e.success&&F(e.data)}).catch(e=>console.error(e)).finally(()=>{C&&C()}))},de=(e,l)=>{U(a=>{const t=a.filter(l=>!((0,p.id)(null===l||void 0===l?void 0:l.OrderId,null===e||void 0===e?void 0:e.OrderId)&&(0,p.id)(null===l||void 0===l?void 0:l.Item_Id,null===e||void 0===e?void 0:e.ItemId)&&(0,p.id)(null===l||void 0===l?void 0:l.DeliveryId,null===e||void 0===e?void 0:e.Trip_Item_SNo)));if(l)return t;{const l=H.filter(l=>(0,p.id)(l.OrderId,e.OrderId)&&(0,p.id)(null===e||void 0===e?void 0:e.ItemId,null===l||void 0===l?void 0:l.ItemId)&&(0,p.id)(null===e||void 0===e?void 0:e.Trip_Item_SNo,null===l||void 0===l?void 0:l.Trip_Item_SNo)),a=[...new Map(l.flatMap(e=>e.EmployeesInvolved).filter(e=>!M.some(l=>(0,p.id)(l.Involved_Emp_Id,e.EmployeeId))).map(e=>[e.EmployeeId,e])).values()];a.length>0&&k(e=>[...e,...a.map(e=>Object.fromEntries(Object.entries(f).map(l=>{let[a,t]=l;switch(a){case"Involved_Emp_Id":return[a,null===e||void 0===e?void 0:e.EmployeeId];case"Involved_Emp_Name":return[a,null===e||void 0===e?void 0:e.EmployeeName];case"Cost_Center_Type_Id":return[a,null===e||void 0===e?void 0:e.CostType];default:return[a,t]}})))]);const s=l.map(e=>{var l,a;const t=O(le.products,e.ItemId),s=Z?t.Igst_P:t.Gst_P,r=s>0,d=null!==(l=parseFloat(e.Weight))&&void 0!==l?l:0,o=null!==(a=(0,p.e3)(e.BilledRate))&&void 0!==a?a:0,n=(0,p.JH)(d,o),i=X?"zerotax":J?"remove":"add",c=(0,N.v)(o,s,i),u=(0,N.v)(n,s,i),v=Z?0:u.cgst_per,m=Z?u.igst_per:0,_=Z?0:u.cgst_amount,h=Z?u.igst_amount:0;return Object.fromEntries(Object.entries(y).map(l=>{var a;let[i,p]=l;switch(i){case"DeliveryId":return[i,Number(null===e||void 0===e?void 0:e.Trip_Item_SNo)];case"OrderId":return[i,Number(null===e||void 0===e?void 0:e.OrderId)];case"Po_Inv_Date":return[i,null===P||void 0===P?void 0:P.Po_Inv_Date];case"Location_Id":return[i,null!==(a=Number(null===e||void 0===e?void 0:e.LocationId))&&void 0!==a?a:""];case"Item_Id":return[i,Number(null===e||void 0===e?void 0:e.ItemId)];case"Item_Name":return[i,null===t||void 0===t?void 0:t.Product_Name];case"Unit_Id":return[i,null===t||void 0===t?void 0:t.UOM_Id];case"Unit_Name":return[i,null===t||void 0===t?void 0:t.Units];case"Bill_Qty":return[i,null===e||void 0===e?void 0:e.pendingInvoiceWeight];case"Act_Qty":case"Total_Qty":return[i,d];case"Item_Rate":return[i,o];case"Bill_Alt_Qty":return[i,Number(null===e||void 0===e?void 0:e.Quantity)];case"Batch_No":return[i,null===e||void 0===e?void 0:e.BatchLocation];case"Amount":return[i,n];case"Taxable_Rate":return[i,c.base_amount];case"Taxble":return[i,r?1:0];case"HSN_Code":return[i,t.HSN_Code];case"Taxable_Amount":return[i,u.base_amount];case"Tax_Rate":return[i,s];case"Cgst":case"Sgst":return[i,null!==v&&void 0!==v?v:0];case"Cgst_Amo":case"Sgst_Amo":return[i,X?0:_];case"Igst":return[i,null!==m&&void 0!==m?m:0];case"Igst_Amo":return[i,X?0:h];case"Final_Amo":return[i,u.with_tax];default:return[i,p]}}))});return t.concat(s)}})},oe=()=>{K(Q)},ne=(e,l,a)=>{U(s=>s.map((s,r)=>{if((0,p.id)(r,e))switch(l){case"Bill_Qty":{const e=parseFloat(a||0),l=(0,t.A)((0,t.A)({},s),{},{Bill_Qty:e});return s.Item_Rate?l.Amount=(0,p.JH)(s.Item_Rate,e):s.Amount&&(l.Item_Rate=(0,p.SX)(s.Amount,e)),l}case"Item_Rate":{const e=parseFloat(a||0),l=(0,t.A)((0,t.A)({},s),{},{Item_Rate:e});return s.Bill_Qty&&(l.Amount=(0,p.JH)(e,s.Bill_Qty)),l}case"Amount":{const e=parseFloat(a||0),l=(0,t.A)((0,t.A)({},s),{},{Amount:e});return s.Bill_Qty&&(l.Item_Rate=(0,p.SX)(e,s.Bill_Qty)),l}default:return(0,t.A)((0,t.A)({},s),{},{[l]:a})}return s}))};return(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(D,{orderProducts:L,setOrderProducts:U,open:$.addProductDialog,onClose:()=>{K(e=>(0,t.A)((0,t.A)({},e),{},{addProductDialog:!1})),z(null)},products:le.products,brands:le.brand,uom:le.uom,godowns:le.godown,GST_Inclusive:J,IS_IGST:Z,editValues:V,initialValue:y,stockInGodown:[]}),(0,R.jsx)("form",{onSubmit:e=>{e.preventDefault(),g&&g(),(0,r.z)({address:"purchase/purchaseOrder",method:(0,p.IQ)(null===P||void 0===P?void 0:P.PIN_Id)?"PUT":"POST",bodyData:(0,t.A)({Product_Array:L,StaffArray:M},P)}).then(e=>{e.success?(x.oR.success((null===e||void 0===e?void 0:e.message)||"Saved"),U([]),E(b),F([]),k([]),(Array.isArray(null===B||void 0===B?void 0:B.orderInfo)||(0,p.aF)(null===B||void 0===B?void 0:B.invoiceInfo))&&window.history.length>1?T(-1):T(S.pathname,{replace:!0,state:null})):x.oR.error((null===e||void 0===e?void 0:e.message)||"Request Failed")}).catch(e=>console.error(e)).finally(()=>{C&&C()})},children:(0,R.jsxs)(d.A,{children:[(0,R.jsxs)("div",{className:"d-flex flex-wrap align-items-center border-bottom py-2 px-3",children:[(0,R.jsx)("span",{className:"flex-grow-1 fa-16 fw-bold",children:"Purchase Invoice Creation"}),(0,R.jsxs)("span",{children:[(0,R.jsx)("label",{htmlFor:"",children:"Manual Invoice"}),(0,R.jsx)(o.A,{checked:Y,onChange:e=>{ee(e.target.checked),U([])}}),(0,R.jsx)(n.A,{type:"button",onClick:()=>{(Array.isArray(null===B||void 0===B?void 0:B.orderInfo)||(0,p.aF)(null===B||void 0===B?void 0:B.invoiceInfo))&&window.history.length>1?T(-1):T("/erp/purchase/invoice")},children:"Cancel"}),(0,R.jsx)(n.A,{type:"submit",variant:"contained",children:"submit"})]})]}),(0,R.jsxs)(i.A,{children:[(0,R.jsxs)("div",{className:"row",children:[(0,R.jsx)(G,{baseData:le,StaffArray:M,setStaffArray:k,staffRowDetails:f}),(0,R.jsx)(w,{invoiceDetails:P,setInvoiceDetails:E,baseData:le,selectedItems:L,setSelectedItems:U,searchFromArrival:re,inputStyle:W})]}),(0,R.jsxs)("div",{className:"table-responsive",children:[(0,R.jsxs)("div",{className:"d-flex p-2 justify-content-end",children:[(0,R.jsx)(n.A,{type:"button",onClick:()=>U([]),children:"clear selected"}),Y?(0,R.jsx)(n.A,{onClick:()=>{z(null),K(e=>(0,t.A)((0,t.A)({},e),{},{addProductDialog:!0}))},sx:{ml:1},variant:"outlined",type:"button",startIcon:(0,R.jsx)(_.A,{}),disabled:!(0,p.IQ)(P.Retailer_Id),children:"Add Product"}):(0,R.jsx)(n.A,{variant:"outlined",className:"ms-2",type:"button",onClick:()=>K(e=>(0,t.A)((0,t.A)({},e),{},{selectArrivalDialog:!0})),startIcon:(0,R.jsx)(_.A,{}),disabled:!(0,p.IQ)(P.Retailer_Id),children:"Add Products"})]}),(0,R.jsxs)("table",{className:"table",children:[(0,R.jsx)("thead",{children:(0,R.jsxs)("tr",{children:[(0,R.jsx)("td",{className:q,children:"SNo"}),(0,R.jsx)("td",{className:q,children:"Item"}),(0,R.jsx)("td",{className:q,children:"Rate"}),(0,R.jsx)("td",{className:q,children:"Bill Quantity"}),(0,R.jsx)("td",{className:q,children:"Acl Quantity"}),(0,R.jsx)("td",{className:q,children:"Unit"}),(0,R.jsx)("td",{className:q,children:"Amount"}),(0,R.jsx)("td",{className:q,children:"Godown Location"}),(0,R.jsx)("td",{className:q,children:"Batch"}),(0,R.jsx)("td",{className:q,children:"#"})]})}),(0,R.jsx)("tbody",{children:L.map((e,l)=>{var a;return(0,R.jsxs)("tr",{children:[(0,R.jsx)("td",{className:q,children:l+1}),(0,R.jsx)("td",{className:q,children:(null===e||void 0===e?void 0:e.Item_Name)||"Not found"}),(0,R.jsx)("td",{className:q,children:(0,R.jsx)("input",{value:null!==e&&void 0!==e&&e.Item_Rate?null===e||void 0===e?void 0:e.Item_Rate:"",type:"number",className:W,onChange:e=>ne(l,"Item_Rate",e.target.value),required:!0})}),(0,R.jsx)("td",{className:q,children:(0,R.jsx)("input",{value:null!==e&&void 0!==e&&e.Bill_Qty?null===e||void 0===e?void 0:e.Bill_Qty:"",type:"number",className:W,onChange:e=>ne(l,"Bill_Qty",e.target.value),required:!0})}),(0,R.jsx)("td",{className:q,children:(0,R.jsx)("input",{value:null!==(a=null===e||void 0===e?void 0:e.Act_Qty)&&void 0!==a?a:"",type:"number",className:W,onChange:e=>ne(l,"Act_Qty",e.target.value),required:!0})}),(0,R.jsx)("td",{className:q,children:(0,R.jsxs)("select",{value:null===e||void 0===e?void 0:e.Unit_Id,className:W,onChange:e=>{const a=e.target.selectedIndex,t=e.target.options[a].text,s=e.target.value;ne(l,"Unit_Id",s),ne(l,"Unit_Name",t)},required:!0,children:[(0,R.jsx)("option",{value:"",children:"select"}),le.uom.map((e,l)=>(0,R.jsx)("option",{value:e.Unit_Id,children:e.Units},l))]})}),(0,R.jsx)("td",{className:q,children:(0,R.jsx)("input",{value:null!==e&&void 0!==e&&e.Amount?null===e||void 0===e?void 0:e.Amount:"",type:"number",className:W,onChange:e=>ne(l,"Amount",e.target.value),required:!0})}),(0,R.jsx)("td",{className:q,children:(0,R.jsxs)("select",{value:null===e||void 0===e?void 0:e.Location_Id,className:W,onChange:e=>ne(l,"Location_Id",e.target.value),children:[(0,R.jsx)("option",{value:"",children:"select"}),le.godown.map((e,l)=>(0,R.jsx)("option",{value:null===e||void 0===e?void 0:e.Godown_Id,children:null===e||void 0===e?void 0:e.Godown_Name},l))]})}),(0,R.jsx)("td",{className:q,children:(0,R.jsx)("input",{value:null===e||void 0===e?void 0:e.Batch_No,className:W,onChange:e=>ne(l,"Batch_No",e.target.value),disabled:(0,p.Ro)(null===e||void 0===e?void 0:e.DeliveryId)})}),(0,R.jsx)("td",{className:q,children:(0,R.jsx)(c.A,{onClick:()=>{U(e=>e.filter((e,a)=>l!==a))},size:"small",children:(0,R.jsx)(h.A,{color:"error"})})})]},l)})})]}),(0,R.jsx)("table",{className:"table",children:(0,R.jsxs)("tbody",{children:[(0,R.jsxs)("tr",{children:[(0,R.jsxs)("td",{className:"border p-2",rowSpan:(0,p.id)(P.IS_IGST,1)?4:5,children:["Total in words: ",(0,p.GF)(parseInt(te))]}),(0,R.jsx)("td",{className:"border p-2",children:"Total Taxable Amount"}),(0,R.jsx)("td",{className:"border p-2",children:se.totalTaxable})]}),Z?(0,R.jsxs)("tr",{children:[(0,R.jsx)("td",{className:"border p-2",children:"IGST"}),(0,R.jsx)("td",{className:"border p-2",children:se.igst})]}):(0,R.jsxs)(R.Fragment,{children:[(0,R.jsxs)("tr",{children:[(0,R.jsx)("td",{className:"border p-2",children:"CGST"}),(0,R.jsx)("td",{className:"border p-2",children:se.cgst})]}),(0,R.jsxs)("tr",{children:[(0,R.jsx)("td",{className:"border p-2",children:"SGST"}),(0,R.jsx)("td",{className:"border p-2",children:se.sgst})]})]}),(0,R.jsxs)("tr",{children:[(0,R.jsx)("td",{className:"border p-2",children:"Round Off"}),(0,R.jsx)("td",{className:"border p-2",children:(0,R.jsx)("input",{value:P.Round_off,defaultValue:se.roundOff,style:{minWidth:"200px",maxWidth:"350px"},className:"cus-inpt p-2",onInput:p.rV,onChange:e=>E(l=>(0,t.A)((0,t.A)({},l),{},{Round_off:e.target.value}))})})]}),(0,R.jsxs)("tr",{children:[(0,R.jsx)("td",{className:"border p-2",children:"Total"}),(0,R.jsx)("td",{className:"border p-2",children:(0,p.jG)(Math.round(te))})]})]})})]})]})]})}),(0,R.jsxs)(u.A,{open:$.selectArrivalDialog,onClose:oe,fullScreen:!0,children:[(0,R.jsxs)(v.A,{className:"d-flex flex-wrap align-items-center ",children:[(0,R.jsx)("span",{className:"flex-grow-1",children:"Select Purchase Order"}),(0,R.jsx)("span",{children:(0,R.jsx)(n.A,{onClick:oe,type:"button",className:"me-2",children:"close"})})]}),(0,R.jsx)(m.A,{children:(0,R.jsx)(I.Ay,{dataArray:H,columns:[{isVisible:1,ColumnHeader:"#",isCustomCell:!0,Cell:e=>{let{row:l}=e;const a=-1!==L.findIndex(e=>(0,p.id)(null===e||void 0===e?void 0:e.DeliveryId,null===l||void 0===l?void 0:l.Trip_Item_SNo));return(0,R.jsx)("div",{children:(0,R.jsx)("input",{className:"form-check-input shadow-none pointer",style:{padding:"0.7em"},type:"checkbox",checked:a,onChange:()=>{a?de(l,!0):de(l)}})})}},(0,I.Lj)("ArrivalDate","date"),(0,I.Lj)("ItemName","string"),(0,I.Lj)("BilledRate","string"),{isVisible:1,ColumnHeader:"Weight",isCustomCell:!0,Cell:e=>{var l;let{row:a}=e;return(null!==(l=null===a||void 0===a?void 0:a.Weight)&&void 0!==l?l:0)+" "+(null===a||void 0===a?void 0:a.Units)}},(0,I.Lj)("pendingInvoiceWeight","number","Pending Tonnage"),(0,I.Lj)("Quantity","number"),(0,I.Lj)("PO_ID","string"),(0,I.Lj)("Location","string")],EnableSerialNumber:!0,disablePagination:!0,title:"Arrival Details of ".concat(null!==(l=null===(a=le.retailers)||void 0===a||null===(A=a.find(e=>(0,p.id)(null===e||void 0===e?void 0:e.Retailer_Id,null===P||void 0===P?void 0:P.Retailer_Id)))||void 0===A?void 0:A.Retailer_Name)&&void 0!==l?l:"Not available"),maxHeightOption:!0})})]})]})}},26494:(e,l,a)=>{a.d(l,{A:()=>p});var t=a(58168),s=a(98587),r=a(65043),d=a(58387),o=a(68606),n=a(34535),i=a(6431),c=a(57056),u=a(32400);function v(e){return(0,u.Ay)("MuiCardContent",e)}(0,c.A)("MuiCardContent",["root"]);var m=a(70579);const _=["className","component"],h=(0,n.Ay)("div",{name:"MuiCardContent",slot:"Root",overridesResolver:(e,l)=>l.root})(()=>({padding:16,"&:last-child":{paddingBottom:24}})),p=r.forwardRef(function(e,l){const a=(0,i.b)({props:e,name:"MuiCardContent"}),{className:r,component:n="div"}=a,c=(0,s.A)(a,_),u=(0,t.A)({},a,{component:n}),p=(e=>{const{classes:l}=e;return(0,o.A)({root:["root"]},v,l)})(u);return(0,m.jsx)(h,(0,t.A)({as:n,className:(0,d.A)(p.root,r),ownerState:u,ref:l},c))})},34496:(e,l,a)=>{a.d(l,{A:()=>r});var t=a(59662),s=a(70579);const r=(0,t.A)((0,s.jsx)("path",{d:"M5 13h14v-2H5zm-2 4h14v-2H3zM7 7v2h14V7z"}),"ClearAll")},51387:(e,l,a)=>{a.d(l,{A:()=>r});var t=a(59662),s=a(70579);const r=(0,t.A)((0,s.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete")},70141:(e,l,a)=>{a.d(l,{A:()=>r});var t=a(59662),s=a(70579);const r=(0,t.A)((0,s.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add")}}]);
//# sourceMappingURL=3476.ca25f9c9.chunk.js.map