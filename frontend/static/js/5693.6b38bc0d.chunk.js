"use strict";(self.webpackChunkerp=self.webpackChunkerp||[]).push([[5693],{15693:(e,t,n)=>{n.r(t),n.d(t,{default:()=>B});var l=n(89379),s=n(65043),r=n(81e3),a=n(63336),i=n(17392),c=n(85865),o=n(30279),d=n(79650),h=n(71806),x=n(84882),u=n(28076),A=n(39652),m=n(73460),j=n(81637),g=n(77739),p=n(83462),f=n(26600),v=n(35316),b=n(67784),y=n(12412),C=n(29347),D=n(11906),N=n(52101),_=n(58293),z=n(59662),S=n(70579);const w=(0,z.A)((0,S.jsx)("path",{d:"M22 11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3zM7 9H4V5h3zm10 6h3v4h-3zm0-10h3v4h-3z"}),"AccountTreeOutlined"),I=(0,z.A)((0,S.jsx)("path",{d:"M6.5 10h-2v7h2zm6 0h-2v7h2zm8.5 9H2v2h19zm-2.5-9h-2v7h2zm-7-6.74L16.71 6H6.29zm0-2.26L2 6v2h19V6z"}),"AccountBalanceOutlined"),k=(0,z.A)((0,S.jsx)("path",{d:"M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4"}),"AttachMoneyOutlined");var F=n(48920),M=n(70141);const L=(0,z.A)((0,S.jsx)("path",{d:"M5 13h14v-2H5zm-2 4h14v-2H3zM7 7v2h14V7z"}),"ClearAllOutlined"),E=(0,z.A)((0,S.jsx)("path",{d:"M10 18h4v-2h-4zM3 6v2h18V6zm3 7h12v-2H6z"}),"FilterListOutlined");var H=n(97707),W=n(65074),O=n(91036);const V=e=>{var t,n;let l=0,s=0;return null!==(t=e.accounts)&&void 0!==t&&t.length&&e.accounts.forEach(e=>{l+=Number(e.Debit_Amount||0),s+=Number(e.Credit_Amount||0)}),null!==(n=e.children)&&void 0!==n&&n.length&&e.children.forEach(e=>{const t=V(e);l+=t.debit,s+=t.credit}),{debit:l,credit:s,balance:l-s}},G=e=>{var t,n;let{node:l,depth:g=0,filters:p}=e;const[f,v]=(0,s.useState)(0===g),[b,y]=(0,s.useState)([]),[C,D]=(0,s.useState)(!1),[z,L]=(0,s.useState)([]),[E,B]=(0,s.useState)(!1),[P,R]=(0,s.useState)(null),T=V(l),J=(null===(t=l.children)||void 0===t?void 0:t.length)>0,U=(null===(n=l.accounts)||void 0===n?void 0:n.length)>0,q=!J&&l.Acc_Id,K=!J&&!U&&l.group_id||q,Q=(0,s.useCallback)(async()=>{try{D(!0);const e=await(0,W.z)({address:"/reports/expenseByAccId",params:{group_id:l.group_id,fromDate:p.fromDate,toDate:p.toDate}});y(e.data||[])}catch(e){console.error("Error fetching child data:",e),y([])}finally{D(!1)}},[l.group_id,p.fromDate,p.toDate]),X=(0,s.useCallback)(e=>{B(!0),(0,W.z)({address:"reports/expenseByAccId",method:"POST",bodyData:{acc_id:e,fromDate:p.fromDate,toDate:p.toDate},headers:{"Content-Type":"application/json"}}).then(t=>{t.success?L(n=>[...n.filter(t=>{var n;return!(null!==(n=t.Acc_Id)&&void 0!==n&&n.includes(e.toString()))}),...t.data||[]]):O.oR.error((null===t||void 0===t?void 0:t.message)||"Failed to load account details")}).catch(e=>{console.error("Error fetching account details:",e),O.oR.error("Something went wrong while fetching account details")}).finally(()=>{B(!1)})},[p.fromDate,p.toDate]);return(0,S.jsx)(r.A,{sx:{ml:2*g},children:(0,S.jsxs)(a.A,{sx:{mb:1,p:1,backgroundColor:0===g?"#f5f5f5":"white",overflow:"hidden"},children:[(0,S.jsxs)(r.A,{display:"flex",alignItems:"center",sx:{cursor:J||U||K?"pointer":"default",minHeight:"48px"},onClick:()=>{!K||f||b.length||Q(),v(!f)},children:[(0,S.jsxs)(r.A,{sx:{display:"flex",alignItems:"center",flex:"1 1 50%",minWidth:0},children:[(J||U||K)&&(0,S.jsx)(i.A,{size:"small",sx:{mr:1},children:f?(0,S.jsx)(N.A,{}):(0,S.jsx)(_.A,{})}),J?(0,S.jsx)(w,{color:"primary",sx:{mr:1}}):(0,S.jsx)(I,{color:"secondary",sx:{mr:1}}),(0,S.jsx)(c.A,{fontWeight:"medium",noWrap:!0,sx:{flex:1},children:l.group_name||l.Account_Name||"Expense"})]}),(0,S.jsxs)(r.A,{sx:{display:"flex",flex:"1 1 50%",justifyContent:"flex-end",gap:3,pr:2},children:[(0,S.jsxs)(c.A,{variant:"body2",sx:{minWidth:120,textAlign:"right"},children:["Debit: \u20b9",(0,H.jG)(Number(T.debit.toFixed(2)))]}),(0,S.jsxs)(c.A,{variant:"body2",sx:{minWidth:120,textAlign:"right"},children:["Credit: \u20b9",(0,H.jG)(Number(T.credit.toFixed(2)))]}),(0,S.jsxs)(c.A,{variant:"body2",sx:{minWidth:140,textAlign:"right",fontWeight:"bold",color:T.balance>=0?"green":"red"},children:["Balance: \u20b9",(0,H.jG)(Math.abs(T.balance).toFixed(2)),T.balance>=0?"Dr":"Cr"]})]})]}),(0,S.jsxs)(o.A,{in:f,children:[U&&(0,S.jsx)(d.A,{sx:{mt:1,mb:1},children:(0,S.jsxs)(h.A,{size:"small",sx:{tableLayout:"fixed"},children:[(0,S.jsxs)("colgroup",{children:[(0,S.jsx)("col",{style:{width:"50%"}}),(0,S.jsx)("col",{style:{width:"10%"}}),(0,S.jsx)("col",{style:{width:"10%"}}),(0,S.jsx)("col",{style:{width:"10%"}})]}),(0,S.jsx)(x.A,{children:(0,S.jsxs)(u.A,{sx:{backgroundColor:"#eeeeee"},children:[(0,S.jsx)(A.A,{children:"Account"}),(0,S.jsx)(A.A,{align:"right",children:"Debit"}),(0,S.jsx)(A.A,{align:"right",children:"Credit"}),(0,S.jsx)(A.A,{align:"right",children:"Balance"})]})}),(0,S.jsx)(m.A,{children:l.accounts.map(e=>{var t;const n=!(null!==(t=e.children)&&void 0!==t&&t.length);return(0,S.jsxs)(s.Fragment,{children:[(0,S.jsxs)(u.A,{hover:!0,children:[(0,S.jsx)(A.A,{sx:{overflow:"hidden",textOverflow:"ellipsis"},children:(0,S.jsxs)(r.A,{display:"flex",alignItems:"center",children:[(0,S.jsx)(k,{fontSize:"small",sx:{mr:1}}),e.Account_Name,n&&(0,S.jsx)(i.A,{size:"small",onClick:t=>((e,t)=>{e.stopPropagation(),P===t?R(null):(R(t),z.some(e=>{var n;return null===(n=e.Acc_Id)||void 0===n?void 0:n.includes(t.toString())})||X(t))})(t,e.Acc_Id),sx:{ml:1},children:P===e.Acc_Id?(0,S.jsx)(F.A,{fontSize:"small"}):(0,S.jsx)(M.A,{fontSize:"small"})})]})}),(0,S.jsxs)(A.A,{align:"right",children:["\u20b9",(0,H.jG)(Number(e.Debit_Amount||0).toFixed(2))]}),(0,S.jsxs)(A.A,{align:"right",children:["\u20b9",(0,H.jG)(Number(e.Credit_Amount||0).toFixed(2))]}),(0,S.jsxs)(A.A,{align:"right",children:["\u20b9",(0,H.jG)(Number(e.Debit_Amount||0-e.Credit_Amount||0).toFixed(2))]})]}),P===e.Acc_Id&&(0,S.jsx)(u.A,{children:(0,S.jsx)(A.A,{colSpan:4,sx:{p:0,backgroundColor:"#fafafa"},children:E?(0,S.jsx)(r.A,{display:"flex",justifyContent:"center",p:2,children:(0,S.jsx)(j.A,{size:24})}):z.some(t=>{var n;return null===(n=t.Acc_Id)||void 0===n?void 0:n.includes(e.Acc_Id.toString())})?(0,S.jsxs)(h.A,{size:"small",sx:{tableLayout:"fixed"},children:[(0,S.jsxs)("colgroup",{children:[(0,S.jsx)("col",{style:{width:"10%"}}),(0,S.jsx)("col",{style:{width:"10%"}}),(0,S.jsx)("col",{style:{width:"20%"}}),(0,S.jsx)("col",{style:{width:"18%"}}),(0,S.jsx)("col",{style:{width:"10%"}}),(0,S.jsx)("col",{style:{width:"10%"}})]}),(0,S.jsx)(x.A,{children:(0,S.jsxs)(u.A,{sx:{backgroundColor:"#f0f0f0"},children:[(0,S.jsx)(A.A,{children:"Date"}),(0,S.jsx)(A.A,{children:"Invoice No"}),(0,S.jsx)(A.A,{align:"left",children:"Particular"}),(0,S.jsx)(A.A,{align:"right",children:"Debit"}),(0,S.jsx)(A.A,{align:"right",children:"Credit"}),(0,S.jsx)(A.A,{align:"right",children:"Balance"})]})}),(0,S.jsx)(m.A,{children:z.filter(t=>{var n;return null===(n=t.Acc_Id)||void 0===n?void 0:n.includes(e.Acc_Id.toString())}).map((e,t)=>(0,S.jsxs)(u.A,{children:[(0,S.jsx)(A.A,{children:new Date(e.Ledger_Date).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}).replace(/\//g,"-")}),(0,S.jsx)(A.A,{children:e.invoice_no}),(0,S.jsx)(A.A,{children:e.Particulars}),(0,S.jsxs)(A.A,{align:"right",children:["\u20b9",(0,H.jG)(Number(e.Debit_Amt||0).toFixed(2))]}),(0,S.jsxs)(A.A,{align:"right",children:["\u20b9",(0,H.jG)(Number(e.Credit_Amt||0).toFixed(2))]}),(0,S.jsxs)(A.A,{align:"right",children:["\u20b9",(0,H.jG)((Number(e.Debit_Amt||0)-Number(e.Credit_Amt||0)).toFixed(2))]}),"    "]},"detail-".concat(t)))})]}):(0,S.jsx)(c.A,{sx:{p:2,color:"text.secondary"},children:"No transactions available"})})})]},e.Acc_Id)})})]})}),J&&(0,S.jsx)(r.A,{sx:{mt:1},children:l.children.map(e=>(0,S.jsx)(G,{node:e,depth:g+1,filters:p},e.group_id))}),K&&f&&(0,S.jsx)(r.A,{sx:{mt:1},children:C?(0,S.jsx)(r.A,{display:"flex",justifyContent:"center",p:2,children:(0,S.jsx)(j.A,{size:24})}):b.length>0?b.map(e=>(0,S.jsx)(G,{node:e,depth:g+1,filters:p},e.group_id||e.Acc_Id)):(0,S.jsx)(c.A,{variant:"body2",sx:{p:2,textAlign:"center",color:"text.secondary"},children:"No additional data available"})})]})]})})},B=()=>{const e=(new Date).toISOString().split("T")[0],[t,n]=(0,s.useState)([]),[o,d]=(0,s.useState)([]),[h,x]=(0,s.useState)(!1),[u,A]=(0,s.useState)(!1),[m,N]=(0,s.useState)({accountNames:[]}),[_,z]=(0,s.useState)({fromDate:e,toDate:e,accountName:null}),w=(0,s.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set;return e.forEach(e=>{var n,l;null!==(n=e.accounts)&&void 0!==n&&n.length&&e.accounts.forEach(e=>{e.Account_Name&&t.add(e.Account_Name)}),null!==(l=e.children)&&void 0!==l&&l.length&&w(e.children,t)}),t},[]);(0,s.useEffect)(()=>{if(o.length>0){const e=w(o);N(t=>(0,l.A)((0,l.A)({},t),{},{accountNames:Array.from(e).sort()}))}},[o,w]);const I=(0,s.useCallback)(e=>e?e.reduce((e,t)=>{var n,s,r,a;const i=(0,l.A)({},t);null!==(n=i.accounts)&&void 0!==n&&n.length&&(i.accounts=i.accounts.filter(e=>{var t;return!(_.accountName&&(null===(t=e.Account_Name)||void 0===t||!t.toLowerCase().includes(_.accountName.toLowerCase())))})),null!==(s=i.children)&&void 0!==s&&s.length&&(i.children=I(i.children));const c=(null===(r=i.accounts)||void 0===r?void 0:r.length)>0,o=(null===(a=i.children)||void 0===a?void 0:a.length)>0;return(c||o)&&e.push(i),e},[]):[],[_.accountName]),k=(0,s.useCallback)(async()=>{try{x(!0);const e=new URLSearchParams({fromDate:_.fromDate,toDate:_.toDate}).toString(),t=(await(0,W.z)({address:"/reports/expenseReport?".concat(e)})).data||[];d(t),n(t)}catch(e){console.error("Error fetching expenses:",e)}finally{x(!1)}},[_.fromDate,_.toDate]),F=(0,s.useCallback)(()=>{if(_.accountName){const e=I(JSON.parse(JSON.stringify(o)));n(e)}else n(o);A(!1)},[_.accountName,o,I]),M=(0,s.useCallback)(()=>{z({fromDate:e,toDate:e,accountName:null}),n(o)},[o,e]);return(0,s.useEffect)(()=>{k()},[k]),(0,S.jsxs)(r.A,{sx:{p:3},children:[(0,S.jsxs)(r.A,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[(0,S.jsx)(c.A,{variant:"h5",children:"Expense Hierarchy"}),(0,S.jsxs)(r.A,{children:[(0,S.jsx)(g.A,{title:"Reset filters",children:(0,S.jsx)(i.A,{onClick:M,sx:{mr:1},children:(0,S.jsx)(L,{})})}),(0,S.jsx)(g.A,{title:"Filter options",children:(0,S.jsx)(i.A,{color:"primary",onClick:()=>A(!0),sx:{backgroundColor:"rgba(25, 118, 210, 0.04)"},children:(0,S.jsx)(E,{})})})]})]}),(0,S.jsxs)(p.A,{open:u,onClose:()=>A(!1),maxWidth:"sm",fullWidth:!0,children:[(0,S.jsx)(f.A,{children:"Filter Options"}),(0,S.jsx)(v.A,{children:(0,S.jsxs)(r.A,{display:"flex",flexDirection:"column",gap:2,sx:{pt:2},children:[(0,S.jsx)(b.A,{type:"date",label:"From Date",value:_.fromDate,onChange:e=>z((0,l.A)((0,l.A)({},_),{},{fromDate:e.target.value})),InputLabelProps:{shrink:!0},fullWidth:!0}),(0,S.jsx)(b.A,{type:"date",label:"To Date",value:_.toDate,onChange:e=>z((0,l.A)((0,l.A)({},_),{},{toDate:e.target.value})),InputLabelProps:{shrink:!0},fullWidth:!0}),(0,S.jsx)(y.A,{options:m.accountNames,value:_.accountName,onChange:(e,t)=>z((0,l.A)((0,l.A)({},_),{},{accountName:t})),renderInput:e=>(0,S.jsx)(b.A,(0,l.A)((0,l.A)({},e),{},{label:"Account Name",fullWidth:!0})),freeSolo:!0})]})}),(0,S.jsxs)(C.A,{children:[(0,S.jsx)(D.A,{onClick:()=>A(!1),children:"Cancel"}),(0,S.jsx)(D.A,{variant:"contained",onClick:F,disabled:h,children:"Apply Filters"})]})]}),h?(0,S.jsx)(r.A,{display:"flex",justifyContent:"center",p:4,children:(0,S.jsx)(j.A,{})}):0===t.length?(0,S.jsx)(a.A,{sx:{p:2,textAlign:"center"},children:(0,S.jsx)(c.A,{children:"No expense data available"})}):t.map(e=>(0,S.jsx)(G,{node:e,filters:_},e.group_id))]})}},48920:(e,t,n)=>{n.d(t,{A:()=>r});var l=n(59662),s=n(70579);const r=(0,l.A)((0,s.jsx)("path",{d:"M19 13H5v-2h14z"}),"Remove")},52101:(e,t,n)=>{n.d(t,{A:()=>r});var l=n(59662),s=n(70579);const r=(0,l.A)((0,s.jsx)("path",{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}),"ExpandLess")},58293:(e,t,n)=>{n.d(t,{A:()=>r});var l=n(59662),s=n(70579);const r=(0,l.A)((0,s.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore")},70141:(e,t,n)=>{n.d(t,{A:()=>r});var l=n(59662),s=n(70579);const r=(0,l.A)((0,s.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add")},81e3:(e,t,n)=>{n.d(t,{A:()=>o});var l=n(84402),s=n(25430),r=n(37344),a=n(13375);const i=(0,n(57056).A)("MuiBox",["root"]),c=(0,r.A)(),o=(0,l.A)({themeId:a.A,defaultTheme:c,defaultClassName:i.root,generateClassName:s.A.generate})},84402:(e,t,n)=>{n.d(t,{A:()=>u});var l=n(58168),s=n(98587),r=n(65043),a=n(58387),i=n(13174),c=n(58812),o=n(18698),d=n(45527),h=n(70579);const x=["className","component"];function u(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{themeId:t,defaultTheme:n,defaultClassName:u="MuiBox-root",generateClassName:A}=e,m=(0,i.default)("div",{shouldForwardProp:e=>"theme"!==e&&"sx"!==e&&"as"!==e})(c.A);return r.forwardRef(function(e,r){const i=(0,d.A)(n),c=(0,o.A)(e),{className:j,component:g="div"}=c,p=(0,s.A)(c,x);return(0,h.jsx)(m,(0,l.A)({as:g,ref:r,className:(0,a.A)(j,A?A(u):u),theme:t&&i[t]||i},p))})}}}]);
//# sourceMappingURL=5693.6b38bc0d.chunk.js.map