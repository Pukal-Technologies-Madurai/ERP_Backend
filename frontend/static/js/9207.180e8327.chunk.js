"use strict";(self.webpackChunkerp=self.webpackChunkerp||[]).push([[9207],{14792:(e,l,s)=>{s.d(l,{A:()=>d});var a=s(70579);const d=()=>(0,a.jsx)("span",{style:{color:"red",fontWeight:"bold",fontSize:"1em"},children:" *"})},60108:(e,l,s)=>{s.d(l,{b:()=>i,h:()=>t});var a=s(22520);const d=(0,a.aN)().user,i={collection_id:"",collection_inv_no:"",voucher_id:"",collection_no:"",year_id:"",retailer_id:"",payed_by:"",collection_date:(0,a.ny)(),collection_type:"CASH",collection_account:"",payment_status:"",latitude:"",longitude:"",collected_by:"",total_amount:0,created_on:"",alterd_on:"",narration:"",verify_status:0,bank_date:"",created_by:d.UserId,updated_by:d.UserId,verified_by:d.UserId,verified_at:""},t={auto_id:"",collection_id:"",bill_id:"",bill_amount:0,collected_amount:0}},99207:(e,l,s)=>{s.r(l),s.d(l,{default:()=>_,payTypeAndStatus:()=>A});var a=s(89379),d=s(12110),i=s(11906),t=s(26494),o=s(22520),n=s(65074),c=s(20656),r=s(65043),u=s(73216),v=s(60108),h=s(91036),m=s(14792),p=s(92765),x=s(18124),j=s(70579);const b=e=>{var l,s,d;let{row:t={},receiptsPaymentInfo:n=[],setReceiptsPaymentInfo:c,Sno:u}=e;const[h,b]=(0,r.useState)(!1),[A,_]=(0,r.useState)(!1),y=(0,r.useMemo)(()=>{const e=n.find(e=>(0,o.id)(null===e||void 0===e?void 0:e.bill_id,null===t||void 0===t?void 0:t.Do_Id));return(0,o.aF)(e)?e:{}},[n,t]),N=(0,r.useMemo)(()=>n.findIndex(e=>(0,o.id)(null===e||void 0===e?void 0:e.bill_id,null===t||void 0===t?void 0:t.Do_Id)),[n,t]),g=(e,l)=>{c(s=>{const d=[...s];if(-1===N){const s=(0,a.A)({},v.h);return s.bill_id=null===t||void 0===t?void 0:t.Do_Id,s.bill_amount=(0,o.Ro)(null===t||void 0===t?void 0:t.Total_Invoice_value),s[e]=l,[...d,s]}return d[N][e]=l,d})},f=(0,r.useMemo)(()=>{var e;return Array.isArray(null===t||void 0===t?void 0:t.Payments)?null===t||void 0===t||null===(e=t.Payments)||void 0===e?void 0:e.reduce((e,l)=>(0,o.Lr)(e,l.collected_amount),0):0},[t]),C=(0,o.IQ)(null===y||void 0===y?void 0:y.bill_id);return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)("tr",{children:[(0,j.jsx)("td",{className:"border",children:u}),(0,j.jsx)("td",{className:"border",children:(0,j.jsx)("div",{children:(0,j.jsx)("input",{className:"form-check-input shadow-none pointer",style:{padding:"0.7em"},type:"checkbox",checked:C,onChange:()=>{C?c(e=>e.filter(e=>!(0,o.id)(e.bill_id,null===t||void 0===t?void 0:t.Do_Id))):g("bill_amount",(0,o.Ro)(null===t||void 0===t?void 0:t.Total_Invoice_value))}})})}),(0,j.jsx)("td",{className:"border",children:null===t||void 0===t?void 0:t.Do_Inv_No}),(0,j.jsx)("td",{className:"border",children:(0,o.yc)(null===t||void 0===t?void 0:t.Do_Date)}),(0,j.jsx)("td",{className:"border",children:(0,o.Ro)(null===t||void 0===t?void 0:t.Total_Invoice_value)}),(0,j.jsx)("td",{className:"border",children:f}),(0,j.jsx)("td",{className:"border",children:null===t||void 0===t?void 0:t.pendingAmount}),(0,j.jsx)("td",{className:"border",children:(0,o.Ro)(null===t||void 0===t||null===(l=t.Payments)||void 0===l?void 0:l.length)})]}),(0,j.jsx)("tr",{children:(0,j.jsx)("td",{colSpan:8,children:(0,j.jsxs)("div",{className:"d-flex align-items-end flex-wrap",children:[(0,j.jsxs)("div",{className:"flex-grow-1",children:[(0,j.jsxs)("label",{className:"fa-14 w-100",children:["Receipt Amount (\u20b9)",C&&(0,j.jsx)(m.A,{})]}),(0,j.jsx)("input",{onInput:o.BE,disabled:!C,value:null!==y&&void 0!==y&&y.collected_amount?(0,o.Ro)(null===y||void 0===y?void 0:y.collected_amount):"",onChange:e=>g("collected_amount",e.target.value),style:{width:"100%",maxWidth:"350px"},className:"cus-inpt border p-2",placeholder:"Enter Receipt Amount",max:(0,o.Ro)(null===t||void 0===t?void 0:t.pendingAmount),required:C})]}),(0,j.jsxs)(i.A,{startIcon:A?(0,j.jsx)(p.A,{}):(0,j.jsx)(x.A,{}),onClick:()=>_(e=>!e),children:[A?"Hide":"Show"," Invoice"]}),(0,j.jsxs)(i.A,{startIcon:h?(0,j.jsx)(p.A,{}):(0,j.jsx)(x.A,{}),onClick:()=>b(e=>!e),disabled:!Array.isArray(null===t||void 0===t?void 0:t.Payments)||0===(0,o.Ro)(null===t||void 0===t||null===(s=t.Payments)||void 0===s?void 0:s.length),children:[h?"Hide":"Previous"," Receipts"]})]})})}),A&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("tr",{children:(0,j.jsxs)("td",{colSpan:8,children:["Bill Details of - ",null===t||void 0===t?void 0:t.Do_Inv_No]})}),(0,j.jsx)("tr",{children:(0,j.jsx)("td",{colSpan:8,className:"p-0",children:(0,j.jsx)("div",{className:"table-responsive fa-13 m-0",children:(0,j.jsxs)("table",{className:"table m-0",children:[(0,j.jsx)("thead",{children:(0,j.jsx)("tr",{children:["SNo","Item","Quantity","Rate","Pack","Tax","Amount"].map((e,l)=>(0,j.jsx)("th",{className:"bg-light",children:e},l))})}),(0,j.jsx)("tbody",{children:Array.isArray(null===t||void 0===t?void 0:t.Products_List)&&t.Products_List.map((e,l)=>(0,j.jsxs)("tr",{children:[(0,j.jsx)("td",{children:l+1}),(0,j.jsx)("td",{children:null===e||void 0===e?void 0:e.Product_Name}),(0,j.jsx)("td",{children:null===e||void 0===e?void 0:e.Bill_Qty}),(0,j.jsx)("td",{children:null===e||void 0===e?void 0:e.Item_Rate}),(0,j.jsx)("td",{children:null===e||void 0===e?void 0:e.UOM}),(0,j.jsx)("td",{children:(0,o.Lr)(null===e||void 0===e?void 0:e.Cgst_Amo,null===e||void 0===e?void 0:e.Sgst_Amo)||(0,o.Ro)(null===e||void 0===e?void 0:e.Igst_Amo)}),(0,j.jsx)("td",{children:null===e||void 0===e?void 0:e.Amount})]},l))})]})})})})]}),h&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("tr",{children:(0,j.jsxs)("td",{colSpan:8,children:["Previous Receipts of - ",null===t||void 0===t?void 0:t.Do_Inv_No]})}),(0,j.jsx)("tr",{children:(0,j.jsx)("td",{colSpan:8,className:"p-0 border-0",children:(0,j.jsx)("div",{className:"table-responsive fa-13",children:(0,j.jsxs)("table",{className:"table m-0",children:[(0,j.jsx)("thead",{children:(0,j.jsx)("tr",{children:["SNo","Collected By","Amount","Date","Receipt Type","payment_status","Verify Status"].map((e,l)=>(0,j.jsx)("th",{className:"bg-light border",children:e},l))})}),(0,j.jsx)("tbody",{children:null===(d=Array.isArray(null===t||void 0===t?void 0:t.Payments)?null===t||void 0===t?void 0:t.Payments:[])||void 0===d?void 0:d.filter(e=>!(0,o.id)(e.auto_id,null===t||void 0===t?void 0:t.auto_id)).map((e,l)=>(0,j.jsxs)("tr",{children:[(0,j.jsx)("td",{className:"border",children:l+1}),(0,j.jsx)("td",{className:"border",children:null===e||void 0===e?void 0:e.CreatedByGet}),(0,j.jsx)("td",{className:"border",children:null===e||void 0===e?void 0:e.collected_amount}),(0,j.jsx)("td",{className:"border",children:null===e||void 0===e?void 0:e.collection_date}),(0,j.jsx)("td",{className:"border",children:null===e||void 0===e?void 0:e.collection_type}),(0,j.jsx)("td",{className:"border",children:null===e||void 0===e?void 0:e.collection_type}),(0,j.jsx)("td",{className:"border",children:null===e||void 0===e?void 0:e.verify_status})]},l))})]})})})}),(0,j.jsx)("tr",{children:(0,j.jsx)("td",{colSpan:8,className:"border-0"})})]})]})},A=[{type:"CASH",default:"CREATED-CASH",statusOptions:["CREATED-CASH","CASH-PROCESSING","CASH-MISSING"]},{type:"UPI",default:"CREATED-UPI",statusOptions:["CREATED-UPI","UPI-PROCESSING","UPI-NOT-RECEIVED"]},{type:"CHEQUE",default:"CREATED-CHEQUE",statusOptions:["CREATED-CHEQUE","CHEQUE-PROCESSING","CHEQUE-BOUNCE"]},{type:"BANK",default:"CREATED-BANK-TRANSFER",statusOptions:["CREATED-BANK-TRANSFER","BANK-PROCESSING","BANK-NOT-RECEIVED"]}],_=e=>{var l;let{loadingOn:s,loadingOff:p}=e;const x=(0,u.Zp)(),[_,y]=(0,r.useState)([]),[N,g]=(0,r.useState)([]),[f,C]=(0,r.useState)({salesPerson:[],voucherData:[],creditAccount:[]}),[S,R]=(0,r.useState)(v.b),[I,E]=(0,r.useState)([]),[P,D]=(0,r.useState)({Fromdate:(0,o.ny)(),Todate:(0,o.ny)(),Retailer:{value:"",label:"Search by Retailer..."}}),T=(null===(l=A.find(e=>e.type===(null===S||void 0===S?void 0:S.collection_type)))||void 0===l?void 0:l.statusOptions)||{};(0,r.useEffect)(()=>{(0,n.z)({address:"receipt/getRetailersWhoHasBills"}).then(e=>{e.success?g(e.data):g([])}).catch(e=>console.error(e)),(0,n.z)({address:"masters/users/salesPerson/dropDown"}).then(e=>{e.success?C(l=>(0,a.A)((0,a.A)({},l),{},{salesPerson:e.data})):C(e=>(0,a.A)((0,a.A)({},e),{},{salesPerson:[]}))}).catch(e=>console.error(e)),(0,n.z)({address:"masters/voucher"}).then(e=>{e.success?C(l=>(0,a.A)((0,a.A)({},l),{},{voucherData:e.data})):C(e=>(0,a.A)((0,a.A)({},e),{},{voucherData:[]}))}).catch(e=>console.error(e)),(0,n.z)({address:"receipt/creditAccounts"}).then(e=>{e.success?C(l=>(0,a.A)((0,a.A)({},l),{},{creditAccount:e.data})):C(e=>(0,a.A)((0,a.A)({},e),{},{creditAccount:[]}))}).catch(e=>console.error(e))},[]),(0,r.useEffect)(()=>{(0,o.IQ)(S.retailer_id)&&(s&&s(),(0,n.z)({address:"receipt/retailerBills?retailer_id=".concat(S.retailer_id)}).then(e=>{e.success?y(e.data):y([])}).catch(e=>console.error(e)).finally(()=>{p&&p()}))},[S.retailer_id]);const w=(0,r.useMemo)(()=>I.reduce((e,l)=>(0,o.Lr)(e,null===l||void 0===l?void 0:l.collected_amount),0),[I]),H=()=>{s&&s(),(0,n.z)({address:"receipt/collectionReceipts",method:(0,o.IQ)(S.collection_id)&&S.collection_id>0?"PUT":"POST",bodyData:(0,a.A)((0,a.A)({},S),{},{Collections:I})}).then(e=>{e.success?(h.oR.success((null===e||void 0===e?void 0:e.message)||"Receipt Created"),D(e=>(0,a.A)((0,a.A)({},e),{},{Retailer:{value:"",label:"Search by Retailer..."}})),R(v.b),E([]),y([])):h.oR.error((null===e||void 0===e?void 0:e.message)||"Failed to create Receipt")}).catch(e=>console.error(e)).finally(()=>{p&&p()})};return(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(d.A,{children:(0,j.jsxs)("form",{onSubmit:e=>{e.preventDefault(),H()},children:[(0,j.jsxs)("div",{className:"px-3 py-2 d-flex align-items-center",children:[(0,j.jsx)("h5",{className:"m-0 flex-grow-1",children:"Receipt Creation"}),(0,j.jsx)(i.A,{variant:"outlined",type:"button",className:"me-1",onClick:()=>x("/erp/crm/paymentCollection"),children:"Back"}),(0,j.jsx)(i.A,{variant:"outlined",type:"submit",disabled:0===I.length||I.every(e=>(0,o.Ro)(e.collected_amount)<=0),children:"save receipt"})]}),(0,j.jsxs)(t.A,{children:[(0,j.jsx)("label",{children:"Retailer"}),(0,j.jsx)("div",{className:"d-flex",children:(0,j.jsx)("div",{style:{width:"100%",maxWidth:"400px"},children:(0,j.jsx)(c.Ay,{menuPortalTarget:document.body,options:[{value:"",label:"select",isDisabled:!0},...N.map(e=>({value:null===e||void 0===e?void 0:e.Retailer_Id,label:null===e||void 0===e?void 0:e.Retailer_Name}))],value:P.Retailer,menu:!0,onChange:e=>{D(l=>(0,a.A)((0,a.A)({},l),{},{Retailer:e})),R(l=>(0,a.A)((0,a.A)({},l),{},{retailer_id:e.value}))},placeholder:"Search by Retailer",filterOption:o.GI})})}),(0,j.jsxs)("div",{className:"row fa-13 pb-3 mt-2",children:[(0,j.jsxs)("div",{className:"col-lg-3 col-md-4 col-sm-6 p-2",children:[(0,j.jsxs)("label",{children:["Date",(0,j.jsx)(m.A,{})]}),(0,j.jsx)("input",{type:"date",className:"cus-inpt border p-2",value:S.collection_date,onChange:e=>R(l=>(0,a.A)((0,a.A)({},l),{},{collection_date:e.target.value})),required:!0})]}),(0,j.jsxs)("div",{className:"col-lg-3 col-md-4 col-sm-6 p-2",children:[(0,j.jsxs)("label",{children:["Voucher",(0,j.jsx)(m.A,{})]}),(0,j.jsxs)("select",{className:"cus-inpt border p-2",value:S.voucher_id,required:!0,onChange:e=>R(l=>(0,a.A)((0,a.A)({},l),{},{voucher_id:e.target.value})),children:[(0,j.jsx)("option",{value:"",disabled:!0,children:"Select"}),f.voucherData.filter(e=>(0,o.xL)(e.Type,"Receipt")).map((e,l)=>(0,j.jsx)("option",{value:e.Vocher_Type_Id,children:e.Voucher_Type},l))]})]})]}),(0,j.jsxs)("div",{className:"row fa-13 pb-3",children:[(0,j.jsxs)("div",{className:"col-lg-3 col-md-4 col-sm-6 p-2",children:[(0,j.jsxs)("label",{children:["Payment Type",(0,j.jsx)(m.A,{})]}),(0,j.jsxs)("select",{className:"cus-inpt border p-2",value:S.collection_type,required:!0,onChange:e=>R(l=>{var s;return(0,a.A)((0,a.A)({},l),{},{collection_type:e.target.value,payment_status:null===(s=A.find(l=>l.type===e.target.value))||void 0===s?void 0:s.default})}),children:[(0,j.jsx)("option",{value:"",disabled:!0,children:"Select"}),(0,j.jsx)("option",{value:"CASH",children:"CASH"}),(0,j.jsx)("option",{value:"UPI",children:"UPI"}),(0,j.jsx)("option",{value:"CHEQUE",children:"CHEQUE"}),(0,j.jsx)("option",{value:"BANK",children:"BANK"})]})]}),(0,j.jsxs)("div",{className:"col-lg-3 col-md-4 col-sm-6 p-2",children:[(0,j.jsxs)("label",{children:["Payment Account ",(0,j.jsx)(m.A,{})]}),(0,j.jsxs)("select",{className:"cus-inpt border p-2",value:S.collection_account,required:!0,disabled:!S.collection_type,onChange:e=>R(l=>(0,a.A)((0,a.A)({},l),{},{collection_account:e.target.value})),children:[(0,j.jsx)("option",{value:"",disabled:!0,children:"Select"}),f.creditAccount.filter(e=>(0,o.xL)(S.collection_type,"CASH")?(0,o.xL)(e.Type,"CASH"):!(0,o.xL)(e.Type,"CASH")).map((e,l)=>(0,j.jsx)("option",{value:null===e||void 0===e?void 0:e.Id,children:null===e||void 0===e?void 0:e.Bank_Name},l))]})]}),(0,j.jsxs)("div",{className:"col-lg-3 col-md-4 col-sm-6 p-2",children:[(0,j.jsxs)("label",{children:["Payment Status",(0,j.jsx)(m.A,{})]}),(0,j.jsxs)("select",{className:"cus-inpt border p-2",value:S.payment_status,required:!0,disabled:!S.collection_type,onChange:e=>R(l=>(0,a.A)((0,a.A)({},l),{},{payment_status:e.target.value})),children:[(0,j.jsx)("option",{value:"",disabled:!0,children:"Select"}),T.map((e,l)=>(0,j.jsx)("option",{value:e,children:e},l)),(0,j.jsx)("option",{value:"Canceled",children:"Canceled"}),(0,j.jsx)("option",{value:"Completed",children:"Completed"})]})]})]}),(0,j.jsxs)("div",{className:"row fa-13 pb-3",children:[(0,j.jsxs)("div",{className:"col-lg-3 col-md-4 col-sm-6 p-2",children:[(0,j.jsx)("label",{children:"Payed By"}),(0,j.jsx)("input",{className:"cus-inpt border p-2",value:S.payed_by,placeholder:"Owner, Shop Keeper..",onChange:e=>R(l=>(0,a.A)((0,a.A)({},l),{},{payed_by:e.target.value}))})]}),(0,j.jsxs)("div",{className:"col-lg-3 col-md-4 col-sm-6 p-2",children:[(0,j.jsxs)("label",{children:["Amount Received By",(0,j.jsx)(m.A,{})]}),(0,j.jsxs)("select",{className:"cus-inpt border p-2",value:S.collected_by,onChange:e=>R(l=>(0,a.A)((0,a.A)({},l),{},{collected_by:e.target.value})),required:!0,children:[(0,j.jsx)("option",{value:"",disabled:!0,children:"Select"}),f.salesPerson.map((e,l)=>(0,j.jsx)("option",{value:e.UserId,children:e.Name},l))]})]}),(0,j.jsxs)("div",{className:"col-lg-3 col-md-4 col-sm-6 p-1",children:[(0,j.jsx)("label",{className:"fa-14",children:"Verify Date"}),(0,j.jsx)("input",{type:"date",value:null!==S&&void 0!==S&&S.bank_date?null===S||void 0===S?void 0:S.bank_date:"",onChange:e=>R(l=>(0,a.A)((0,a.A)({},l),{},{bank_date:e.target.value})),className:"cus-inpt border border p-2"})]}),(0,j.jsxs)("div",{className:"col-lg-3 col-md-4 col-sm-6 p-1",children:[(0,j.jsx)("label",{className:"fa-14",children:"Verify Status"}),(0,j.jsxs)("select",{value:null===S||void 0===S?void 0:S.verify_status,onChange:e=>R(l=>(0,a.A)((0,a.A)({},l),{},{verify_status:e.target.value})),className:"cus-inpt border border p-2",children:[(0,j.jsx)("option",{value:0,children:"Not-verified"}),(0,j.jsx)("option",{value:1,children:"verified"})]})]}),(0,j.jsxs)("div",{className:"col-lg-6 col-sm-8 p-1",children:[(0,j.jsx)("label",{className:"fa-14 w-100",children:"Narration"}),(0,j.jsx)("textarea",{style:{width:"100%",maxWidth:"450px"},className:"cus-inpt border p-2",value:null===S||void 0===S?void 0:S.narration,onChange:e=>R(l=>(0,a.A)((0,a.A)({},l),{},{narration:e.target.value})),placeholder:"Narration..."})]}),(0,j.jsxs)("div",{className:"col-lg-6 col-sm-4 p-1 text-end",children:[(0,j.jsx)("label",{className:"fa-14 w-100",children:"Total Receipt Amount"}),(0,j.jsx)("input",{className:"cus-inpt bg-white p-2 w-auto border border-primary text-primary",value:(0,o.e3)(w),disabled:!0})]})]}),(0,j.jsx)("div",{className:"table-responsive",children:(0,j.jsxs)("table",{className:"table table-bordered",children:[(0,j.jsx)("thead",{children:(0,j.jsx)("tr",{children:["Sno","#","Invoice No","Date","Invoice Value","Paid","Pending","Receipts"].map((e,l)=>(0,j.jsx)("th",{className:"bg-light fa-13 border",children:e},l))})}),(0,j.jsx)("tbody",{children:_.map((e,l)=>(0,j.jsx)(b,{row:e,Sno:l+1,receiptsPaymentInfo:I,setReceiptsPaymentInfo:E},l))})]})})]})]})})})}}}]);
//# sourceMappingURL=9207.180e8327.chunk.js.map