"use strict";(self.webpackChunkerp=self.webpackChunkerp||[]).push([[5233],{5745:(e,t,o)=>{o.r(t),o.d(t,{default:()=>oe});var l=o(89379),i=o(65043),n=o(12110),d=o(11906),a=o(26494),r=o(17392),s=o(98587),c=o(58168),u=o(58387),v=o(68606),m=o(34535),_=o(6431),p=o(57056),I=o(32400);function h(e){return(0,I.Ay)("MuiCardActions",e)}(0,p.A)("MuiCardActions",["root","spacing"]);var A=o(70579);const g=["disableSpacing","className"],y=(0,m.Ay)("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,!o.disableSpacing&&t.spacing]}})(e=>{let{ownerState:t}=e;return(0,c.A)({display:"flex",alignItems:"center",padding:8},!t.disableSpacing&&{"& > :not(style) ~ :not(style)":{marginLeft:8}})}),f=i.forwardRef(function(e,t){const o=(0,_.b)({props:e,name:"MuiCardActions"}),{disableSpacing:l=!1,className:i}=o,n=(0,s.A)(o,g),d=(0,c.A)({},o,{disableSpacing:l}),a=(e=>{const{classes:t,disableSpacing:o}=e,l={root:["root",!o&&"spacing"]};return(0,v.A)(l,h,t)})(d);return(0,A.jsx)(y,(0,c.A)({className:(0,u.A)(a.root,i),ownerState:d,ref:t},n))});var x=o(83462),b=o(26600),j=o(35316),N=o(29347),S=o(91036),C=o(22520),w=o(33438),D=o(70141),T=o(44676),G=o(83560),Q=o(51387),R=o(65074),E=o(48471),B=o(14844),O=o(73216),P=o(97280),k=o(63406),L=o(20656);const M=e=>{let{StaffArray:t=[],setStaffArray:o,costCenter:i=[],costCategory:n=[]}=e;const a=(e,o)=>{return(0,C.IQ)(null===e||void 0===e?void 0:e.Emp_Type_Id)?(l=e.Emp_Type_Id,n=o,(0,C.IQ)(l)?(0,C.$r)(i).filter(e=>(0,C.id)(e.User_Type,l)&&!t.some((t,o)=>o!==n&&(0,C.id)(t.Emp_Id,e.Cost_Center_Id))).map(e=>({value:e.Cost_Center_Id,label:e.Allias_Name,userType:e.User_Type})):[]):(e=>(0,C.$r)(i).filter(o=>!t.some((t,l)=>l!==e&&(0,C.id)(t.Emp_Id,o.Cost_Center_Id))).map(e=>({value:e.Cost_Center_Id,label:e.Allias_Name,userType:e.User_Type})))(o);var l,n};return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsxs)("div",{className:"d-flex align-items-center flex-wrap mb-2 border-bottom pb-2",children:[(0,A.jsx)("h6",{className:"flex-grow-1 m-0",children:"Staff Involved"}),(0,A.jsx)(d.A,{variant:"outlined",color:"primary",type:"button",onClick:()=>o(e=>[...e,(0,l.A)({},P.Ud)]),children:"Add"})]}),(0,A.jsxs)("table",{className:"table table-bordered",children:[(0,A.jsx)("thead",{children:(0,A.jsxs)("tr",{children:[(0,A.jsx)("th",{className:"fa-13",children:"Category"}),(0,A.jsx)("th",{className:"fa-13",children:"Staff Name"}),(0,A.jsx)("th",{className:"fa-13",children:"#"})]})}),(0,A.jsx)("tbody",{children:(0,C.$r)(t).map((e,t)=>(0,A.jsxs)("tr",{children:[(0,A.jsx)("td",{className:"fa-13 w-100 p-0",children:(0,A.jsx)(L.Ay,{value:(0,C.IQ)(null===e||void 0===e?void 0:e.Emp_Id)?{value:null===e||void 0===e?void 0:e.Emp_Id,label:null===e||void 0===e?void 0:e.Emp_Name}:null,onChange:e=>((e,t)=>{o(o=>o.map((o,n)=>{if(n===t){const t=(0,C.$r)(i).find(t=>(0,C.id)(t.Cost_Center_Id,e.value));return(0,l.A)((0,l.A)({},o),{},{Emp_Id:Number(e.value),Emp_Name:e.label,Emp_Type_Id:(null===t||void 0===t?void 0:t.User_Type)||""})}return o}))})(e,t),options:a(e,t),styles:k.MR,isSearchable:!0,placeholder:"Select Staff",filterOption:C.GI,noOptionsMessage:()=>(0,C.IQ)(null===e||void 0===e?void 0:e.Emp_Type_Id)?"No staff available for this category":"No staff available"})}),(0,A.jsx)("td",{className:"fa-13 vctr p-0",style:{maxWidth:"130px",minWidth:"100px"},children:(0,A.jsxs)("select",{value:(null===e||void 0===e?void 0:e.Emp_Type_Id)||"",onChange:e=>((e,t)=>{const n=e.target.value;o(e=>e.map((e,o)=>{if(o===t){const t=(0,C.$r)(i).find(t=>(0,C.id)(t.Cost_Center_Id,e.Emp_Id)),o=t&&!(0,C.id)(t.User_Type,n);return(0,l.A)((0,l.A)({},e),{},{Emp_Type_Id:n},o?{Emp_Id:"",Emp_Name:""}:{})}return e}))})(e,t),className:"cus-inpt p-2 border-0 w-100",children:[(0,A.jsx)("option",{value:"",children:"Select Category"}),(0,C.$r)(n).map((e,t)=>(0,A.jsx)("option",{value:null===e||void 0===e?void 0:e.Cost_Category_Id,children:null===e||void 0===e?void 0:e.Cost_Category},t))]})}),(0,A.jsx)("td",{className:"fa-13 vctr p-0",children:(0,A.jsx)(r.A,{onClick:()=>{o(e=>e.filter((e,o)=>t!==o))},size:"small",children:(0,A.jsx)(Q.A,{color:"error"})})})]},t))})]})]})};var z=o(79399),U=o(24651),V=o(34104),H=o(35786),F=o(80045),$=o(34496),W=o(14792);const Y=["stock"],q=(e,t,o)=>{var l;const i=null===(l=(0,C.$r)(o).find(o=>(0,C.id)(null===o||void 0===o?void 0:o.Product_Id,e)&&(0,C.id)(null===o||void 0===o?void 0:o.Godown_Id,t)))||void 0===l?void 0:l.Act_Bal_Qty;return(0,C.Ro)(i)},X=e=>{var t,o;let{children:n,orderProducts:a=[],setOrderProducts:r,open:s=!1,onClose:c,products:u=[],brands:v=[],uom:m=[],godowns:_=[],GST_Inclusive:p,IS_IGST:I,editValues:h=null,initialValue:g={},batchDetails:y=[]}=e;const[f,w]=(0,i.useState)(g),D=(0,C.id)(p,1),T=(0,C.id)(p,2),[G,Q]=(0,i.useState)([]),E=(0,i.useRef)(null);(0,i.useEffect)(()=>{(0,C.aF)(h)&&s&&w(e=>Object.fromEntries(Object.entries(e).map(e=>{let[t,o]=e;return[t,h[t]?h[t]:o]})))},[h]);const O=e=>{var t;return null!==(t=null===u||void 0===u?void 0:u.find(t=>(0,C.id)(null===t||void 0===t?void 0:t.Product_Id,e)))&&void 0!==t?t:{}},P=()=>{w(g),c()},M=(e,t)=>{e.preventDefault(),!(0,C.gf)(f.Item_Id)||Object.hasOwn(f,"GoDown_Id")&&!(0,C.gf)(f.GoDown_Id)?f.Item_Id?S.oR.warn("Select Godown"):S.oR.warn("Select Product"):function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];r(e=>[...e.filter(e=>e.rowId!==f.rowId),Object.fromEntries(Object.entries(f).map(e=>{let[t,o]=e;const l=O(f.Item_Id),i=I?l.Igst_P:l.Gst_P,n=i>0,d=q(f.Item_Id,f.GoDown_Id,G),{Bill_Qty:a,Item_Rate:r,Amount:s}=f,c=T?"zerotax":D?"remove":"add",u=(0,B.v)(r,i,c),v=(0,B.v)(s,i,c),m=I?0:v.cgst_per,_=I?v.igst_per:0,p=I?0:v.cgst_amount,h=I?v.igst_amount:0;switch(t){case"Item_Name":return[t,l.Product_Name];case"Taxable_Rate":return[t,u.base_amount];case"Total_Qty":return[t,a];case"Taxble":return[t,n?1:0];case"Taxable_Amount":return[t,v.base_amount];case"Tax_Rate":return[t,i];case"Cgst":case"Sgst":return[t,null!==m&&void 0!==m?m:0];case"Cgst_Amo":case"Sgst_Amo":return[t,T?0:p];case"Igst":return[t,null!==_&&void 0!==_?_:0];case"Igst_Amo":return[t,T?0:h];case"Final_Amo":return[t,v.with_tax];case"Godown_Stock":return[t,d];default:return[t,f[t]||o]}}))]),e?P():w(g)}(t)};(0,i.useEffect)(()=>{Q([]),(0,C.IQ)(f.Item_Id)&&!(0,C.id)(f.Item_Id,0)&&(0,R.z)({address:"sales/stockInGodown?Item_Id=".concat(f.Item_Id)}).then(e=>{const t=(e.success?e.data:[]).sort((e,t)=>(0,C.Ro)(null===t||void 0===t?void 0:t.Act_Bal_Qty)-(0,C.Ro)(null===e||void 0===e?void 0:e.Act_Bal_Qty));Q(t)})},[f.Item_Id]);const z=(0,i.useMemo)(()=>{const e=O(f.Item_Id);return f.Item_Id?e:{}},[u,f.Item_Id]);(0,i.useEffect)(()=>{const{Item_Rate:e,Amount:t,Bill_Qty:o}=f;if((0,C.gf)(o)&&0!==o){if(("RATE"===E.current||"QTY"===E.current)&&(0,C.gf)(e)){const t=(0,C.JH)(e,o);w(e=>e.Amount===t?e:(0,l.A)((0,l.A)({},e),{},{Amount:t}))}if("AMOUNT"===E.current&&(0,C.gf)(t)){const e=(0,C.SX)(t,o);w(t=>t.Item_Rate===e?t:(0,l.A)((0,l.A)({},t),{},{Item_Rate:e}))}}},[f.Item_Rate,f.Amount,f.Bill_Qty,f.Act_Qty]);const U=(0,i.useMemo)(()=>{if(!(0,C.IQ)(f.Item_Id))return[];const e=O(f.Item_Id),t=(null===e||void 0===e?void 0:e.PackGet)||1;return(0,C.$r)(_).map(e=>{const o=(0,C.IQ)(null===e||void 0===e?void 0:e.Godown_Id)?(0,C.Ro)(q(f.Item_Id,null===e||void 0===e?void 0:e.Godown_Id,G)):0,l=(0,C.SX)(o,t);return{value:null===e||void 0===e?void 0:e.Godown_Id,label:"".concat(null===e||void 0===e?void 0:e.Godown_Name," (Q: ").concat(o,", P: ").concat(l,")"),stock:o}}).sort((e,t)=>t.stock-e.stock).map(e=>{let{stock:t}=e;return(0,F.A)(e,Y)})},[_,f.Item_Id,G,u]);return(0,A.jsxs)(A.Fragment,{children:[n,(0,A.jsxs)(x.A,{open:s,onClose:P,maxWidth:"md",fullWidth:!0,children:[(0,A.jsx)(b.A,{className:"border-bottom",children:(0,A.jsx)("span",{children:"Add Products Details"})}),(0,A.jsxs)("form",{onSubmit:e=>M(e,!0),children:[(0,A.jsx)(j.A,{children:(0,A.jsxs)("div",{className:"row pb-5",children:[(0,A.jsxs)("div",{className:"col-6 p-2",children:[(0,A.jsx)("label",{children:"Brand"}),(0,A.jsx)(L.Ay,{value:{value:f.BrandID,label:f.Brand},onChange:e=>w(t=>(0,l.A)((0,l.A)({},t),{},{BrandID:e.value,Brand:e.label})),options:[{value:"",label:"select",isDisabled:!0},...v.map(e=>({value:null===e||void 0===e?void 0:e.Brand,label:null===e||void 0===e?void 0:e.Brand_Name}))],styles:k.MR,menuPortalTarget:document.body,isSearchable:!0,placeholder:"Select Brand",maxMenuHeight:200,filterOption:C.GI})]}),(0,A.jsxs)("div",{className:"col-6 p-2",children:[(0,A.jsx)("label",{children:"Group"}),(0,A.jsx)(L.Ay,{value:{value:f.GroupID,label:f.Group},onChange:e=>w(t=>(0,l.A)((0,l.A)({},t),{},{GroupID:e.value,Group:e.label})),options:[{value:"",label:"select",isDisabled:!0},...u.filter(e=>!f.BrandID||(0,C.id)(e.Brand,f.BrandID)).reduce((e,t)=>(e.some(e=>e.value===t.Product_Group)||e.push({value:t.Product_Group,label:t.Pro_Group}),e),[])],styles:k.MR,menuPortalTarget:document.body,isSearchable:!0,placeholder:"Select Group",maxMenuHeight:200,filterOption:C.GI})]}),(0,A.jsxs)("div",{className:Object.hasOwn(f,"GoDown_Id")?"col-md-8 p-2":"col-12 p-2",children:[(0,A.jsxs)("label",{children:["Item Name ",(0,A.jsx)(W.A,{})]}),(0,A.jsx)(L.Ay,{value:{value:f.Item_Id,label:null===(t=O(f.Item_Id))||void 0===t?void 0:t.Product_Name},isDisabled:(0,C.IQ)(f.Pre_Id),menuPortalTarget:document.body,onChange:e=>{const t=O(e.value);w(o=>{var i,n,d,a,r,s,c;return(0,l.A)((0,l.A)({},o),{},{Group:null!==(i=t.Pro_Group)&&void 0!==i?i:o.Group,GroupID:null!==(n=t.Product_Group)&&void 0!==n?n:o.GroupID,Brand:null!==(d=t.Brand_Name)&&void 0!==d?d:o.Brand,BrandID:null!==(a=t.Brand)&&void 0!==a?a:o.BrandID,Item_Id:e.value,Item_Rate:null!==(r=t.Item_Rate)&&void 0!==r?r:0,GoDown_Id:"",Bill_Qty:0,Alt_Bill_Qty:0,Act_Qty:0,Alt_Act_Qty:0,Amount:0,Unit_Id:null!==(s=t.UOM_Id)&&void 0!==s?s:o.Unit_Id,Unit_Name:null!==(c=t.Units)&&void 0!==c?c:o.Unit_Name,HSN_Code:null===t||void 0===t?void 0:t.HSN_Code})})},options:[{value:"",label:"select",isDisabled:!0},...[...u.filter(e=>!f.BrandID||(0,C.id)(e.Brand,f.BrandID)).filter(e=>!f.GroupID||(0,C.id)(e.Product_Group,f.GroupID))].map(e=>({value:null===e||void 0===e?void 0:e.Product_Id,label:null===e||void 0===e?void 0:e.Product_Name,isDisabled:-1!==a.findIndex(t=>(0,C.id)(null===t||void 0===t?void 0:t.Item_Id,null===e||void 0===e?void 0:e.Product_Id))}))],styles:k.MR,isSearchable:!0,placeholder:"Select Product",maxMenuHeight:200,filterOption:C.GI})]}),Object.hasOwn(f,"GoDown_Id")&&(0,A.jsxs)("div",{className:"col-md-4 p-2",children:[(0,A.jsx)("label",{children:"Godown"}),(0,A.jsx)(L.Ay,{value:{value:null===f||void 0===f?void 0:f.GoDown_Id,label:(null===(o=_.find(e=>(0,C.id)(e.Godown_Id,null===f||void 0===f?void 0:f.GoDown_Id)))||void 0===o?void 0:o.Godown_Name)||""},onChange:e=>w(t=>(0,l.A)((0,l.A)({},t),{},{GoDown_Id:e.value})),options:[{value:"",label:"select",isDisabled:!0},...U],styles:k.MR,isDisabled:!(0,C.IQ)(null===f||void 0===f?void 0:f.Item_Id),menuPortalTarget:document.body,isSearchable:!0,placeholder:"Select Godown",filterOption:C.GI})]}),(0,A.jsxs)("div",{className:"col-md-6 p-2",children:[(0,A.jsx)("label",{children:"Actual Quantity "}),(0,A.jsx)("input",{value:f.Act_Qty?f.Act_Qty:"",onInput:C.BE,disabled:!(0,C.IQ)(f.Item_Id),onChange:e=>{E.current="QTY";const t=null===z||void 0===z?void 0:z.PackGet,o=(0,C.SX)(e.target.value,t);w(t=>(0,l.A)((0,l.A)({},t),{},{Act_Qty:e.target.value,Bill_Qty:e.target.value,Alt_Act_Qty:o,Alt_Bill_Qty:o}))},required:!0,className:"cus-inpt"})]}),(0,A.jsxs)("div",{className:"col-md-6 p-2",children:[(0,A.jsx)("label",{children:"Alt Act Quantity"}),(0,A.jsx)("input",{value:f.Alt_Act_Qty||"",className:"cus-inpt",type:"number",onChange:e=>{E.current="QTY";const t=null===z||void 0===z?void 0:z.PackGet,o=(0,C.JH)(e.target.value,t);w(t=>(0,l.A)((0,l.A)({},t),{},{Alt_Act_Qty:e.target.value,Alt_Bill_Qty:e.target.value,Act_Qty:o,Bill_Qty:o}))}})]}),(0,A.jsxs)("div",{className:"col-md-6 p-2",children:[(0,A.jsxs)("label",{children:["Bill Quantity ",(0,A.jsx)(W.A,{})]}),(0,A.jsx)("input",{required:!0,value:f.Bill_Qty?f.Bill_Qty:"",onInput:C.BE,disabled:!(0,C.IQ)(f.Item_Id),onChange:e=>{E.current="QTY";const t=null===z||void 0===z?void 0:z.PackGet,o=(0,C.SX)(e.target.value,t);w(t=>(0,l.A)((0,l.A)({},t),{},{Bill_Qty:e.target.value,Alt_Bill_Qty:o}))},className:"cus-inpt",min:1})]}),(0,A.jsxs)("div",{className:"col-md-6 p-2",children:[(0,A.jsx)("label",{children:"Alt Bill Quantity"}),(0,A.jsx)("input",{value:f.Alt_Bill_Qty||"",className:"cus-inpt",type:"number",onChange:e=>{E.current="QTY";const t=null===z||void 0===z?void 0:z.PackGet;w(o=>(0,l.A)((0,l.A)({},o),{},{Alt_Bill_Qty:e.target.value,Bill_Qty:(0,C.JH)(e.target.value,t)}))}})]}),(0,A.jsxs)("div",{className:"col-lg-4 col-md-6 p-2",children:[(0,A.jsx)("label",{children:"Rate "}),(0,A.jsx)("input",{value:f.Item_Rate||"",onInput:C.BE,disabled:!(0,C.IQ)(f.Item_Id),onChange:e=>{return t=e.target.value,E.current="RATE",void w(e=>(0,l.A)((0,l.A)({},e),{},{Item_Rate:t}));var t},required:!0,className:"cus-inpt"})]}),(0,A.jsxs)("div",{className:"col-lg-4 col-md-6 p-2",children:[(0,A.jsx)("label",{children:"UOM"}),(0,A.jsxs)("select",{value:Object.hasOwn(f,"UOM")?f.UOM:Object.hasOwn(f,"Unit_Id")?f.Unit_Id:"",onChange:e=>{const t=e.target.selectedIndex,o=e.target.options[t].text,i=e.target.value;w(e=>(0,l.A)((0,l.A)({},e),{},{UOM:i,Unit_Id:i,Units:o,Unit_Name:o}))},className:"cus-inpt",disabled:!(0,C.IQ)(f.Item_Id),children:[(0,A.jsx)("option",{value:"",disabled:!0,children:"select"}),m.map((e,t)=>(0,A.jsx)("option",{value:e.Unit_Id,children:e.Units},t))]})]}),(0,A.jsxs)("div",{className:"col-lg-4 col-md-6 p-2",children:[(0,A.jsx)("label",{children:"Amount"}),(0,A.jsx)("input",{required:!0,value:f.Amount||"",onInput:C.BE,disabled:!(0,C.IQ)(f.Item_Id),onChange:e=>{return t=e.target.value,E.current="AMOUNT",void w(e=>(0,l.A)((0,l.A)({},e),{},{Amount:t}));var t},className:"cus-inpt",min:1})]}),(0,A.jsxs)("div",{className:"col-lg-4 col-md-6 p-2",children:[(0,A.jsx)("label",{children:"Batch"}),(0,A.jsx)(L.Ay,{value:{value:(null===f||void 0===f?void 0:f.Batch_Name)||"",label:(null===f||void 0===f?void 0:f.Batch_Name)||""},onChange:e=>w(t=>(0,l.A)((0,l.A)({},t),{},{Batch_Name:e.value})),options:y.filter(e=>(0,C.id)(e.item_id,null===f||void 0===f?void 0:f.Item_Id)&&(0,C.id)(null===e||void 0===e?void 0:e.godown_id,null===f||void 0===f?void 0:f.GoDown_Id)&&(0,C.Ro)(e.pendingQuantity)>=(0,C.Ro)(null===f||void 0===f?void 0:f.Bill_Qty)).map(e=>({value:e.batch,label:e.batch})),styles:k.MR,isSearchable:!0,placeholder:"Select Batch",menuPortalTarget:document.body,isDisabled:!0})]})]})}),(0,A.jsxs)(N.A,{className:"d-flex justify-content-between align-items-center",children:[(0,A.jsx)(d.A,{onClick:()=>w(g),type:"button",startIcon:(0,A.jsx)($.A,{}),children:"Clear"}),(0,A.jsxs)("span",{children:[(0,A.jsx)(d.A,{type:"button",onClick:P,children:"cancel"}),(0,A.jsx)(d.A,{type:"button",onClick:e=>M(e,!1),variant:"outlined",className:"me-2",children:"Next"}),(0,A.jsx)(d.A,{type:"submit",variant:"contained",children:"Add"})]})]})]})]})]})};var J=o(90001),Z=o(10489),K=o(22240);const ee=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(!e||!Array.isArray(e)||0===e.length)return!1;const l={1:"createOption",2:"getOption",3:"updateOption",4:"deleteOption"};return!!t&&e.some(e=>{const i=l[o]||"";return e.ruleCode===t&&i?(0,C.id)(e[i],1):e.ruleCode===t&&{createAccess:(0,C.id)(null===e||void 0===e?void 0:e.createOption,1),readAccess:(0,C.id)(null===e||void 0===e?void 0:e.getOption,1),updateAccess:(0,C.id)(null===e||void 0===e?void 0:e.updateOption,1),deleteAccess:(0,C.id)(null===e||void 0===e?void 0:e.deleteOption,1)}})},te=function(){var e;let t=arguments.length>1?arguments[1]:void 0;return null!==(e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).find(e=>(0,C.id)(e.Product_Id,t)))&&void 0!==e?e:{}},oe=e=>{let{loadingOn:t,loadingOff:o}=e;const s=(0,O.Zp)(),c=(0,O.zy)().state,[u,v]=(0,i.useState)({products:[],branch:[],retailers:[],voucherType:[],uom:[],staff:[],staffType:[],brand:[],godown:[],expence:[],stockInGodown:[],stockItemLedgerName:[],batchDetails:[],moduleConfiguration:[]}),[m,_]=(0,i.useState)({addProductDialog:!1,importFromSaleOrder:!1,godownMismatch:!1}),[p,I]=(0,i.useState)(P.Q4),[h,g]=(0,i.useState)(P.zA),[y,k]=(0,i.useState)(P.zA),[L,F]=(0,i.useState)([]),[$,W]=(0,i.useState)([]),[Y,q]=(0,i.useState)([]),[oe,le]=(0,i.useState)(P.NP),[ie,ne]=(0,i.useState)(null),de=(0,C.id)(p.GST_Inclusive,1),ae=(0,C.id)(p.GST_Inclusive,2),re=(0,C.id)(p.IS_IGST,1),se=ae?"zerotax":de?"remove":"add",ce=3-L.length,[ue,ve]=(0,i.useState)({open:!1,Do_Id:null,deliverySlipDialog:!1}),me=(0,i.useMemo)(()=>(0,C.gf)(null===p||void 0===p?void 0:p.Do_Id),[null===p||void 0===p?void 0:p.Do_Id]);(0,i.useEffect)(()=>{(async()=>{try{t&&t();const[e,o,i,n,d,a,r,s,c,u,m,_]=await Promise.all([(0,R.z)({address:"masters/branch/dropDown"}),(0,R.z)({address:"masters/products"}),(0,R.z)({address:"masters/retailers/dropDown"}),(0,R.z)({address:"masters/voucher?module=SALES"}),(0,R.z)({address:"masters/uom"}),(0,R.z)({address:"dataEntry/costCenter"}),(0,R.z)({address:"dataEntry/costCenter/category"}),(0,R.z)({address:"dataEntry/godownLocationMaster"}),(0,R.z)({address:"masters/defaultAccountMaster?Type=SALES_INVOICE"}),(0,R.z)({address:"purchase/stockItemLedgerName?type=SALES"}),(0,R.z)({address:"inventory/batchMaster/stockBalance"}),(0,R.z)({address:"authorization/moduleConfiguration?moduleName=SALE_INVOICE"})]),p=(e.success?e.data:[]).sort((e,t)=>String(null===e||void 0===e?void 0:e.BranchName).localeCompare(null===t||void 0===t?void 0:t.BranchName)),I=(o.success?o.data:[]).sort((e,t)=>String(null===e||void 0===e?void 0:e.Product_Name).localeCompare(null===t||void 0===t?void 0:t.Product_Name)),h=(i.success?i.data:[]).sort((e,t)=>String(null===e||void 0===e?void 0:e.Retailer_Name).localeCompare(null===t||void 0===t?void 0:t.Retailer_Name)),A=(n.success?n.data:[]).sort((e,t)=>String(null===e||void 0===e?void 0:e.Voucher_Type).localeCompare(null===t||void 0===t?void 0:t.Voucher_Type)),g=(d.success?d.data:[]).sort((e,t)=>String(e.Units).localeCompare(t.Units)),y=(a.success?a.data:[]).sort((e,t)=>String(null===e||void 0===e?void 0:e.Cost_Center_Name).localeCompare(null===t||void 0===t?void 0:t.Cost_Center_Name)),f=(r.success?r.data:[]).sort((e,t)=>String(null===e||void 0===e?void 0:e.Cost_Category).localeCompare(null===t||void 0===t?void 0:t.Cost_Category)),x=(s.success?s.data:[]).sort((e,t)=>String(null===e||void 0===e?void 0:e.Godown_Name).localeCompare(null===t||void 0===t?void 0:t.Godown_Name)),b=(c.success?(0,C.$r)(c.data):[]).sort((e,t)=>String(null===e||void 0===e?void 0:e.Account_Name).localeCompare(null===t||void 0===t?void 0:t.Account_Name)),j=u.success?u.data:[],N=_.success?_.data:[];v(e=>(0,l.A)((0,l.A)({},e),{},{products:I,branch:p,retailers:h,voucherType:A,uom:g,staff:y,staffType:f,godown:x,brand:(0,C.Mn)(I,"Brand",["Brand_Name"]),expence:b.map(e=>({Id:e.Acc_Id,Expence_Name:e.Account_Name,percentageValue:e.percentageValue})),stockItemLedgerName:j,batchDetails:(0,C.$r)(m.data),moduleConfiguration:N}))}catch(e){console.error("Error fetching data:",e)}finally{o&&o()}})()},[]),(0,i.useEffect)(()=>{(0,C.gf)(p.Retailer_Id)?(0,R.z)({address:"receipt/receiptMaster/pendingSalesInvoiceReceipt/amount?Retailer_Id=".concat(p.Retailer_Id),loadingOff:o,loadingOn:t}).then(e=>{if(e.success){const t=(0,P.WS)(null===e||void 0===e?void 0:e.others);le(o=>{var i,n,d,a,r;return(0,l.A)((0,l.A)({},o),{},{outstanding:(0,C.Ro)(null===e||void 0===e||null===(i=e.others)||void 0===i?void 0:i.outstanding),creditLimit:(0,C.Ro)(null===e||void 0===e||null===(n=e.others)||void 0===n?void 0:n.creditLimit),creditDays:(0,C.Ro)(null===e||void 0===e||null===(d=e.others)||void 0===d?void 0:d.creditDays),recentDate:null!==e&&void 0!==e&&null!==(a=e.others)&&void 0!==a&&a.recentDate?new Date(null===e||void 0===e||null===(r=e.others)||void 0===r?void 0:r.recentDate):new Date,invoiceCreationStatus:t})})}}).catch(console.error):le(P.NP)},[p.Retailer_Id]),(0,i.useEffect)(()=>{if((0,C.aF)(c)&&Array.isArray(null===c||void 0===c?void 0:c.Products_List)){const{Products_List:e,Expence_Array:t,Staffs_Array:o}=c;I(Object.fromEntries(Object.entries(P.Q4).map(e=>{var t;let[o,l]=e;return"Do_Date"===o?[o,c[o]?(0,C.ny)(c[o]):l]:[o,null!==(t=c[o])&&void 0!==t?t:l]}))),F(e.sort((e,t)=>(0,C.Ro)(null===e||void 0===e?void 0:e.S_No)-(0,C.Ro)(null===t||void 0===t?void 0:t.S_No)).map(e=>Object.fromEntries(Object.entries(P.a4).map(t=>{var o;let[l,i]=t;return"rowId"===l?[l,(0,C.aG)()]:[l,null!==(o=e[l])&&void 0!==o?o:i]})))),W((0,C.$r)(t).map(e=>Object.fromEntries(Object.entries(P.ju).map(t=>{var o;let[l,i]=t;return[l,null!==(o=e[l])&&void 0!==o?o:i]})))),q(()=>{const e=(0,C.$r)(o).map(e=>Object.fromEntries(Object.entries(P.Ud).map(t=>{var o;let[l,i]=t;return[l,null!==(o=e[l])&&void 0!==o?o:i]})));return Array.from(new Map(e.map(e=>["".concat(e.Emp_Id,"-").concat(e.Emp_Type_Id),e])).values())})}},[c]),(0,i.useEffect)(()=>{const e=(0,C.$r)(null===c||void 0===c?void 0:c.Staffs_Array);if((0,C.IQ)(p.Retailer_Id)&&u.retailers.length&&0===e.length){const e=(0,C.$r)(u.retailers).find(e=>(0,C.id)(null===e||void 0===e?void 0:e.Retailer_Id,p.Retailer_Id));if(!e)return;q(t=>{const o=[];(0,C.gf)(e.brokerId)&&o.push({Emp_Id:e.brokerId,Emp_Name:e.brokerName,Emp_Type_Id:e.brokerTypeId}),(0,C.gf)(e.transporterId)&&o.push({Emp_Id:e.transporterId,Emp_Name:e.transporterName,Emp_Type_Id:e.transporterTypeId});let l=[...t];return o.forEach(e=>{const t=l.findIndex(t=>(0,C.id)(t.Emp_Type_Id,e.Emp_Type_Id));if(-1!==t){const o=l[t];(0,C.gf)(o.Emp_Id)||(l[t]=e)}else l.push(e)}),l})}},[p.Retailer_Id,u.retailers.length,c]),(0,i.useEffect)(()=>{if(u.stockItemLedgerName.length>0&&(null===c||void 0===c||!c.Stock_Item_Ledger_Name)){const e=u.stockItemLedgerName[0];e&&I(t=>(0,l.A)((0,l.A)({},t),{},{Stock_Item_Ledger_Name:null===e||void 0===e?void 0:e.Stock_Item_Ledger_Name}))}},[c,u.stockItemLedgerName]),(0,i.useEffect)(()=>{const e=null===p||void 0===p?void 0:p.Retailer_Id;if((0,C.gf)(e)){var t,o;const l=u.retailers.find(t=>(0,C.id)(t.Retailer_Id,e))||{},i=(0,C.$r)(null===l||void 0===l?void 0:l.deliveryAddresses),{lolDeliveryName:n="",lolPhoneNumber:d="",lolCityName:a="",lolDeliveryAddress:r="",lolGstNumber:s="",lolStateName:c=""}=l,v=null!==(t=i.find(e=>(0,C.id)(null===e||void 0===e?void 0:e.id,null===p||void 0===p?void 0:p.deliveryAddressId)))&&void 0!==t?t:null;v?(0,P.vD)(v,g):(0,P.vD)({deliveryName:n,phoneNumber:d,cityName:a,deliveryAddress:r,gstNumber:s,stateName:c},g);const m=null!==(o=i.find(e=>(0,C.id)(null===e||void 0===e?void 0:e.id,null===p||void 0===p?void 0:p.shipingAddressId)))&&void 0!==o?o:null;m?(0,P.vD)(m,k):(0,P.vD)({deliveryName:n,phoneNumber:d,cityName:a,deliveryAddress:r,gstNumber:s,stateName:c},k)}},[u.retailers,p.Retailer_Id]),(0,i.useEffect)(()=>{const e=(0,P.$B)(u.staffType);q(t=>{const o=e.filter(e=>!t.some(t=>(0,C.id)(t.Emp_Type_Id,e.Emp_Type_Id)));return[...t,...o]})},[u.staffType]),(0,i.useEffect)(()=>{F(e=>[...e].map(e=>Object.fromEntries(Object.entries(e).map(t=>{let[o,l]=t;const i=te(u.products,null===e||void 0===e?void 0:e.Item_Id),n=re?i.Igst_P:i.Gst_P,d=n>0,{Bill_Qty:a,Item_Rate:r,Amount:s}=e,c=(0,B.v)(r,n,se),v=(0,B.v)(s,n,se),m=re?0:v.cgst_per,_=re?v.igst_per:0,p=re?0:v.cgst_amount,I=re?v.igst_amount:0;switch(o){case"Taxable_Rate":return[o,c.base_amount];case"Total_Qty":return[o,a];case"Taxble":return[o,d?1:0];case"Taxable_Amount":return[o,v.base_amount];case"Tax_Rate":return[o,n];case"Cgst":case"Sgst":return[o,null!==m&&void 0!==m?m:0];case"Cgst_Amo":case"Sgst_Amo":return[o,ae?0:p];case"Igst":return[o,null!==_&&void 0!==_?_:0];case"Igst_Amo":return[o,ae?0:I];case"Final_Amo":return[o,v.with_tax];default:return[o,e[o]||l]}}))))},[u.products,re,se]),(0,i.useEffect)(()=>{W(e=>[...e].map(e=>{const t=re?(0,C.Ro)(null===e||void 0===e?void 0:e.Igst):0,o=re?0:(0,C.Ro)(null===e||void 0===e?void 0:e.Cgst),i=re?0:(0,C.Ro)(null===e||void 0===e?void 0:e.Sgst),n=(0,C.Ro)(null===e||void 0===e?void 0:e.Expence_Value),d=re?t:(0,C.Lr)(o,i),a=(0,B.v)(n,d,se);return(0,l.A)((0,l.A)({},e),{},{Cgst:o,Sgst:i,Igst:t,Expence_Value:n,Cgst_Amo:o>0?a.cgst_amount:0,Sgst_Amo:i>0?a.sgst_amount:0,Igst_Amo:t>0?a.igst_amount:0})}))},[u.expence,re,se]);const _e=(0,i.useMemo)(()=>(0,C.$r)($).reduce((e,t)=>(0,C.Lr)(e,null===t||void 0===t?void 0:t.Expence_Value),0),[$]),pe=(0,i.useMemo)(()=>{const e=L.reduce((e,t)=>{const o=(0,C.e3)(null===t||void 0===t?void 0:t.Amount);if(ae)return(0,C.Lr)(e,o);const l=te(u.products,t.Item_Id),i=re?l.Igst_P:l.Gst_P;return de?(0,C.Lr)(e,(0,B.v)(o,i,"remove").with_tax):(0,C.Lr)(e,(0,B.v)(o,i,"add").with_tax)},0);return(0,C.Lr)(e,_e)},[L,ae,u.products,re,de,_e]),Ie=(0,i.useMemo)(()=>{if(0===(0,C.$r)(L).length)return{};let e=0,t=0;L.forEach(o=>{const l=(0,C.e3)((null===o||void 0===o?void 0:o.Amount)||0);if(ae)return void(e=(0,C.Lr)(e,l));const i=te(u.products,o.Item_Id),n=(0,C.id)(re,1)?i.Igst_P:i.Gst_P,d=(0,B.v)(l,n,de?"remove":"add");e=(0,C.Lr)(e,parseFloat(d.without_tax)),t=(0,C.Lr)(t,parseFloat(d.tax_amount))});const o=(0,C.Lr)(e,t),l=(0,C.Lr)(o,_e),i=Math.round(l),n=(0,C.e3)(i-l),d=(0,C.id)(re,1)?0:(0,C.e3)(t/2),a=(0,C.id)(re,1)?0:(0,C.e3)(t/2),r=(0,C.id)(re,1)?(0,C.e3)(t):0;return{totalTaxable:(0,C.e3)(e),totalTax:(0,C.e3)(t),cgst:d,sgst:a,igst:r,roundOff:n,invoiceTotal:i}},[L,u.products,re,ae,de,_e]);(0,i.useEffect)(()=>{null!==Ie&&void 0!==Ie&&Ie.roundOff&&(null===Ie||void 0===Ie?void 0:Ie.roundOff)!==p.Round_off&&I(e=>(0,l.A)((0,l.A)({},e),{},{Round_off:Ie.roundOff}))},[null===Ie||void 0===Ie?void 0:Ie.roundOff]);const he=()=>{I(P.Q4),F([]),W([]),q([])},Ae=()=>{(0,C.gf)(null===p||void 0===p?void 0:p.Do_Id)&&0===(0,C.iw)(null===p||void 0===p?void 0:p.Alter_Reason).length?S.oR.warn("Alter reason is required"):!1!==oe.forceCreateInvoice||!1!==ye?(0,R.z)({address:"sales/salesInvoice",method:(0,C.IQ)(null===p||void 0===p?void 0:p.Do_Id)?"PUT":"POST",loadingOff:o,loadingOn:t,bodyData:(0,l.A)((0,l.A)({},p),{},{deliveryAddressDetails:{delivery_id:null===h||void 0===h?void 0:h.id,deliveryName:null===h||void 0===h?void 0:h.deliveryName,phoneNumber:null===h||void 0===h?void 0:h.phoneNumber,cityName:null===h||void 0===h?void 0:h.cityName,deliveryAddress:null===h||void 0===h?void 0:h.deliveryAddress,gstNumber:null===h||void 0===h?void 0:h.gstNumber,stateName:null===h||void 0===h?void 0:h.stateName},shipingAddressDetails:{delivery_id:null===y||void 0===y?void 0:y.id,deliveryName:null===y||void 0===y?void 0:y.deliveryName,phoneNumber:null===y||void 0===y?void 0:y.phoneNumber,cityName:null===y||void 0===y?void 0:y.cityName,deliveryAddress:null===y||void 0===y?void 0:y.deliveryAddress,gstNumber:null===y||void 0===y?void 0:y.gstNumber,stateName:null===y||void 0===y?void 0:y.stateName},Product_Array:L.map((e,t)=>(0,l.A)((0,l.A)({},e),{},{S_No:t+1})),Staffs_Array:Array.from(new Map(Y.filter(e=>(0,C.gf)(e.Emp_Id)&&(0,C.gf)(e.Emp_Type_Id)).map(e=>["".concat(e.Emp_Id,"-").concat(e.Emp_Type_Id),e])).values()),Expence_Array:$})}).then(e=>{if(e.success){var t;const o=null===(t=e.others)||void 0===t?void 0:t.Do_Id;S.oR.success(e.message),ve({open:!0,Do_Id:o,deliverySlipDialog:!1})}else S.oR.warn(e.message)}).catch(e=>{console.error(e),S.oR.error("Failed to save invoice")}):le(e=>(0,l.A)((0,l.A)({},e),{},{dialog:!0}))},ge=(0,i.useMemo)(()=>{const e=me?3:1;return{stockSeparation:ee(u.moduleConfiguration,"SI_1",e),singleGodown:ee(u.moduleConfiguration,"SI_3",e),creditAmountLimit:ee(u.moduleConfiguration,"SI_4",e),creditDaysLimit:ee(u.moduleConfiguration,"SI_5",e),voucherBasedGodown:ee(u.moduleConfiguration,"SI_6",e)}},[u.moduleConfiguration,me]),ye=(0,i.useMemo)(()=>{const{outstanding:e,creditLimit:t,creditDays:o,recentDate:l,forceCreateInvoice:i}=oe;if(i)return!0;if(!l)return!0;const n=new Date(l),d=new Date(n);d.setDate(d.getDate()+(0,C.Ro)(o));const a=new Date,r=(null===Ie||void 0===Ie?void 0:Ie.invoiceTotal)||0,s=(0,C.Ro)(t)>0&&(0,C.Lr)((0,C.Ro)(e),r)>(0,C.Ro)(t),c=(0,C.Ro)(o)>0&&a>d;return(!ge.creditAmountLimit||!s)&&(!ge.creditDaysLimit||!c)},[oe,ge,null===Ie||void 0===Ie?void 0:Ie.invoiceTotal]),fe=(0,i.useMemo)(()=>{if(!ge.voucherBasedGodown)return!0;if(me)return!0;const e=u.voucherType.find(e=>(0,C.id)(e.Vocher_Type_Id,p.Voucher_Type))||{},t=(0,C.Ro)(null===e||void 0===e?void 0:e.GodownId);return L.length>0&&L.every(e=>(0,C.id)(null===e||void 0===e?void 0:e.GoDown_Id,t))},[u.voucherType,p.Voucher_Type,L,me,ge.voucherBasedGodown]),xe=(0,i.useMemo)(()=>{var e;if(!ge.singleGodown)return!0;if(L.length<=1)return!0;const t=null===(e=L[0])||void 0===e?void 0:e.GoDown_Id;return L.every(e=>(0,C.id)(null===e||void 0===e?void 0:e.GoDown_Id,t))},[L,ge.singleGodown]),be=(0,i.useMemo)(()=>{if(!ge.stockSeparation)return!0;if(0===L.length)return!0;const e=L.some(e=>{const t=(0,C.Ro)(null===e||void 0===e?void 0:e.Godown_Stock),o=(0,C.Ro)(null===e||void 0===e?void 0:e.Bill_Qty);return(0,C.DG)(t,o)>=0}),t=L.some(e=>{const t=(0,C.Ro)(null===e||void 0===e?void 0:e.Godown_Stock),o=(0,C.Ro)(null===e||void 0===e?void 0:e.Bill_Qty);return(0,C.DG)(t,o)<0});return!(e&&t)},[L,ge.stockSeparation]),je=(0,i.useMemo)(()=>{if(L.length>0){const e=L.reduce((e,t)=>({Act_Qty:(0,C.Lr)(e.Act_Qty,t.Act_Qty),Alt_Act_Qty:(0,C.Lr)(e.Alt_Act_Qty,t.Alt_Act_Qty),Bill_Qty:(0,C.Lr)(e.Bill_Qty,t.Bill_Qty),Alt_Bill_Qty:(0,C.Lr)(e.Alt_Bill_Qty,t.Alt_Bill_Qty),Amount:(0,C.Lr)(e.Amount,t.Amount)}),{Act_Qty:0,Alt_Act_Qty:0,Bill_Qty:0,Alt_Bill_Qty:0,Amount:0});return(0,l.A)((0,l.A)((0,l.A)({},P.a4),e),{},{Item_Name:"Total",Item_Id:"TOTAL_ROW"})}return null},[L]),Ne=()=>{fe?Ae():_(e=>(0,l.A)((0,l.A)({},e),{},{godownMismatch:!0}))};return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(X,{orderProducts:L,setOrderProducts:F,open:m.addProductDialog,onClose:()=>{_(e=>(0,l.A)((0,l.A)({},e),{},{addProductDialog:!1})),ne(null)},products:u.products,brands:u.brand,uom:u.uom,godowns:u.godown,GST_Inclusive:p.GST_Inclusive,IS_IGST:re,editValues:ie,initialValue:(0,l.A)((0,l.A)({},P.a4),{},{Pre_Id:p.So_No,rowId:(0,C.aG)()}),batchDetails:u.batchDetails,saleOrderNumber:(0,C.Ro)(p.So_No),voucherType:p}),(0,A.jsxs)(n.A,{children:[(0,A.jsxs)("div",{className:"d-flex flex-wrap align-items-center border-bottom py-2 px-3",children:[(0,A.jsx)("span",{className:"flex-grow-1 fa-16 fw-bold",children:"Sales Invoice"}),(0,A.jsxs)("span",{children:[(0,A.jsx)(d.A,{type:"button",onClick:()=>{window.history.length>1?s(-1):s("/erp/sales/invoice")},children:"Cancel"}),(0,A.jsx)(d.A,{onClick:Ne,variant:"contained",disabled:!be||!xe,children:"submit"})]})]}),(0,A.jsxs)(a.A,{children:[(0,A.jsxs)("div",{className:"row p-0",children:[(0,A.jsx)("div",{className:"col-xxl-3 col-lg-4 col-md-5 p-2",children:(0,A.jsx)("div",{className:"border p-2",style:{minHeight:"30vh",height:"100%"},children:(0,A.jsx)(M,{StaffArray:Y,setStaffArray:q,costCenter:u.staff,costCategory:u.staffType})})}),(0,A.jsx)("div",{className:"col-xxl-9 col-lg-8 col-md-7 py-2 px-0",children:(0,A.jsx)("div",{className:"border px-3 py-1",style:{minHeight:"30vh",height:"100%"},children:(0,A.jsx)(z.A,{invoiceInfo:p,setInvoiceInfo:I,retailers:u.retailers,branches:u.branch,voucherType:u.voucherType,stockItemLedgerName:u.stockItemLedgerName,onChangeRetailer:()=>{},retailerDeliveryAddress:h,setRetailerDeliveryAddress:g,shippingAddress:y,setShippingAddress:k,retailerSalesStatus:(0,l.A)((0,l.A)({},oe),{},{invoiceCreationStatus:ye}),staffArray:Y,setStaffArray:q,salesInvoiceAccess:ge})})})]}),!be&&ge.stockSeparation&&(0,A.jsx)("div",{className:"alert alert-danger p-2 mb-2",children:"Can't save invoice with mixed stock (positive and negative). Please ensure all items have either positive or negative stock."}),!xe&&ge.singleGodown&&(0,A.jsx)("div",{className:"alert alert-danger p-2 mb-2",children:"Can't save invoice with multiple godowns. Please ensure all items are from a single godown."}),(0,A.jsx)(E.Ay,{title:"Items",headerFontSizePx:13,bodyFontSizePx:13,EnableSerialNumber:!0,disablePagination:!0,ButtonArea:(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(d.A,{onClick:()=>{ne(null),_(e=>(0,l.A)((0,l.A)({},e),{},{addProductDialog:!0}))},sx:{ml:1},variant:"outlined",type:"button",startIcon:(0,A.jsx)(D.A,{}),disabled:!(0,C.IQ)(p.Retailer_Id)||L.length>0&&(0,C.IQ)(p.So_No),children:"Add Product"}),(0,A.jsx)(V.A,{loadingOn:t,loadingOff:o,open:m.importFromSaleOrder,onClose:()=>_(e=>(0,l.A)((0,l.A)({},e),{},{importFromSaleOrder:!1})),retailer:null===p||void 0===p?void 0:p.Retailer_Id,selectedItems:L,setSelectedItems:F,staffArray:Y,setStaffArray:q,products:u.products,GST_Inclusive:p.GST_Inclusive,IS_IGST:re,invoiceInfo:p,setInvoiceInfo:I,godowns:u.godown,stockInGodown:u.stockInGodown,children:(0,A.jsx)(d.A,{onClick:()=>_(e=>(0,l.A)((0,l.A)({},e),{},{importFromSaleOrder:!0})),disabled:!(0,C.IQ)(p.Retailer_Id)||L.length>0&&!(0,C.IQ)(p.So_No),sx:{ml:1},type:"button",variant:"outlined",startIcon:(0,A.jsx)(T.A,{}),children:"Choose Sale Order"})})]}),dataArray:[...L,...Array.from({length:ce>0?ce:0}).map(e=>P.a4),...je?[je]:[]],columns:[(0,E.Lj)("Item_Name","string"),(0,E.Lj)("Batch_Name","string"),{isVisible:1,ColumnHeader:"Act Qty",isCustomCell:!0,Cell:e=>{let{row:t}=e;return null!==t&&void 0!==t&&t.Act_Qty?"".concat(null===t||void 0===t?void 0:t.Act_Qty," (").concat(null===t||void 0===t?void 0:t.Alt_Act_Qty,")"):""}},{isVisible:1,ColumnHeader:"Bill Qty",isCustomCell:!0,Cell:e=>{let{row:t}=e;return null!==t&&void 0!==t&&t.Bill_Qty?"".concat(null===t||void 0===t?void 0:t.Bill_Qty," (").concat(null===t||void 0===t?void 0:t.Alt_Bill_Qty,")"):""}},(0,E.Lj)("Item_Rate","number"),{isVisible:1,ColumnHeader:"Tax",isCustomCell:!0,Cell:e=>{let{row:t}=e;const{Cgst:o=0,Sgst:l=0,Igst:i=0,Cgst_Amo:n=0,Sgst_Amo:d=0,Igst_Amo:a=0}=t,r=re?i:(0,C.Lr)(o,l),s=re?a:(0,C.Lr)(n,d);return(0,C.IQ)(null===t||void 0===t?void 0:t.Item_Id)?"".concat(s," - (").concat(r," %)"):""}},{isVisible:1,ColumnHeader:"Godown",isCustomCell:!0,Cell:e=>{var t,o;let{row:l}=e;return null!==(t=null===(o=u.godown.find(e=>(0,C.id)(e.Godown_Id,null===l||void 0===l?void 0:l.GoDown_Id)))||void 0===o?void 0:o.Godown_Name)&&void 0!==t?t:""}},(0,E.Lj)("Amount","number"),{isCustomCell:!0,Cell:e=>{let{row:t}=e;return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(r.A,{onClick:()=>{ne(t),_(e=>(0,l.A)((0,l.A)({},e),{},{addProductDialog:!0}))},size:"small",type:"button",disabled:!(0,C.IQ)(null===t||void 0===t?void 0:t.Item_Id),children:(0,A.jsx)(G.A,{})}),(0,A.jsx)(r.A,{size:"small",type:"button",onClick:()=>F(e=>e.filter(e=>e.rowId!==t.rowId)),color:"error",disabled:!(0,C.IQ)(null===t||void 0===t?void 0:t.Item_Id),children:(0,A.jsx)(Q.A,{})})]})},ColumnHeader:"Action",isVisible:1}]}),(0,A.jsx)("br",{}),(0,A.jsx)(H.A,{invoiceExpences:$,setInvoiceExpences:W,expenceMaster:u.expence,IS_IGST:re,taxType:se,Total_Invoice_value:pe,invoiceProducts:L,findProductDetails:te,products:u.products}),(0,A.jsx)("br",{}),(0,A.jsx)(U.A,{invoiceExpences:$,isNotTaxableBill:ae,isInclusive:de,IS_IGST:re,products:u.products,invoiceInfo:p,setInvoiceInfo:I,invExpencesTotal:_e,Total_Invoice_value:pe,taxSplitUp:Ie}),(0,A.jsx)("label",{className:"fa-13",children:"Narration"}),(0,A.jsx)("textarea",{className:"cus-inpt fa-14",rows:2,value:p.Narration,onChange:e=>I(t=>(0,l.A)((0,l.A)({},t),{},{Narration:e.target.value}))})]}),(0,A.jsxs)(f,{className:"d-flex justify-content-end",children:[(0,A.jsx)(d.A,{type:"button",onClick:()=>{window.history.length>1?s(-1):s("/erp/sales/invoice")},children:"Cancel"}),(0,A.jsx)(d.A,{onClick:Ne,variant:"contained",disabled:!be,children:"submit"})]})]}),(0,A.jsx)(Z.A,{open:m.godownMismatch,onClose:()=>_(e=>(0,l.A)((0,l.A)({},e),{},{godownMismatch:!1})),title:"Godown Mismatch",submitText:"Yes",closeText:"No",onSubmit:()=>{_(e=>(0,l.A)((0,l.A)({},e),{},{godownMismatch:!1})),Ae()},children:"The godown is not match with Voucher type anyway do you want to save?"}),(0,A.jsxs)(Z.A,{open:oe.dialog,onClose:()=>le(e=>(0,l.A)((0,l.A)({},e),{},{dialog:!1})),title:"Retailer Sales Status",onSubmit:()=>{le(e=>(0,l.A)((0,l.A)({},e),{},{dialog:!1,forceCreateInvoice:!0})),Ae()},submitText:"Yes",closeText:"No",maxWidth:"sm",fullWidth:!0,isSubmit:!0,children:[(0,A.jsx)("h3",{children:"The Retailer Exceeds the credit limit and credit days!"}),(0,A.jsx)("p",{children:"Anyway Do you want to create invoice?"})]}),(0,A.jsxs)(x.A,{open:ue.open,maxWidth:"lg",fullWidth:!0,scroll:"paper",onClose:()=>{ve({open:!1,Do_Id:null,deliverySlipDialog:!1}),he(),s("/erp/sales/invoice")},children:[(0,A.jsxs)(b.A,{className:"d-flex align-items-center justify-content-between",children:[(0,A.jsxs)("span",{children:["Print Invoice #",ue.Do_Id]}),(0,A.jsxs)("div",{className:"d-flex align-items-center",children:[(0,A.jsx)(d.A,{variant:"outlined",size:"small",onClick:()=>{ve({open:!1,Do_Id:ue.Do_Id,deliverySlipDialog:!0})},sx:{mr:1},children:"Delivery Slip"}),(0,A.jsx)(r.A,{onClick:()=>{ve({open:!1,Do_Id:null,deliverySlipDialog:!1}),he(),s("/erp/sales/invoice")},size:"small",children:(0,A.jsx)(w.A,{})})]})]}),(0,A.jsx)(j.A,{children:ue.Do_Id&&(0,A.jsx)(J.A,{Do_Id:ue.Do_Id,loadingOn:t,loadingOff:o})}),(0,A.jsx)(N.A,{children:(0,A.jsx)(d.A,{onClick:()=>{ve({open:!1,Do_Id:null,deliverySlipDialog:!1}),he(),s("/erp/sales/invoice")},children:"Close and Go to Listing"})})]}),(0,A.jsxs)(x.A,{open:ue.deliverySlipDialog||!1,onClose:()=>{ve({open:!1,Do_Id:null,deliverySlipDialog:!1}),s("/erp/sales/invoice")},maxWidth:"lg",fullWidth:!0,scroll:"paper",children:[(0,A.jsxs)(b.A,{className:"d-flex align-items-center justify-content-between",children:[(0,A.jsxs)("span",{children:["Delivery Slip for Invoice #",ue.Do_Id]}),(0,A.jsx)(r.A,{onClick:()=>{ve({open:!1,Do_Id:null,deliverySlipDialog:!1}),s("/erp/sales/invoice")},size:"small",children:(0,A.jsx)(w.A,{})})]}),(0,A.jsx)(j.A,{children:ue.Do_Id&&(0,A.jsx)(K.A,{Do_Id:ue.Do_Id,loadingOn:t,loadingOff:o})}),(0,A.jsx)(N.A,{children:(0,A.jsx)(d.A,{onClick:()=>{ve({open:!1,Do_Id:null,deliverySlipDialog:!1}),s("/erp/sales/invoice")},children:"Close"})})]})]})}},30513:(e,t,o)=>{o.d(t,{A:()=>n});var l=o(59662),i=o(70579);const n=(0,l.A)((0,i.jsx)("path",{d:"M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3m-3 11H8v-5h8zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1m-1-9H6v4h12z"}),"Print")},44676:(e,t,o)=>{o.d(t,{A:()=>n});var l=o(59662),i=o(70579);const n=(0,l.A)([(0,i.jsx)("path",{d:"M19.5 3.5 18 2l-1.5 1.5L15 2l-1.5 1.5L12 2l-1.5 1.5L9 2 7.5 3.5 6 2v14H3v3c0 1.66 1.34 3 3 3h12c1.66 0 3-1.34 3-3V2zM19 19c0 .55-.45 1-1 1s-1-.45-1-1v-3H8V5h11z"},"0"),(0,i.jsx)("path",{d:"M9 7h6v2H9zm7 0h2v2h-2zm-7 3h6v2H9zm7 0h2v2h-2z"},"1")],"ReceiptLong")}}]);
//# sourceMappingURL=5233.da143344.chunk.js.map